
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,l,a){b instanceof String&&(b=String(b));for(var d=b.length,c=0;c<d;c++){var e=b[c];if(l.call(a,e,c,b))return{i:c,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,l,a){b!=Array.prototype&&b!=Object.prototype&&(b[l]=a.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,l,a,d){if(l){a=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var c=b[d];c in a||(a[c]={});a=a[c]}b=b[b.length-1];d=a[b];l=l(d);l!=d&&null!=l&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:l})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(l){return $jscomp.SYMBOL_PREFIX+(l||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var l=0;return $jscomp.iteratorPrototype(function(){return l<b.length?{done:!1,value:b[l++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,l){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var a=0,d={next:function(){if(a<b.length){var c=a++;return{value:l(c,b[c]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");$jscomp.polyfill("Array.from",function(b){return b?b:function(b,a,d){$jscomp.initSymbolIterator();a=null!=a?a:function(a){return a};var c=[],e=b[Symbol.iterator];if("function"==typeof e)for(b=e.call(b);!(e=b.next()).done;)c.push(a.call(d,e.value));else{e=b.length;for(var f=0;f<e;f++)c.push(a.call(d,b[f]))}return c}},"es6","es3");
var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(b){function l(a){return/^[-+]?[0-9]+$/.test(a)}function a(a){if(null==a)return a;switch(typeof a){case "string":a=String(a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case "object":if(Array.isArray(a)){a=b.extend(!0,[],a);for(var e=0;e<a.length;e++)a[e]=this.encodeTags(a[e])}else for(e in a=b.extend(!0,{},a),a)a[e]=this.encodeTags(a[e])}return a}function d(){try{return localStorage.setItem("w2ui_test",
"w2ui_test"),localStorage.removeItem("w2ui_test"),!0}catch(e){return!1}}var c={};return{version:"1.5.x",settings:{locale:"tr-tr",dateFormat:"dd/mm/yyyy",timeFormat:"h24",datetimeFormat:"dd/mm/yyyy|hh24:mm:ss",currency:"^[-+]?[0-9]*[\\.]?[0-9]+\\&#x20BA;$",currencyPrefix:"",currencyPrecision:2,currencySuffix:"&#x20BA;",groupSymbol:",",decimalSymbol:",","float":"^[-+]?[0-9]*[\\.,]?[0-9]+$",shortmonths:"Oca \u015eub Mar May Nis Haz Tem A\u011fu Eyl Ekm Kas Ara".split(" "),fullmonths:"Ocak \u015eubat Mart Nisan May\u0131s Haziran Temmuz A\u011fustos Eyl\u00fcl Ekim Kas\u0131m Aral\u0131k".split(" "),
shortdays:"Pts Sa \u00c7a Pe Cu Ct Pz".split(" "),fulldays:"Pazartesi Sal\u0131 \u00c7ar\u015famba Per\u015fembe Cuma Cumartesi Pazar".split(" "),weekStarts:"M",dataType:"HTTPJSON",dateStartYear:1950,dateEndYear:2040,macButtonOrder:!1,phrases:{"Add new record":"Yeni kay\u0131t ekle","Add New":"Yeni Ekle","All Fields":"T\u00fcm Alanlar","Are you sure you want to delete selected records?":"Se\u00e7ili kay\u0131tlar\u0131 silmek istedi\u011finize emin misiniz?","Attach files by dragging and dropping or Click to Select":"S\u00fcr\u00fckle b\u0131rak ile dosya ekle ve se\u00e7mek i\u00e7in t\u0131kla",
"begins with":"\u015fununla ba\u015flayan",begins:"ba\u015flayan",between:"\u015funlar\u0131n aras\u0131nda",buffered:"buferde",Cancel:"\u0130ptal",Confirmation:"Onay",contains:"\u015funu i\u00e7eren","Delete Confirmation":"Silme \u0130\u015flemi Onay\u0131","Delete selected records":"Se\u00e7ili kay\u0131tlar\u0131 sil",Delete:"Sil","Edit selected record":"Se\u00e7ilmi\u015fler de\u011fi\u015f",Edit:"De\u011fi\u015f","ends with":"\u015fununla biten",ends:"biten",Hide:"Gizle","in":"\u015funlardan biri",
is:"\u015fu olan","Multi Fields":"\u00c7oklu Alanlar","No items found":"Hi\u00e7bir madde bulunamad\u0131",No:"Hay\u0131r",none:"hi\u00e7biri","Not a float":"Ondal\u0131kl\u0131 say\u0131 de\u011fil","Not a hex number":"HEX format\u0131 uygun de\u011fil","Not a valid date":"Ge\u00e7erli bir tarih de\u011fil","Not a valid email":"E-posta uygun de\u011fil","Not alpha-numeric":"Alfasay\u0131sal de\u011fil","Not an integer":"Tam say\u0131 de\u011fil","Not in money format":"Para format\u0131 uygun de\u011fil",
"not in":"i\u00e7ermeyen",Notification:"Bildirim",of:"/",Ok:"Tamam","Open Search Fields":"Arama Alanlar\u0131n\u0131 A\u00e7","Record ID":"Kay\u0131t ID",Records:"Kay\u0131tlar","Refreshing...":"Yenileniyor...","Reload data in the list":"Listeyi yeniden y\u00fckle",Remove:"Kald\u0131r","Required field":"Gerekli alan","Reset Column Size":"S\u00fctun Geni\u015fli\u011fini S\u0131f\u0131rla",Reset:"S\u0131f\u0131rla","Restore Default State":"Varsay\u0131lanlar\u0131 d\u00f6n","Return data is not in JSON format. See console for more information.":"Gelen veri JSON format\u0131nda de\u011fil. Bilgi i\u00e7in konsola bak\u0131n\u0131z.",
"Save changed records":"De\u011fi\u015fiklikleri kaydet","Save Grid State":"Gridin durumunu ekle",Save:"Kaydet","Saving...":"Kaydediliyor...",Search:"Ara","Search...":"Ara...",sec:"san","Select Search Field":"Arama Alan\u0131n\u0131 Se\u00e7",selected:"se\u00e7ilmi\u015f","Server Response":"Serverin cavab\u0131",Show:"G\u00f6ster","Show/hide columns":"S\u00fctunlar\u0131 g\u00f6ster/gizle",Skip:"\u00d6t\u00fcr","Toggle Line Numbers":"Sat\u0131r Num. G\u00f6ster/Gizle",Yes:"Evet",Yesterday:"D\u00fcn"}},
isBin:function(a){return/^[0-1]+$/.test(a)},isInt:l,isFloat:function(a){"string"===typeof a&&(a=a.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,"."));return("number"===typeof a||"string"===typeof a&&""!==a)&&!isNaN(Number(a))},isMoney:function(a){var e=w2utils.settings,b=new RegExp("^"+(e.currencyPrefix?"\\"+e.currencyPrefix+"?":"")+"[-+]?"+(e.currencyPrefix?"\\"+e.currencyPrefix+"?":"")+"[0-9]*[\\"+e.decimalSymbol+"]?[0-9]+"+(e.currencySuffix?
"\\"+e.currencySuffix+"?":"")+"$","i");"string"===typeof a&&(a=a.replace(new RegExp(e.groupSymbol,"g"),""));return"object"===typeof a||""===a?!1:b.test(a)},isHex:function(a){return/^(0x)?[0-9a-fA-F]+$/.test(a)},isAlphaNumeric:function(a){return/^[a-zA-Z0-9_-]+$/.test(a)},isEmail:function(a){return/^[a-zA-Z0-9._%\-+]+@[\u0430-\u044f\u0410-\u042fa-zA-Z0-9.-]+\.[\u0430-\u044f\u0410-\u042fa-zA-Z]+$/.test(a)},isIpAddress:function(a){return/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?).){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(a)},
isDate:function(a,b,c){if(!a)return!1;null==b&&(b=w2utils.settings.dateFormat);if("function"===typeof a.getFullYear){var e=a.getFullYear();var d=a.getMonth()+1;var f=a.getDate()}else if(parseInt(a)==a&&0<parseInt(a))a=new Date(parseInt(a)),e=a.getFullYear(),d=a.getMonth()+1,f=a.getDate();else{a=String(a);if(/mon/ig.test(b)){b=b.replace(/month/ig,"m").replace(/mon/ig,"m").replace(/dd/ig,"d").replace(/[, ]/ig,"/").replace(/\/\//g,"/").toLowerCase();a=a.replace(/[, ]/ig,"/").replace(/\/\//g,"/").toLowerCase();
for(var g=0,p=w2utils.settings.fullmonths.length;g<p;g++){var v=w2utils.settings.fullmonths[g];a=a.replace(new RegExp(v,"ig"),parseInt(g)+1).replace(new RegExp(v.substr(0,3),"ig"),parseInt(g)+1)}}a=a.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/");b=b.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===b&&(d=a[0],f=a[1],e=a[2]);"m/d/yyyy"===b&&(d=a[0],f=a[1],e=a[2]);"dd/mm/yyyy"===b&&(d=a[1],f=a[0],e=a[2]);"d/m/yyyy"===b&&(d=a[1],f=a[0],e=a[2]);"yyyy/dd/mm"===b&&(d=a[2],
f=a[1],e=a[0]);"yyyy/d/m"===b&&(d=a[2],f=a[1],e=a[0]);"yyyy/mm/dd"===b&&(d=a[1],f=a[2],e=a[0]);"yyyy/m/d"===b&&(d=a[1],f=a[2],e=a[0]);"mm/dd/yy"===b&&(d=a[0],f=a[1],e=a[2]);"m/d/yy"===b&&(d=a[0],f=a[1],e=parseInt(a[2])+1900);"dd/mm/yy"===b&&(d=a[1],f=a[0],e=parseInt(a[2])+1900);"d/m/yy"===b&&(d=a[1],f=a[0],e=parseInt(a[2])+1900);"yy/dd/mm"===b&&(d=a[2],f=a[1],e=parseInt(a[0])+1900);"yy/d/m"===b&&(d=a[2],f=a[1],e=parseInt(a[0])+1900);"yy/mm/dd"===b&&(d=a[1],f=a[2],e=parseInt(a[0])+1900);"yy/m/d"===
b&&(d=a[1],f=a[2],e=parseInt(a[0])+1900)}if(!l(e)||!l(d)||!l(f))return!1;e=+e;d=+d;f=+f;b=new Date(e,d-1,f);return null===d||"Invalid Date"===String(b)||b.getMonth()+1!==d||b.getDate()!==f||b.getFullYear()!==e?!1:!0===c?b:!0},isTime:function(a,c){if(null==a)return!1;var e;a=String(a);a=a.toUpperCase();var d=0<=a.indexOf("AM");var f=(e=0<=a.indexOf("PM"))||d;var n=f?12:24;a=a.replace("AM","").replace("PM","");a=b.trim(a);a=a.split(":");var m=parseInt(a[0]||0),p=parseInt(a[1]||0),v=parseInt(a[2]||0);
return(!f||1!==a.length)&&2!==a.length&&3!==a.length||""===a[0]||0>m||m>n||!this.isInt(a[0])||2<a[0].length||1<a.length&&(""===a[1]||0>p||59<p||!this.isInt(a[1])||2!==a[1].length)||2<a.length&&(""===a[2]||0>v||59<v||!this.isInt(a[2])||2!==a[2].length)||!f&&n===m&&(0!==p||0!==v)||f&&1===a.length&&0===m?!1:!0===c?(e&&12!==m&&(m+=12),d&&12===m&&(m+=12),{hours:m,minutes:p,seconds:v}):!0},isDateTime:function(a,b,c){null==b&&(b=w2utils.settings.datetimeFormat);b=b.split("|");if("function"===typeof a.getFullYear)return!0!==
c?!0:a;if(parseInt(a)===a&&0<=parseInt(a))return a=new Date(parseInt(a)),!0!==c?!0:a;if(parseInt(a)===a&&0>parseInt(a))return!1;var e=String(a).indexOf(" ");a=[a.substr(0,e),a.substr(e).trim()];b[0]=b[0].trim();b[1]&&(b[1]=b[1].trim());b=w2utils.isDate(a[0],b[0],!0);a=w2utils.isTime(a[1],!0);if(!1!==b&&!1!==a){if(!0!==c)return!0;b.setHours(a.hours);b.setMinutes(a.minutes);b.setSeconds(a.seconds);return b}return!1},age:function(a){if(""===a||null==a)return"";a="function"===typeof a.getFullYear?a:parseInt(a)==
a&&0<parseInt(a)?new Date(parseInt(a)):new Date(a);if("Invalid Date"===String(a))return"";a=((new Date).getTime()-a.getTime())/1E3;var b="",e="";0>a?(b=0,e="sec"):60>a?(b=Math.floor(a),e="sec",0>a&&(b=0,e="sec")):3600>a?(b=Math.floor(a/60),e="min"):86400>a?(b=Math.floor(a/60/60),e="hour"):2592E3>a?(b=Math.floor(a/24/60/60),e="day"):31536E3>a?(b=Math.floor(a/30/24/60/60*10)/10,e="month"):126144E3>a?(b=Math.floor(a/365/24/60/60*10)/10,e="year"):126144E3<=a&&(b=Math.floor(a/365.25/24/60/60*10)/10,e=
"year");return b+" "+e+(1<b?"s":"")},interval:function(a){return 1E3>a?"< 1 sec":6E4>a?Math.floor(a/1E3)+" secs":36E5>a?Math.floor(a/6E4)+" mins":864E5>a?Math.floor(a/36E5*10)/10+" hours":2628E6>a?Math.floor(a/864E5*10)/10+" days":31536E6>a?Math.floor(a/2628E6*10)/10+" months":Math.floor(a/31536E5)/10+" years"},date:function(a){if(""===a||null==a||"object"===typeof a&&!a.getMonth)return"";var b=new Date(a);w2utils.isInt(a)&&(b=new Date(Number(a)));if("Invalid Date"===String(b))return"";var e=w2utils.settings.shortmonths,
c=new Date,d=new Date;d.setTime(d.getTime()-864E5);a=e[b.getMonth()]+" "+b.getDate()+", "+b.getFullYear();c=e[c.getMonth()]+" "+c.getDate()+", "+c.getFullYear();e=e[d.getMonth()]+" "+d.getDate()+", "+d.getFullYear();d=b.getHours()-(12<b.getHours()?12:0)+":"+(10>b.getMinutes()?"0":"")+b.getMinutes()+" "+(12<=b.getHours()?"pm":"am");b=b.getHours()-(12<b.getHours()?12:0)+":"+(10>b.getMinutes()?"0":"")+b.getMinutes()+":"+(10>b.getSeconds()?"0":"")+b.getSeconds()+" "+(12<=b.getHours()?"pm":"am");var n=
a;a===c&&(n=d);a===e&&(n=w2utils.lang("Yesterday"));return'<span title="'+a+" "+b+'">'+n+"</span>"},formatSize:function(a){if(!w2utils.isFloat(a)||""===a)return"";a=parseFloat(a);if(0===a)return 0;var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(Math.floor(a/Math.pow(1024,b)*10)/10).toFixed(0===b?0:1)+" "+("Bt KB MB GB TB PB EB ZB".split(" ")[b]||"??")},formatNumber:function(a,b,c){if(null==a||""===a||"object"===typeof a)return"";c={minimumFractionDigits:b,maximumFractionDigits:b,useGrouping:c};
if(null==b||0>b)c.minimumFractionDigits=0,c.maximumFractionDigits=20;return parseFloat(a).toLocaleString(w2utils.settings.locale,c)},formatDate:function(a,b){b||(b=this.settings.dateFormat);if(""===a||null==a||"object"===typeof a&&!a.getMonth)return"";"string"===typeof a&&(a=a.replace(" 00:00:00",""));var e="string"===typeof a&&19===a.length?w2utils.isDateTime(a,w2utils.settings.datetimeFormat,!0):w2utils.isDate(a,w2utils.settings.dateFormat,!0);if(!1===e)return"";e=new Date(e.getTime());w2utils.isInt(a)&&
(e=new Date(Number(a)));if("Invalid Date"===String(e))return"";a=e.getFullYear();var c=e.getMonth();e=e.getDate();return b.toLowerCase().replace("month",w2utils.settings.fullmonths[c]).replace("mon",w2utils.settings.shortmonths[c]).replace(/yyyy/g,a).replace(/yyy/g,a).replace(/yy/g,2E3<a?100+parseInt(String(a).substr(2)):String(a).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+a).replace(/mm/g,(10>c+1?"0":"")+(c+1)).replace(/dd/g,(10>e?"0":"")+e).replace(/th/g,1==e?"st":"th").replace(/th/g,2==e?"nd":"th").replace(/th/g,
3==e?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(c+1)).replace(/(^|[^a-z$])d/g,"$1"+e)},formatTime:function(a,b){b||(b=this.settings.timeFormat);if(""===a||null==a||"object"===typeof a&&!a.getMonth)return"";var e=new Date(a);w2utils.isInt(a)&&(e=new Date(Number(a)));w2utils.isTime(a)&&(a=w2utils.isTime(a,!0),e=new Date,e.setHours(a.hours),e.setMinutes(a.minutes));if("Invalid Date"===String(e))return"";a="am";var c=e.getHours(),d=e.getHours(),f=e.getMinutes();e=e.getSeconds();10>f&&(f="0"+f);10>e&&(e=
"0"+e);if(-1!==b.indexOf("am")||-1!==b.indexOf("pm"))12<=c&&(a="pm"),12<c&&(c-=12),0===c&&(c=12);return b.toLowerCase().replace("am",a).replace("pm",a).replace("hhh",10>c?"0"+c:c).replace("hh24",10>d?"0"+d:d).replace("h24",d).replace("hh",c).replace("mm",f).replace("mi",f).replace("ss",e).replace(/(^|[^a-z$])h/g,"$1"+c).replace(/(^|[^a-z$])m/g,"$1"+f).replace(/(^|[^a-z$])s/g,"$1"+e)},formatDateTime:function(a,b){if(""===a||null==a||"object"===typeof a&&!a.getMonth)return"";"string"!==typeof b?b=[this.settings.dateFormat,
this.settings.timeFormat]:(b=b.split("|"),b[0]=b[0].trim(),b[1]=1<b.length?b[1].trim():this.settings.timeFormat);"h12"===b[1]&&(b[1]="h:m pm");"h24"===b[1]&&(b[1]="h24:m");return this.formatDate(a,b[0])+" "+this.formatTime(a,b[1])},stripTags:function(a){if(null==a)return a;switch(typeof a){case "string":a=String(a).replace(/<(?:[^>=]|='[^']*'|="[^"]*"|=[^'"][^\s>]*)*>/ig,"");break;case "object":if(Array.isArray(a)){a=b.extend(!0,[],a);for(var e=0;e<a.length;e++)a[e]=this.stripTags(a[e])}else for(e in a=
b.extend(!0,{},a),a)a[e]=this.stripTags(a[e])}return a},encodeTags:a,decodeTags:function(a){if(null==a)return a;switch(typeof a){case "string":a=String(a).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case "object":if(Array.isArray(a)){a=b.extend(!0,[],a);for(var e=0;e<a.length;e++)a[e]=this.decodeTags(a[e])}else for(e in a=b.extend(!0,{},a),a)a[e]=this.decodeTags(a[e])}return a},escapeId:function(a){return""===a||null==a?"":String(a).replace(/([;&,\.\+\*~'`:"!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,
"\\$1")},base64encode:function(a){var b="",e,c=0;a=String(a).replace(/\r\n/g,"\n");var d="";for(e=0;e<a.length;e++){var n=a.charCodeAt(e);128>n?d+=String.fromCharCode(n):(127<n&&2048>n?d+=String.fromCharCode(n>>6|192):(d+=String.fromCharCode(n>>12|224),d+=String.fromCharCode(n>>6&63|128)),d+=String.fromCharCode(n&63|128))}for(a=d;c<a.length;){var m=a.charCodeAt(c++);d=a.charCodeAt(c++);e=a.charCodeAt(c++);n=m>>2;m=(m&3)<<4|d>>4;var p=(d&15)<<2|e>>6;var v=e&63;isNaN(d)?p=v=64:isNaN(e)&&(v=64);b=b+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(v)}return b},base64decode:function(a){var b="",e=0;for(a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");e<a.length;){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(e++));
var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(e++));var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(e++));var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(e++));c=c<<2|d>>4;d=(d&15)<<4|n>>2;var p=(n&3)<<6|m;b+=String.fromCharCode(c);64!==n&&(b+=String.fromCharCode(d));64!==m&&(b+=String.fromCharCode(p))}a=b;b="";for(n=0;n<a.length;)m=a.charCodeAt(n),128>m?(b+=String.fromCharCode(m),
n++):191<m&&224>m?(e=a.charCodeAt(n+1),b+=String.fromCharCode((m&31)<<6|e&63),n+=2):(e=a.charCodeAt(n+1),c=a.charCodeAt(n+2),b+=String.fromCharCode((m&15)<<12|(e&63)<<6|c&63),n+=3);return b},md5:function(a){function b(a,b,e,c,d,f){a=n(n(b,a),n(c,f));return n(a<<d|a>>>32-d,e)}function e(a,e,c,d,f,g,h){return b(e&c|~e&d,a,e,f,g,h)}function c(a,e,c,d,f,g,h){return b(e&d|c&~d,a,e,f,g,h)}function d(a,e,c,d,f,g,h){return b(c^(e|~d),a,e,f,g,h)}function n(a,b){var e=(a&65535)+(b&65535);return(a>>16)+(b>>
16)+(e>>16)<<16|e&65535}var m=0;return function(a){try{m=""}catch(w){m=0}for(var b=m?"0123456789ABCDEF":"0123456789abcdef",e="",c,d=0;d<a.length;d++)c=a.charCodeAt(d),e+=b.charAt(c>>>4&15)+b.charAt(c&15);return e}(function(a){for(var f=Array(a.length>>2),g=0;g<f.length;g++)f[g]=0;for(g=0;g<8*a.length;g+=8)f[g>>5]|=(a.charCodeAt(g/8)&255)<<g%32;a=8*a.length;f[a>>5]|=128<<a%32;f[(a+64>>>9<<4)+14]=a;a=1732584193;g=-271733879;for(var h=-1732584194,m=271733878,k=0;k<f.length;k+=16){var p=a,l=g,z=h,q=m;
a=e(a,g,h,m,f[k+0],7,-680876936);m=e(m,a,g,h,f[k+1],12,-389564586);h=e(h,m,a,g,f[k+2],17,606105819);g=e(g,h,m,a,f[k+3],22,-1044525330);a=e(a,g,h,m,f[k+4],7,-176418897);m=e(m,a,g,h,f[k+5],12,1200080426);h=e(h,m,a,g,f[k+6],17,-1473231341);g=e(g,h,m,a,f[k+7],22,-45705983);a=e(a,g,h,m,f[k+8],7,1770035416);m=e(m,a,g,h,f[k+9],12,-1958414417);h=e(h,m,a,g,f[k+10],17,-42063);g=e(g,h,m,a,f[k+11],22,-1990404162);a=e(a,g,h,m,f[k+12],7,1804603682);m=e(m,a,g,h,f[k+13],12,-40341101);h=e(h,m,a,g,f[k+14],17,-1502002290);
g=e(g,h,m,a,f[k+15],22,1236535329);a=c(a,g,h,m,f[k+1],5,-165796510);m=c(m,a,g,h,f[k+6],9,-1069501632);h=c(h,m,a,g,f[k+11],14,643717713);g=c(g,h,m,a,f[k+0],20,-373897302);a=c(a,g,h,m,f[k+5],5,-701558691);m=c(m,a,g,h,f[k+10],9,38016083);h=c(h,m,a,g,f[k+15],14,-660478335);g=c(g,h,m,a,f[k+4],20,-405537848);a=c(a,g,h,m,f[k+9],5,568446438);m=c(m,a,g,h,f[k+14],9,-1019803690);h=c(h,m,a,g,f[k+3],14,-187363961);g=c(g,h,m,a,f[k+8],20,1163531501);a=c(a,g,h,m,f[k+13],5,-1444681467);m=c(m,a,g,h,f[k+2],9,-51403784);
h=c(h,m,a,g,f[k+7],14,1735328473);g=c(g,h,m,a,f[k+12],20,-1926607734);a=b(g^h^m,a,g,f[k+5],4,-378558);m=b(a^g^h,m,a,f[k+8],11,-2022574463);h=b(m^a^g,h,m,f[k+11],16,1839030562);g=b(h^m^a,g,h,f[k+14],23,-35309556);a=b(g^h^m,a,g,f[k+1],4,-1530992060);m=b(a^g^h,m,a,f[k+4],11,1272893353);h=b(m^a^g,h,m,f[k+7],16,-155497632);g=b(h^m^a,g,h,f[k+10],23,-1094730640);a=b(g^h^m,a,g,f[k+13],4,681279174);m=b(a^g^h,m,a,f[k+0],11,-358537222);h=b(m^a^g,h,m,f[k+3],16,-722521979);g=b(h^m^a,g,h,f[k+6],23,76029189);a=
b(g^h^m,a,g,f[k+9],4,-640364487);m=b(a^g^h,m,a,f[k+12],11,-421815835);h=b(m^a^g,h,m,f[k+15],16,530742520);g=b(h^m^a,g,h,f[k+2],23,-995338651);a=d(a,g,h,m,f[k+0],6,-198630844);m=d(m,a,g,h,f[k+7],10,1126891415);h=d(h,m,a,g,f[k+14],15,-1416354905);g=d(g,h,m,a,f[k+5],21,-57434055);a=d(a,g,h,m,f[k+12],6,1700485571);m=d(m,a,g,h,f[k+3],10,-1894986606);h=d(h,m,a,g,f[k+10],15,-1051523);g=d(g,h,m,a,f[k+1],21,-2054922799);a=d(a,g,h,m,f[k+8],6,1873313359);m=d(m,a,g,h,f[k+15],10,-30611744);h=d(h,m,a,g,f[k+6],
15,-1560198380);g=d(g,h,m,a,f[k+13],21,1309151649);a=d(a,g,h,m,f[k+4],6,-145523070);m=d(m,a,g,h,f[k+11],10,-1120210379);h=d(h,m,a,g,f[k+2],15,718787259);g=d(g,h,m,a,f[k+9],21,-343485551);a=n(a,p);g=n(g,l);h=n(h,z);m=n(m,q)}f=[a,g,h,m];a="";for(g=0;g<32*f.length;g+=8)a+=String.fromCharCode(f[g>>5]>>>g%32&255);return a}(function(a){for(var b="",e=-1,c,d;++e<a.length;)c=a.charCodeAt(e),d=e+1<a.length?a.charCodeAt(e+1):0,55296<=c&&56319>=c&&56320<=d&&57343>=d&&(c=65536+((c&1023)<<10)+(d&1023),e++),127>=
c?b+=String.fromCharCode(c):2047>=c?b+=String.fromCharCode(192|c>>>6&31,128|c&63):65535>=c?b+=String.fromCharCode(224|c>>>12&15,128|c>>>6&63,128|c&63):2097151>=c&&(b+=String.fromCharCode(240|c>>>18&7,128|c>>>12&63,128|c>>>6&63,128|c&63));return b}(a)))},transition:function(a,c,d,h){var e=b(a).width(),f=b(a).height();if(a&&c){a.parentNode.style.cssText+="perspective: 900px; overflow: hidden;";a.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden";c.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden";
switch(d){case "slide-left":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";c.style.cssText+="overflow: hidden; transform: translate3d("+e+"px, 0, 0)";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)";a.style.cssText+="transition: 0.5s; transform: translate3d(-"+e+"px, 0, 0)"},1);break;case "slide-right":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";c.style.cssText+="overflow: hidden; transform: translate3d(-"+
e+"px, 0, 0)";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)";a.style.cssText+="transition: 0.5s; transform: translate3d("+e+"px, 0, 0)"},1);break;case "slide-down":a.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)";c.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)";
a.style.cssText+="transition: 0.5s; transform: translate3d(0, "+f+"px, 0)"},1);break;case "slide-up":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";c.style.cssText+="overflow: hidden; transform: translate3d(0, "+f+"px, 0)";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)";a.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"},1);break;case "flip-left":a.style.cssText+="overflow: hidden; transform: rotateY(0deg)";
c.style.cssText+="overflow: hidden; transform: rotateY(-180deg)";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: rotateY(0deg)";a.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"},1);break;case "flip-right":a.style.cssText+="overflow: hidden; transform: rotateY(0deg)";c.style.cssText+="overflow: hidden; transform: rotateY(180deg)";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: rotateY(0deg)";a.style.cssText+=
"transition: 0.5s; transform: rotateY(-180deg)"},1);break;case "flip-down":a.style.cssText+="overflow: hidden; transform: rotateX(0deg)";c.style.cssText+="overflow: hidden; transform: rotateX(180deg)";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: rotateX(0deg)";a.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"},1);break;case "flip-up":a.style.cssText+="overflow: hidden; transform: rotateX(0deg)";c.style.cssText+="overflow: hidden; transform: rotateX(-180deg)";
b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: rotateX(0deg)";a.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"},1);break;case "pop-in":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";c.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;";a.style.cssText+="transition: 0.5s;"},
1);break;case "pop-out":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;";c.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;";b(c).show();window.setTimeout(function(){c.style.cssText+="transition: 0.5s; opacity: 1;";a.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"},1);break;default:a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",c.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",
b(c).show(),window.setTimeout(function(){c.style.cssText+="transition: 0.5s; opacity: 1;";a.style.cssText+="transition: 0.5s"},1)}setTimeout(function(){"slide-down"===d&&(b(a).css("z-index","1019"),b(c).css("z-index","1020"));c&&b(c).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""}));a&&b(a).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""}));"function"===typeof h&&h()},500)}else console.log("ERROR: Cannot do transition when one of the divs is null")},lock:function(a,
c,d){var e={};"object"===typeof c?e=c:(e.msg=c,e.spinner=d);e.msg||0===e.msg||(e.msg="");w2utils.unlock(a);b(a).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');c=b(a).find(".w2ui-lock");a=b(a).find(".w2ui-lock-msg");e.msg||a.css({"background-color":"transparent",border:"0px"});!0===e.spinner&&(e.msg='<div class="w2ui-spinner" '+(e.msg?"":'style="width: 35px; height: 35px"')+"></div>"+e.msg);null!=e.opacity&&c.css("opacity",e.opacity);"function"===typeof c.fadeIn?(c.fadeIn(200),
a.html(e.msg).fadeIn(200)):(c.show(),a.html(e.msg).show(0))},unlock:function(a,c){l(c)?(b(a).find(".w2ui-lock").fadeOut(c),setTimeout(function(){b(a).find(".w2ui-lock").remove();b(a).find(".w2ui-lock-msg").remove()},c)):(b(a).find(".w2ui-lock").remove(),b(a).find(".w2ui-lock-msg").remove())},message:function(a,c){function e(c,e){if(null==x&&(x=e.trigger({phase:"before",type:"open",target:"self"}),!0===x.isCancelled)){v.css("z-index",v.data("old-z-index"));b(a.box).find("#w2ui-message"+l).remove();
return}var g=c.data("prev_focus");c.remove();g&&0<g.length?g.focus():d&&d.focus&&d.focus();v.css("z-index",v.data("old-z-index"));e.trigger(b.extend(x,{phase:"after"}))}var d=this;b().w2tag();c||(c={width:200,height:100});null==c.on&&b.extend(c,w2utils.event);null==c.width&&(c.width=200);null==c.height&&(c.height=100);var f=parseInt(b(a.box).width()),n=parseInt(b(a.box).height()),m=parseInt(b(a.box).find(a.title).css("height")||0);c.width>f&&(c.width=f-10);c.height>n-m&&(c.height=n-10-m);c.originalWidth=
c.width;c.originalHeight=c.height;0>parseInt(c.width)&&(c.width=f+c.width);10>parseInt(c.width)&&(c.width=10);0>parseInt(c.height)&&(c.height=n+c.height-m);10>parseInt(c.height)&&(c.height=10);null==c.hideOnClick&&(c.hideOnClick=!1);var p=b(a.box).data("options")||{};if(null==c.width||c.width>p.width-10)c.width=p.width-10;if(null==c.height||c.height>p.height-m-5)c.height=p.height-m-5;0>c.originalHeight&&(c.height=n+c.originalHeight-m);0>c.originalWidth&&(c.width=f+2*c.originalWidth);var v=b(a.box).find(a.title);
n=b(a.box).find(".w2ui-message.w2ui-closing");0<b(a.box).find(".w2ui-message.w2ui-closing").length&&(clearTimeout(w),e(n,n.data("options")||{}));var l=b(a.box).find(".w2ui-message").length;if(""===b.trim(c.html)&&""===b.trim(c.body)&&""===b.trim(c.buttons)){if(0!==l){var t=b(a.box).find("#w2ui-message"+(l-1));c=t.data("options")||{};var x=c.trigger({phase:"before",type:"close",target:"self"});if(!0!==x.isCancelled){t.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+c.height+"px)"})).addClass("w2ui-closing");
1===l?this.unlock&&(a.param?this.unlock(a.param,150):this.unlock(150)):b(a.box).find("#w2ui-message"+(l-2)).css("z-index",1500);var w=setTimeout(function(){e(t,c)},150)}}}else{if(""!==b.trim(c.body)||""!==b.trim(c.buttons))c.html='<div class="w2ui-message-body">'+(c.body||"")+'</div><div class="w2ui-message-buttons">'+(c.buttons||"")+"</div>";b(a.box).find(".w2ui-message").css("z-index",1390);v.data("old-z-index",v.css("z-index"));v.css("z-index",1501);b(a.box).find(a.body).before('<div id="w2ui-message'+
l+'" onmousedown="event.stopPropagation();"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===v.length?"top: 0px;":"top: "+w2utils.getSize(v,"height")+"px;")+(null!=c.width?"width: "+c.width+"px; left: "+(f-c.width)/2+"px;":"left: 10px; right: 10px;")+(null!=c.height?"height: "+c.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===c.hideOnClick?a.param?'onclick="'+a.path+".message('"+a.param+"');\"":'onclick="'+a.path+'.message();"':"")+"></div>");b(a.box).find("#w2ui-message"+
l).data("options",c).data("prev_focus",b(":focus"));var u=b(a.box).find("#w2ui-message"+l).css("display");b(a.box).find("#w2ui-message"+l).css(w2utils.cssPrefix({transform:"none"===u?"translateY(-"+c.height+"px)":"translateY(0px)"}));"none"===u&&(b(a.box).find("#w2ui-message"+l).show().html(c.html),c.box=b(a.box).find("#w2ui-message"+l),x=c.trigger({phase:"before",type:"open",target:"self"}),!0===x.isCancelled?(v.css("z-index",v.data("old-z-index")),b(a.box).find("#w2ui-message"+l).remove()):(setTimeout(function(){b(a.box).find("#w2ui-message"+
l).css(w2utils.cssPrefix({transform:"none"===u?"translateY(0px)":"translateY(-"+c.height+"px)"}))},1),0===l&&this.lock&&(a.param?this.lock(a.param):this.lock()),setTimeout(function(){b(a.box).find("#w2ui-message"+l).css(w2utils.cssPrefix({transition:"0s"}));c.trigger(b.extend(x,{phase:"after"}))},350)))}},naturalCompare:function(a,b){function c(a,b,d){if(d){for(e=b;d=c(a,e),76>d&&65<d;)++e;return+a.slice(b-1,e)}d=p&&p.indexOf(a.charAt(b));return-1<d?d+76:(d=a.charCodeAt(b)||0,45>d||127<d)?d:46>d?
65:48>d?d-1:58>d?d+18:65>d?d-11:91>d?d+11:97>d?d-37:123>d?d+5:d-63}var e,d=1,f=0,m=0,p=String.alphabet;if((a+="")!=(b+=""))for(;d;){var v=c(a,f++);d=c(b,m++);76>v&&76>d&&66<v&&66<d&&(v=c(a,f,f),d=c(b,m,f=e),m=e);if(v!=d)return v<d?-1:1}return 0},lang:function(a){var b=this.settings.phrases[a];return null==b?a:b},locale:function(a,c){a||(a="tr-tr");"string"!==typeof a?w2utils.settings=b.extend(!0,w2utils.settings,a):(5===a.length&&(a="locale/"+a+".json"),w2utils.settings.phrases={},b.ajax({url:a,type:"GET",
dataType:"JSON",success:function(a,e,d){w2utils.settings=b.extend(!0,w2utils.settings,a);"function"===typeof c&&c()},error:function(b,c,e){console.log("ERROR: Cannot load locale "+a)}}))},getSize:function(a,c){a=b(a);var e=parseInt(a.css("border-left-width"))||0,d=parseInt(a.css("border-right-width"))||0,f=parseInt(a.css("border-top-width"))||0,n=parseInt(a.css("border-bottom-width"))||0,m=parseInt(a.css("margin-left"))||0,p=parseInt(a.css("margin-right"))||0,v=parseInt(a.css("margin-top"))||0,l=
parseInt(a.css("margin-bottom"))||0,t=parseInt(a.css("padding-left"))||0,x=parseInt(a.css("padding-right"))||0,w=parseInt(a.css("padding-top"))||0,u=parseInt(a.css("padding-bottom"))||0;switch(c){case "top":return f+v+w;case "bottom":return n+l+u;case "left":return e+m+t;case "right":return d+p+x;case "width":return e+d+m+p+t+x+parseInt(a.width());case "height":return f+n+v+l+w+u+parseInt(a.height());case "+width":return e+d+m+p+t+x;case "+height":return f+n+v+l+w+u}return 0},getStrWidth:function(c,
d){c='<div id="_tmp_width" style="position: absolute; top: -900px;'+(d||"")+'">'+a(c)+"</div>";b("body").append(c);c=b("#_tmp_width").width();b("#_tmp_width").remove();return c},scrollBarSize:function(){if(c.scrollBarSize)return c.scrollBarSize;b("body").append('<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>');c.scrollBarSize=100-b("#_scrollbar_width > div").width();b("#_scrollbar_width").remove();
0<=String(navigator.userAgent).indexOf("MSIE")&&(c.scrollBarSize/=2);return c.scrollBarSize},checkName:function(a,b){return a&&null!=a.name?null!=w2ui[a.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+a.name+")."),!1):w2utils.isAlphaNumeric(a.name)?!0:(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+
b+"()."),!1)},checkUniqueId:function(a,c,d,h){b.isArray(c)||(c=[c]);for(var e=0;e<c.length;e++)if(c[e].id===a)return console.log('ERROR: The parameter "id='+a+'" is not unique within the current '+d+". (obj: "+h+")"),!1;return!0},parseRoute:function(a){var b=[];a=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,e,d,f,p){b.push({name:d,optional:!!p});c=c||"";return""+(p?"":c)+"(?:"+(p?c:"")+(e||"")+(f||e&&"([^/.]+?)"||"([^/]+?)")+")"+(p||
"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+a+"$","i"),keys:b}},cssPrefix:function(a,c,d){var e={},g={},f="";b.isPlainObject(a)?(e=a,!0===c&&(d=!0)):e[a]=c;for(var m in e)g[m]=e[m],g["-webkit-"+m]=e[m],g["-moz-"+m]=e[m].replace("-webkit-","-moz-"),g["-ms-"+m]=e[m].replace("-webkit-","-ms-"),g["-o-"+m]=e[m].replace("-webkit-","-o-");if(!0===d)for(m in g)f+=m+": "+g[m]+"; ";else f=g;return f},parseColor:function(a){if("string"!==typeof a)return null;
a=a.trim().toUpperCase();"#"===a[0]&&(a=a.substr(1));if(3===a.length)a={r:parseInt(a[0]+a[0],16),g:parseInt(a[1]+a[1],16),b:parseInt(a[2]+a[2],16),a:1};else if(6===a.length)a={r:parseInt(a.substr(0,2),16),g:parseInt(a.substr(2,2),16),b:parseInt(a.substr(4,2),16),a:1};else if(4<a.length&&"RGB("===a.substr(0,4))a=a.replace("RGB","").replace(/\(/g,"").replace(/\)/g,"").split(","),a={r:parseInt(a[0],10),g:parseInt(a[1],10),b:parseInt(a[2],10),a:1};else if(5<a.length&&"RGBA("===a.substr(0,5))a=a.replace("RGBA",
"").replace(/\(/g,"").replace(/\)/g,"").split(","),a={r:parseInt(a[0],10),g:parseInt(a[1],10),b:parseInt(a[2],10),a:parseFloat(a[3])};else return null;return a},hsv2rgb:function(a,b,c,d){1===arguments.length&&(b=a.s,c=a.v,d=a.a,a=a.h);a/=360;b/=100;c/=100;var e=Math.floor(6*a);var g=6*a-e;var f=c*(1-b);var h=c*(1-g*b);g=c*(1-(1-g)*b);switch(e%6){case 0:var v=c;var l=g;var t=f;break;case 1:v=h;l=c;t=f;break;case 2:v=f;l=c;t=g;break;case 3:v=f;l=h;t=c;break;case 4:v=g;l=f;t=c;break;case 5:v=c,l=f,t=
h}return{r:Math.round(255*v),g:Math.round(255*l),b:Math.round(255*t),a:null!=d?d:1}},rgb2hsv:function(a,b,c,d){1===arguments.length&&(b=a.g,c=a.b,d=a.a,a=a.r);var e=Math.max(a,b,c),g=Math.min(a,b,c),f=e-g;switch(e){case g:var h=0;break;case a:h=(b-c+f*(b<c?6:0))/(6*f);break;case b:h=(c-a+2*f)/(6*f);break;case c:h=(a-b+4*f)/(6*f)}return{h:Math.round(360*h),s:Math.round(100*(0===e?0:f/e)),v:Math.round(e/255*100),a:null!=d?d:1}},getCursorPosition:function(a){if(null==a)return null;var b=0,c=a.ownerDocument||
a.document,d=c.defaultView||c.parentWindow;if(a.tagName&&"INPUT"===a.tagName.toUpperCase()&&a.selectionStart)b=a.selectionStart;else if(d.getSelection){var e=d.getSelection();0<e.rangeCount&&(c=e.getRangeAt(0),b=c.cloneRange(),b.selectNodeContents(a),b.setEnd(c.endContainer,c.endOffset),b=b.toString().length)}else(e=c.selection)&&"Control"!==e.type&&(b=e.createRange(),c=c.body.createTextRange(),c.moveToElementText(a),c.setEndPoint("EndToEnd",b),b=c.text.length);return b},setCursorPosition:function(a,
c,d){var e=document.createRange(),g=window.getSelection();if(null!=a){for(var f=0;f<a.childNodes.length;f++){var m=b(a.childNodes[f]).text();a.childNodes[f].tagName&&(m=b(a.childNodes[f]).html(),m=m.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," "));if(c<=m.length){var p=a.childNodes[f];p.childNodes&&0<p.childNodes.length&&(p=p.childNodes[0]);p.childNodes&&0<p.childNodes.length&&(p=p.childNodes[0]);break}else c-=m.length}null!=p&&(c>p.length&&
(c=p.length),e.setStart(p,c),d?e.setEnd(p,d):e.collapse(!0),g.removeAllRanges(),g.addRange(e))}},testLocalStorage:d,hasLocalStorage:d(),isIOS:-1!==navigator.userAgent.toLowerCase().indexOf("iphone")||-1!==navigator.userAgent.toLowerCase().indexOf("ipod")||-1!==navigator.userAgent.toLowerCase().indexOf("ipad")||-1!==navigator.userAgent.toLowerCase().indexOf("mobile")||-1!==navigator.userAgent.toLowerCase().indexOf("android")?!0:!1,isIE:-1!==navigator.userAgent.toLowerCase().indexOf("msie")||-1!==navigator.userAgent.toLowerCase().indexOf("trident")?
!0:!1}}(jQuery);
w2utils.formatters={number:function(b,l){20<parseInt(l)&&(l=20);0>parseInt(l)&&(l=0);return null==b||""===b?"":w2utils.formatNumber(parseFloat(b),l,!0)},"float":function(b,l){return w2utils.formatters.number(b,l)},"int":function(b,l){return w2utils.formatters.number(b,0)},money:function(b,l){if(null==b||""===b)return"";b=w2utils.formatNumber(Number(b),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+b+(w2utils.settings.currencySuffix||"")},currency:function(b,l){return w2utils.formatters.money(b,
l)},percent:function(b,l){return null==b||""===b?"":w2utils.formatNumber(b,l||1)+"%"},size:function(b,l){return null==b||""===b?"":w2utils.formatSize(parseInt(b))},date:function(b,l){""===l&&(l=w2utils.settings.dateFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,l,!0);!1===a&&(a=w2utils.isDate(b,l,!0));return'<span title="'+a+'">'+w2utils.formatDate(a,l)+"</span>"},datetime:function(b,l){""===l&&(l=w2utils.settings.datetimeFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,
l,!0);!1===a&&(a=w2utils.isDate(b,l,!0));return'<span title="'+a+'">'+w2utils.formatDateTime(a,l)+"</span>"},time:function(b,l){""===l&&(l=w2utils.settings.timeFormat);"h12"===l&&(l="hh:mi pm");"h24"===l&&(l="h24:mi");if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,l,!0);!1===a&&(a=w2utils.isDate(b,l,!0));return'<span title="'+a+'">'+w2utils.formatTime(b,l)+"</span>"},timestamp:function(b,l){""===l&&(l=w2utils.settings.datetimeFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,
l,!0);!1===a&&(a=w2utils.isDate(b,l,!0));return a.toString?a.toString():""},gmt:function(b,l){""===l&&(l=w2utils.settings.datetimeFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,l,!0);!1===a&&(a=w2utils.isDate(b,l,!0));return a.toUTCString?a.toUTCString():""},age:function(b,l){if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,null,!0);!1===a&&(a=w2utils.isDate(b,null,!0));return'<span title="'+a+'">'+w2utils.age(b)+(l?" "+l:"")+"</span>"},interval:function(b,l){return null==
b||0===b||""===b?"":w2utils.interval(b)+(l?" "+l:"")},toggle:function(b,l){return b?"Yes":""},password:function(b,l){l="";for(var a=0;a<b.length;a++)l+="*";return l}};
w2utils.event={on:function(b,l){var a=jQuery;if("string"===typeof b&&-1!==b.indexOf(".")){var d=b.split(".");b=d[0];var c=d[1]}"string"===typeof b&&-1!==b.indexOf(":")&&(d=b.split(":"),-1!==["complete","done"].indexOf(b[1])&&(b[1]="after"),b={type:d[0],execute:d[1]});a.isPlainObject(b)||(b={type:b,scope:c});b=a.extend({type:null,execute:"before",target:null,onComplete:null},b);b.type?l?(a.isArray(this.handlers)||(this.handlers=[]),this.handlers.push({edata:b,handler:l})):console.log("ERROR: You must specify event handler function when calling .on() method of "+
this.name):console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(b,l){var a=jQuery;if("string"===typeof b&&-1!==b.indexOf(".")){var d=b.split(".");b=d[0];var c=d[1]}"string"===typeof b&&-1!==b.indexOf(":")&&(d=b.split(":"),-1!==["complete","done"].indexOf(b[1])&&(b[1]="after"),b={type:d[0],execute:d[1]});a.isPlainObject(b)||(b={type:b});b=a.extend({},{type:null,execute:"before",target:null,onComplete:null},b);if(b.type||c){l||(l=null);a=[];d=0;for(var e=
this.handlers.length;d<e;d++){var f=this.handlers[d];(f.edata.type!==b.type&&"*"!==b.type&&(null==f.edata.scope||""!=b.type)||f.edata.target!==b.target&&null!=b.target||f.edata.execute!==b.execute&&null!=b.execute||!(f.handler===l&&null!=l||null!=c&&f.edata.scope==c))&&a.push(f)}this.handlers=a}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)},trigger:function(b){var l=jQuery;b=l.extend({type:null,phase:"before",target:null,doneHandlers:[]},b,{isStopped:!1,
isCancelled:!1,done:function(a){this.doneHandlers.push(a)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}});"before"===b.phase&&(b.onComplete=null);var a;null==b.target&&(b.target=null);l.isArray(this.handlers)||(this.handlers=[]);for(var d=this.handlers.length-1;0<=d;d--){var c=this.handlers[d];if(!(c.edata.type!==b.type&&"*"!==c.edata.type||c.edata.target!==b.target&&null!=c.edata.target||c.edata.execute!==b.phase&&"*"!==c.edata.execute&&"*"!==c.edata.phase)){b=
l.extend({},c.edata,b);var e=[];(a=(new RegExp(/\((.*?)\)/)).exec(c.handler))&&(e=a[1].split(/\s*,\s*/));2===e.length?c.handler.call(this,b.target,b):c.handler.call(this,b);if(!0===b.isStopped||!0===b.stop)return b}}d="on"+b.type.substr(0,1).toUpperCase()+b.type.substr(1);if("before"===b.phase&&"function"===typeof this[d]&&(l=this[d],e=[],(a=(new RegExp(/\((.*?)\)/)).exec(l))&&(e=a[1].split(/\s*,\s*/)),2===e.length?l.call(this,b.target,b):l.call(this,b),!0===b.isStopped||!0===b.stop)||null!=b.object&&
"before"===b.phase&&"function"===typeof b.object[d]&&(l=b.object[d],e=[],(a=(new RegExp(/\((.*?)\)/)).exec(l))&&(e=a[1].split(/\s*,\s*/)),2===e.length?l.call(this,b.target,b):l.call(this,b),!0===b.isStopped||!0===b.stop))return b;if("after"===b.phase)for("function"===typeof b.onComplete&&b.onComplete.call(this,b),e=0;e<b.doneHandlers.length;e++)"function"===typeof b.doneHandlers[e]&&b.doneHandlers[e].call(this,b);return b}};
(function(b){b.fn.w2render=function(l){0<b(this).length&&("string"===typeof l&&w2ui[l]&&w2ui[l].render(b(this)[0]),"object"===typeof l&&l.render(b(this)[0]))};b.fn.w2destroy=function(b){!b&&0<this.length&&(b=this.attr("name"));"string"===typeof b&&w2ui[b]&&w2ui[b].destroy();"object"===typeof b&&b.destroy()};b.fn.w2marker=function(){function l(a,b){for(;-1!==b.innerHTML.indexOf('<span class="w2ui-marker">');)b.innerHTML=b.innerHTML.replace(/<span class="w2ui\-marker">((.|\n|\r)*)<\/span>/ig,"$1")}
var a=Array.prototype.slice.call(arguments,0);Array.isArray(a[0])&&(a=a[0]);return 0!==a.length&&a[0]?b(this).each(function(b,c){function d(a){return'<span class="w2ui-marker">'+a+"</span>"}l(b,c);for(b=0;b<a.length;b++){var f=a[b];"string"!==typeof f&&(f=String(f));f=f.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");c.innerHTML=c.innerHTML.replace(new RegExp(f+"(?!([^<]+)?>)","gi"),d)}}):b(this).each(l)};b.fn.w2tag=function(l,a){1===arguments.length&&
"object"===typeof l&&(a=l,null!=a.html&&(l=a.html));a=b.extend({id:null,html:l,position:"right|top",align:"none",left:0,top:0,maxWidth:null,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnFocus:!1,hideOnBlur:!1,hideOnClick:!1,hideOnChange:!0},a);null!=a.name&&null==a.id&&(a.id=a.name);""!==a["class"]&&""===a.inputClass&&(a.inputClass=a["class"]);if(0===b(this).length)b(".w2ui-tag").each(function(a,c){(a=b(c).data("w2tag"))&&a.hide()});else return b(this).each(function(d,
c){function e(){n.box.css("display","block");if(n&&n.box&&b(n.attachedTo).offset()){var d=n.getPos();n.box.css({opacity:"1",left:d.left+"px",top:d.top+"px"}).data("w2tag",n).find(".w2ui-tag-body").addClass(d.posClass);n.tmp.pos=d.left+"x"+d.top;b(n.attachedTo).off(".w2tag").css(n.options.css).addClass(n.options.inputClass);if(n.options.hideOnKeyPress)b(n.attachedTo).on("keypress.w2tag",n.hide);if(n.options.hideOnFocus)b(n.attachedTo).on("focus.w2tag",n.hide);if(a.hideOnChange)if("INPUT"===c.nodeName)b(c).on("change.w2tag",
n.hide);else b(c).find("input").on("change.w2tag",n.hide);if(n.options.hideOnBlur)b(n.attachedTo).on("blur.w2tag",n.hide);if(n.options.hideOnClick)b("body").on("click.w2tag"+(n.id||""),n.hide);if("function"===typeof n.options.onShow)n.options.onShow();g()}}function f(){if(!(0>=n.box.length)&&(n.tmp.timer&&clearTimeout(n.tmp.timer),n.box.remove(),n.options.hideOnClick&&b("body").off(".w2tag"+(n.id||"")),b(n.attachedTo).off(".w2tag").removeClass(n.options.inputClass).removeData("w2tag"),0<b(n.attachedTo).length&&
(b(n.attachedTo)[0].style.cssText=n.tmp.originalCSS),"function"===typeof n.options.onHide))n.options.onHide()}function g(a){var c=b(n.attachedTo).offset();0===b(n.attachedTo).length||0===c.left&&0===c.top||0===n.box.find(".w2ui-tag-body").length?n.hide():(c=h(),n.tmp.pos!==c.left+"x"+c.top&&(n.box.css(w2utils.cssPrefix({transition:a?"0s":".2s"})).css({left:c.left+"px",top:c.top+"px"}),n.tmp.pos=c.left+"x"+c.top),n.tmp.timer&&clearTimeout(n.tmp.timer),n.tmp.timer=setTimeout(g,100))}function h(){var a=
b(n.attachedTo).offset(),c="w2ui-tag-right",d=parseInt(a.left+n.attachedTo.offsetWidth+(n.options.left?n.options.left:0)),e=parseInt(a.top+(n.options.top?n.options.top:0)),g=n.box.find(".w2ui-tag-body"),f=g[0].offsetWidth,h=g[0].offsetHeight;"string"===typeof n.options.position&&-1!==n.options.position.indexOf("|")&&(n.options.position=n.options.position.split("|"));if("top"===n.options.position)c="w2ui-tag-top",d=parseInt(a.left+(n.options.left?n.options.left:0))-14,e=parseInt(a.top+(n.options.top?
n.options.top:0))-h-10;else if("bottom"===n.options.position)c="w2ui-tag-bottom",d=parseInt(a.left+(n.options.left?n.options.left:0))-14,e=parseInt(a.top+n.attachedTo.offsetHeight+(n.options.top?n.options.top:0))+10;else if("left"===n.options.position)c="w2ui-tag-left",d=parseInt(a.left+(n.options.left?n.options.left:0))-f-20,e=parseInt(a.top+(n.options.top?n.options.top:0));else if(Array.isArray(n.options.position)){for(var k=window.innerWidth,l=window.innerHeight,z=0;z<n.options.position.length;z++){var q=
n.options.position[z];if("right"===q){if(c="w2ui-tag-right",d=parseInt(a.left+n.attachedTo.offsetWidth+(n.options.left?n.options.left:0)),e=parseInt(a.top+(n.options.top?n.options.top:0)),d+f<=k)break}else if("left"===q){if(c="w2ui-tag-left",d=parseInt(a.left+(n.options.left?n.options.left:0))-f-20,e=parseInt(a.top+(n.options.top?n.options.top:0)),0<=d)break}else if("top"===q){if(c="w2ui-tag-top",d=parseInt(a.left+(n.options.left?n.options.left:0))-14,e=parseInt(a.top+(n.options.top?n.options.top:
0))-h-10,d+f<=k&&0<=e)break}else if("bottom"===q&&(c="w2ui-tag-bottom",d=parseInt(a.left+(n.options.left?n.options.left:0))-14,e=parseInt(a.top+n.attachedTo.offsetHeight+(n.options.top?n.options.top:0))+10,d+f<=k&&e+h<=l))break}g.data("posClass")!==c&&g.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(c).data("posClass",c)}return{left:d,top:e,posClass:c}}var k=a.id?a.id:c.id;""==k&&(k=b(c).find("input").attr("id"));k||(k="noid");d=w2utils.escapeId(k);if(null!=b(this).data("w2tag")){var n=
b(this).data("w2tag");b.extend(n.options,a)}else n={id:k,attachedTo:c,box:b("#w2ui-tag-"+d),options:b.extend({},a),init:e,hide:f,getPos:h,isMoved:g,tmp:{}};""===l||null==l?n.hide():0!==n.box.length?n.box.find(".w2ui-tag-body").css(n.options.css).attr("style",n.options.style).addClass(n.options.className).html(n.options.html):(n.tmp.originalCSS="",0<b(n.attachedTo).length&&(n.tmp.originalCSS=b(n.attachedTo)[0].style.cssText),k="white-space: nowrap;",n.options.maxWidth&&w2utils.getStrWidth(l)>n.options.maxWidth&&
(k="width: "+n.options.maxWidth+"px"),b("body").append('<div onclick="event.stopPropagation()" style="display: none;" id="w2ui-tag-'+n.id+'"        class="w2ui-tag '+(0<b(n.attachedTo).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; '+k+'">      <div class="w2ui-tag-body '+n.options.className+'" style="'+(n.options.style||"")+'">'+l+"</div>   </div></div>"),n.box=b("#w2ui-tag-"+d),b(n.attachedTo).data("w2tag",n),setTimeout(e,
1))})};b.fn.w2overlay=function(l,a){function d(){var a=b("#w2ui-overlay"+g);if(a.data("element")===f[0]&&0!==a.length){var e=b(f).offset()||{};e=e.left+"x"+e.top;a.data("position")!==e?c():setTimeout(d,250)}}function c(c){if(!c||0===c.button){var d=b("#w2ui-overlay"+g);if(!c||b(b(c.target).closest(".w2ui-overlay").data("element")).closest(".w2ui-overlay")[0]!==d[0])if(!0===d.data("keepOpen"))d.removeData("keepOpen");else{var e;"function"===typeof a.onHide&&(e=a.onHide());!1!==e&&(d.remove(),b(document).off(".w2overlay"+
g),clearInterval(d.data("timer")))}}}function e(){var c=b("#w2ui-overlay"+g),d=c.find(" > div"),h=b("#w2ui-overlay"+g+" div.w2ui-menu");if(0<h.length){h.css("overflow-y","hidden");var k=h.scrollTop();var l=h.scrollLeft()}if(0<c.length){d.height("auto").width("auto");var t=!1,x=d.height(),w=d.width();a.width&&a.width<w&&(w=a.width);30>w&&(w=30);a.tmp.contentHeight&&(x=parseInt(a.tmp.contentHeight),d.height(x),setTimeout(function(){var a=d.find("div.w2ui-menu");x>a.height()&&d.find("div.w2ui-menu").css("overflow-y",
"hidden")},1),setTimeout(function(){var a=d.find("div.w2ui-menu");"auto"!==a.css("overflow-y")&&a.css("overflow-y","auto")},10));a.tmp.contentWidth&&"both"!==a.align?(w=parseInt(a.tmp.contentWidth),d.width(w),setTimeout(function(){w>d.find("div.w2ui-menu > table").width()&&d.find("div.w2ui-menu > table").css("overflow-x","hidden")},1),setTimeout(function(){d.find("div.w2ui-menu > table").css("overflow-x","auto")},10)):d.find("div.w2ui-menu").css("width","100%");var u=a.left,y=a.width,z=a.tipLeft;
switch(a.align){case "both":u=17;0===a.width&&(a.width=w2utils.getSize(b(f),"width"));a.maxWidth&&a.width>a.maxWidth&&(a.width=a.maxWidth);break;case "left":u=17;break;case "right":u=w2utils.getSize(b(f),"width")-w+10,z=w-40}y=30!==w||y?a.width?a.width:"auto":30;var q=(w-17)/2;"auto"!==y&&(q=(y-17)/2);25>q&&(u=25-q,z=Math.floor(q));if(a.contextMenu){var A=a.pageX+8;var B=a.pageY-0;u=a.pageY}else q=f.offset()||{},A=(25<q.left?q.left:25)+u,B=q.top+w2utils.getSize(f,"height")+a.top+7,u=q.top;c.css({left:A+
"px",top:B+"px","min-width":y,"min-height":a.height?a.height:"auto"});q=d.offset()||{};y=window.innerHeight+b(document).scrollTop()-q.top-7;A=window.innerWidth+b(document).scrollLeft()-q.left-7;a.contextMenu&&(y=window.innerHeight+b(document).scrollTop()-a.pageY-15,A=window.innerWidth+b(document).scrollLeft()-a.pageX);-50<y&&210>y||!0===a.openAbove?(a.contextMenu?(y=a.pageY-7,A=5):(y=q.top-b(document).scrollTop()-7,A=24),a.maxHeight&&y>a.maxHeight&&(y=a.maxHeight),x>y&&(t=!0,d.height(y).width(w).css({"overflow-y":"auto"}),
x=y),c.addClass("bottom-arrow"),c.css("top",u-x-A+a.top+"px")):(a.maxHeight&&y>a.maxHeight&&(y=a.maxHeight),x>y&&(t=!0,d.height(y).width(w).css({"overflow-y":"auto"})),c.addClass("top-arrow"));c.find(">style").html("#w2ui-overlay"+g+":before { margin-left: "+parseInt(z)+"px; }#w2ui-overlay"+g+":after { margin-left: "+parseInt(z)+"px; }");w=d.width();A=window.innerWidth+b(document).scrollLeft()-q.left-7;a.maxWidth&&A>a.maxWidth&&(A=a.maxWidth);w>A&&"both"!==a.align&&(a.align="right",setTimeout(function(){e()},
1));(a.contextMenu||a.noTip)&&c.find(">style").html("#w2ui-overlay"+g+":before { display: none; }#w2ui-overlay"+g+":after { display: none; }");t&&"both"!==a.align&&d.width(w+w2utils.scrollBarSize()+2)}0<h.length&&(h.css("overflow-y","auto"),h.scrollTop(k),h.scrollLeft(l))}var f=this,g="";1===arguments.length&&(a="object"===typeof l?l:{html:l});2===arguments.length&&(a.html=l);b.isPlainObject(a)||(a={});a=b.extend({},{name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,
height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"","class":"",overlayStyle:"",onShow:null,onHide:null,openAbove:!1,tmp:{}},a);a.name&&(g="-"+a.name);if(0===this.length||""===a.html||null==a.html){if(0<b("#w2ui-overlay"+g).length){var h=b("#w2ui-overlay"+g)[0].hide;"function"===typeof h&&h()}else b("#w2ui-overlay"+g).remove();return b(this)}0<b("#w2ui-overlay"+g).length&&(h=b("#w2ui-overlay"+g)[0].hide,b(document).off(".w2overlay"+g),"function"===
typeof h&&h());0<f.length&&(null==f[0].tagName||"BODY"===f[0].tagName.toUpperCase())&&(a.contextMenu=!0);a.contextMenu&&a.originalEvent&&(a.pageX=a.originalEvent.pageX,a.pageY=a.originalEvent.pageY);!a.contextMenu||null!=a.pageX&&null!=a.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY.");b("body").append('<div id="w2ui-overlay'+g+'" style="display: none; left: 0px; top: 0px; '+a.overlayStyle+'"        class="w2ui-reset w2ui-overlay '+(0<b(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length?
"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+a.style+'" class="'+a["class"]+'"></div></div>');h=b("#w2ui-overlay"+g);var k=h.find(" > div");k.html(a.html);k=k.css("background-color");null!=k&&"rgba(0, 0, 0, 0)"!==k&&"transparent"!==k&&h.css({"background-color":k,"border-color":k});k=b(f).offset()||{};h.data("element",0<f.length?f[0]:null).data("options",a).data("position",k.left+"x"+k.top).fadeIn("fast").on("click",function(a){b("#w2ui-overlay"+g).data("keepOpen",
!0);"LABEL"===a.target.tagName.toUpperCase()&&a.stopPropagation()}).on("mousedown",function(b){var c=b.target.tagName.toUpperCase();-1!==["INPUT","TEXTAREA","SELECT"].indexOf(c)||a.selectable||b.preventDefault()});h[0].hide=c;h[0].resize=e;setTimeout(function(){b(document).off(".w2overlay"+g).on("click.w2overlay"+g,c);if("function"===typeof a.onShow)a.onShow();e()},10);d();return b(this)};b.fn.w2menu=function(l,a){function d(){setTimeout(function(){b("#w2ui-overlay"+h+" tr.w2ui-selected").removeClass("w2ui-selected");
var c=b("#w2ui-overlay"+h+" tr[index="+a.index+"]"),d=b("#w2ui-overlay"+h+" div.w2ui-menu").scrollTop();c.addClass("w2ui-selected");a.tmp&&(a.tmp.contentHeight=b("#w2ui-overlay"+h+" table").height()+(a.search?50:10),a.tmp.contentWidth=b("#w2ui-overlay"+h+" table").width());0<b("#w2ui-overlay"+h).length&&b("#w2ui-overlay"+h)[0].resize();if(0<c.length){var e=c[0].offsetTop-5,g=b("#w2ui-overlay"+h+" div.w2ui-menu").height();b("#w2ui-overlay"+h+" div.w2ui-menu").scrollTop(d);(e<d||e+c.height()>d+g)&&
b("#w2ui-overlay"+h+" div.w2ui-menu").animate({scrollTop:e-(g-2*c.height())/2},200,"linear")}},1)}function c(c){var e=this.value,f=!1;switch(c.keyCode){case 13:b("#w2ui-overlay"+h).remove();b.fn.w2menuClick(c,a.index);break;case 9:case 27:b("#w2ui-overlay"+h).remove();b.fn.w2menuClick(c,-1);break;case 38:a.index=w2utils.isInt(a.index)?parseInt(a.index):0;for(a.index--;0<a.index&&a.items[a.index].hidden;)a.index--;if(0===a.index&&a.items[a.index].hidden)for(;a.items[a.index]&&a.items[a.index].hidden;)a.index++;
0>a.index&&(a.index=0);f=!0;break;case 40:a.index=w2utils.isInt(a.index)?parseInt(a.index):0;for(a.index++;a.index<a.items.length-1&&a.items[a.index].hidden;)a.index++;if(a.index===a.items.length-1&&a.items[a.index].hidden)for(;a.items[a.index]&&a.items[a.index].hidden;)a.index--;a.index>=a.items.length&&(a.index=a.items.length-1);f=!0}if(!f){for(f=c=0;f<a.items.length;f++){var m=a.items[f],k="",n="";-1!==["is","begins with"].indexOf(a.match)&&(k="^");-1!==["is","ends with"].indexOf(a.match)&&(n=
"$");try{(new RegExp(k+e+n,"i")).test(m.text)||"..."===m.text?m.hidden=!1:m.hidden=!0}catch(y){}"enum"===g.type&&-1!==b.inArray(m.id,ids)&&(m.hidden=!0);!0!==m.hidden&&c++}for(a.index=0;a.index<a.items.length-1&&a.items[a.index].hidden;)a.index++;0>=c&&(a.index=-1)}b(g).w2menu("refresh",a);d()}function e(b,c,d,g){if(a.spinner)return'<table><tbody><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+
w2utils.lang("Loading...")+"</div></td></tr></tbody></table>";d=0;var f='<table cellspacing="0" cellpadding="0" class="'+(c?" sub-menu":"")+'"><tbody>',h=null,m=null;null==b&&(b=a.items);for(var k=0;k<b.length;k++){var n=b[k];"string"===typeof n?n={id:n,text:n}:(null!=n.text&&null==n.id&&(n.id=n.text),null==n.text&&null!=n.id&&(n.text=n.id),null!=n.caption&&(n.text=n.caption),h=n.img,m=n.icon,null==h&&(h=null),null==m&&(m=null));-1==["radio","check"].indexOf(a.type)||Array.isArray(n.items)||(m=!0===
n.checked?"w2ui-icon-check":"w2ui-icon-empty");if(!0!==n.hidden){var p="",v=n.text,l="";"function"===typeof a.render&&(v=a.render(n,a));h&&(p='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+h+'"></div></td>');m&&(p='<td class="menu-icon" align="center"><span class="w2ui-icon '+m+'"></span></td>');if("break"!==n.type&&null!=v&&""!==v&&"--"!=String(v).substr(0,2)){var r=0===d%2?"w2ui-item-even":"w2ui-item-odd";!0!==a.altRows&&(r="");var t=1;""===p&&t++;null==n.count&&null==n.hotkey&&!0!==
n.remove&&null==n.items&&t++;null==n.tooltip&&null!=n.hint&&(n.tooltip=n.hint);var x="";!0===n.remove?x='<span class="remove">X</span>':null!=n.items?(l=[],"function"==typeof n.items?l=n.items(n):Array.isArray(n.items)&&(l=n.items),x="<span></span>",l='<tr style="'+(n.expanded?"":"display: none")+'">     <td colspan="3">'+e(l,!0,!n.expanded,k)+"</td><tr>"):(null!=n.count&&(x+="<span>"+n.count+"</span>"),null!=n.hotkey&&(x+='<span class="hotkey">'+n.hotkey+"</span>"));f+='<tr index="'+k+'" style="'+
(n.style?n.style:"")+'" '+(n.tooltip?'title="'+w2utils.lang(n.tooltip)+'"':"")+' class="'+r+(a.index===k?" w2ui-selected":"")+(!0===n.disabled?" w2ui-disabled":"")+(""!==l?" has-sub-menu"+(n.expanded?" expanded":" collapsed"):"")+'"        onmousedown="if ('+(!0===n.disabled?"true":"false")+") return;               jQuery.fn.w2menuDown(event, "+k+",  "+g+');"        onclick="event.stopPropagation();                if ('+(!0===n.disabled?"true":"false")+") return;               jQuery.fn.w2menuClick(event, "+
k+",  "+g+');">'+(c?"<td></td>":"")+p+'   <td class="menu-text" colspan="'+t+'">'+w2utils.lang(v)+'</td>   <td class="menu-count">'+x+"</td></tr>"+l;d++}else p=v.replace(/^-+/g,""),f+='<tr><td colspan="3" class="menu-divider '+(""!=p?"divider-text":"")+'">   <div class="line">'+p+'</div>   <div class="text">'+p+"</div></td></tr>"}b[k]=n}0===d&&(f+='<tr><td style="padding: 13px; color: #999; text-align: center">'+a.msgNoItems+"</div></td></tr>");return f+"</tbody></table>"}a&&"function"===typeof a.items&&
(a.items=a.items());var f={type:"normal",index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,hideOnRemove:!1,tmp:{}},g=this,h="";if("refresh"===l)b.fn.w2menuOptions&&(h="-"+b.fn.w2menuOptions.name),a.name&&(h="-"+a.name),0<b("#w2ui-overlay"+h).length?(a=b.extend(b.fn.w2menuOptions,a),f=b("#w2ui-overlay"+h+" div.w2ui-menu").scrollTop(),b("#w2ui-overlay"+h+" div.w2ui-menu").html(e()),b("#w2ui-overlay"+h+" div.w2ui-menu").scrollTop(f),d()):b(this).w2menu(a);else if("refresh-index"===
l){var k=b("#w2ui-overlay"+h+" div.w2ui-menu"),n=k.find("tr[index="+a.index+"]");f=k.scrollTop();k.find("tr.w2ui-selected").removeClass("w2ui-selected");n.addClass("w2ui-selected");if(0<n.length){var m=n[0].offsetTop-5,p=k.height();k.scrollTop(f);(m<f||m+n.height()>f+p)&&k.animate({scrollTop:m-(p-2*n.height())/2},200,"linear")}d()}else{1===arguments.length?a=l:a.items=l;"object"!==typeof a&&(a={});a=b.extend({},f,a);b.fn.w2menuOptions=a;a.name&&(h="-"+a.name);"function"===typeof a.select&&"function"!==
typeof a.onSelect&&(a.onSelect=a.select);"function"===typeof a.remove&&"function"!==typeof a.onRemove&&(a.onRemove=a.remove);"function"===typeof a.onRender&&"function"!==typeof a.render&&(a.render=a.onRender);b.fn.w2menuClick=function(c,e,g){var f=!1,m=b(c.target).closest("tr");-1!==["radio","check"].indexOf(a.type)&&(c.shiftKey||c.metaKey||c.ctrlKey)&&(f=!0);items=null==g?a.items:a.items[g].items;if(b(c.target).hasClass("remove")){if("function"===typeof a.onRemove)a.onRemove({index:e,parentIndex:g,
item:items[e],keepOpen:f,originalEvent:c});f=!a.hideOnRemove;b(c.target).closest("tr").remove();d()}else m.hasClass("has-sub-menu")?(f=!0,m.hasClass("expanded")?(items[e].expanded=!1,m.removeClass("expanded").addClass("collapsed").next().hide()):(items[e].expanded=!0,m.addClass("expanded").removeClass("collapsed").next().show()),d()):"function"===typeof a.onSelect&&(m=items,"function"==typeof items&&(m=items(a.items[g])),a.onSelect({index:e,parentIndex:g,item:m[e],keepOpen:f,originalEvent:c}));if(null==
items[e]||!0!==items[e].keepOpen)c=b("#w2ui-overlay"+h),c.removeData("keepOpen"),0<c.length&&"function"===typeof c[0].hide&&!f&&c[0].hide()};b.fn.w2menuDown=function(c,d,e){var g=b(c.target).closest("tr"),f=b(g.get(0)).find(".w2ui-icon");var h=null==e?a.items:a.items[e].items;if(!("check"!==a.type&&"radio"!==a.type||b(c.target).hasClass("remove")||b(c.target).closest("tr").hasClass("has-sub-menu"))){var m=h[d];m.checked=!m.checked;m.checked?("radio"===a.type&&f.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),
"check"===a.type&&null!=m.group&&h.forEach(function(a,b){a.id!=m.id&&a.group===m.group&&a.checked&&(f.closest("table").find("tr[index="+b+"] .w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),h[b].checked=!1)}),f.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"===a.type&&null==m.group&&f.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")}g.parent().find("tr").removeClass("w2ui-selected");g.addClass("w2ui-selected")};f="";if(a.search)for(f+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',
a.style+=";background-color: #ECECEC",k=a.index=0;k<a.items.length;k++)a.items[k].hidden=!1;f+='<div class="w2ui-menu" style="top: '+(a.search?40:0)+'px">'+e()+"</div>";f=b(this).w2overlay(f,a);setTimeout(function(){b("#w2ui-overlay"+h+" #menu-search").on("keyup",c).on("keydown",function(a){9===a.keyCode&&(a.stopPropagation(),a.preventDefault())});if(a.search){if(-1!==["text","password"].indexOf(b(g)[0].type)||"TEXTAREA"===b(g)[0].tagName.toUpperCase())return;b("#w2ui-overlay"+h+" #menu-search").focus()}d()},
250);d();return f}};b.fn.w2color=function(l,a){var d,c,e,f,g,h,k;function n(a){for(var b,c='<div class="w2ui-color" onmousedown="jQuery(this).parents(\'.w2ui-overlay\').data(\'keepOpen\', true)"><div class="w2ui-color-palette"><table cellspacing="5"><tbody>',d=0;d<r.length;d++){c+="<tr>";for(var e=0;e<r[d].length;e++)b="FFFFFF"===r[d][e]?";border: 1px solid #efefef":"",c+='<td>    <div class="color '+(""===r[d][e]?"no-color":"")+'" style="background-color: #'+r[d][e]+b+';"        name="'+r[d][e]+
'" index="'+d+":"+e+'">'+(a.color==r[d][e]?"&#149;":"&#160;")+"    </div></td>",a.color==r[d][e]&&(v=[d,e]);c+="</tr>";2>d&&(c+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return c=c+'</tbody></table></div><div class="w2ui-color-advanced" style="display: none">   <div class="color-info">       <div class="color-preview-bg"><div class="color-preview"></div><div class="color-original"></div></div>       <div class="color-part">           <span>H</span> <input name="h" maxlength="3" max="360" tabindex="101">           <span>R</span> <input name="r" maxlength="3" max="255" tabindex="104">       </div>       <div class="color-part">           <span>S</span> <input name="s" maxlength="3" max="100" tabindex="102">           <span>G</span> <input name="g" maxlength="3" max="255" tabindex="105">       </div>       <div class="color-part">           <span>V</span> <input name="v" maxlength="3" max="100" tabindex="103">           <span>B</span> <input name="b" maxlength="3" max="255" tabindex="106">       </div>       <div class="color-part" style="margin: 30px 0px 0px 2px">           <span style="width: 40px">Opacity</span>            <input name="a" maxlength="5" max="1" style="width: 32px !important" tabindex="107">       </div>   </div>   <div class="palette" name="palette">       <div class="palette-bg"></div>       <div class="value1 move-x move-y"></div>   </div>   <div class="rainbow" name="rainbow">       <div class="value2 move-x"></div>   </div>   <div class="alpha" name="alpha">       <div class="alpha-bg"></div>       <div class="value2 move-x"></div>   </div></div>'+
("<div class=\"w2ui-color-tabs\">   <div class=\"w2ui-color-tab selected\" onclick=\"jQuery(this).addClass('selected').next().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').hide().parent().find('.w2ui-color-palette').show(); jQuery.fn._colorAdvanced = false; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-colors\"></span></div>   <div class=\"w2ui-color-tab\" onclick=\"jQuery(this).addClass('selected').prev().removeClass('selected').parents('.w2ui-overlay').find('.w2ui-color-advanced').show().parent().find('.w2ui-color-palette').hide(); jQuery.fn._colorAdvanced = true; jQuery('#w2ui-overlay')[0].resize()\"><span class=\"w2ui-icon w2ui-icon-settings\"></span></div>   <div style=\"padding: 8px; text-align: right;\">"+
("string"==typeof a.html?a.html:"")+'</div></div></div><div style="clear: both; height: 0"></div>')}var m=b(this),p=m[0];if(m.data("skipInit"))m.removeData("skipInit");else{var v=[-1,-1];null==b.fn.w2colorPalette&&(b.fn.w2colorPalette=["000000 333333 555555 777777 888888 999999 AAAAAA CCCCCC DDDDDD EEEEEE F7F7F7 FFFFFF".split(" "),"FF011B FF9838 FFC300 FFFD59 86FF14 14FF7A 2EFFFC 2693FF 006CE7 9B24F4 FF21F5 FF0099".split(" "),"FFEAEA FCEFE1 FCF4DC FFFECF EBFFD9 D9FFE9 E0FFFF E8F4FF ECF4FC EAE6F4 FFF5FE FCF0F7".split(" "),
"F4CCCC FCE5CD FFF1C2 FFFDA1 D5FCB1 B5F7D0 BFFFFF D6ECFF CFE2F3 D9D1E9 FFE3FD FFD9F0".split(" "),"EA9899 F9CB9C FFE48C F7F56F B9F77E 84F0B1 83F7F7 B5DAFF 9FC5E8 B4A7D6 FAB9F6 FFADDE".split(" "),"E06666 F6B26B DEB737 E0DE51 8FDB48 52D189 4EDEDB 76ACE3 6FA8DC 8E7CC3 E07EDA F26DBD".split(" "),"CC0814 E69138 AB8816 B5B20E 6BAB30 27A85F 1BA8A6 3C81C7 3D85C6 674EA7 A14F9D BF4990".split(" "),"99050C B45F17 80650E 737103 395E14 10783D 13615E 094785 0A5394 351C75 780172 782C5A".split(" ")]);var r=b.fn.w2colorPalette;
"string"===typeof l&&(l={color:l,transparent:!0});null==l.onSelect&&null!=a&&(l.onSelect=a);l.transparent&&"333333"==r[0][1]&&(r[0].splice(1,1),r[0].push(""));l.transparent||"333333"==r[0][1]||(r[0].splice(1,0,"333333"),r[0].pop());l.color&&(l.color=String(l.color).toUpperCase());"string"===typeof l.color&&"#"===l.color.substr(0,1)&&(l.color=l.color.substr(1));null==l.fireChange&&(l.fireChange=!0);0===b("#w2ui-overlay").length?b(p).w2overlay(n(l),l):(b("#w2ui-overlay .w2ui-color").parent().html(n(l)),
b("#w2ui-overlay").show());b("#w2ui-overlay .color").off(".w2color").on("mousedown.w2color",function(a){var c=b(a.originalEvent.target).attr("name");v=b(a.originalEvent.target).attr("index").split(":");"INPUT"===p.tagName.toUpperCase()?(l.fireChange&&b(p).change(),b(p).next().find(">div").css("background-color",c)):b(p).data("_color",c);if("function"===typeof l.onSelect)l.onSelect(c)}).on("mouseup.w2color",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},
10)});b("#w2ui-overlay .color-original").off(".w2color").on("click.w2color",function(a){a=w2utils.parseColor(b(a.target).css("background-color"));null!=a&&(t=a,x=w2utils.rgb2hsv(t),w(x),u(),y())});b("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",function(a){b("#w2ui-overlay").data("keepOpen",!0);setTimeout(function(){b("#w2ui-overlay").data("keepOpen",!0)},10);a.stopPropagation()}).on("change.w2color",function(){var a=b(this),c=parseFloat(a.val()),d=parseFloat(a.attr("max"));isNaN(c)&&
(c=0);1<d&&(c=parseInt(c));0<d&&c>d&&(a.val(d),c=d);0>c&&(a.val(0),c=0);a=a.attr("name");d={};-1!==["r","g","b","a"].indexOf(a)?(t[a]=c,x=w2utils.rgb2hsv(t)):-1!==["h","s","v"].indexOf(a)&&(d[a]=c);w(d);u();y()});var t=w2utils.parseColor(l.color);if(null==t){t={r:140,g:150,b:160,a:1};var x=w2utils.rgb2hsv(t)}x=w2utils.rgb2hsv(t);var w=function(a,c){null!=a.h&&(x.h=a.h);null!=a.s&&(x.s=a.s);null!=a.v&&(x.v=a.v);null!=a.a&&(t.a=a.a,x.a=a.a);t=w2utils.hsv2rgb(x);a="rgba("+t.r+","+t.g+","+t.b+","+t.a+
")";var d=[Number(t.r).toString(16).toUpperCase(),Number(t.g).toString(16).toUpperCase(),Number(t.b).toString(16).toUpperCase()];d.forEach(function(a,b){1===a.length&&(d[b]="0"+a)});1===t.a&&(a=d[0]+d[1]+d[2]);b("#w2ui-overlay .color-preview").css("background-color",a);b("#w2ui-overlay input").each(function(a,b){b.name&&(null!=t[b.name]&&(b.value=t[b.name]),null!=x[b.name]&&(b.value=x[b.name]),"a"===b.name&&(b.value=t.a))});if(c)b("#w2ui-overlay .color-original").css("background-color",a);else if("INPUT"===
p.tagName.toUpperCase()?(b(p).val(a).data("skipInit",!0),l.fireChange&&b(p).change(),b(p).next().find(">div").css("background-color",a)):b(p).data("_color",a),"function"===typeof l.onSelect)l.onSelect(a)},u=function(){var a=b("#w2ui-overlay .palette .value1"),c=b("#w2ui-overlay .rainbow .value2"),d=b("#w2ui-overlay .alpha .value2"),e=parseInt(a.width())/2,g=parseInt(c.width())/2;a.css({left:150*x.s/100-e,top:125*(100-x.v)/100-e});c.css("left",x.h/2.4-g);d.css("left",150*t.a-g)},y=function(){var a=
w2utils.hsv2rgb(x.h,100,100);a=a.r+","+a.g+","+a.b;b("#w2ui-overlay .palette").css("background-image","linear-gradient(90deg, rgba("+a+",0) 0%, rgba("+a+",1) 100%)")};a=function(a){var m=b(this).find(".value1, .value2"),n=parseInt(m.width())/2;m.hasClass("move-x")&&m.css({left:a.offsetX-n+"px"});m.hasClass("move-y")&&m.css({top:a.offsetY-n+"px"});d=m;c=a.pageX;e=a.pageY;f=m.parent().width();g=m.parent().height();h=parseInt(m.css("left"));k=parseInt(m.css("top"));q(a);b("body").off(".w2color").on(B,
q).on(A,z)};var z=function(a){b("body").off(".w2color")},q=function(a){var b=d,m=h+(a.pageX-c),n=k+(a.pageY-e);a=parseInt(b.width())/2;m<-a&&(m=-a);n<-a&&(n=-a);m>f-a&&(m=f-a);n>g-a&&(n=g-a);b.hasClass("move-x")&&b.css({left:m+"px"});b.hasClass("move-y")&&b.css({top:n+"px"});m=b.parent().attr("name");n=parseInt(b.css("left"))+a;b=parseInt(b.css("top"))+a;"palette"===m&&w({s:Math.round(n/f*100),v:Math.round(100-b/g*100)});"rainbow"===m&&(w({h:Math.round(2.4*n)}),y());"alpha"===m&&w({a:parseFloat(Number(n/
150).toFixed(2))})};if(!0===b.fn._colorAdvanced||!0===l.advanced)b("#w2ui-overlay .w2ui-color-tabs :nth-child(2)").click(),b("#w2ui-overlay").removeData("keepOpen");w({},!0);y();u();var A="mouseup.w2color",B="mousemove.w2color";w2utils.isIOS&&(A="touchend.w2color",B="touchmove.w2color  ");b("#w2ui-overlay .palette").off(".w2color").on("mousedown.w2color",a);b("#w2ui-overlay .rainbow").off(".w2color").on("mousedown.w2color",a);b("#w2ui-overlay .alpha").off(".w2color").on("mousedown.w2color",a);p.nav=
function(a){switch(a){case "up":v[0]--;break;case "down":v[0]++;break;case "right":v[1]++;break;case "left":v[1]--}0>v[0]&&(v[0]=0);v[0]>r.length-2&&(v[0]=r.length-2);0>v[1]&&(v[1]=0);v[1]>r[0].length-1&&(v[1]=r[0].length-1);color=r[v[0]][v[1]];b(p).data("_color",color);return color}}}})(jQuery);
(function(b){var l=function(a){this.box=this.name=null;this.columns=[];this.columnGroups=[];this.records=[];this.summary=[];this.searches=[];this.sortMap={};this.toolbar={};this.total=0;this.recid=null;this.last={field:"",label:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,loading:!1,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)};
b.extend(!0,this,w2obj.grid);this.show=b.extend(!0,{},l.prototype.show);this.postData=b.extend(!0,{},l.prototype.postData);this.httpHeaders=b.extend(!0,{},l.prototype.httpHeaders);this.buttons=b.extend(!0,{},l.prototype.buttons);this.operators=b.extend(!0,{},l.prototype.operators);this.operatorsMap=b.extend(!0,{},l.prototype.operatorsMap);this.stateColProps=b.extend(!0,{},l.prototype.stateColProps);this.stateColDefaults=b.extend(!0,{},l.prototype.stateColDefaults);b.extend(!0,this,a)};b.fn.w2grid=
function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2grid")){var d=a.columns,c=a.columnGroups,e=a.records,f=a.searches,g=a.searchData,h=a.sortData,k=new l(a);b.extend(k,{records:[],columns:[],searches:[],sortData:[],searchData:[],handlers:[]});var n;if(d)for(n=0;n<d.length;n++)k.columns[n]=b.extend(!0,{},d[n]);if(c)for(n=0;n<c.length;n++)k.columnGroups[n]=b.extend(!0,{},c[n]);if(f)for(n=0;n<f.length;n++)k.searches[n]=b.extend(!0,{},f[n]);if(g)for(n=0;n<g.length;n++)k.searchData[n]=b.extend(!0,
{},g[n]);if(h)for(n=0;n<h.length;n++)k.sortData[n]=b.extend(!0,{},h[n]);if(e)for(d=0;d<e.length;d++){null!=e[d][k.recid]&&(e[d].recid=e[d][k.recid]);if(null==e[d].recid){console.log("ERROR: Cannot add records without recid. (obj: "+k.name+")");return}k.records[d]=b.extend(!0,{},e[d])}for(e=0;e<k.columns.length;e++)d=k.columns[e],c=d.searchable,null!=c&&!1!==c&&null==k.getSearch(d.field)&&(b.isPlainObject(c)?k.addSearch(b.extend({field:d.field,label:d.text,type:"text"},c)):(c=d.searchable,f="",!0===
d.searchable&&(c="text",f='size="20"'),k.addSearch({field:d.field,label:d.text,type:c,attr:f})));k.initToolbar();k.updateToolbar();0!==b(this).length&&k.render(b(this)[0]);return w2ui[k.name]=k}}else return k=w2ui[b(this).attr("name")],k?0<arguments.length?(k[a]&&k[a].apply(k,Array.prototype.slice.call(arguments,1)),this):k:null};l.prototype={header:"",url:"",limit:100,offset:0,searchData:[],sortData:[],routeData:{},postData:{},httpHeaders:{},show:{header:!1,toolbar:!1,footer:!1,columnHeaders:!0,
lineNumbers:!1,orderColumn:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,searchHiddenMsg:!1,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},stateId:null,hasFocus:!1,autoLoad:!0,fixedBody:!0,recordHeight:24,lineNumberWidth:null,
keyboard:!0,selectType:"row",multiSearch:!0,multiSelect:!0,multiSort:!0,reorderColumns:!1,reorderRows:!1,showExtraOnSearch:0,markSearch:!0,columnTooltip:"top|bottom",disableCVS:!1,textSearch:"begins",nestedFields:!0,vs_start:150,vs_extra:15,style:"",ranges:[],menu:[],method:null,dataType:null,parser:null,stateColProps:{text:!1,field:!0,size:!0,min:!1,max:!1,gridMinWidth:!1,sizeCorrected:!1,sizeCalculated:!0,sizeOriginal:!0,sizeType:!0,hidden:!0,sortable:!1,searchable:!1,clipboardCopy:!1,resizable:!1,
hideable:!1,attr:!1,style:!1,render:!1,title:!1,editable:!1,frozen:!0,info:!1},stateColDefaults:{text:"",field:"",size:null,min:20,max:null,gridMinWidth:null,sizeCorrected:null,sizeCalculated:null,sizeOriginal:null,sizeType:null,hidden:!1,sortable:!1,searchable:!1,clipboardCopy:!1,resizable:!0,hideable:!0,attr:"",style:"",render:null,title:null,editable:{},frozen:!1,info:null},msgDelete:"Are you sure you want to delete NN records?",msgDeleteBtn:"Delete",msgNotJSON:"Returned data is not in valid JSON format.",
msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgNeedReload:"Your remote data source record count has changed, reloading from the first record.",msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon icon-search-down w2ui-search-down\" onclick=\"var grid = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; grid.searchShowFields()\"></div>"},
"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"Search",tooltip:"Open Search Fields"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},"delete":{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",
tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:"= between > < >= <=".split(" "),date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],"enum":["in","not in"]},operatorsMap:{text:"text","int":"number","float":"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",
list:"list",combo:"text","enum":"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onColumnAutoResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,
onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,add:function(a,d){b.isArray(a)||(a=[a]);for(var c=0,e=0;e<a.length;e++){var f=a[e];null!=f[this.recid]&&(f.recid=f[this.recid]);null==f.recid?console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")"):(f.w2ui&&!0===f.w2ui.summary?d?this.summary.unshift(f):
this.summary.push(f):d?this.records.unshift(f):this.records.push(f),c++)}if("object"!=typeof this.url?!this.url:!this.url.get)return this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),this.refreshBody(),this.resizeRecords(),c;this.refresh();return c},find:function(a,b){null==a&&(a={});var c=[],d=!1,f;for(f in a)-1!=String(f).indexOf(".")&&(d=!0);for(var g=0;g<this.records.length;g++){var h=!0;for(f in a){var k=this.records[g][f];d&&-1!=String(f).indexOf(".")&&(k=this.parseField(this.records[g],
f));if("not-null"==a[f]){if(null==k||""===k)h=!1}else a[f]!=k&&(h=!1)}h&&!0!==b&&c.push(this.records[g].recid);h&&!0===b&&c.push(g)}return c},set:function(a,d,c){"object"==typeof a&&null!==a&&(c=d,d=a,a=null);if(null==a){for(a=0;a<this.records.length;a++)b.extend(!0,this.records[a],d);!0!==c&&this.refresh()}else{var e=this.get(a,!0);if(null==e)return!1;this.records[e]&&this.records[e].recid==a?b.extend(!0,this.records[e],d):b.extend(!0,this.summary[e],d);!0!==c&&this.refreshRow(a,e)}return!0},get:function(a,
d){if(b.isArray(a)){for(var c=[],e=0;e<a.length;e++){var f=this.get(a[e],d);null!==f&&c.push(f)}return c}c=this.last.idCache;c||(this.last.idCache=c={});e=c[a];if("number"===typeof e){if(0<=e&&e<this.records.length&&this.records[e].recid==a)return!0===d?e:this.records[e];e=~e;if(0<=e&&e<this.summary.length&&this.summary[e].recid==a)return!0===d?e:this.summary[e];this.last.idCache=c={}}for(e=0;e<this.records.length;e++)if(this.records[e].recid==a)return c[a]=e,!0===d?e:this.records[e];for(e=0;e<this.summary.length;e++)if(this.summary[e].recid==
a)return c[a]=~e,!0===d?e:this.summary[e];return null},getFirst:function(){if(0==this.records.length)return null;var a=this.records[0].recid,b=this.last.searchIds;0<this.searchData.length&&(a=Array.isArray(b)&&0<b.length?this.records[b[0]].recid:null);return a},remove:function(){for(var a=0,b=0;b<arguments.length;b++){for(var c=this.records.length-1;0<=c;c--)this.records[c].recid==arguments[b]&&(this.records.splice(c,1),a++);for(c=this.summary.length-1;0<=c;c--)this.summary[c].recid==arguments[b]&&
(this.summary.splice(c,1),a++)}("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!1,!0),this.localSearch());this.refresh();return a},addColumn:function(a,d){var c=0;1==arguments.length?(d=a,a=this.columns.length):("string"==typeof a&&(a=this.getColumn(a,!0)),null==a&&(a=this.columns.length));b.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){this.columns.splice(a,0,d[e]);if(d[e].searchable){var f=d[e].searchable,g="";!0===d[e].searchable&&(f="text",g='size="20"');this.addSearch({field:d[e].field,
label:d[e].label,type:f,attr:g})}a++;c++}this.refresh();return c},removeColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.columns.length-1;0<=c;c--)this.columns[c].field==arguments[b]&&(this.columns[c].searchable&&this.removeSearch(arguments[b]),this.columns.splice(c,1),a++);this.refresh();return a},getColumn:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.columns.length;d++)c.push(this.columns[d].field);return c}for(d=0;d<this.columns.length;d++)if(this.columns[d].field==
a)return!0===b?d:this.columns[d];return null},updateColumn:function(a,d){var c=this,e=0;a=Array.isArray(a)?a:[a];a.forEach(function(a){c.columns.forEach(function(c){if(c.field==a){var g=b.extend(!0,{},d);Object.keys(g).forEach(function(a){"function"==typeof g[a]&&(g[a]=g[a](c));c[a]!=g[a]&&e++});b.extend(!0,c,g)}})});this.refreshBody();this.resizeRecords();return e},toggleColumn:function(){return this.updateColumn(Array.from(arguments),{hidden:function(a){return!a.hidden}})},showColumn:function(){return this.updateColumn(Array.from(arguments),
{hidden:!1})},hideColumn:function(){return this.updateColumn(Array.from(arguments),{hidden:!0})},addSearch:function(a,d){var c=0;1==arguments.length?(d=a,a=this.searches.length):("string"==typeof a&&(a=this.getSearch(a,!0)),null==a&&(a=this.searches.length));b.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++)this.searches.splice(a,0,d[e]),a++,c++;this.searchClose();return c},removeSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;0<=c;c--)this.searches[c].field==
arguments[b]&&(this.searches.splice(c,1),a++);this.searchClose();return a},getSearch:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.searches.length;d++)c.push(this.searches[d].field);return c}for(d=0;d<this.searches.length;d++)if(this.searches[d].field==a)return!0===b?d:this.searches[d];return null},toggleSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;0<=c;c--)this.searches[c].field==arguments[b]&&(this.searches[c].hidden=!this.searches[c].hidden,
a++);this.searchClose();return a},showSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;0<=c;c--)this.searches[c].field==arguments[b]&&!1!==this.searches[c].hidden&&(this.searches[c].hidden=!1,a++);this.searchClose();return a},hideSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var c=this.searches.length-1;0<=c;c--)this.searches[c].field==arguments[b]&&!0!==this.searches[c].hidden&&(this.searches[c].hidden=!0,a++);this.searchClose();return a},getSearchData:function(a){for(var b=
0;b<this.searchData.length;b++)if(this.searchData[b].field==a)return this.searchData[b];return null},localSort:function(a,d){function c(a,b){if(!(a.w2ui&&null!=a.w2ui.parent_recid||b.w2ui&&null!=b.w2ui.parent_recid))return f(a,b);a=e(a);b=e(b);for(var c=0;c<Math.min(a.length,b.length);c++){var d=f(a[c],b[c]);if(0!==d)return d}if(a.length>b.length)return 1;if(a.length<b.length)return-1;console.log("ERROR: two paths should not be equal.");return 0}function e(a){if(!a.w2ui||null==a.w2ui.parent_recid)return[a];
if(a.w2ui._path)return a.w2ui._path;var b=k.get(a.w2ui.parent_recid);return b?e(b).concat(a):(console.log("ERROR: no parent record: "+a.w2ui.parent_recid),[a])}function f(a,c){if(a===c)return 0;for(var d=0;d<k.sortData.length;d++){var e=k.sortData[d].field,f=k.sortData[d].field_?k.sortData[d].field_:e,h=a[f],m=c[f];-1!=String(e).indexOf(".")&&(h=k.parseField(a,f),m=k.parseField(c,f));(e=k.getColumn(e))&&null!=e.editable&&(b.isPlainObject(h)&&h.text&&(h=h.text),b.isPlainObject(m)&&m.text&&(m=m.text));
h=g(h,m,d,k.sortData[d].direction,e.sortMode||"default");if(0!==h)return h}return h=g(a.recid,c.recid,-1,"asc")}function g(a,c,d,e,g){if(a===c)return 0;if((null==a||""===a)&&null!=c&&""!==c)return 1;if(null!=a&&""!==a&&(null==c||""===c))return-1;d="asc"===e.toLowerCase()?1:-1;if(typeof a!=typeof c)return typeof a>typeof c?d:-d;if(a.constructor.name!=c.constructor.name)return a.constructor.name>c.constructor.name?d:-d;a&&"object"==typeof a&&(a=a.valueOf());c&&"object"==typeof c&&(c=c.valueOf());e=
{}.toString;a&&"object"==typeof a&&a.toString!=e&&(a=String(a));c&&"object"==typeof c&&c.toString!=e&&(c=String(c));"string"==typeof a&&(a=b.trim(a.toLowerCase()));"string"==typeof c&&(c=b.trim(c.toLowerCase()));switch(g){case "natural":g=w2utils.naturalCompare}return"function"==typeof g?g(a,c)*d:a>c?d:a<c?-d:0}if("object"!=typeof this.url?this.url:this.url.get)console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");else if(!b.isEmptyObject(this.sortData)){var h=
(new Date).getTime(),k=this;k.selectionSave();k.prepareData();d||k.reset();for(var n=0;n<this.sortData.length;n++){var m=this.getColumn(this.sortData[n].field);if(!m)return;"string"==typeof m.render&&(-1!=["date","age"].indexOf(m.render.split(":")[0])&&(this.sortData[n].field_=m.field+"_"),-1!=["time"].indexOf(m.render.split(":")[0])&&(this.sortData[n].field_=m.field+"_"))}(function(){for(var a=0;a<k.records.length;a++){var b=k.records[a];b.w2ui&&null!=b.w2ui.parent_recid&&(b.w2ui._path=e(b))}})();
this.records.sort(function(a,b){return c(a,b)});(function(){for(var a=0;a<k.records.length;a++){var b=k.records[a];b.w2ui&&null!=b.w2ui.parent_recid&&(b.w2ui._path=null)}})();k.selectionRestore(d);h=(new Date).getTime()-h;!0!==a&&k.show.statusSort&&setTimeout(function(){k.status(w2utils.lang("Sorting took")+" "+h/1E3+" "+w2utils.lang("sec"))},10);return h}},localSearch:function(a){function d(a){for(var c=0,e=!1,f=0;f<g.searchData.length;f++){var m=g.searchData[f],k=g.getSearch(m.field);if(null!=m){null==
k&&(k={field:m.field,type:m.type});var n=g.parseField(a,k.field),p=null===n||void 0===n||"object"==typeof n&&n.toString==h?"":String(n).toLowerCase();if(null!=m.value)if(b.isArray(m.value)){q=m.value[0];var l=m.value[1]}else var q=String(m.value).toLowerCase();switch(m.operator){case "=":case "is":g.parseField(a,k.field)==m.value?c++:"date"==k.type?(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.formatDate(k,"yyyy-mm-dd"),q=w2utils.formatDate(w2utils.isDate(q,
w2utils.settings.dateFormat,!0),"yyyy-mm-dd"),p==q&&c++):"time"==k.type?(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.formatTime(k,"hh24:mi"),q=w2utils.formatTime(q,"hh24:mi"),p==q&&c++):"datetime"==k.type&&(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.formatDateTime(k,"yyyy-mm-dd|hh24:mm:ss"),q=w2utils.formatDateTime(w2utils.isDateTime(q,w2utils.settings.datetimeFormat,!0),
"yyyy-mm-dd|hh24:mm:ss"),p==q&&c++);break;case "between":-1!=["int","float","money","currency","percent"].indexOf(k.type)?parseFloat(g.parseField(a,k.field))>=parseFloat(q)&&parseFloat(g.parseField(a,k.field))<=parseFloat(l)&&c++:"date"==k.type?(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.isDate(k,w2utils.settings.dateFormat,!0),q=w2utils.isDate(q,w2utils.settings.dateFormat,!0),l=w2utils.isDate(l,w2utils.settings.dateFormat,!0),null!=
l&&(l=new Date(l.getTime()+864E5)),p>=q&&p<l&&c++):"time"==k.type?(p=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),q=w2utils.isTime(q,!0),l=w2utils.isTime(l,!0),q=(new Date).setHours(q.hours,q.minutes,q.seconds?q.seconds:0,0),l=(new Date).setHours(l.hours,l.minutes,l.seconds?l.seconds:0,0),p>=q&&p<l&&c++):"datetime"==k.type&&(p=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),q=w2utils.isDateTime(q,w2utils.settings.datetimeFormat,
!0),(l=w2utils.isDateTime(l,w2utils.settings.datetimeFormat,!0))&&(l=new Date(l.getTime()+864E5)),p>=q&&p<l&&c++);break;case "<=":e=!0;case "<":case "less":-1!=["int","float","money","currency","percent"].indexOf(k.type)?(p=parseFloat(g.parseField(a,k.field)),q=parseFloat(m.value),(p<q||e&&p===q)&&c++):"date"==k.type?(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.isDate(k,w2utils.settings.dateFormat,!0),q=w2utils.isDate(q,w2utils.settings.dateFormat,
!0),(p<q||e&&p===q)&&c++):"time"==k.type?(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.formatTime(k,"hh24:mi"),q=w2utils.formatTime(q,"hh24:mi"),(p<q||e&&p===q)&&c++):"datetime"==k.type&&(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.formatDateTime(k,"yyyy-mm-dd|hh24:mm:ss"),q=w2utils.formatDateTime(w2utils.isDateTime(q,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),
p.length==q.length&&(p<q||e&&p===q)&&c++);break;case ">=":e=!0;case ">":case "more":-1!=["int","float","money","currency","percent"].indexOf(k.type)?(p=parseFloat(g.parseField(a,k.field)),q=parseFloat(m.value),(p>q||e&&p===q)&&c++):"date"==k.type?(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.isDate(k,w2utils.settings.dateFormat,!0),q=w2utils.isDate(q,w2utils.settings.dateFormat,!0),(p>q||e&&p===q)&&c++):"time"==k.type?(k=g.parseField(a,
k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.formatTime(k,"hh24:mi"),q=w2utils.formatTime(q,"hh24:mi"),(p>q||e&&p===q)&&c++):"datetime"==k.type&&(k=g.parseField(a,k.field+"_")instanceof Date?g.parseField(a,k.field+"_"):g.parseField(a,k.field),p=w2utils.formatDateTime(k,"yyyy-mm-dd|hh24:mm:ss"),q=w2utils.formatDateTime(w2utils.isDateTime(q,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),p.length==q.length&&(p>q||e&&p===q)&&c++);break;case "in":k=
m.value;m.svalue&&(k=m.svalue);-1===k.indexOf(w2utils.isFloat(n)?parseFloat(n):n)&&-1===k.indexOf(p)||c++;break;case "not in":k=m.value;m.svalue&&(k=m.svalue);-1===k.indexOf(w2utils.isFloat(n)?parseFloat(n):n)&&-1===k.indexOf(p)&&c++;break;case "begins":case "begins with":0===p.indexOf(q)&&c++;break;case "contains":0<=p.indexOf(q)&&c++;break;case "null":null==g.parseField(a,k.field)&&c++;break;case "not null":null!=g.parseField(a,k.field)&&c++;break;case "ends":case "ends with":m=p.lastIndexOf(q),
-1!==m&&m==p.length-q.length&&c++}}}if("OR"==g.last.logic&&0!==c||"AND"==g.last.logic&&c==g.searchData.length)return!0;if(a.w2ui&&a.w2ui.children&&!0!==a.w2ui.expanded)for(c=0;c<a.w2ui.children.length;c++)if(d(a.w2ui.children[c]))return!0;return!1}function c(a){if(void 0!==a&&!k[a]&&(k[a]=!0,a=g.get(a,!0),null!=a&&-1==b.inArray(a,g.last.searchIds))){var d=g.records[a];d&&d.w2ui&&c(d.w2ui.parent_recid);g.last.searchIds.push(a)}}var e="object"!=typeof this.url?this.url:this.url.get;if(e)console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");
else{var f=(new Date).getTime(),g=this,h={}.toString,k={};this.total=this.records.length;this.last.searchIds=[];this.prepareData();if(0<this.searchData.length&&!e){for(e=this.total=0;e<this.records.length;e++){var n=this.records[e];if(d(n))if(n&&n.w2ui&&c(n.w2ui.parent_recid),0<this.showExtraOnSearch){var m=this.showExtraOnSearch;n=this.showExtraOnSearch;e<m&&(m=e);e+n>this.records.length&&(n=this.records.length-e);if(0<m)for(m=e-m;m<e;m++)0>this.last.searchIds.indexOf(m)&&this.last.searchIds.push(m);
0>this.last.searchIds.indexOf(e)&&this.last.searchIds.push(e);if(0<n)for(m=e+1;m<=e+n;m++)0>this.last.searchIds.indexOf(m)&&this.last.searchIds.push(m)}else this.last.searchIds.push(e)}this.total=this.last.searchIds.length}f=(new Date).getTime()-f;!0!==a&&g.show.statusSearch&&setTimeout(function(){g.status(w2utils.lang("Search took")+" "+f/1E3+" "+w2utils.lang("sec"))},10);return f}},getRangeData:function(a,b){var c=this.get(a[0].recid,!0),d=this.get(a[1].recid,!0),f=a[0].column;a=a[1].column;var g=
[];if(f==a)for(;c<=d;c++){var h=this.records[c],k=h[this.columns[f].field]||null;!0!==b?g.push(k):g.push({data:k,column:f,index:c,record:h})}else if(c==d){h=this.records[c];for(var n=f;n<=a;n++)k=h[this.columns[n].field]||null,!0!==b?g.push(k):g.push({data:k,column:n,index:c,record:h})}else for(;c<=d;c++)for(h=this.records[c],g.push([]),n=f;n<=a;n++)k=h[this.columns[n].field],!0!==b?g[g.length-1].push(k):g[g.length-1].push({data:k,column:n,index:c,record:h});return g},addRange:function(a){var d=0;
if("row"==this.selectType)return d;b.isArray(a)||(a=[a]);for(var c=0;c<a.length;c++){"object"!=typeof a[c]&&(a[c]={name:"selection"});if("selection"==a[c].name){if(!1===this.show.selectionBorder)continue;var e=this.getSelection();if(0===e.length){this.removeRange("selection");continue}else{var f=e[0];e=e[e.length-1]}}else f=a[c].range[0],e=a[c].range[1];if(f){f={name:a[c].name,range:[{recid:f.recid,column:f.column},{recid:e.recid,column:e.column}],style:a[c].style||""};e=!1;for(var g=0;g<this.ranges.length;g++)if(this.ranges[g].name==
a[c].name){e=g;break}!1!==e?this.ranges[e]=f:this.ranges.push(f);d++}}this.refreshRanges();return d},removeRange:function(){for(var a=0,d=0;d<arguments.length;d++){var c=arguments[d];b("#grid_"+this.name+"_"+c).remove();b("#grid_"+this.name+"_f"+c).remove();for(var e=this.ranges.length-1;0<=e;e--)this.ranges[e].name==c&&(this.ranges.splice(e,1),a++)}return a},refreshRanges:function(){function a(a){var d=c.last.move;if(d&&"expand"==d.type){d.divX=a.screenX-d.x;d.divY=a.screenY-d.y;var e;a=a.originalEvent.target;
"TD"!=a.tagName.toUpperCase()&&(a=b(a).parents("td")[0]);null!=b(a).attr("col")&&(e=parseInt(b(a).attr("col")));a=b(a).parents("tr")[0];a=b(a).attr("recid");if(d.newRange[1].recid!=a||d.newRange[1].column!=e){var g=b.extend({},d.newRange);d.newRange=[{recid:d.recid,column:d.column},{recid:a,column:e}];q=c.trigger(b.extend(q,{originalRange:d.originalRange,newRange:d.newRange}));!0===q.isCancelled?(d.newRange=g,q.newRange=g):(c.removeRange("grid-selection-expand"),c.addRange({name:"grid-selection-expand",
range:q.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"}))}}}function d(a){c.removeRange("grid-selection-expand");delete c.last.move;b(document).off(".w2ui-"+c.name);c.trigger(b.extend(q,{phase:"after"}))}if(0!==this.ranges.length){for(var c=this,e=(new Date).getTime(),f=b("#grid_"+this.name+"_frecords"),g=b("#grid_"+this.name+"_records"),h=0;h<this.ranges.length;h++){var k=this.ranges[h],n=k.range[0],m=k.range[1];null==n.index&&(n.index=this.get(n.recid,
!0));null==m.index&&(m.index=this.get(m.recid,!0));var p=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)+' td[col="'+n.column+'"]'),v=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(m.recid)+' td[col="'+m.column+'"]'),l=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(n.recid)+' td[col="'+n.column+'"]'),t=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(m.recid)+' td[col="'+m.column+'"]'),x=m.column;n.column<this.last.colStart&&m.column>this.last.colStart&&(p=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)+
' td[col="start"]'));n.column<this.last.colEnd&&m.column>this.last.colEnd&&(x='"end"',v=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(m.recid)+' td[col="end"]'));var w=parseInt(b("#grid_"+this.name+"_rec_top").next().attr("index")),u=parseInt(b("#grid_"+this.name+"_rec_bottom").prev().attr("index")),y=parseInt(b("#grid_"+this.name+"_frec_top").next().attr("index")),z=parseInt(b("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===p.length&&n.index<w&&m.index>w&&(p=b("#grid_"+this.name+"_rec_top").next().find("td[col="+
n.column+"]"));0===v.length&&m.index>u&&n.index<u&&(v=b("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+x+"]"));0===l.length&&n.index<y&&m.index>y&&(l=b("#grid_"+this.name+"_frec_top").next().find("td[col="+n.column+"]"));0===t.length&&m.index>z&&n.index<z&&(t=b("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+m.column+"]"));w=b(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input");x=w.attr("recid");w=w.attr("column");if("selection"!=k.name||k.range[0].recid!=x||k.range[0].column!=
w)x=b("#grid_"+this.name+"_f"+k.name),0<l.length||0<t.length?(0===x.length?(f.append('<div id="grid_'+this.name+"_f"+k.name+'" class="w2ui-selection" style="'+k.style+'">'+("selection"==k.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),x=b("#grid_"+this.name+"_f"+k.name)):(x.attr("style",k.style),x.find(".w2ui-selection-resizer").show()),0===t.length&&(t=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(m.recid)+" td:last-child"),0===t.length&&(t=b("#grid_"+
this.name+"_frec_bottom td:first-child")),x.css("border-right","0px"),x.find(".w2ui-selection-resizer").hide()),null!=n.recid&&null!=m.recid&&0<l.length&&0<t.length?(w=l.position().left-0+f.scrollLeft(),u=l.position().top-0+f.scrollTop(),x.show().css({left:(0<w?w:0)+"px",top:(0<u?u:0)+"px",width:t.position().left-l.position().left+t.width()+2+"px",height:t.position().top-l.position().top+t.height()+1+"px"})):x.hide()):x.hide(),x=b("#grid_"+this.name+"_"+k.name),0<p.length||0<v.length?(0===x.length?
(g.append('<div id="grid_'+this.name+"_"+k.name+'" class="w2ui-selection" style="'+k.style+'">'+("selection"==k.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),x=b("#grid_"+this.name+"_"+k.name)):x.attr("style",k.style),0===p.length&&(p=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)+" td:first-child"),0===p.length&&(p=b("#grid_"+this.name+"_rec_top td:first-child"))),0!==t.length&&x.css("border-left","0px"),null!=n.recid&&null!=m.recid&&0<p.length&&
0<v.length?(w=p.position().left-0+g.scrollLeft(),u=p.position().top-0+g.scrollTop(),x.show().css({left:(0<w?w:0)+"px",top:(0<u?u:0)+"px",width:v.position().left-p.position().left+v.width()+2+"px",height:v.position().top-p.position().top+v.height()+1+"px"})):x.hide()):x.hide()}b(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",function(e){var g=c.getSelection();c.last.move={type:"expand",x:e.screenX,y:e.screenY,divX:0,divY:0,recid:g[0].recid,column:g[0].column,originalRange:[{recid:g[0].recid,
column:g[0].column},{recid:g[g.length-1].recid,column:g[g.length-1].column}],newRange:[{recid:g[0].recid,column:g[0].column},{recid:g[g.length-1].recid,column:g[g.length-1].column}]};b(document).off(".w2ui-"+c.name).on("mousemove.w2ui-"+c.name,a).on("mouseup.w2ui-"+c.name,d);e.preventDefault()}).off("dblclick").on("dblclick",function(a){a=c.trigger({phase:"before",type:"resizerDblClick",target:c.name,originalEvent:a});!0!==a.isCancelled&&c.trigger(b.extend(a,{phase:"after"}))});var q={phase:"before",
type:"selectionExtend",target:c.name,originalRange:null,newRange:null};return(new Date).getTime()-e}},select:function(){if(0===arguments.length)return 0;(new Date).getTime();var a=0,d=this.last.selection;this.multiSelect||this.selectNone();var c={phase:"before",type:"select",target:this.name};1==arguments.length?(c.multiple=!1,b.isPlainObject(arguments[0])?(c.recid=arguments[0].recid,c.column=arguments[0].column):c.recid=arguments[0]):(c.multiple=!0,c.recids=Array.prototype.slice.call(arguments,0));
c=this.trigger(c);if(!0===c.isCancelled)return 0;if("row"==this.selectType)for(var e=0;e<arguments.length;e++){var f="object"==typeof arguments[e]?arguments[e].recid:arguments[e],g=this.get(f,!0);if(null!=g){var h=null,k=null;if(0!==this.searchData.length||g+1>=this.last.range_start&&g+1<=this.last.range_end)h=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(f)),k=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(f));"row"==this.selectType&&-1==d.indexes.indexOf(g)&&(d.indexes.push(g),h&&k&&(h.addClass("w2ui-selected").data("selected",
"yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),k.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),h.find(".w2ui-grid-select-check").prop("checked",!0)),a++)}}else{var n={};for(e=0;e<arguments.length;e++)if(f="object"==typeof arguments[e]?arguments[e].recid:arguments[e],g="object"==typeof arguments[e]?arguments[e].column:null,n[f]=n[f]||[],b.isArray(g))n[f]=g;else if(w2utils.isInt(g))n[f].push(g);else for(g=0;g<this.columns.length;g++)this.columns[g].hidden||
n[f].push(parseInt(g));e=[];for(f in n)if(g=this.get(f,!0),null!=g){k=h=null;g+1>=this.last.range_start&&g+1<=this.last.range_end&&(h=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(f)),k=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(f)));var m=d.columns[g]||[];-1==d.indexes.indexOf(g)&&d.indexes.push(g);for(var p=0;p<n[f].length;p++)-1==m.indexOf(n[f][p])&&m.push(n[f][p]);m.sort(function(a,b){return a-b});for(p=0;p<n[f].length;p++){var l=n[f][p];-1==e.indexOf(l)&&e.push(l);h&&(h.find("#grid_"+this.name+
"_data_"+g+"_"+l).addClass("w2ui-selected"),h.find(".w2ui-col-number").addClass("w2ui-row-selected"),h.data("selected","yes"),h.find(".w2ui-grid-select-check").prop("checked",!0));k&&(k.find("#grid_"+this.name+"_data_"+g+"_"+l).addClass("w2ui-selected"),k.find(".w2ui-col-number").addClass("w2ui-row-selected"),k.data("selected","yes"),k.find(".w2ui-grid-select-check").prop("checked",!0));a++}d.columns[g]=m}for(f=0;f<e.length;f++)b(this.box).find("#grid_"+this.name+"_column_"+e[f]+" .w2ui-col-header").addClass("w2ui-col-selected")}d.indexes.sort(function(a,
b){return a-b});f=0<this.records.length&&d.indexes.length==this.records.length;n=0<d.indexes.length&&0!==this.searchData.length&&d.indexes.length==this.last.searchIds.length;f||n?b("#grid_"+this.name+"_check_all").prop("checked",!0):b("#grid_"+this.name+"_check_all").prop("checked",!1);this.status();this.addRange("selection");this.updateToolbar(d,f);this.trigger(b.extend(c,{phase:"after"}));return a},unselect:function(){for(var a=0,d=this.last.selection,c=0;c<arguments.length;c++){var e="object"==
typeof arguments[c]?arguments[c].recid:arguments[c],f=this.get(e);if(null!=f){var g=this.get(f.recid,!0),h=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),k=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if("row"==this.selectType){if(-1==d.indexes.indexOf(g))continue;var n=this.trigger({phase:"before",type:"unselect",target:this.name,recid:e,index:g});if(!0===n.isCancelled)continue;d.indexes.splice(d.indexes.indexOf(g),1);h.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected");
k.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected");0!=h.length&&(h[0].style.cssText="height: "+this.recordHeight+"px; "+h.attr("custom_style"),k[0].style.cssText="height: "+this.recordHeight+"px; "+k.attr("custom_style"));h.find(".w2ui-grid-select-check").prop("checked",!1);a++}else{var m=arguments[c].column;if(!w2utils.isInt(m)){a=[];for(f=0;f<this.columns.length;f++)this.columns[f].hidden||a.push({recid:e,column:f});return this.unselect.apply(this,
a)}var p=d.columns[g];if(!b.isArray(p)||-1==p.indexOf(m))continue;n=this.trigger({phase:"before",type:"unselect",target:this.name,recid:e,column:m});if(!0===n.isCancelled)continue;p.splice(p.indexOf(m),1);b("#grid_"+this.name+"_rec_"+w2utils.escapeId(e)).find(" > td[col="+m+"]").removeClass("w2ui-selected w2ui-inactive");b("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)).find(" > td[col="+m+"]").removeClass("w2ui-selected w2ui-inactive");var l=!1,r=!1,t=this.getSelection();for(f=0;f<t.length;f++)t[f].column==
m&&(l=!0),t[f].recid==e&&(r=!0);l||b(this.box).find(".w2ui-grid-columns td[col="+m+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+m+"] .w2ui-col-header").removeClass("w2ui-col-selected");r||b("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)).find(".w2ui-col-number").removeClass("w2ui-row-selected");a++;0===p.length&&(delete d.columns[g],d.indexes.splice(d.indexes.indexOf(g),1),h.removeData("selected"),h.find(".w2ui-grid-select-check").prop("checked",!1),k.removeData("selected"))}this.trigger(b.extend(n,
{phase:"after"}))}}e=0<this.records.length&&d.indexes.length==this.records.length;c=0<d.indexes.length&&0!==this.searchData.length&&d.indexes.length==this.last.searchIds.length;e||c?b("#grid_"+this.name+"_check_all").prop("checked",!0):b("#grid_"+this.name+"_check_all").prop("checked",!1);this.status();this.addRange("selection");this.updateToolbar(d,e);return a},selectAll:function(){var a=(new Date).getTime();if(!1!==this.multiSelect){var d=this.trigger({phase:"before",type:"select",target:this.name,
all:!0});if(!0!==d.isCancelled){for(var c="object"!=typeof this.url?this.url:this.url.get,e=this.last.selection,f=[],g=0;g<this.columns.length;g++)f.push(g);e.indexes=[];if(c||0===this.searchData.length){var h=this.records.length;0==this.searchData.length||c||(h=this.last.searchIds.length);for(g=0;g<h;g++)e.indexes.push(g),"row"!=this.selectType&&(e.columns[g]=f.slice())}else for(g=0;g<this.last.searchIds.length;g++)e.indexes.push(this.last.searchIds[g]),"row"!=this.selectType&&(e.columns[this.last.searchIds[g]]=
f.slice());"row"==this.selectType?(b(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected")):(b(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),
b(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),b(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected",
"yes"));b(this.box).find("input.w2ui-grid-select-check").prop("checked",!0);e=this.getSelection(!0);1==e.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit");1<=e.length?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete");this.addRange("selection");b("#grid_"+this.name+"_check_all").prop("checked",!0);this.status();this.updateToolbar({indexes:e},!0);this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}}},selectNone:function(){var a=(new Date).getTime(),
d=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0!==d.isCancelled){var c=this.last.selection;"row"==this.selectType?(b(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected")):
(b(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),b(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"));b(this.box).find("input.w2ui-grid-select-check").prop("checked",!1);
c.indexes=[];c.columns={};this.toolbar.disable("w2ui-edit","w2ui-delete");this.removeRange("selection");b("#grid_"+this.name+"_check_all").prop("checked",!1);this.status();this.updateToolbar(c,!1);this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}},updateToolbar:function(a,b){function c(b,c){0===b.batch&&(0<f?d.toolbar.enable(c+b.id):d.toolbar.disable(c+b.id));null!=b.batch&&!isNaN(b.batch)&&0<b.batch&&(f==b.batch?d.toolbar.enable(c+b.id):d.toolbar.disable(c+b.id));"function"==
typeof b.batch&&b.batch("cell"==d.selectType?a:a?a.indexes:null)}var d=this,f=a&&a.indexes?a.indexes.length:0;this.toolbar.items.forEach(function(a){c(a,"");Array.isArray(a.items)&&a.items.forEach(function(b){c(b,a.id+":")})})},getSelection:function(a){var b=[],c=this.last.selection;if("row"==this.selectType)for(var e=0;e<c.indexes.length;e++)this.records[c.indexes[e]]&&(!0===a?b.push(c.indexes[e]):b.push(this.records[c.indexes[e]].recid));else for(e=0;e<c.indexes.length;e++)if(a=c.columns[c.indexes[e]],
this.records[c.indexes[e]])for(var f=0;f<a.length;f++)b.push({recid:this.records[c.indexes[e]].recid,index:parseInt(c.indexes[e]),column:a[f]});return b},search:function(a,d){for(var c="object"!=typeof this.url?this.url:this.url.get,e=[],f=this.last.multi,g=this.last.logic,h=this.last.field,k=this.last.search,n=!1,m=0;m<this.searches.length;m++)this.searches[m].hidden&&null!=this.searches[m].value&&(e.push({field:this.searches[m].field,operator:this.searches[m].operator||"is",type:this.searches[m].type,
value:this.searches[m].value||""}),n=!0);if(0===arguments.length){k="";for(m=0;m<this.searches.length;m++){var p=this.searches[m];g=b("#grid_"+this.name+"_operator_"+m).val();var l=b("#grid_"+this.name+"_field_"+m),r=b("#grid_"+this.name+"_field2_"+m),t=l.val(),x=r.val(),w=null,u=null;if(-1!=["int","float","money","currency","percent"].indexOf(p.type)){var y=l.data("w2field");r=r.data("w2field");y&&(t=y.clean(t));r&&(x=r.clean(x))}if(-1!=["list","enum"].indexOf(p.type))if(t=l.data("selected")||{},
b.isArray(t)){w=[];for(y=0;y<t.length;y++)w.push(w2utils.isFloat(t[y].id)?parseFloat(t[y].id):String(t[y].id).toLowerCase()),delete t[y].hidden;b.isEmptyObject(t)&&(t="")}else u=t.text||"",t=t.id||"";if(""!==t&&null!=t||null!=x&&""!==x){l={field:p.field,type:p.type,operator:g};"between"==g?b.extend(l,{value:[t,x]}):"in"==g&&"string"==typeof t?b.extend(l,{value:t.split(",")}):"not in"==g&&"string"==typeof t?b.extend(l,{value:t.split(",")}):b.extend(l,{value:t});w&&b.extend(l,{svalue:w});u&&b.extend(l,
{text:u});try{"date"==p.type&&"between"==g&&(l.value[0]=t,l.value[1]=x),"date"==p.type&&"is"==g&&(l.value=t)}catch(q){}e.push(l);f=!0}}g="AND"}if("string"==typeof a&&(1==arguments.length&&(d=a,a="all"),h=a,k=d,f=!1,g=n?"AND":"OR",null!=d))if("all"==a.toLowerCase())if(0<this.searches.length)for(m=0;m<this.searches.length;m++){p=this.searches[m];if("text"==p.type||"alphanumeric"==p.type&&w2utils.isAlphaNumeric(d)||"int"==p.type&&w2utils.isInt(d)||"float"==p.type&&w2utils.isFloat(d)||"percent"==p.type&&
w2utils.isFloat(d)||("hex"==p.type||"color"==p.type)&&w2utils.isHex(d)||"currency"==p.type&&w2utils.isMoney(d)||"money"==p.type&&w2utils.isMoney(d)||"date"==p.type&&w2utils.isDate(d)||"time"==p.type&&w2utils.isTime(d)||"datetime"==p.type&&w2utils.isDateTime(d)||"datetime"==p.type&&w2utils.isDate(d)||"enum"==p.type&&w2utils.isAlphaNumeric(d)||"list"==p.type&&w2utils.isAlphaNumeric(d))l={field:p.field,type:p.type,operator:null!=p.operator?p.operator:"text"==p.type?this.textSearch:"is",value:d},""!=
b.trim(d)&&e.push(l);-1!=["int","float","money","currency","percent"].indexOf(p.type)&&2==b.trim(String(d)).split("-").length&&(n=b.trim(String(d)).split("-"),l={field:p.field,type:p.type,operator:null!=p.operator?p.operator:"between",value:[n[0],n[1]]},e.push(l));if(-1!=["list","enum"].indexOf(p.type)){n=[];null==p.options&&(p.options={});Array.isArray(p.options.items)||(p.options.items=[]);for(y=0;y<p.options.items;y++){l=p.options.items[y];try{var z=new RegExp(d,"i");z.test(l)&&n.push(y);l.text&&
z.test(l.text)&&n.push(l.id)}catch(q){}}0<n.length&&(l={field:p.field,type:p.type,operator:null!=p.operator?p.operator:"in",value:n},e.push(l))}}else for(m=0;m<this.columns.length;m++)l={field:this.columns[m].field,type:"text",operator:this.textSearch,value:d},e.push(l);else if(m=b("#grid_"+this.name+"_search_all"),p=this.getSearch(a),null==p&&(p={field:a,type:"text"}),p.field==a&&(this.last.label=p.label),""!==d){z=this.textSearch;n=d;-1!=["date","time","datetime"].indexOf(p.type)&&(z="is");-1!=
["list","enum"].indexOf(p.type)&&(z="is",n=(l=m.data("selected"))&&!b.isEmptyObject(l)?l.id:"");if("int"==p.type&&""!==d&&(z="is",-1!=String(d).indexOf("-")&&(l=d.split("-"),2==l.length&&(z="between",n=[parseInt(l[0]),parseInt(l[1])])),-1!=String(d).indexOf(",")))for(l=d.split(","),z="in",n=[],m=0;m<l.length;m++)n.push(l[m]);null!=p.operator&&(z=p.operator);l={field:p.field,type:p.type,operator:z,value:n};e.push(l)}if(b.isArray(a))for(p="AND","string"==typeof d&&(p=d.toUpperCase(),"OR"!=p&&"AND"!=
p&&(p="AND")),k="",f=!0,g=p,m=0;m<a.length;m++){z=a[m];p=this.getSearch(z.field);null==p&&(p={type:"text",operator:this.textSearch});if(b.isArray(z.value))for(y=0;y<z.value.length;y++)"string"==typeof z.value[y]&&(z.value[y]=z.value[y].toLowerCase());e.push(b.extend(!0,{},p,z))}e=this.trigger({phase:"before",type:"search",target:this.name,multi:0===arguments.length?!0:!1,searchField:a?a:"multi",searchValue:a?d:"multi",searchData:e,searchLogic:g});!0!==e.isCancelled&&(this.searchData=e.searchData,
this.last.field=h,this.last.search=k,this.last.multi=f,this.last.logic=e.searchLogic,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),c?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger(b.extend(e,{phase:"after"})))},searchOpen:function(){if(this.box&&0!==this.searches.length){var a=this,d=a.toolbar.get("w2ui-search-advanced"),c="#tb_"+a.toolbar.name+"_item_"+w2utils.escapeId(d.id)+" table.w2ui-button",
e=this.trigger({phase:"before",type:"searchOpen",target:this.name});!0===e.isCancelled?setTimeout(function(){a.toolbar.uncheck("w2ui-search-advanced")},1):b("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,"class":"w2ui-grid-searches",onShow:function(){a.initSearches();b("#w2ui-overlay-"+a.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",a.name);var f=b("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]");
0<f.length&&f[0].focus();d.checked||(d.checked=!0,b(c).addClass("checked"));a.trigger(b.extend(e,{phase:"after"}))},onHide:function(){d.checked=!1;b(c).removeClass("checked")}})}},searchClose:function(){this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced","w2ui-column-on-off"),b().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(a){for(var d=[],c=!1,e=0;e<this.searches.length;e++)this.searches[e].hidden&&null!=this.searches[e].value&&(d.push({field:this.searches[e].field,
operator:this.searches[e].operator||"is",type:this.searches[e].type,value:this.searches[e].value||""}),c=!0);d=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:d});if(!0!==d.isCancelled){this.searchData=d.searchData;this.last.search="";this.last.logic=c?"AND":"OR";if(0<this.searches.length)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label=w2utils.lang("All Fields");else{for(c=0;c<this.searches.length&&(this.searches[c].hidden||!1===this.searches[c].simple);)c++;
c>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[c].field,this.last.label=this.searches[c].label)}this.last.multi=!1;this.last.xhr_offset=0;this.last.scrollTop=0;this.last.scrollLeft=0;this.last.selection.indexes=[];this.last.selection.columns={};this.searchClose();b("#grid_"+this.name+"_search_all").val("").removeData("selected");a||this.reload();this.trigger(b.extend(d,{phase:"after"}))}},searchShowFields:function(a){var d=b("#grid_"+this.name+"_search_all");
if(!0===a)b(d).w2overlay({name:this.name+"-searchFields"});else{var c='<div class="w2ui-select-field"><table><tbody>';for(a=-1;a<this.searches.length;a++){var e=this.searches[a],f=this.getColumn(e?e.field:null),g=!1,h="This column is hidden";1==this.show.searchHiddenMsg&&-1!=a&&(null==f||!0===f.hidden&&!1!==f.hideable)&&(g=!0,null==f&&(h="This column does not exist"));if(-1==a){if(!this.multiSearch||!this.show.searchAll)continue;e={field:"all",label:w2utils.lang("All Fields")}}else{if(null!=f&&!1===
f.hideable)continue;if(!0===this.searches[a].hidden||!1===this.searches[a].simple)continue}null==e.label&&null!=e.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",e),e.label=e.caption);c+='<tr style="'+(g?"color: silver":"")+'" '+(g?"onmouseenter=\"jQuery(this).w2tag({ top: 4, html: '"+h+'\' })" onmouseleave="jQuery(this).w2tag()"':"")+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+e.field+"');      event.stopPropagation(); jQuery('#grid_"+
this.name+"_search_all').w2overlay({ name: '"+this.name+'-searchFields\' });">   <td>       <span class="w2ui-column-check w2ui-icon-'+(e.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+e.label+"</td></tr>"}c+="</tbody></table></div>";var k=this.name+"-searchFields";1==b("#w2ui-overlay-"+k).length&&(c="");setTimeout(function(){b(d).w2overlay({html:c,name:k,left:-10})},1)}},initAllField:function(a,d){var c=b("#grid_"+this.name+"_search_all");if("all"==a)a={field:"all",label:w2utils.lang("All Fields")},
c.w2field("clear"),c.change();else{a=this.getSearch(a);if(null==a)return;var e=a.type;-1!=["enum","select"].indexOf(e)&&(e="list");c.w2field(e,b.extend({},a.options,{suffix:"",autoFormat:!1,selected:d}));-1!=["list","enum","date","time","datetime"].indexOf(a.type)&&(this.last.search="",this.last.item="",c.val(""),b("#grid_"+this.name+"_searchClear").hide())}""!=this.last.search?(this.last.label=a.label,this.search(a.field,this.last.search)):(this.last.field=a.field,this.last.label=a.label);c.attr("placeholder",
w2utils.lang(a.label||a.caption||a.field));b().w2overlay({name:this.name+"-searchFields"})},clear:function(a){this.total=0;this.records=[];this.summary=[];this.last.xhr_offset=0;this.last.idCache={};this.reset(!0);a||this.refresh()},reset:function(a){this.last.scrollTop=0;this.last.scrollLeft=0;this.last.selection={indexes:[],columns:{}};this.last.range_start=null;this.last.range_end=null;b("#grid_"+this.name+"_records").prop("scrollTop",0);a||this.refresh()},skip:function(a,b){if("object"!=typeof this.url?
this.url:this.url.get){this.offset=parseInt(a);this.offset>this.total&&(this.offset=this.total-this.limit);if(0>this.offset||!w2utils.isInt(this.offset))this.offset=0;this.clear(!0);this.reload(b)}else console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(a,b){null==a?console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'):(this.clear(!0),this.request("get",{},a,b))},reload:function(a){var b=this,
c="object"!=typeof this.url?this.url:this.url.get;b.selectionSave();c?this.load(c,function(){b.selectionRestore();"function"==typeof a&&a()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof a&&a({status:"success"}))},request:function(a,d,c,e){null==d&&(d={});if(""==c||null==c)c=this.url;if(""!=c&&null!=c){w2utils.isInt(this.offset)||(this.offset=0);w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0);var f={limit:this.limit,offset:parseInt(this.offset)+parseInt(this.last.xhr_offset),
searchLogic:this.last.logic,search:this.searchData.map(function(a){a=b.extend({},a);this.searchMap&&this.searchMap[a.field]&&(a.field=this.searchMap[a.field]);return a}.bind(this)),sort:this.sortData.map(function(a){a=b.extend({},a);this.sortMap&&this.sortMap[a.field]&&(a.field=this.sortMap[a.field]);return a}.bind(this))};0===this.searchData.length&&(delete f.search,delete f.searchLogic);0===this.sortData.length&&delete f.sort;b.extend(f,this.postData);b.extend(f,d);if("delete"==a||"save"==a)delete f.limit,
delete f.offset,f.action=a,"delete"==a&&(f[this.recid||"recid"]=this.getSelection());if("get"==a){if(d=this.trigger({phase:"before",type:"request",target:this.name,url:c,postData:f,httpHeaders:this.httpHeaders}),!0===d.isCancelled){"function"==typeof e&&e({status:"error",message:"Request aborted."});return}}else d={url:c,postData:f,httpHeaders:this.httpHeaders};var g=this;0===this.last.xhr_offset?g.lock(w2utils.lang(g.msgRefresh),!0):(c=b("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more"),
!0===this.autoLoad?c.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):c.find("td").html("<div>"+w2utils.lang("Load")+" "+g.limit+" "+w2utils.lang("More")+"...</div>"));if(this.last.xhr)try{this.last.xhr.abort()}catch(k){}c="object"!=typeof d.url?d.url:d.url.get;"save"==a&&"object"==typeof d.url&&(c=d.url.save);"delete"==a&&"object"==typeof d.url&&(c=d.url.remove);if(!b.isEmptyObject(g.routeData)&&(f=w2utils.parseRoute(c),0<f.keys.length))for(var h=
0;h<f.keys.length;h++)null!=g.routeData[f.keys[h].name]&&(c=c.replace(new RegExp(":"+f.keys[h].name,"g"),g.routeData[f.keys[h].name]));c={type:"POST",url:c,data:d.postData,headers:d.httpHeaders,dataType:"text"};switch(this.dataType||w2utils.settings.dataType){case "HTTP":c.data="object"==typeof c.data?String(b.param(c.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):c.data;break;case "HTTPJSON":c.data={request:JSON.stringify(c.data)};break;case "RESTFULL":c.type="GET";"save"==a&&(c.type="PUT");"delete"==
a&&(c.type="DELETE");c.data="object"==typeof c.data?String(b.param(c.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):c.data;break;case "RESTFULLJSON":c.type="GET";"save"==a&&(c.type="PUT");"delete"==a&&(c.type="DELETE");c.data=JSON.stringify(c.data);c.contentType="application/json";break;case "JSON":c.type="POST",c.data=JSON.stringify(c.data),c.contentType="application/json"}this.method&&(c.type=this.method);this.last.xhr_cmd=a;this.last.xhr_start=(new Date).getTime();this.last.loading=!0;this.last.xhr=
b.ajax(c).done(function(b,c,d){g.requestComplete(c,a,e)}).fail(function(c,d,f){f=g.trigger({phase:"before",type:"error",error:{status:d,error:f,rawResponseText:c.responseText},xhr:c});if(!0!==f.isCancelled){if("abort"!=d){try{var h=b.parseJSON(c.responseText)}catch(v){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof h?h:c.responseText);
g.requestComplete("error",a,e)}g.trigger(b.extend(f,{phase:"after"}))}});"get"==a&&this.trigger(b.extend(d,{phase:"after"}))}},requestComplete:function(a,d,c){var e=this;this.unlock();setTimeout(function(){e.show.statusResponse&&e.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-e.last.xhr_start)/1E3+" "+w2utils.lang("sec"));e.last.loading=!1},10);this.last.pull_more=!1;this.last.pull_refresh=!0;var f="load";"save"==this.last.xhr_cmd&&(f="save");"delete"==this.last.xhr_cmd&&(f="delete");
f=this.trigger({phase:"before",target:this.name,type:f,xhr:this.last.xhr,status:a});if(!0===f.isCancelled)"function"==typeof c&&c({status:"error",message:"Request aborted."});else{var g=this.last.xhr.responseText;if("error"!=a){if(null!=g&&""!=g){if("object"==typeof g)var h=g;else if("function"==typeof e.parser)h=e.parser(g),"object"!=typeof h&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+g)}catch(k){}null==h?h={status:"error",message:w2utils.lang(this.msgNotJSON),
responseText:g}:Array.isArray(h)&&(h={status:"success",records:h,total:h.length});if(e.recid&&h.records)for(a=0;a<h.records.length;a++)h.records[a].recid=h.records[a][e.recid];if("error"==h.status)e.error(h.message);else{if("get"==d){null==h.total&&(h.total=-1);null==h.records&&(h.records=[]);h.records.length==this.limit?this.last.xhr_hasMore=!0:(this.last.xhr_hasMore=!1,this.total=this.offset+this.last.xhr_offset+h.records.length);if(0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(h.total)&&
(this.total=parseInt(h.total));else if(-1!=h.total&&parseInt(h.total)!=parseInt(this.total)){this.message(w2utils.lang(this.msgNeedReload),function(){delete this.last.xhr_offset;this.reload()}.bind(this));return}if(h.records)for(a=0;a<h.records.length;a++)this.records.push(h.records[a]);if(h.summary)for(this.summary=[],a=0;a<h.summary.length;a++)this.summary.push(h.summary[a])}if("delete"==d){this.reset();this.reload();return}}}}else h={status:"error",message:w2utils.lang(this.msgAJAXerror),responseText:g},
e.error(w2utils.lang(this.msgAJAXerror));("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(),this.localSearch());this.total=parseInt(this.total);0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize());"function"==typeof c&&c(h);this.trigger(b.extend(f,{phase:"after"}))}},error:function(a){var d=this.trigger({target:this.name,type:"error",message:a,xhr:this.last.xhr});!0===d.isCancelled?"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}):
(this.message(a),this.trigger(b.extend(d,{phase:"after"})))},getChanges:function(a){var d=[];"undefined"==typeof a&&(a=this.records);for(var c=0;c<a.length;c++){var e=a[c];if(e.w2ui){if(null!=e.w2ui.changes){var f={};f[this.recid||"recid"]=e.recid;d.push(b.extend(!0,f,e.w2ui.changes))}!0!==e.w2ui.expanded&&e.w2ui.children&&e.w2ui.children.length&&b.merge(d,this.getChanges(e.w2ui.children))}}return d},mergeChanges:function(){for(var a=this.getChanges(),b=0;b<a.length;b++){var c=this.get(a[b].recid),
e;for(e in a[b])if("recid"!=e){"object"===typeof a[b][e]&&(a[b][e]=a[b][e].text);try{-1!=e.indexOf(".")?eval("record['"+e.replace(/\./g,"']['")+"'] = changes[c][s]"):c[e]=a[b][e]}catch(f){console.log("ERROR: Cannot merge. ",f.message||"",f)}c.w2ui&&delete c.w2ui.changes}}this.refresh()},save:function(a){var d=this,c=this.getChanges(),e="object"!=typeof this.url?this.url:this.url.save,f=this.trigger({phase:"before",target:this.name,type:"save",changes:c});!0===f.isCancelled?e&&"function"==typeof a&&
a({status:"error",message:"Request aborted."}):e?this.request("save",{changes:f.changes},null,function(c){"error"!==c.status&&d.mergeChanges();d.trigger(b.extend(f,{phase:"after"}));"function"==typeof a&&a(c)}):(this.mergeChanges(),this.trigger(b.extend(f,{phase:"after"})))},editField:function(a,d,c,e){function f(a){try{var c="DIV"==this.tagName.toUpperCase()?b(this).text():this.value,d=b("#grid_"+g.name+"_editable"),e="font-family: "+b(this).css("font-family")+"; font-size: "+b(this).css("font-size")+
"; white-space: pre;",f=w2utils.getStrWidth(c,e);f+20>d.width()&&d.width(f+20)}catch(C){}}var g=this;if(!0===this.last.inEditMode)if(13==e.keyCode){var h=this.last._edit.index;d=this.last._edit.column;a=this.last._edit.recid;this.editChange({type:"custom",value:this.last._edit.value},this.get(a,!0),d,e);var k=e.shiftKey?this.prevRow(h,d):this.nextRow(h,d);null!=k&&k!=h&&setTimeout(function(){"row"!=g.selectType?(g.selectNone(),g.select({recid:g.records[k].recid,column:d})):g.editField(g.records[k].recid,
d,null,e)},1);this.last.inEditMode=!1}else{var n=b(this.box).find("div.w2ui-edit-box .w2ui-input");0<n.length&&"DIV"==n[0].tagName&&(n.text(n.text()+c),w2utils.setCursorPosition(n[0],n.text().length))}else{h=g.get(a,!0);var m=g.getCellEditable(h,d);if(m){var p=g.records[h],l=g.columns[d];n=!0===l.frozen?"_f":"_";if(-1!=["enum","file"].indexOf(m.type))console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');else{var r=g.trigger({phase:"before",type:"editField",target:g.name,
recid:a,column:d,value:c,index:h,originalEvent:e});if(!0!==r.isCancelled&&(c=r.value,this.last.inEditMode=!0,this.last._edit={value:c,index:h,column:d,recid:a},this.selectNone(),this.select({recid:a,column:d}),-1==["checkbox","check"].indexOf(m.type))){var t=b("#grid_"+g.name+n+"rec_"+w2utils.escapeId(a)),x=t.find("[col="+d+"] > div");b(this.box).find("div.w2ui-edit-box").remove();"row"!=this.selectType&&(b("#grid_"+this.name+n+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),
x=b("#grid_"+this.name+"_editable >div:first-child"));null==m.inTag&&(m.inTag="");null==m.outTag&&(m.outTag="");null==m.style&&(m.style="");null==m.items&&(m.items=[]);var w=p.w2ui&&p.w2ui.changes&&null!=p.w2ui.changes[l.field]?w2utils.stripTags(p.w2ui.changes[l.field]):w2utils.stripTags(p[l.field]);null==w&&(w="");var u="object"!=typeof w?w:"";null!=r.old_value&&(u=r.old_value);null!=c&&(w=c);n=null!=l.style?l.style+";":"";"string"==typeof l.render&&-1!="number int float money percent size".split(" ").indexOf(l.render.split(":")[0])&&
(n+="text-align: right;");0<m.items.length&&!b.isPlainObject(m.items[0])&&(m.items=w2obj.field.prototype.normMenu(m.items));switch(m.type){case "select":c="";for(t=0;t<m.items.length;t++)c+='<option value="'+m.items[t].id+'"'+(m.items[t].id==w?' selected="selected"':"")+">"+m.items[t].text+"</option>";x.addClass("w2ui-editable").html('<select id="grid_'+g.name+"_edit_"+a+"_"+d+'" column="'+d+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+
n+m.style+'"     field="'+l.field+'" recid="'+a+'"     '+m.inTag+">"+c+"</select>"+m.outTag);setTimeout(function(){x.find("select").on("change",function(a){delete g.last.move}).on("blur",function(a){1!=b(this).data("keep-open")&&g.editChange.call(g,this,h,d,a)})},10);break;case "div":t=t.find("[col="+d+"] > div");t="font-family: "+t.css("font-family")+"; font-size: "+t.css("font-size")+";";x.addClass("w2ui-editable").html('<div id="grid_'+g.name+"_edit_"+a+"_"+d+'" class="w2ui-input"    contenteditable style="'+
t+n+m.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+l.field+'" recid="'+a+'" column="'+d+'" '+m.inTag+"></div>"+m.outTag);null==c&&x.find("div.w2ui-input").text("object"!=typeof w?w:"");var y=x.find("div.w2ui-input").get(0);setTimeout(function(){var a=y;b(a).on("blur",function(c){1!=b(this).data("keep-open")&&g.editChange.call(g,a,h,d,c)})},10);null!=c&&b(y).text("object"!=typeof w?w:"");break;default:t=t.find("[col="+d+"] > div"),t="font-family: "+t.css("font-family")+
"; font-size: "+t.css("font-size"),x.addClass("w2ui-editable").html('<input id="grid_'+g.name+"_edit_"+a+"_"+d+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+t+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+n+m.style+'"     field="'+l.field+'" recid="'+a+'" column="'+d+'" class="w2ui-input"'+m.inTag+"/>"+m.outTag),"number"==m.type&&(w=w2utils.formatNumber(w)),"date"==m.type&&
(w=w2utils.formatDate(w2utils.isDate(w,m.format,!0)||new Date,m.format)),null==c&&x.find("input").val("object"!=typeof w?w:""),y=x.find("input").get(0),b(y).w2field(m.type,b.extend(m,{selected:w})),setTimeout(function(){var a=y;"list"==m.type&&(a=b(b(y).data("w2field").helpers.focus).find("input"),"object"!=typeof w&&""!=w&&a.val(w).css({opacity:1}).prev().css({opacity:1}),x.find("input").on("change",function(a){g.editChange.call(g,y,h,d,a)}));b(a).on("blur",function(a){1!=b(this).data("keep-open")&&
g.editChange.call(g,y,h,d,a)})},10),null!=c&&b(y).val("object"!=typeof w?w:"")}setTimeout(function(){g.last.inEditMode&&(x.find("input, select, div.w2ui-input").data("old_value",u).on("mousedown",function(a){a.stopPropagation()}).on("click",function(a){"div"==m.type?f.call(x.find("div.w2ui-input")[0],null):f.call(x.find("input, select")[0],null)}).on("paste",function(a){var b=a.originalEvent;a.preventDefault();a=b.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,a)}).on("keydown",
function(c){var e=this,k="DIV"==e.tagName.toUpperCase()?b(e).text():b(e).val();switch(c.keyCode){case 8:"list"!=m.type||b(y).data("w2field")||c.preventDefault();break;case 9:case 13:c.preventDefault();break;case 37:0===w2utils.getCursorPosition(e)&&c.preventDefault();break;case 39:w2utils.getCursorPosition(e)==k.length&&(w2utils.setCursorPosition(e,k.length),c.preventDefault())}setTimeout(function(){switch(c.keyCode){case 9:var m=a,k=c.shiftKey?g.prevCell(h,d,!0):g.nextCell(h,d,!0);if(null==k){var n=
c.shiftKey?g.prevRow(h,d):g.nextRow(h,d);if(null!=n&&n!=h)for(m=g.records[n].recid,n=0;n<g.columns.length;n++){var v=g.getCellEditable(h,n);if(null!=v&&-1==["checkbox","check"].indexOf(v.type)&&(k=parseInt(n),!c.shiftKey))break}}!1===m&&(m=a);null==k&&(k=d);e.blur();setTimeout(function(){"row"!=g.selectType?(g.selectNone(),g.select({recid:m,column:k})):g.editField(m,k,null,c)},1);c.preventDefault&&c.preventDefault();break;case 13:e.blur();var t=c.shiftKey?g.prevRow(h,d):g.nextRow(h,d);null!=t&&t!=
h&&setTimeout(function(){"row"!=g.selectType?(g.selectNone(),g.select({recid:g.records[t].recid,column:d})):g.editField(g.records[t].recid,d,null,c)},1);"DIV"==e.tagName.toUpperCase()&&c.preventDefault();break;case 27:n=g.parseField(p,l.field),p.w2ui&&p.w2ui.changes&&null!=p.w2ui.changes[l.field]&&(n=p.w2ui.changes[l.field]),null!=b(e).data("old_value")&&(n=b(e).data("old_value")),"DIV"==e.tagName.toUpperCase()?b(e).text(null!=n?n:""):e.value=null!=n?n:"",e.blur(),setTimeout(function(){g.select({recid:a,
column:d})},1)}f.call(e,c)},1)}).on("keyup",function(a){f.call(this,a)}),setTimeout(function(){if(g.last.inEditMode){var a=x.find(".w2ui-input"),c=null!=b(a).val()?b(a).val().length:0;"div"==m.type&&(c=b(a).text().length);0<a.length&&(a.focus(),clearTimeout(g.last.kbd_timer),"SELECT"!=a[0].tagName.toUpperCase()&&w2utils.setCursorPosition(a[0],c),a[0].resize=f,f.call(a[0],null))}},50),g.trigger(b.extend(r,{phase:"after",input:x.find("input, select, div.w2ui-input")})))},5)}}}}},editChange:function(a,
d,c,e){var f=this;setTimeout(function(){var a=b(f.box).find("#grid_"+f.name+"_focus");a.is(":focus")||a.focus()},10);var g=0>d;d=0>d?-d-1:d;var h=(g?this.summary:this.records)[d],k=this.columns[c],n=b("#grid_"+this.name+(!0===k.frozen?"_frec_":"_rec_")+w2utils.escapeId(h.recid)),m=a.tagName&&"DIV"==a.tagName.toUpperCase()?b(a).text():a.value,p=this.parseField(h,k.field),l=b(a).data("w2field");if(l){"list"==l.type&&(m=b(a).data("selected"));if(b.isEmptyObject(m)||null==m)m="";b.isPlainObject(m)||(m=
l.clean(m))}"checkbox"==a.type&&(h.w2ui&&!1===h.w2ui.editable&&(a.checked=!a.checked),m=a.checked);a={phase:"before",type:"change",target:this.name,input_id:a.id,recid:h.recid,index:d,column:c,originalEvent:e.originalEvent?e.originalEvent:e,value_new:m,value_previous:h.w2ui&&h.w2ui.changes&&h.w2ui.changes.hasOwnProperty(k.field)?h.w2ui.changes[k.field]:p,value_original:p};null!=b(e.target).data("old_value")&&(a.value_previous=b(e.target).data("old_value"));for(;;){m=a.value_new;if("object"!=typeof m&&
String(p)!=String(m)||"object"==typeof m&&m&&m.id!=p&&("object"!=typeof p||null==p||m.id!=p.id)){if(a=this.trigger(b.extend(a,{type:"change",phase:"before"})),!0!==a.isCancelled){if(m!==a.value_new)continue;h.w2ui=h.w2ui||{};h.w2ui.changes=h.w2ui.changes||{};h.w2ui.changes[k.field]=a.value_new;this.trigger(b.extend(a,{phase:"after"}))}}else if(a=this.trigger(b.extend(a,{type:"restore",phase:"before"})),!0!==a.isCancelled){if(m!==a.value_new)continue;h.w2ui&&h.w2ui.changes&&delete h.w2ui.changes[k.field];
h.w2ui&&b.isEmptyObject(h.w2ui.changes)&&delete h.w2ui.changes;this.trigger(b.extend(a,{phase:"after"}))}break}e=b(n).find("[col="+c+"]");g||(h.w2ui&&h.w2ui.changes&&null!=h.w2ui.changes[k.field]?e.addClass("w2ui-changed"):e.removeClass("w2ui-changed"),e.replaceWith(this.getCellHTML(d,c,g)));b(this.box).find("div.w2ui-edit-box").remove();this.show.toolbarSave&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"));f.last.inEditMode=!1},"delete":function(a){(new Date).getTime();
var d=this,c=this.trigger({phase:"before",target:this.name,type:"delete",force:a});a&&this.message();if(!0!==c.isCancelled){a=c.force;setTimeout(function(){b().w2tag()},20);var e=this.getSelection();if(0!==e.length)if(""==this.msgDelete||a){if("object"!=typeof this.url?this.url:this.url.remove)this.request("delete");else if("object"!=typeof e[0])this.selectNone(),this.remove.apply(this,e);else{for(a=0;a<e.length;a++){var f=this.columns[e[a].column].field,g=this.get(e[a].recid,!0),h=this.records[g];
null!=g&&"recid"!=f&&(this.records[g][f]="",h.w2ui&&h.w2ui.changes&&delete h.w2ui.changes[f])}this.update()}this.trigger(b.extend(c,{phase:"after"}))}else this.message({width:380,height:170,body:'<div class="w2ui-centered">'+w2utils.lang(d.msgDelete).replace("NN",e.length).replace("records",1==e.length?"record":"records")+"</div>",buttons:w2utils.settings.macButtonOrder?'<button type="button" class="w2ui-btn btn-default" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("Cancel")+'</button><button type="button" class="w2ui-btn" onclick="w2ui[\''+
this.name+"'].delete(true)\">"+w2utils.lang(this.msgDeleteBtn)+"</button>":'<button type="button" class="w2ui-btn" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang(this.msgDeleteBtn)+'</button><button type="button" class="w2ui-btn btn-default" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("Cancel")+"</button>",onOpen:function(a){var c=b(this.box).find("input, textarea, select, button");c.off(".message").on("blur.message",function(a){c.index(a.target)+1===c.length&&(c.get(0).focus(),
a.preventDefault())}).on("keydown.message",function(a){27==a.keyCode&&d.message()});setTimeout(function(){b(this.box).find(".w2ui-btn.btn-default").focus();clearTimeout(d.last.kbd_timer)}.bind(this),50)}})}},click:function(a,d){var c=(new Date).getTime(),e=null;if(!(1==this.last.cancelClick||d&&d.altKey))if("object"==typeof a&&null!==a&&(e=a.column,a=a.recid),null==d&&(d={}),350>c-parseInt(this.last.click_time)&&this.last.click_recid==a&&"click"==d.type)this.dblClick(a,d);else{this.last.bubbleEl&&
(b(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);this.last.click_time=c;var f=this.last.click_recid;this.last.click_recid=a;if(null==e&&d.target){var g=d.target;"TD"!=g.tagName.toUpperCase()&&(g=b(g).parents("td")[0]);null!=b(g).attr("col")&&(e=parseInt(b(g).attr("col")))}c=this.trigger({phase:"before",target:this.name,type:"click",recid:a,column:e,originalEvent:d});if(!0!==c.isCancelled){g=this.getSelection();b("#grid_"+this.name+"_check_all").prop("checked",!1);var h=this.get(a,!0),k=[];
this.last.sel_ind=h;this.last.sel_col=e;this.last.sel_recid=a;this.last.sel_type="click";if(d.shiftKey&&0<g.length&&this.multiSelect){if(g[0].recid)for(d=this.get(g[0].recid,!0),a=this.get(a,!0),e>g[0].column?h=g[0].column:(h=e,e=g[0].column),g=h;g<=e;g++)k.push(g);else d=this.get(f,!0),a=this.get(a,!0);e=[];d>a&&(g=d,d=a,a=g);for(g="object"!=typeof this.url?this.url:this.url.get;d<=a;d++)if(!(0<this.searchData.length)||g||-1!=b.inArray(d,this.last.searchIds))if("row"==this.selectType)e.push(this.records[d].recid);
else for(h=0;h<k.length;h++)e.push({recid:this.records[d].recid,column:k[h]});this.select.apply(this,e)}else{k=this.last.selection;f=-1!=k.indexes.indexOf(h)?!0:!1;var n=!1;b(d.target).parents("td").hasClass("w2ui-col-select")&&(n=!0);(d.ctrlKey||d.shiftKey||d.metaKey||n)&&this.multiSelect||this.showSelectColumn?(g=b(d.target).parents("tr").find(".w2ui-grid-select-check").is(":checked"),"row"==this.selectType||-1!=b.inArray(e,k.columns[h])||g||(f=!1),!0===f?this.unselect({recid:a,column:e}):this.select({recid:a,
column:e})):("row"!=this.selectType&&-1==b.inArray(e,k.columns[h])&&(f=!1),300<g.length?this.selectNone():this.unselect.apply(this,g),!0===f&&1==g.length?this.unselect({recid:a,column:e}):this.select({recid:a,column:e}))}this.status();this.initResize();this.trigger(b.extend(c,{phase:"after"}))}}},columnClick:function(a,d){var c=this.trigger({phase:"before",type:"columnClick",target:this.name,field:a,originalEvent:d});if(!0!==c.isCancelled){if("row"==this.selectType){var e=this.getColumn(a);e&&e.sortable&&
this.sort(a,null,d&&(d.ctrlKey||d.metaKey)?!0:!1);"line-number"==c.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll())}else if(d.altKey&&(e=this.getColumn(a))&&e.sortable&&this.sort(a,null,d&&(d.ctrlKey||d.metaKey)?!0:!1),"line-number"==c.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{d.shiftKey||d.metaKey||d.ctrlKey||this.selectNone();var f=this.getSelection();e=this.getColumn(c.field,!0);a=[];var g=[];if(0!=f.length&&
d.shiftKey)for(d=e,c=f[0].column,d>c&&(d=f[0].column,c=e),e=d;e<=c;e++)g.push(e);else g.push(e);c=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:g});if(!0!==c.isCancelled){for(e=0;e<this.records.length;e++)a.push({recid:this.records[e].recid,column:g});this.select.apply(this,a)}this.trigger(b.extend(c,{phase:"after"}))}this.trigger(b.extend(c,{phase:"after"}))}},columnDblClick:function(a,d){a=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:a,originalEvent:d});
!0!==a.isCancelled&&this.trigger(b.extend(a,{phase:"after"}))},focus:function(a){var d=this;a=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=!0;b(this.box).removeClass("w2ui-inactive").find(".w2ui-inactive").removeClass("w2ui-inactive");setTimeout(function(){var a=b(d.box).find("#grid_"+d.name+"_focus");a.is(":focus")||a.focus()},10);this.trigger(b.extend(a,{phase:"after"}))},blur:function(a){a=this.trigger({phase:"before",
type:"blur",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=!1;b(this.box).addClass("w2ui-inactive").find(".w2ui-selected").addClass("w2ui-inactive");b(this.box).find(".w2ui-selection").addClass("w2ui-inactive");this.trigger(b.extend(a,{phase:"after"}))},keydown:function(a){function d(){var a=Math.floor(k[0].scrollTop/e.recordHeight)+1;if(!e.records[a]||2>a)a=0;e.select({recid:e.records[a].recid,column:0})}function c(){if("click"!=e.last.sel_type)return!1;if("row"!=
e.selectType){if(e.last.sel_type="key",1<n.length){for(var a=0;a<n.length;a++)if(n[a].recid==e.last.sel_recid&&n[a].column==e.last.sel_col){n.splice(a,1);break}e.unselect.apply(e,n);return!0}}else if(e.last.sel_type="key",1<n.length)return n.splice(n.indexOf(e.records[e.last.sel_ind].recid),1),e.unselect.apply(e,n),!0;return!1}var e=this,f="object"!=typeof this.url?this.url:this.url.get;if(!0===e.keyboard){var g=e.trigger({phase:"before",type:"keydown",target:e.name,originalEvent:a});if(!0!==g.isCancelled)if(0<
b(this.box).find(">.w2ui-message").length)27==a.keyCode&&this.message();else{var h=!1,k=b("#grid_"+e.name+"_records"),n=e.getSelection();0===n.length&&(h=!0);var m=n[0]||null,p=[],l=n[n.length-1];if("object"==typeof m&&null!=m){m=n[0].recid;p=[];for(var r=0;n[r]&&n[r].recid==m;)p.push(n[r].column),r++;l=n[n.length-1].recid}r=e.get(m,!0);var t=e.get(l,!0);e.get(m);var x=b("#grid_"+e.name+"_rec_"+(null!=r?w2utils.escapeId(e.records[r].recid):"none")),w=!1;l=a.keyCode;var u=a.shiftKey;switch(l){case 8:case 46:e["delete"]();
w=!0;a.stopPropagation();break;case 27:e.selectNone();w=!0;break;case 65:if(!a.metaKey&&!a.ctrlKey)break;e.selectAll();w=!0;break;case 13:if("row"==this.selectType&&!0===e.show.expandColumn)0>=x.length||(e.toggle(m,a),w=!0);else{for(u=0;u<this.columns.length;u++)if(this.getCellEditable(r,u)){p.push(parseInt(u));break}"row"==this.selectType&&this.last._edit&&this.last._edit.column&&(p=[this.last._edit.column]);0<p.length&&(e.editField(m,p[0],null,a),w=!0)}break;case 37:if(h){d();break}if("row"==this.selectType){if(0>=
x.length)break;f=this.records[r].w2ui||{};!f||null==f.parent_recid||Array.isArray(f.children)&&0!==f.children.length&&f.expanded?e.collapse(m,a):(e.unselect(m),e.collapse(f.parent_recid,a),e.select(f.parent_recid))}else if(h=e.prevCell(r,p[0]),u||null!=h||(this.selectNone(),h=0),null!=h)if(u&&e.multiSelect){if(c())return;f=[];w=[];t=[];if(0===p.indexOf(this.last.sel_col)&&1<p.length){for(u=0;u<n.length;u++)-1==f.indexOf(n[u].recid)&&f.push(n[u].recid),t.push({recid:n[u].recid,column:p[p.length-1]});
e.unselect.apply(e,t);e.scrollIntoView(r,p[p.length-1],!0)}else{for(u=0;u<n.length;u++)-1==f.indexOf(n[u].recid)&&f.push(n[u].recid),w.push({recid:n[u].recid,column:h});e.select.apply(e,w);e.scrollIntoView(r,h,!0)}}else a.metaKey=!1,e.click({recid:m,column:h},a),e.scrollIntoView(r,h,!0);else if(!u)if(1<n.length)e.selectNone();else for(r=1;r<n.length;r++)e.unselect(n[r]);w=!0;break;case 39:if(h){d();break}if("row"==this.selectType){if(0>=x.length)break;e.expand(m,a)}else if(h=e.nextCell(r,p[p.length-
1]),u||null!=h||(this.selectNone(),h=this.columns.length-1),null!=h)if(u&&39==l&&e.multiSelect){if(c())return;f=[];w=[];t=[];if(p.indexOf(this.last.sel_col)==p.length-1&&1<p.length){for(u=0;u<n.length;u++)-1==f.indexOf(n[u].recid)&&f.push(n[u].recid),t.push({recid:n[u].recid,column:p[0]});e.unselect.apply(e,t);e.scrollIntoView(r,p[0],!0)}else{for(u=0;u<n.length;u++)-1==f.indexOf(n[u].recid)&&f.push(n[u].recid),w.push({recid:n[u].recid,column:h});e.select.apply(e,w);e.scrollIntoView(r,h,!0)}}else a.metaKey=
!1,e.click({recid:m,column:h},a),e.scrollIntoView(r,h,!0);else if(!u)if(1<n.length)e.selectNone();else for(r=0;r<n.length-1;r++)e.unselect(n[r]);w=!0;break;case 38:h&&d();if(0>=x.length)break;h=e.prevRow(r,p[0]);u||null!=h||(h=0==this.searchData.length||f?0:this.last.searchIds[0]);if(null!=h){if(u&&e.multiSelect){if(c())return;if("row"==e.selectType)e.last.sel_ind>h&&e.last.sel_ind!=t?e.unselect(e.records[t].recid):e.select(e.records[h].recid);else if(e.last.sel_ind>h&&e.last.sel_ind!=t){h=t;f=[];
for(u=0;u<p.length;u++)f.push({recid:e.records[h].recid,column:p[u]});e.unselect.apply(e,f)}else{f=[];for(u=0;u<p.length;u++)f.push({recid:e.records[h].recid,column:p[u]});e.select.apply(e,f)}}else 300<n.length?this.selectNone():this.unselect.apply(this,n),e.click({recid:e.records[h].recid,column:p[0]},a);e.scrollIntoView(h);a.preventDefault&&a.preventDefault()}else if(!u)if(1<n.length)e.selectNone();else for(r=1;r<n.length;r++)e.unselect(n[r]);break;case 40:h&&d();if(0>=x.length)break;h=e.nextRow(t,
p[0]);u||null!=h||(h=0==this.searchData.length||f?this.records.length-1:this.last.searchIds[this.last.searchIds.length-1]);if(null!=h){if(u&&e.multiSelect){if(c())return;if("row"==e.selectType)this.last.sel_ind<h&&this.last.sel_ind!=r?e.unselect(e.records[r].recid):e.select(e.records[h].recid);else if(this.last.sel_ind<h&&this.last.sel_ind!=r){h=r;f=[];for(u=0;u<p.length;u++)f.push({recid:e.records[h].recid,column:p[u]});e.unselect.apply(e,f)}else{f=[];for(u=0;u<p.length;u++)f.push({recid:e.records[h].recid,
column:p[u]});e.select.apply(e,f)}}else 300<n.length?this.selectNone():this.unselect.apply(this,n),e.click({recid:e.records[h].recid,column:p[0]},a);e.scrollIntoView(h);w=!0}else if(!u)if(1<n.length)e.selectNone();else for(r=0;r<n.length-1;r++)e.unselect(n[r]);break;case 17:case 91:if(h)break;e.last.isSafari&&(e.last.copy_event=e.copy(!1,a),b("#grid_"+e.name+"_focus").val(e.last.copy_event.text).select());break;case 67:if(a.metaKey||a.ctrlKey)e.last.isSafari||(e.last.copy_event=e.copy(!1,a),b("#grid_"+
e.name+"_focus").val(e.last.copy_event.text).select()),e.copy(e.last.copy_event,a);break;case 88:h||!a.ctrlKey&&!a.metaKey||(e.last.isSafari||(e.last.copy_event=e.copy(!1,a),b("#grid_"+e.name+"_focus").val(e.last.copy_event.text).select()),e.copy(e.last.copy_event,a))}f=[32,187,189,192,219,220,221,186,222,188,190,191];for(u=48;111>=u;u++)f.push(u);-1==f.indexOf(l)||a.ctrlKey||a.metaKey||w||(0===p.length&&p.push(0),w=!1,setTimeout(function(){var c=b("#grid_"+e.name+"_focus"),d=c.val();c.val("");e.editField(m,
p[0],d,a)},1));w&&a.preventDefault&&a.preventDefault();e.trigger(b.extend(g,{phase:"after"}))}}},scrollIntoView:function(a,d,c){var e=this.records.length;0==this.searchData.length||this.url||(e=this.last.searchIds.length);if(0!==e){if(null==a){var f=this.getSelection();if(0===f.length)return;b.isPlainObject(f[0])?(a=f[0].index,d=f[0].column):a=this.get(f[0],!0)}f=b("#grid_"+this.name+"_records");var g=this.last.searchIds.length;0<g&&(a=this.last.searchIds.indexOf(a));f.height()<this.recordHeight*
(0<g?g:e)&&0<f.length&&(e=Math.floor(f[0].scrollTop/this.recordHeight),g=e+Math.floor(f.height()/this.recordHeight),a==e&&(!0===c?f.prop({scrollTop:f.scrollTop()-f.height()/1.3}):(f.stop(),f.animate({scrollTop:f.scrollTop()-f.height()/1.3},250,"linear"))),a==g&&(!0===c?f.prop({scrollTop:f.scrollTop()+f.height()/1.3}):(f.stop(),f.animate({scrollTop:f.scrollTop()+f.height()/1.3},250,"linear"))),a<e||a>g)&&(!0===c?f.prop({scrollTop:(a-1)*this.recordHeight}):(f.stop(),f.animate({scrollTop:(a-1)*this.recordHeight},
250,"linear")));if(null!=d){e=a=0;g=w2utils.scrollBarSize();for(var h=0;h<=d;h++){var k=this.columns[h];k.frozen||k.hidden||(a=e,e+=parseInt(k.sizeCalculated))}f.width()<e-f.scrollLeft()?!0===c?f.prop({scrollLeft:a-g}):f.animate({scrollLeft:a-g},250,"linear"):a<f.scrollLeft()&&(!0===c?f.prop({scrollLeft:e-f.width()+2*g}):f.animate({scrollLeft:e-f.width()+2*g},250,"linear"))}}},dblClick:function(a,d){var c=null;"object"==typeof a&&null!==a&&(c=a.column,a=a.recid);null==d&&(d={});null==c&&d.target&&
(c=d.target,"TD"!=c.tagName.toUpperCase()&&(c=b(c).parents("td")[0]),c=parseInt(b(c).attr("col")));var e=this.get(a,!0),f=this.records[e],g=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:a,column:c,originalEvent:d});!0!==g.isCancelled&&(this.selectNone(),this.getCellEditable(e,c)?this.editField(a,c,null,d):(this.select({recid:a,column:c}),(this.show.expandColumn||f.w2ui&&Array.isArray(f.w2ui.children))&&this.toggle(a)),this.trigger(b.extend(g,{phase:"after"})))},contextMenu:function(a,
d,c){var e=this;if("text"!=e.last.userSelect){null==c&&(c={offsetX:0,offsetY:0,target:b("#grid_"+e.name+"_rec_"+a)[0]});null==c.offsetX&&(c.offsetX=c.layerX-c.target.offsetLeft,c.offsetY=c.layerY-c.target.offsetTop);w2utils.isFloat(a)&&(a=parseFloat(a));var f=this.getSelection();if("row"==this.selectType)-1==f.indexOf(a)&&e.click(a);else{d=b(c.target);"TD"!=d[0].tagName.toUpperCase()&&(d=b(c.target).parents("td"));var g=!1;d=d.attr("col");for(var h=0;h<f.length;h++)if(f[h].recid==a||f[h].column==
d)g=!0;g||null==a||e.click({recid:a,column:d});g||null==d||e.columnClick(this.columns[d].field,c)}f=e.trigger({phase:"before",type:"contextMenu",target:e.name,originalEvent:c,recid:a,column:d});!0!==f.isCancelled&&(0<e.menu.length&&b(e.box).find(c.target).w2menu(e.menu,{originalEvent:c,contextMenu:!0,onSelect:function(b){e.menuClick(a,parseInt(b.index),b.originalEvent)}}),c.preventDefault&&c.preventDefault(),e.trigger(b.extend(f,{phase:"after"})))}},menuClick:function(a,d,c){a=this.trigger({phase:"before",
type:"menuClick",target:this.name,originalEvent:c,recid:a,menuIndex:d,menuItem:this.menu[d]});!0!==a.isCancelled&&this.trigger(b.extend(a,{phase:"after"}))},toggle:function(a){var b=this.get(a);b.w2ui=b.w2ui||{};return!0===b.w2ui.expanded?this.collapse(a):this.expand(a)},expand:function(a){var d=this.get(a,!0),c=this.records[d];c.w2ui=c.w2ui||{};var e=w2utils.escapeId(a),f=c.w2ui.children;if(Array.isArray(f)){if(!0===c.w2ui.expanded||0===f.length)return!1;var g=this.trigger({phase:"before",type:"expand",
target:this.name,recid:a});if(!0===g.isCancelled)return!1;c.w2ui.expanded=!0;f.forEach(function(a){a.w2ui=a.w2ui||{};a.w2ui.parent_recid=c.recid;null==a.w2ui.children&&(a.w2ui.children=[])});this.records.splice.apply(this.records,[d+1,0].concat(f));this.total+=f.length;("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(!0,!0),0<this.searchData.length&&this.localSearch(!0));this.refresh();this.trigger(b.extend(g,{phase:"after"}))}else{if(0<b("#grid_"+this.name+"_rec_"+e+"_expanded_row").length||
!0!==this.show.expandColumn||"none"==c.w2ui.expanded)return!1;b("#grid_"+this.name+"_rec_"+e).after('<tr id="grid_'+this.name+"_rec_"+a+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+a+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>');b("#grid_"+this.name+"_frec_"+e).after('<tr id="grid_'+this.name+"_frec_"+a+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':
"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+a+'_expanded"></div>   </td></tr>');g=this.trigger({phase:"before",type:"expand",target:this.name,recid:a,box_id:"grid_"+this.name+"_rec_"+a+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+e+"_expanded"});if(!0===g.isCancelled)return b("#grid_"+this.name+"_rec_"+e+"_expanded_row").remove(),b("#grid_"+this.name+"_frec_"+e+"_expanded_row").remove(),!1;d=b(this.box).find("#grid_"+this.name+"_rec_"+
a+"_expanded");f=b(this.box).find("#grid_"+this.name+"_frec_"+a+"_expanded");var h=d.find("> div:first-child").height();d.height()<h&&d.css({height:h+"px"});f.height()<h&&f.css({height:h+"px"});b("#grid_"+this.name+"_rec_"+e).attr("expanded","yes").addClass("w2ui-expanded");b("#grid_"+this.name+"_frec_"+e).attr("expanded","yes").addClass("w2ui-expanded");b("#grid_"+this.name+"_cell_"+this.get(a,!0)+"_expand div").html("-");c.w2ui.expanded=!0;this.trigger(b.extend(g,{phase:"after"}));this.resizeRecords()}return!0},
collapse:function(a){function d(a){a.w2ui.expanded=!1;for(var b=0;b<a.w2ui.children.length;b++){var c=a.w2ui.children[b];c.w2ui.expanded&&d(c)}}var c=this,e=this.get(a,!0),f=this.records[e];f.w2ui=f.w2ui||{};var g=w2utils.escapeId(a);if(Array.isArray(f.w2ui.children)){if(!0!==f.w2ui.expanded)return!1;var h=this.trigger({phase:"before",type:"collapse",target:this.name,recid:a});if(!0===h.isCancelled)return!1;d(f);a=[];for(var k=f;null!=k;k=this.get(k.w2ui.parent_recid))a.push(k.w2ui.parent_recid);
for(k=e+=1;!(this.records.length<=k+1||null==this.records[k+1].w2ui||0<=a.indexOf(this.records[k+1].w2ui.parent_recid));)k++;this.records.splice(e,k-e+1);this.total-=k-e+1;("object"!=typeof this.url?this.url:this.url.get)||0<this.searchData.length&&this.localSearch(!0);this.refresh();c.trigger(b.extend(h,{phase:"after"}))}else{if(0===b("#grid_"+this.name+"_rec_"+g+"_expanded_row").length||!0!==this.show.expandColumn)return!1;h=this.trigger({phase:"before",type:"collapse",target:this.name,recid:a,
box_id:"grid_"+this.name+"_rec_"+g+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+g+"_expanded"});if(!0===h.isCancelled)return!1;b("#grid_"+this.name+"_rec_"+g).removeAttr("expanded").removeClass("w2ui-expanded");b("#grid_"+this.name+"_frec_"+g).removeAttr("expanded").removeClass("w2ui-expanded");b("#grid_"+this.name+"_cell_"+this.get(a,!0)+"_expand div").html("+");b("#grid_"+c.name+"_rec_"+g+"_expanded").css("height","0px");b("#grid_"+c.name+"_frec_"+g+"_expanded").css("height","0px");setTimeout(function(){b("#grid_"+
c.name+"_rec_"+g+"_expanded_row").remove();b("#grid_"+c.name+"_frec_"+g+"_expanded_row").remove();f.w2ui.expanded=!1;c.trigger(b.extend(h,{phase:"after"}));c.resizeRecords()},300)}return!0},sort:function(a,d,c){var e=this.trigger({phase:"before",type:"sort",target:this.name,field:a,direction:d,multiField:c});if(!0!==e.isCancelled){if(null!=a){for(var f=this.sortData.length,g=0;g<this.sortData.length;g++)if(this.sortData[g].field==a){f=g;break}if(null==d)if(null==this.sortData[f])d="asc";else switch(null==
this.sortData[f].direction&&(this.sortData[f].direction=""),this.sortData[f].direction.toLowerCase()){case "asc":d="desc";break;case "desc":d="asc";break;default:d="asc"}!1===this.multiSort&&(this.sortData=[],f=0);1!=c&&(this.sortData=[],f=0);null==this.sortData[f]&&(this.sortData[f]={});this.sortData[f].field=a;this.sortData[f].direction=d}else this.sortData=[];("object"!=typeof this.url?this.url:this.url.get)?(this.trigger(b.extend(e,{phase:"after",direction:d})),this.last.xhr_offset=0,this.reload()):
(this.localSort(!0,!0),0<this.searchData.length&&this.localSearch(!0),this.last.scrollTop=0,b("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger(b.extend(e,{phase:"after",direction:d})),this.refresh())}},copy:function(a,d){if(b.isPlainObject(a))return this.trigger(b.extend(a,{phase:"after"})),a.text;var c=this.getSelection();if(0===c.length)return"";var e="";if("object"==typeof c[0]){for(var f=c[0].column,g=c[0].column,h=[],k=0;k<c.length;k++)c[k].column<f&&(f=c[k].column),c[k].column>
g&&(g=c[k].column),-1==h.indexOf(c[k].index)&&h.push(c[k].index);h.sort(function(a,b){return a-b});for(c=0;c<h.length;c++){for(var n=h[c],m=f;m<=g;m++){var p=this.columns[m];!0!==p.hidden&&(e+=this.getCellCopy(n,m)+"\t")}e=e.substr(0,e.length-1);e+="\n"}}else{for(m=0;m<this.columns.length;m++)p=this.columns[m],!0!==p.hidden&&(f=p.text?p.text:p.field,p.text&&3>p.text.length&&p.tooltip&&(f=p.tooltip),e+='"'+w2utils.stripTags(f)+'"\t');e=e.substr(0,e.length-1);e+="\n";for(k=0;k<c.length;k++){n=this.get(c[k],
!0);for(m=0;m<this.columns.length;m++)p=this.columns[m],!0!==p.hidden&&(e+='"'+this.getCellCopy(n,m)+'"\t');e=e.substr(0,e.length-1);e+="\n"}}e=e.substr(0,e.length-1);if(null==a){a=this.trigger({phase:"before",type:"copy",target:this.name,text:e,cut:88==d.keyCode?!0:!1,originalEvent:d});if(!0===a.isCancelled)return"";e=a.text;this.trigger(b.extend(a,{phase:"after"}));return e}if(!1===a){a=this.trigger({phase:"before",type:"copy",target:this.name,text:e,cut:88==d.keyCode?!0:!1,originalEvent:d});if(!0===
a.isCancelled)return"";e=a.text;return a}},getCellCopy:function(a,b){return w2utils.stripTags(this.getCellHTML(a,b))},paste:function(a){var d=this.getSelection(),c=this.get(d[0].recid,!0),e=d[0].column,f=this.trigger({phase:"before",type:"paste",target:this.name,text:a,index:c,column:e});if(!0!==f.isCancelled){a=f.text;if("row"==this.selectType||0===d.length)console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected.");else{d=[];a=a.split("\n");for(var g=
0;g<a.length;g++){var h=a[g].split("\t"),k=0,n=this.records[c],m=[];if(null!=n){for(var p=0;p<h.length;p++)this.columns[e+k]&&(this.setCellPaste(n,e+k,h[p]),m.push(e+k),k++);for(h=0;h<m.length;h++)d.push({recid:n.recid,column:m[h]});c++}}this.selectNone();this.select.apply(this,d);this.refresh()}this.trigger(b.extend(f,{phase:"after"}))}},setCellPaste:function(a,b,c){b=this.columns[b].field;a.w2ui=a.w2ui||{};a.w2ui.changes=a.w2ui.changes||{};a.w2ui.changes[b]=c},resize:function(){var a=(new Date).getTime();
if(this.box&&b(this.box).attr("name")==this.name){b(this.box).find("> div.w2ui-grid-box").css("width",b(this.box).width()).css("height",b(this.box).height());var d=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==d.isCancelled)return this.resizeBoxes(),this.resizeRecords(),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.trigger(b.extend(d,{phase:"after"})),(new Date).getTime()-a}},update:function(a){var d=(new Date).getTime();if(null==this.box)return 0;if(null==
a)for(var c=this.last.range_start-1;c<=this.last.range_end-1;c++){if(!(0>c)){var e=this.records[c]||{};e.w2ui||(e.w2ui={});for(var f=0;f<this.columns.length;f++){var g=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e.recid)),h=b(this.box).find("#grid_"+this.name+"_data_"+c+"_"+f);h.replaceWith(this.getCellHTML(c,f,!1));h=b(this.box).find("#grid_"+this.name+"_data_"+c+"_"+f);null==e.w2ui.style||b.isEmptyObject(e.w2ui.style)?h.attr("style",""):("string"==typeof e.w2ui.style&&g.attr("style",
e.w2ui.style),b.isPlainObject(e.w2ui.style)&&"string"==typeof e.w2ui.style[f]&&h.attr("style",e.w2ui.style[f]));null==e.w2ui.class||b.isEmptyObject(e.w2ui.class)||("string"==typeof e.w2ui.class&&g.addClass(e.w2ui.class),b.isPlainObject(e.w2ui.class)&&"string"==typeof e.w2ui.class[f]&&h.addClass(e.w2ui.class[f]))}}}else for(var k=0;k<a.length;k++)c=a[k].index,f=a[k].column,0>c||(null==c||null==f?console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]"):
(e=this.records[c]||{},g=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e.recid)),h=b(this.box).find("#grid_"+this.name+"_data_"+c+"_"+f),e.w2ui||(e.w2ui={}),h.replaceWith(this.getCellHTML(c,f,!1)),h=b(this.box).find("#grid_"+this.name+"_data_"+c+"_"+f),null==e.w2ui.style||b.isEmptyObject(e.w2ui.style)?h.attr("style",""):("string"==typeof e.w2ui.style&&g.attr("style",e.w2ui.style),b.isPlainObject(e.w2ui.style)&&"string"==typeof e.w2ui.style[f]&&h.attr("style",e.w2ui.style[f])),null==
e.w2ui.class||b.isEmptyObject(e.w2ui.class)||("string"==typeof e.w2ui.class&&g.addClass(e.w2ui.class),b.isPlainObject(e.w2ui.class)&&"string"==typeof e.w2ui.class[f]&&h.addClass(e.w2ui.class[f]))));return(new Date).getTime()-d},refreshCell:function(a,d){var c=this.get(a,!0);a=this.records[c]&&this.records[c].recid==a?!1:!0;d=this.getColumn(d,!0);var e=a?this.summary[c]:this.records[c],f=this.columns[d],g=b(this.box).find("#grid_"+this.name+"_data_"+c+"_"+d);if(null==e)return!1;g.replaceWith(this.getCellHTML(c,
d,a));g=b(this.box).find("#grid_"+this.name+"_data_"+c+"_"+d);e.w2ui&&e.w2ui.changes&&null!=e.w2ui.changes[f.field]?g.addClass("w2ui-changed"):g.removeClass("w2ui-changed");e.w2ui&&null!=e.w2ui.style&&!b.isEmptyObject(e.w2ui.style)?("string"==typeof e.w2ui.style&&b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e.recid)).attr("style",e.w2ui.style),b.isPlainObject(e.w2ui.style)&&"string"==typeof e.w2ui.style[d]&&g.attr("style",e.w2ui.style[d])):g.attr("style","");e.w2ui&&null!=e.w2ui.class&&
!b.isEmptyObject(e.w2ui.class)&&("string"==typeof e.w2ui.class&&b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e.recid)).addClass(e.w2ui.class),b.isPlainObject(e.w2ui.class)&&"string"==typeof e.w2ui.class[d]&&g.addClass(e.w2ui.class[d]))},refreshRow:function(a,d){var c=b(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(a)),e=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a));if(0<c.length){null==d&&(d=this.get(a,!0));var f=c.attr("line"),g=this.records[d]&&this.records[d].recid==
a?!1:!0,h="object"!=typeof this.url?this.url:this.url.get;if(0<this.searchData.length&&!h)for(h=0;h<this.last.searchIds.length;h++)this.last.searchIds[h]==d&&(d=h);f=this.getRecordHTML(d,f,g);b(c).replaceWith(f[0]);b(e).replaceWith(f[1]);d=this.records[d].w2ui?this.records[d].w2ui.style:"";"string"==typeof d&&(c=b(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(a)),e=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a)),c.attr("custom_style",d),e.attr("custom_style",d),c.hasClass("w2ui-selected")&&
(d=d.replace("background-color","none")),c[0].style.cssText="height: "+this.recordHeight+"px;"+d,e[0].style.cssText="height: "+this.recordHeight+"px;"+d);g&&this.resize()}},refresh:function(){var a=this,d=(new Date).getTime(),c="object"!=typeof this.url?this.url:this.url.get;0>=this.total&&!c&&0===this.searchData.length&&(this.total=this.records.length);this.toolbar.disable("w2ui-edit","w2ui-delete");if(this.box&&(c=this.trigger({phase:"before",target:this.name,type:"refresh"}),!0!==c.isCancelled)){this.show.header?
b("#grid_"+this.name+"_header").html(this.header+"&#160;").show():b("#grid_"+this.name+"_header").hide();if(this.show.toolbar){if(!(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked)&&(b("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar))for(var e=this.toolbar.items,f=0;f<e.length;f++)"w2ui-search"!=e[f].id&&"break"!=e[f].type&&this.toolbar.refresh(e[f].id)}else b("#grid_"+this.name+"_toolbar").hide();this.searchClose();f=b("#grid_"+
a.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&0<this.searches.length&&(this.last.field=this.searches[0].field,this.last.label=this.searches[0].label);for(e=0;e<this.searches.length;e++)this.searches[e].field==this.last.field&&(this.last.label=this.searches[e].label);this.last.multi?(f.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),f.w2field("clear")):f.attr("placeholder",w2utils.lang(this.last.label));if(f.val()!=this.last.search){var g=this.last.search;(e=f.data("w2field"))&&
(g=e.format(g));f.val(g)}a.refreshBody();this.show.footer?b("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():b("#grid_"+this.name+"_footer").hide();var h=b("#grid_"+this.name+"_searchClear");h.hide();this.searchData.some(function(b){b=a.getSearch(b.field);if(a.last.multi||b&&!b.hidden&&-1==["list","enum"].indexOf(b.type))return h.show(),!0});e=this.last.selection;f=0<e.indexes.length&&0!==this.searchData.length&&e.indexes.length==this.last.searchIds.length;0<this.records.length&&e.indexes.length==
this.records.length||f?b("#grid_"+this.name+"_check_all").prop("checked",!0):b("#grid_"+this.name+"_check_all").prop("checked",!1);this.status();f=a.find({"w2ui.expanded":!0},!0);for(g=0;g<f.length;g++)(e=a.records[f[g]].w2ui)&&!Array.isArray(e.children)&&(e.expanded=!1);a.markSearch&&setTimeout(function(){for(var c=[],d=0;d<a.searchData.length;d++){var e=a.searchData[d],g=a.getSearch(e.field);g&&!g.hidden&&(g=a.getColumn(e.field,!0),c.push({field:e.field,search:e.value,col:g}))}0<c.length&&c.forEach(function(c){b(a.box).find('td[col="'+
c.col+'"]').not(".w2ui-head").w2marker(c.search)})},50);this.show.toolbarSave&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"));this.trigger(b.extend(c,{phase:"after"}));a.resize();a.addRange("selection");setTimeout(function(){a.resize();a.scroll()},1);a.reorderColumns&&!a.last.columnDrag?a.last.columnDrag=a.initColumnDrag():!a.reorderColumns&&a.last.columnDrag&&a.last.columnDrag.remove();return(new Date).getTime()-d}},refreshBody:function(){var a=this,
d=this.find({"w2ui.summary":!0},!0);if(0<d.length){for(var c=0;c<d.length;c++)this.summary.push(this.records[d[c]]);for(c=d.length-1;0<=c;c--)this.records.splice(d[c],1)}this.scroll();d=this.getRecordsHTML();c=this.getColumnsHTML();d='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+d[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+d[1]+'</div><div id="grid_'+
this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+c[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+c[1]+"</tbody></table></div>";var e=b("#grid_"+this.name+"_body",a.box).html(d),f=b("#grid_"+this.name+"_records",a.box);e.data("scrolldata",{lastTime:0,lastDelta:0,time:0}).find(".w2ui-grid-frecords").on("mousewheel DOMMouseScroll ",
function(c){c.preventDefault();var d=c.originalEvent;c=e.data("scrolldata");var g=b(this).siblings(".w2ui-grid-records").addBack().filter(".w2ui-grid-records");d=-1*d.wheelDelta/120;var n=g.scrollTop();c.time=+new Date;c.lastTime<c.time-150&&(c.lastDelta=0);c.lastTime=c.time;c.lastDelta+=d;d=1>Math.abs(c.lastDelta)?0:Math.round(c.lastDelta);e.data("scrolldata",c);d*=(Math.round(f.height()/a.recordHeight)-1)*a.recordHeight/4;g.stop().animate({scrollTop:n+d},250,"linear")});0===this.records.length&&
this.msgEmpty?b("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):0<b("#grid_"+this.name+"_empty_msg").length&&b("#grid_"+this.name+"_empty_msg").remove();0<this.summary.length?(d=this.getSummaryHTML(),b("#grid_"+this.name+"_fsummary").html(d[0]).show(),b("#grid_"+this.name+"_summary").html(d[1]).show()):(b("#grid_"+this.name+"_fsummary").hide(),b("#grid_"+this.name+"_summary").hide())},render:function(a){function d(a){var c=
e.last.move;if(c&&-1!=["select","select-column"].indexOf(c.type)&&(c.divX=a.screenX-c.x,c.divY=a.screenY-c.y,!(1>=Math.abs(c.divX)&&1>=Math.abs(c.divY))))if(e.last.cancelClick=!0,1==e.reorderRows&&e.last.move.reorder){var d=b(e.box).find(".w2ui-grid-records"),f=b(a.target).parents("tr");f=f.attr("recid");"-none-"==f&&(f="bottom");if(f!=c.from){b("#grid_"+e.name+"_rec_"+c.recid);var g=b("#grid_"+e.name+"_rec_"+f);b(e.box).find(".insert-before");g.addClass("insert-before");c.lastY=a.screenY;c.to=f;
f=g.position();a=b("#grid_"+e.name+"_ghost_line");f?a.css({top:f.top+d.scrollTop(),left:c.pos.left,"border-top":"2px solid #769EFC"}):a.css({"border-top":"2px solid transparent"})}b("#grid_"+e.name+"_ghost").css({top:c.pos.top+c.divY+d.scrollTop(),left:c.pos.left})}else if(c.start&&c.recid&&(e.selectNone(),c.start=!1),d=[],f="TR"==a.target.tagName.toUpperCase()?b(a.target).attr("recid"):b(a.target).parents("tr").attr("recid"),null==f){if(!("row"==e.selectType||e.last.move&&"select"==e.last.move.type))if(f=
parseInt(b(a.target).parents("td").attr("col")),isNaN(f))e.removeRange("column-selection"),b(e.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),b(e.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete c.colRange;else{d=f+"-"+f;c.column<f&&(d=c.column+"-"+f);c.column>f&&(d=f+"-"+c.column);a=[];f=d.split("-");for(g=parseInt(f[0]);g<=parseInt(f[1]);g++)a.push(g);if(c.colRange!=d&&(m=e.trigger({phase:"before",type:"columnSelect",
target:e.name,columns:a,isCancelled:!1}),!0!==m.isCancelled)){null==c.colRange&&e.selectNone();f=d.split("-");b(e.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(a=parseInt(f[0]);a<=parseInt(f[1]);a++)b(e.box).find("#grid_"+e.name+"_column_"+a+" .w2ui-col-header").addClass("w2ui-col-selected");b(e.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected");c.colRange=d;e.removeRange("column-selection");e.addRange({name:"column-selection",
range:[{recid:e.records[0].recid,column:f[0]},{recid:e.records[e.records.length-1].recid,column:f[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var h=e.get(c.recid,!0);if(!(null==h||e.records[h]&&e.records[h].recid!=c.recid)&&(g=e.get(f,!0),null!=g)){var k=parseInt(c.column);a=parseInt("TD"==a.target.tagName.toUpperCase()?b(a.target).attr("col"):b(a.target).parents("td").attr("col"));isNaN(k)&&isNaN(a)&&(k=0,a=e.columns.length-1);h>g&&(f=h,h=g,g=f);f="ind1:"+h+",ind2;"+g+",col1:"+
k+",col2:"+a;if(c.range!=f){c.range=f;for(c=h;c<=g;c++)if(!(0<e.last.searchIds.length&&-1==e.last.searchIds.indexOf(c)))if("row"!=e.selectType)for(k>a&&(f=k,k=a,a=f),f=k;f<=a;f++)e.columns[f].hidden||d.push({recid:e.records[c].recid,column:parseInt(f)});else d.push(e.records[c].recid);if("row"!=e.selectType){c=e.getSelection();f=[];for(a=0;a<d.length;a++){g=!1;for(k=0;k<c.length;k++)d[a].recid==c[k].recid&&d[a].column==c[k].column&&(g=!0);g||f.push({recid:d[a].recid,column:d[a].column})}e.select.apply(e,
f);f=[];for(k=0;k<c.length;k++){g=!1;for(a=0;a<d.length;a++)d[a].recid==c[k].recid&&d[a].column==c[k].column&&(g=!0);g||f.push({recid:c[k].recid,column:c[k].column})}e.unselect.apply(e,f)}else if(e.multiSelect){c=e.getSelection();for(a=0;a<d.length;a++)-1==c.indexOf(d[a])&&e.select(d[a]);for(k=0;k<c.length;k++)-1==d.indexOf(c[k])&&e.unselect(c[k])}}}}}function c(a){var c=e.last.move;setTimeout(function(){delete e.last.cancelClick},1);if(!b(a.target).parents().hasClass(".w2ui-head")&&!b(a.target).hasClass(".w2ui-head")){if(c&&
-1!=["select","select-column"].indexOf(c.type)){if(null!=c.colRange&&!0!==m.isCancelled){a=c.colRange.split("-");for(var d=[],f=0;f<e.records.length;f++){for(var g=[],h=parseInt(a[0]);h<=parseInt(a[1]);h++)g.push(h);d.push({recid:e.records[f].recid,column:g})}e.removeRange("column-selection");e.trigger(b.extend(m,{phase:"after"}));e.select.apply(e,d)}if(1==e.reorderRows&&e.last.move.reorder){d=e.trigger({phase:"before",target:e.name,type:"reorderRow",recid:c.from,moveAfter:c.to});if(!0===d.isCancelled){b("#grid_"+
e.name+"_ghost").remove();b("#grid_"+e.name+"_ghost_line").remove();e.refresh();delete e.last.move;return}f=e.get(c.from,!0);g=e.get(c.to,!0);"bottom"==c.to&&(g=e.records.length);a=e.records[f];null!=f&&null!=g&&(e.records.splice(f,1),f>g?e.records.splice(g,0,a):e.records.splice(g-1,0,a));b("#grid_"+e.name+"_ghost").remove();b("#grid_"+e.name+"_ghost_line").remove();e.refresh();e.trigger(b.extend(d,{phase:"after"}))}}delete e.last.move;b(document).off(".w2ui-"+e.name)}}var e=this,f=(new Date).getTime();
null!=a&&(0<b(this.box).find("#grid_"+this.name+"_body").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),this.box=a);if(this.box){var g="object"!=typeof this.url?this.url:this.url.get;a=this.trigger({phase:"before",target:this.name,type:"render",box:a});if(!0!==a.isCancelled){this.reset(!0);if(!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.label=w2utils.lang("All Fields");else{for(var h=0;h<this.searches.length&&
(this.searches[h].hidden||!1===this.searches[h].simple);)h++;h>=this.searches.length?(this.last.field="",this.last.label=""):(this.last.field=this.searches[h].field,this.last.label=this.searches[h].label)}b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid w2ui-inactive").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+
this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input" '+(w2utils.isIOS?"readonly":"")+"></textarea></div>");"row"!=this.selectType&&b(this.box).addClass("w2ui-ss");0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);this.initToolbar();null!=
this.toolbar&&this.toolbar.render(b("#grid_"+this.name+"_toolbar")[0]);if(this.last.field&&"all"!=this.last.field){var k=this.searchData;setTimeout(function(){e.initAllField(e.last.field,1==k.length?k[0].value:null)},1)}b("#grid_"+this.name+"_footer").html(this.getFooterHTML());this.last.state||(this.last.state=this.stateSave(!0));this.stateRestore();g&&(this.clear(),this.refresh());h=!1;for(var n=0;n<this.searches.length;n++)if(this.searches[n].hidden){h=!0;break}h?(this.searchReset(!1),g||setTimeout(function(){e.searchReset()},
1)):this.reload();b(this.box).find("#grid_"+this.name+"_focus").on("focus",function(a){clearTimeout(e.last.kbd_timer);e.hasFocus||e.focus()}).on("blur",function(a){clearTimeout(e.last.kbd_timer);e.last.kbd_timer=setTimeout(function(){e.hasFocus&&e.blur()},100)}).on("paste",function(a){var b=this;setTimeout(function(){w2ui[e.name].paste(b.value);b.value=""},1)}).on("keydown",function(a){w2ui[e.name].keydown.call(w2ui[e.name],a)});var m;b(this.box).on("mousedown",function(a){if(1==a.which&&("text"==
e.last.userSelect&&(delete e.last.userSelect,b(e.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),"row"!=e.selectType||!b(a.target).parents().hasClass("w2ui-head")&&!b(a.target).hasClass("w2ui-head"))&&(!e.last.move||"expand"!=e.last.move.type)){if(a.altKey)b(e.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),e.selectNone(),e.last.move={type:"text-select"},e.last.userSelect="text";else{for(var f=a.target,g=a.offsetX-10,h=a.offsetY-10,k=!1;f&&(!f.classList||
!f.classList.contains("w2ui-grid"));)f.tagName&&"TD"==f.tagName.toUpperCase()&&(k=!0),f.tagName&&"TR"!=f.tagName.toUpperCase()&&1==k&&(g+=f.offsetLeft,h+=f.offsetTop),f=f.parentNode;e.last.move={x:a.screenX,y:a.screenY,divX:0,divY:0,focusX:g,focusY:h,recid:b(a.target).parents("tr").attr("recid"),column:parseInt("TD"==a.target.tagName.toUpperCase()?b(a.target).attr("col"):b(a.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0};null==e.last.move.recid&&(e.last.move.type="select-column");
var m=a.target,n=b(e.box).find("#grid_"+e.name+"_focus");if(e.last.move){f=e.last.move.focusX;g=e.last.move.focusY;h=b(m).parents("table").parent();if(h.hasClass("w2ui-grid-records")||h.hasClass("w2ui-grid-frecords")||h.hasClass("w2ui-grid-columns")||h.hasClass("w2ui-grid-fcolumns")||h.hasClass("w2ui-grid-summary"))f=e.last.move.focusX-b(e.box).find("#grid_"+e.name+"_records").scrollLeft(),g=e.last.move.focusY-b(e.box).find("#grid_"+e.name+"_records").scrollTop();if(b(m).hasClass("w2ui-grid-footer")||
0<b(m).parents("div.w2ui-grid-footer").length)g=b(e.box).find("#grid_"+e.name+"_footer").position().top;h.hasClass("w2ui-scroll-wrapper")&&h.parent().hasClass("w2ui-toolbar")&&(f=e.last.move.focusX-h.scrollLeft());n.css({left:f-10,top:g})}setTimeout(function(){-1!=["INPUT","TEXTAREA","SELECT"].indexOf(m.tagName.toUpperCase())?b(m).focus():n.is(":focus")||n.focus()},50);e.multiSelect||e.reorderRows||"drag"!=e.last.move.type||delete e.last.move}1==e.reorderRows&&(f=a.target,"TD"!=f.tagName.toUpperCase()&&
(f=b(f).parents("td")[0]),b(f).hasClass("w2ui-col-number")||b(f).hasClass("w2ui-col-order")?(e.selectNone(),e.last.move.reorder=!0,f=b(e.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),g=b(e.box).find(".w2ui-odd.w2ui-empty-record").css("background-color"),b(e.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",f),b(e.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",g),g=e.last.move,g.ghost||(h=b("#grid_"+e.name+"_rec_"+g.recid),f=h.parents("table").find("tr:first-child").clone(),
g.offsetY=a.offsetY,g.from=g.recid,g.pos=h.position(),g.ghost=b(h).clone(!0),g.ghost.removeAttr("id"),h.find("td").remove(),h.append('<td colspan="1000"><div style="height: '+e.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></div></td>'),h=b(e.box).find(".w2ui-grid-records"),h.append('<div id="grid_'+e.name+'_ghost_line" style="position: absolute; z-index: 999999; pointer-events: none; width: 100%;"></div>'),h.append('<table id="grid_'+e.name+
'_ghost" style="position: absolute; z-index: 999998; opacity: 0.9; pointer-events: none;"></table>'),b("#grid_"+e.name+"_ghost").append(f).append(g.ghost)),f=b("#grid_"+e.name+"_ghost"),h=b(e.box).find(".w2ui-grid-records"),f.css({top:g.pos.top+h.scrollTop(),left:g.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})):e.last.move.reorder=!1);b(document).on("mousemove.w2ui-"+e.name,d).on("mouseup.w2ui-"+e.name,c);a.stopPropagation()}});this.updateToolbar();this.trigger(b.extend(a,
{phase:"after"}));if(0===b(".w2ui-layout").length)b(window).off("resize.w2ui-"+e.name).on("resize.w2ui-"+e.name,function(a){null==w2ui[e.name]?b(window).off("resize.w2ui-"+e.name):w2ui[e.name].resize()});return(new Date).getTime()-f}}},destroy:function(){var a=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==a.isCancelled&&(b(this.box).off(),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),0<b(this.box).find("#grid_"+this.name+"_body").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid w2ui-inactive").html(""),
delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var a='<div class="w2ui-col-on-off"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+this.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(this.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td>      <label>'+
w2utils.lang("Line #")+"</label>   </td></tr>",b=0;b<this.columns.length;b++){var c=this.columns[b],e=this.columns[b].text;!1!==c.hideable&&(!e&&this.columns[b].tooltip&&(e=this.columns[b].tooltip),e||(e="- column "+(parseInt(b)+1)+" -"),a+='<tr id="grid_'+this.name+"_column_"+b+'_check"        onclick="w2ui[\''+this.name+"'].columnOnOff(event, '"+c.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+
(c.hidden?"empty":"check")+'"></span>   </td>   <td>       <label>'+w2utils.stripTags(e)+"</label>   </td></tr>")}if((b="object"!=typeof this.url?this.url:this.url.get)&&this.show.skipRecords||this.show.saveRestoreState)a+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>';b&&this.show.skipRecords&&(a+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+
this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+this.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("Records")+"    </div></td></tr>");this.show.saveRestoreState&&(a+='<tr><td colspan="2" onclick="var obj = w2ui[\''+this.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+
w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="var obj = w2ui[\''+this.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>");a+="</tbody></table></div>";this.toolbar.get("w2ui-column-on-off").html=a}},initColumnDrag:function(a){function d(){k.pressed=!1;clearTimeout(k.timeout)}function c(a){k.timeout&&clearTimeout(k.timeout);
var c=this;k.pressed=!0;k.timeout=setTimeout(function(){if(k.pressed&&0!==k.numberPreColumnsPresent){var d;var g=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]);if(b(a.originalEvent.target).parents().hasClass("w2ui-head")){var m=0;for(var n=g.length;m<n;m++)if(b(a.originalEvent.target).parents().hasClass(g[m]))return;k.numberPreColumnsPresent=b(h.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length;k.columnHead=g=
b(a.originalEvent.target).parents(".w2ui-head");k.originalPos=d=parseInt(g.attr("col"),10);g=h.trigger({type:"columnDragStart",phase:"before",originalEvent:a,origColumnNumber:d,target:g[0]});if(!0===g.isCancelled)return!1;d=k.columns=b(h.box).find(".w2ui-head:not(.w2ui-head-last)");b(document).on("mouseup",f);b(document).on("mousemove",e);k.ghost=b(c).clone(!0);b(k.ghost).find('[col]:not([col="'+k.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove();b(k.ghost).find(".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select").remove();
b(k.ghost).find(".w2ui-grid-body").css({top:0});m=b(k.ghost).find('[col="'+k.originalPos+'"]');b(document.body).append(k.ghost);b(k.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:m.width(),height:b(h.box).find(".w2ui-grid-body:first").height(),left:a.pageX,top:a.pageY,opacity:.8},0);k.offsets=[];m=0;for(n=d.length;m<n;m++)k.offsets.push(b(d[m]).offset().left);h.trigger(b.extend(g,{phase:"after"}))}}},150)}function e(a){if(k.pressed){var c=
a.originalEvent.pageX;a=a.originalEvent.pageY;var d=k.offsets,e=b(".w2ui-head:not(.w2ui-head-last)").width();k.targetInt=Math.max(k.numberPreColumnsPresent,g(c,d,e));d=k.targetInt;k.marker||k.markerLeft||(k.marker=b('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),k.markerLeft=b('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'));k.lastInt&&k.lastInt===d||(k.lastInt=d,k.marker.remove(),
k.markerLeft.remove(),b(".w2ui-head").removeClass("w2ui-col-intersection"),d>=k.columns.length?(b(k.columns[k.columns.length-1]).children("div:last").append(k.marker.addClass("right").removeClass("left")),b(k.columns[k.columns.length-1]).addClass("w2ui-col-intersection")):d<=k.numberPreColumnsPresent?(b(k.columns[k.numberPreColumnsPresent]).prepend(k.marker.addClass("left").removeClass("right")).css({position:"relative"}),b(k.columns[k.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):
(b(k.columns[d]).children("div:last").prepend(k.marker.addClass("left").removeClass("right")),b(k.columns[d]).prev().children("div:last").append(k.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),b(k.columns[d-1]).addClass("w2ui-col-intersection")));b(k.ghost).css({left:c-10,top:a-10})}}function f(a){k.pressed=!1;var c=b(".w2ui-grid-ghost");a=h.trigger({type:"columnDragEnd",phase:"before",originalEvent:a,target:k.columnHead[0]});if(!0===a.isCancelled)return!1;var d=h.columns[k.originalPos];
var g=h.columns;var n=b(k.columns[Math.min(k.lastInt,k.columns.length-1)]);var l=k.lastInt<k.columns.length?parseInt(n.attr("col")):g.length;l!==k.originalPos+1&&l!==k.originalPos&&n&&n.length?(b(k.ghost).animate({top:b(h.box).offset().top,left:n.offset().left,width:0,height:0,opacity:.2},300,function(){b(this).remove();c.remove()}),g.splice(l,0,b.extend({},d)),g.splice(g.indexOf(d),1)):(b(k.ghost).remove(),c.remove());b(document).off("mouseup",f);b(document).off("mousemove",e);k.marker&&k.marker.remove();
k={};h.refresh();h.trigger(b.extend(a,{phase:"after",targetColumnNumber:l-1}))}function g(a,b,c){if(a<=b[0])return 0;if(a>=b[b.length-1]+c)return b.length;for(var d=0,e=b.length;d<e;d++){var f=b[d+1]||b[d]+c,g=(f-b[d])/2+b[d];if(a>b[d]&&a<=g)return d;if(a>g&&a<=f)return d+1}return intersection}if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var h=this,k={lastInt:null,pressed:!1,timeout:null,columnHead:null};b(h.box).on("mousedown",
c);b(h.box).on("mouseup",d);return{remove:function(){b(h.box).off("mousedown",c);b(h.box).off("mouseup",d);b(h.box).find(".w2ui-head").removeAttr("draggable");h.last.columnDrag=!1}}},columnOnOff:function(a,d){var c=b(a.target).parents("tr").find(".w2ui-column-check"),e=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:d,originalEvent:a});if(!0!==e.isCancelled){var f=this;a=!a.shiftKey&&!a.metaKey&&!a.ctrlKey&&!b(a.target).hasClass("w2ui-column-check");for(var g=f.find({"w2ui.expanded":!0},
!0),h=0;h<g.length;h++){var k=this.records[h].w2ui;k&&!Array.isArray(k.children)&&(this.records[h].w2ui.expanded=!1)}if("line-numbers"==d)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?c.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):c.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{var n=this.getColumn(d);n.hidden?(c.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),setTimeout(function(){f.showColumn(n.field)},
a?0:50)):(c.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),setTimeout(function(){f.hideColumn(n.field)},a?0:50))}a&&setTimeout(function(){b().w2overlay({name:f.name+"_toolbar"})},40);this.trigger(b.extend(e,{phase:"after"}))}},scrollToColumn:function(a){if(null!=a){for(var b=0,c=!1,e=0;e<this.columns.length;e++){var f=this.columns[e];if(f.field==a){c=!0;break}f.frozen||f.hidden||(f=parseInt(f.sizeCalculated?f.sizeCalculated:f.size),b+=f)}c&&(this.last.scrollLeft=b+1,this.scroll())}},initToolbar:function(){var a=
this;if(null==this.toolbar.render){var d=this.toolbar.items||[];this.toolbar.items=[];this.toolbar=b().w2toolbar(b.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this}));this.show.toolbarReload&&this.toolbar.items.push(b.extend(!0,{},this.buttons.reload));this.show.toolbarColumns&&this.toolbar.items.push(b.extend(!0,{},this.buttons.columns));(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"});if(this.show.toolbarInput){var c='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tbody><tr>    <td>'+
this.buttons.search.html+'</td>    <td>        <input type="text" id="grid_'+this.name+'_search_all" class="w2ui-search-all" tabindex="-1"             autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"            placeholder="'+w2utils.lang(this.last.label)+'" value="'+this.last.search+'"            onfocus="var grid = w2ui[\''+this.name+'\']; clearTimeout(grid.last.kbd_timer); grid.searchShowFields(true); grid.searchClose()"            onkeydown="if (event.keyCode == 13 &amp;&amp; w2utils.isIE) this.onchange();"            onchange="                var grid = w2ui[\''+
this.name+"'];                 var val = this.value;                 var sel = jQuery(this).data('selected');                var fld = jQuery(this).data('w2field');                 if (fld) val = fld.clean(val);                if (fld &amp;&amp; fld.type == 'list' &amp;&amp; sel &amp;&amp; typeof sel.id == 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/>    </td>    <td>        <div class=\"w2ui-search-clear\" id=\"grid_"+
this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+'\']; obj.searchReset();" style="display: none"        >&#160;&#160;</div>    </td></tr></tbody></table></div>';this.toolbar.items.push({type:"html",id:"w2ui-search",html:c})}this.show.toolbarSearch&&this.multiSearch&&0<this.searches.length&&this.toolbar.items.push(b.extend(!0,{},this.buttons["search-go"]));(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||
this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"});this.show.toolbarAdd&&Array.isArray(d)&&-1==d.map(function(a){return a.id}).indexOf(this.buttons.add.id)&&this.toolbar.items.push(b.extend(!0,{},this.buttons.add));this.show.toolbarEdit&&Array.isArray(d)&&-1==d.map(function(a){return a.id}).indexOf(this.buttons.edit.id)&&this.toolbar.items.push(b.extend(!0,{},this.buttons.edit));this.show.toolbarDelete&&Array.isArray(d)&&-1==d.map(function(a){return a.id}).indexOf(this.buttons["delete"].id)&&
this.toolbar.items.push(b.extend(!0,{},this.buttons["delete"]));this.show.toolbarSave&&Array.isArray(d)&&-1==d.map(function(a){return a.id}).indexOf(this.buttons.save.id)&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push(b.extend(!0,{},this.buttons.save)));if(d)for(c=0;c<d.length;c++)this.toolbar.items.push(d[c]);a=this;this.toolbar.on("click",function(c){var d=a.trigger({phase:"before",type:"toolbar",
target:c.target,originalEvent:c});if(!0!==d.isCancelled){var e=c.target;switch(e){case "w2ui-reload":c=a.trigger({phase:"before",type:"reload",target:a.name});if(!0===c.isCancelled)return!1;a.reload();a.trigger(b.extend(c,{phase:"after"}));break;case "w2ui-column-on-off":a.initColumnOnOff();a.initResize();a.resize();break;case "w2ui-search-advanced":this.get(e).checked?a.searchClose():a.searchOpen();a.toolbar.tooltipHide("w2ui-search-advanced");c.preventDefault();break;case "w2ui-add":c=a.trigger({phase:"before",
target:a.name,type:"add",recid:null});if(!0===c.isCancelled)return!1;a.trigger(b.extend(c,{phase:"after"}));setTimeout(function(){b().w2tag()},20);break;case "w2ui-edit":c=a.getSelection();e=null;1==c.length&&(e=c[0]);c=a.trigger({phase:"before",target:a.name,type:"edit",recid:e});if(!0===c.isCancelled)return!1;a.trigger(b.extend(c,{phase:"after"}));setTimeout(function(){b().w2tag()},20);break;case "w2ui-delete":a["delete"]();break;case "w2ui-save":a.save()}a.trigger(b.extend(d,{phase:"after"}))}});
this.toolbar.on("refresh",function(b){if("w2ui-search"==b.target){var c=a.searchData;setTimeout(function(){a.initAllField(a.last.field,1==c.length?c[0].value:null)},1)}})}},initResize:function(){var a=this;b(this.box).find(".w2ui-resizer").off("click").on("click",function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault&&a.preventDefault()}).off("mousedown").on("mousedown",function(d){d||(d=window.event);a.resizing=!0;a.last.tmp={x:d.screenX,y:d.screenY,gx:d.screenX,gy:d.screenY,
col:parseInt(b(this).attr("name"))};d.stopPropagation?d.stopPropagation():d.cancelBubble=!0;d.preventDefault&&d.preventDefault();for(var c=0;c<a.columns.length;c++)a.columns[c].hidden||(null==a.columns[c].sizeOriginal&&(a.columns[c].sizeOriginal=a.columns[c].size),a.columns[c].size=a.columns[c].sizeCalculated);var e={phase:"before",type:"columnResize",target:a.name,column:a.last.tmp.col,field:a.columns[a.last.tmp.col].field};e=a.trigger(b.extend(e,{resizeBy:0,originalEvent:d}));var f=function(a,b,
c){var d;return function(){var e=this,f=arguments;d&&clearTimeout(d);d=setTimeout(function(){a&&a.apply(c||e,f);d=null},b)}}(function(){a.resizeRecords();a.scroll()},100,a);b(document).on("mousemove","body",function(c){1==a.resizing&&(c||(c=window.event),e=a.trigger(b.extend(e,{resizeBy:c.screenX-a.last.tmp.gx,originalEvent:c})),!0===e.isCancelled?e.isCancelled=!1:(a.last.tmp.x=c.screenX-a.last.tmp.x,a.last.tmp.y=c.screenY-a.last.tmp.y,a.columns[a.last.tmp.col].size=parseInt(a.columns[a.last.tmp.col].size)+
a.last.tmp.x+"px",f(),a.last.tmp.x=c.screenX,a.last.tmp.y=c.screenY))});b(document).on("mouseup","body",function(c){delete a.resizing;b(document).off("mousemove","body");b(document).off("mouseup","body");a.resizeRecords();a.scroll();a.trigger(b.extend(e,{phase:"after",originalEvent:c}))})}).off("dblclick").on("dblclick",function(d){var c=parseInt(b(this).attr("name")),e=a.columns[c],f=0;if(!1===e.autoResize)return!0;d.stopPropagation?d.stopPropagation():d.cancelBubble=!0;d.preventDefault&&d.preventDefault();
b('.w2ui-grid-records td[col="'+c+'"] > div',a.box).each(function(){var a=this.offsetWidth-this.scrollWidth;a<f&&(f=a-3)});c={phase:"before",type:"columnAutoResize",target:a.name,column:e,field:e.field};c=a.trigger(b.extend(c,{resizeBy:Math.abs(f),originalEvent:d}));!0===c.isCancelled?c.isCancelled=!1:(0>f&&(e.size=Math.min(parseInt(e.size)+Math.abs(f),e.max||Infinity)+"px",a.resizeRecords(),a.resizeRecords(),a.scroll()),a.trigger(b.extend(c,{phase:"after",originalEvent:d})))}).each(function(a,c){a=
b(c).parent();b(c).css({height:a.height(),"margin-left":a.width()-3+"px"})})},resizeBoxes:function(){var a=b("#grid_"+this.name+"_header"),d=b("#grid_"+this.name+"_toolbar"),c=b("#grid_"+this.name+"_fsummary"),e=b("#grid_"+this.name+"_summary"),f=b("#grid_"+this.name+"_footer"),g=b("#grid_"+this.name+"_body");this.show.header&&a.css({top:"0px",left:"0px",right:"0px"});this.show.toolbar&&d.css({top:0+(this.show.header?w2utils.getSize(a,"height"):0)+"px",left:"0px",right:"0px"});0<this.summary.length&&
(c.css({bottom:0+(this.show.footer?w2utils.getSize(f,"height"):0)+"px"}),e.css({bottom:0+(this.show.footer?w2utils.getSize(f,"height"):0)+"px",right:"0px"}));this.show.footer&&f.css({bottom:"0px",left:"0px",right:"0px"});g.css({top:0+(this.show.header?w2utils.getSize(a,"height"):0)+(this.show.toolbar?w2utils.getSize(d,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(f,"height"):0)+(0<this.summary.length?w2utils.getSize(e,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){function a(a,
c,d){var e='<tr class="'+(a%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+c+'px">';d.show.lineNumbers&&(e+='<td class="w2ui-col-number"></td>');d.show.selectColumn&&(e+='<td class="w2ui-grid-data w2ui-col-select"></td>');d.show.expandColumn&&(e+='<td class="w2ui-grid-data w2ui-col-expand"></td>');a='<tr class="'+(a%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" recid="-none-" style="height: '+c+'px"><td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';
d.show.orderColumn&&(a+='<td class="w2ui-grid-data w2ui-col-order" col="order"></td>');for(var f=0;f<d.columns.length;f++){var g=d.columns[f];if(!(g.hidden||f<d.last.colStart||f>d.last.colEnd)||g.frozen)c='<td class="w2ui-grid-data" '+(null!=g.attr?g.attr:"")+' col="'+f+'"></td>',g.frozen?e+=c:a+=c}e+='<td class="w2ui-grid-data-last"></td> </tr>';a+='<td class="w2ui-grid-data-last" col="end"></td> </tr>';b("#grid_"+d.name+"_frecords > table").append(e);b("#grid_"+d.name+"_records > table").append(a)}
var d=this;b(this.box).find(".w2ui-empty-record").remove();var c=b(this.box),e=b(this.box).find("> div.w2ui-grid-box"),f=b("#grid_"+this.name+"_header"),g=b("#grid_"+this.name+"_toolbar"),h=b("#grid_"+this.name+"_summary"),k=b("#grid_"+this.name+"_fsummary"),n=b("#grid_"+this.name+"_footer"),m=b("#grid_"+this.name+"_body"),l=b("#grid_"+this.name+"_columns"),v=b("#grid_"+this.name+"_fcolumns"),r=b("#grid_"+this.name+"_records"),t=b("#grid_"+this.name+"_frecords"),x=b("#grid_"+this.name+"_scroll1"),
w=8*String(this.total).length+10;34>w&&(w=34);null!=this.lineNumberWidth&&(w=this.lineNumberWidth);for(var u=!1,y=!1,z=0,q=0;q<d.columns.length;q++)if(!d.columns[q].frozen&&!d.columns[q].hidden){var A=parseInt(d.columns[q].sizeCalculated?d.columns[q].sizeCalculated:d.columns[q].size);z+=A}r.width()<z&&(u=!0);m.height()-l.height()<b(r).find(">table").height()+(u?w2utils.scrollBarSize():0)&&(y=!0);this.fixedBody?(q=e.height()-(this.show.header?w2utils.getSize(f,"height"):0)-(this.show.toolbar?w2utils.getSize(g,
"height"):0)-("none"!=h.css("display")?w2utils.getSize(h,"height"):0)-(this.show.footer?w2utils.getSize(n,"height"):0),m.css("height",q)):(q=w2utils.getSize(l,"height")+w2utils.getSize(b("#grid_"+d.name+"_records table"),"height")+(u?w2utils.scrollBarSize():0),d.height=q+w2utils.getSize(e,"+height")+(d.show.header?w2utils.getSize(f,"height"):0)+(d.show.toolbar?w2utils.getSize(g,"height"):0)+("none"!=h.css("display")?w2utils.getSize(h,"height"):0)+(d.show.footer?w2utils.getSize(n,"height"):0),e.css("height",
d.height),m.css("height",q),c.css("height",w2utils.getSize(e,"height")+w2utils.getSize(c,"+height")));q=this.records.length;c="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||c||(q=this.last.searchIds.length);this.fixedBody||(y=!1);u||y?(l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),r.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(l,"height")+"px","-webkit-overflow-scrolling":"touch",
"overflow-x":u?"auto":"hidden","overflow-y":y?"auto":"hidden"})):(l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),r.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(l,"height")+"px",overflow:"hidden"}),0<r.length&&(this.last.scrollTop=0,this.last.scrollLeft=0));u?(t.css("margin-bottom",w2utils.scrollBarSize()),x.show()):(t.css("margin-bottom",0),x.hide());t.css({overflow:"hidden",top:r.css("top")});if(this.show.emptyRecords&&!y&&(u=Math.floor(r.height()/
this.recordHeight)-1,c=0,r[0]&&(c=r[0].scrollHeight-u*this.recordHeight),c>=this.recordHeight&&(c-=this.recordHeight,u++),this.fixedBody)){for(;q<u;q++)a(q,this.recordHeight,this);a(u,c,this)}if(0<m.length){var B=y=parseInt(m.width())-(y?w2utils.scrollBarSize():0)-(this.show.lineNumbers?w:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,D=0;u=!1;for(q=0;q<this.columns.length;q++)m=this.columns[q],0<m.gridMinWidth&&(m.gridMinWidth>B&&!0!==m.hidden&&(u=m.hidden=!0),m.gridMinWidth<B&&
!0===m.hidden&&(m.hidden=!1,u=!0));if(!0===u){this.refresh();return}for(q=0;q<this.columns.length;q++)m=this.columns[q],m.hidden||("px"==String(m.size).substr(String(m.size).length-2).toLowerCase()?(y-=parseFloat(m.size),this.columns[q].sizeCalculated=m.size,this.columns[q].sizeType="px"):(D+=parseFloat(m.size),this.columns[q].sizeType="%",delete m.sizeCorrected));if(100!=D&&0<D)for(q=0;q<this.columns.length;q++)m=this.columns[q],m.hidden||"%"!=m.sizeType||(m.sizeCorrected=Math.round(1E4*parseFloat(m.size)/
D)/100+"%");for(q=0;q<this.columns.length;q++)m=this.columns[q],m.hidden||"%"!=m.sizeType||(this.columns[q].sizeCalculated=null!=this.columns[q].sizeCorrected?Math.floor(y*parseFloat(m.sizeCorrected)/100)-1+"px":Math.floor(y*parseFloat(m.size)/100)-1+"px")}for(q=y=0;q<this.columns.length;q++)m=this.columns[q],m.hidden||(null==m.min&&(m.min=20),parseInt(m.sizeCalculated)<parseInt(m.min)&&(m.sizeCalculated=m.min+"px"),parseInt(m.sizeCalculated)>parseInt(m.max)&&(m.sizeCalculated=m.max+"px"),y+=parseInt(m.sizeCalculated));
var C=parseInt(B)-parseInt(y);if(0<C&&0<D)for(q=0;;)if(m=this.columns[q],null==m)q=0;else{if(!m.hidden&&"px"!=m.sizeType&&(m.sizeCalculated=parseInt(m.sizeCalculated)+1+"px",C--,0===C))break;q++}else 0<C&&l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();B=1;this.show.lineNumbers&&(B+=w);this.show.selectColumn&&(B+=26);this.show.expandColumn&&(B+=26);for(q=0;q<this.columns.length;q++)this.columns[q].hidden||this.columns[q].frozen&&(B+=parseInt(this.columns[q].sizeCalculated));
v.css("width",B);t.css("width",B);k.css("width",B);x.css("width",B);l.css("left",B);r.css("left",B);h.css("left",B);l.find("> table > tbody > tr:nth-child(1) td").add(v.find("> table > tbody > tr:nth-child(1) td")).each(function(a,c){b(c).hasClass("w2ui-col-number")&&b(c).css("width",w);a=b(c).attr("col");if(null!=a){if("start"==a){for(var e=0,f=0;f<d.last.colStart;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}d.columns[a]&&
b(c).css("width",d.columns[a].sizeCalculated)}if(b(c).hasClass("w2ui-head-last"))if(d.last.colEnd+1<d.columns.length){e=0;for(f=d.last.colEnd+1;f<d.columns.length;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}else b(c).css("width",w2utils.scrollBarSize()+(0<C&&0===D?C:0)+"px")});3==l.find("> table > tbody > tr").length&&l.find("> table > tbody > tr:nth-child(1) td").add(v.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",
border:"0px",padding:"0px",margin:"0px"});r.find("> table > tbody > tr:nth-child(1) td").add(t.find("> table > tbody > tr:nth-child(1) td")).each(function(a,c){b(c).hasClass("w2ui-col-number")&&b(c).css("width",w);a=b(c).attr("col");if(null!=a){if("start"==a){for(var e=0,f=0;f<d.last.colStart;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}d.columns[a]&&b(c).css("width",d.columns[a].sizeCalculated)}if(b(c).hasClass("w2ui-grid-data-last")&&
0===b(c).parents(".w2ui-grid-frecords").length)if(d.last.colEnd+1<d.columns.length){e=0;for(f=d.last.colEnd+1;f<d.columns.length;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}else b(c).css("width",(0<C&&0===D?C:0)+"px")});h.find("> table > tbody > tr:nth-child(1) td").add(k.find("> table > tbody > tr:nth-child(1) td")).each(function(a,c){b(c).hasClass("w2ui-col-number")&&b(c).css("width",w);a=b(c).attr("col");if(null!=
a){if("start"==a){for(var e=0,f=0;f<d.last.colStart;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}d.columns[a]&&b(c).css("width",d.columns[a].sizeCalculated)}b(c).hasClass("w2ui-grid-data-last")&&0===b(c).parents(".w2ui-grid-frecords").length&&b(c).css("width",w2utils.scrollBarSize()+(0<C&&0===D?C:0)+"px")});this.initResize();this.refreshRanges();(this.last.scrollTop||this.last.scrollLeft)&&0<r.length&&(l.prop("scrollLeft",
this.last.scrollLeft),r.prop("scrollTop",this.last.scrollTop),r.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var a='<table cellspacing="0"><tbody>',d=!1,c=0;c<this.searches.length;c++){var e=this.searches[c];e.type=String(e.type).toLowerCase();if(!e.hidden){var f="";0==d&&(f='<button type="button" class="w2ui-btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) obj.searchClose()\">X</button>",d=!0);null==e.inTag&&(e.inTag="");null==e.outTag&&(e.outTag="");null==
e.style&&(e.style="");null==e.type&&(e.type="text");null==e.label&&null!=e.caption&&(console.log("NOTICE: grid search.caption property is deprecated, please use search.label. Search ->",e),e.label=e.caption);var g='<select id="grid_'+this.name+"_operator_"+c+'" class="w2ui-input"    onchange="w2ui[\''+this.name+"'].initOperator(this, "+c+')">',h=e.operators,k="",n=this.operators[this.operatorsMap[e.type]];null!=h&&(n=h);for(h=0;h<n.length;h++){var m=n[h],l=m;Array.isArray(m)?(l=m[1],m=m[0],null==
l&&(l=m)):b.isPlainObject(m)&&(l=m.text,m=m.oper);k+='<option value="'+m+'">'+w2utils.lang(l)+"</option>\n"}a+='<tr>    <td class="close-btn">'+f+'</td>    <td class="caption">'+(e.label||"")+'</td>    <td class="operator">'+(g+k+"</select>")+'</td>    <td class="value">';switch(e.type){case "text":case "alphanumeric":case "hex":case "color":case "list":case "combo":case "enum":f="width: 250px;";-1!=["hex","color"].indexOf(e.type)&&(f="width: 90px;");a+='<input rel="search" type="text" id="grid_'+
this.name+"_field_"+c+'" name="'+e.field+'"    class="w2ui-input" style="'+f+e.style+'" '+e.inTag+"/>";break;case "int":case "float":case "money":case "currency":case "percent":case "date":case "time":case "datetime":f="width: 90px";"datetime"==e.type&&(f="width: 140px;");a+='<input rel="search" type="text" class="w2ui-input" style="'+f+e.style+'" id="grid_'+this.name+"_field_"+c+'" name="'+e.field+'" '+e.inTag+'/><span id="grid_'+this.name+"_range_"+c+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+
f+e.style+'" id="grid_'+this.name+"_field2_"+c+'" name="'+e.field+'" '+e.inTag+"/></span>";break;case "select":a+='<select rel="search" class="w2ui-input" style="'+e.style+'" id="grid_'+this.name+"_field_"+c+'"  name="'+e.field+'" '+e.inTag+"></select>"}a+=e.outTag+"    </td></tr>"}}return a+='<tr>    <td colspan="4" class="actions">        <div>        <button type="button" class="w2ui-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button type="button" class="w2ui-btn w2ui-btn-blue" onclick="obj = w2ui[\''+
this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></tbody></table>"},initOperator:function(a,d){var c=this.searches[d],e=b("#grid_"+this.name+"_range_"+d);d=b("#grid_"+this.name+"_field_"+d);var f=d.parent().find("span input");d.show();e.hide();switch(b(a).val()){case "between":e.show();f.w2field(c.type,c.options);break;case "not null":case "null":d.hide(),d.val("1"),d.change()}},initSearches:function(){for(var a=this,d=0;d<this.searches.length;d++){var c=
this.searches[d],e=this.getSearchData(c.field);c.type=String(c.type).toLowerCase();var f=a.operators[a.operatorsMap[c.type]];c.operators&&(f=c.operators);var g=f[0];b.isPlainObject(g)&&(g=g.oper);"object"!=typeof c.options&&(c.options={});"text"==c.type&&(g=this.textSearch);for(var h=0;h<f.length;h++){var k=f[h];b.isPlainObject(k)&&(k=k.oper);if(c.operator==k){g=c.operator;break}}switch(c.type){case "text":case "alphanumeric":b("#grid_"+this.name+"_field_"+d).w2field(c.type,c.options);break;case "int":case "float":case "hex":case "color":case "money":case "currency":case "percent":case "date":case "time":case "datetime":b("#grid_"+
this.name+"_field_"+d).w2field(c.type,c.options);b("#grid_"+this.name+"_field2_"+d).w2field(c.type,c.options);setTimeout(function(){b("#grid_"+a.name+"_field_"+d).keydown();b("#grid_"+a.name+"_field2_"+d).keydown()},1);break;case "list":case "combo":case "enum":f=c.options;"list"==c.type&&(f.selected={});"enum"==c.type&&(f.selected=[]);e&&(f.selected=e.value);b("#grid_"+this.name+"_field_"+d).w2field(c.type,b.extend({openOnFocus:!0},f));e&&null!=e.text&&b("#grid_"+this.name+"_field_"+d).data("selected",
{id:e.value,text:e.text});break;case "select":f='<option value="">--</option>';for(h=0;h<c.options.items.length;h++)if(k=c.options.items[h],b.isPlainObject(c.options.items[h])){var n=k.id,m=k.text;null==n&&null!=k.value&&(n=k.value);null==m&&null!=k.text&&(m=k.text);null==n&&(n="");f+='<option value="'+n+'">'+m+"</option>"}else f+='<option value="'+k+'">'+k+"</option>";b("#grid_"+this.name+"_field_"+d).html(f)}null!=e?("int"==e.type&&-1!=["in","not in"].indexOf(e.operator)&&b("#grid_"+this.name+"_field_"+
d).w2field("clear").val(e.value),b("#grid_"+this.name+"_operator_"+d).val(e.operator).trigger("change"),b.isArray(e.value)?-1!=["in","not in"].indexOf(e.operator)?b("#grid_"+this.name+"_field_"+d).val(e.value).trigger("change"):(b("#grid_"+this.name+"_field_"+d).val(e.value[0]).trigger("change"),b("#grid_"+this.name+"_field2_"+d).val(e.value[1]).trigger("change")):null!=e.value&&b("#grid_"+this.name+"_field_"+d).val(e.value).trigger("change")):b("#grid_"+this.name+"_operator_"+d).val(g).trigger("change")}b("#w2ui-overlay-"+
this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]").on("keypress",function(c){13==c.keyCode&&(a.search(),b().w2overlay({name:a.name+"-searchOverlay"}))})},getColumnsHTML:function(){function a(){var a="<tr>",b="<tr>",d=c.columnGroups.length-1;null==c.columnGroups[d].text&&null!=c.columnGroups[d].caption&&(console.log("NOTICE: grid columnGroup.caption property is deprecated, please use columnGroup.text. Group -> ",c.columnGroups[d]),c.columnGroups[d].text=c.columnGroups[d].caption);""!=c.columnGroups[c.columnGroups.length-
1].text&&c.columnGroups.push({text:""});c.show.lineNumbers&&(a+='<td class="w2ui-head w2ui-col-number">    <div style="height: '+(c.recordHeight+1)+'px">&#160;</div></td>');c.show.selectColumn&&(a+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>');c.show.expandColumn&&(a+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');d=0;b+='<td id="grid_'+c.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';
c.show.orderColumn&&(b+='<td class="w2ui-head w2ui-col-order" col="order">    <div style="height: 25px">&#160;</div></td>');for(var e=0;e<c.columnGroups.length;e++){var f=c.columnGroups[e],g=c.columns[d];null!=f.colspan&&(f.span=f.colspan);if(null==f.span||f.span!=parseInt(f.span))f.span=1;null==g.text&&null!=g.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column ->",g),g.text=g.caption);var h=0;for(var l=d;l<d+f.span;l++)c.columns[l]&&!c.columns[l].hidden&&
h++;e==c.columnGroups.length-1&&h++;if(!(0>=h)){if(!0===f.master){l="";for(var w=0;w<c.sortData.length;w++)c.sortData[w].field==g.field&&("asc"===(c.sortData[w].direction||"").toLowerCase()&&(l="w2ui-sort-up"),"desc"===(c.sortData[w].direction||"").toLowerCase()&&(l="w2ui-sort-down"));w="";!1!==g.resizable&&(w='<div class="w2ui-resizer" name="'+d+'"></div>');h='<td id="grid_'+c.name+"_column_"+d+'" class="w2ui-head '+l+'" col="'+d+'"     rowspan="2" colspan="'+h+'"     oncontextmenu = "w2ui[\''+c.name+
"'].contextMenu(null, "+d+', event);"    onclick="w2ui[\''+c.name+"'].columnClick('"+g.field+"', event);\"    ondblclick=\"w2ui['"+c.name+"'].columnDblClick('"+g.field+"', event);\">"+w+'    <div class="w2ui-col-group w2ui-col-header '+(l?"w2ui-col-sorted":"")+'">        <div class="'+l+'"></div>'+(g.text?g.text:"&#160;")+"    </div></td>"}else h='<td id="grid_'+c.name+"_column_"+d+'" class="w2ui-head" col="'+d+'"         colspan="'+h+'">    <div class="w2ui-col-group">'+(f.text?f.text:"&#160;")+
"    </div></td>";g&&g.frozen?a+=h:b+=h}d+=f.span}b+='<td id="grid_'+c.name+'_column_end" class="w2ui-head" col="end"></td></tr>';return[a+"<td></td></tr>",b]}function b(a){var b="<tr>";c.show.lineNumbers&&(b+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+c.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+c.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>");c.show.selectColumn&&(b+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+
c.name+'_check_all" tabindex="-1"            style="'+(0==c.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="var grid = w2ui[\''+c.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>");
c.show.expandColumn&&(b+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');var d=0,e=0;var f="<tr>"+('<td id="grid_'+c.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>');c.show.orderColumn&&(f+='<td class="w2ui-head w2ui-col-order" col="order">    <div>&#160;</div></td>');for(var g=0;g<c.columns.length;g++){var h=c.columns[g];null==h.text&&null!=h.caption&&(console.log("NOTICE: grid column.caption property is deprecated, please use column.text. Column -> ",
h),h.text=h.caption);null==h.size&&(h.size="100%");if(g==e){var k=c.columnGroups[d++]||{};e+=k.span}if(!((g<c.last.colStart||g>c.last.colEnd)&&!h.frozen||h.hidden||!0===k.master&&!a)){var l=c.getColumnCellHTML(g);h&&h.frozen?b+=l:f+=l}}return[b+'<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td></tr>',f+'<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td></tr>']}var c=this,e="",f="";if(this.show.columnHeaders)if(0<this.columnGroups.length){f=b(!0);var g=a(),h=b(!1);e=f[0]+
g[0]+h[0];f=f[1]+g[1]+h[1]}else f=b(!0),e=f[0],f=f[1];return[e,f]},getColumnCellHTML:function(a){var b=this.columns[a];if(null==b)return"";for(var c=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",e="",f=0;f<this.sortData.length;f++)this.sortData[f].field==b.field&&("asc"===(this.sortData[f].direction||"").toLowerCase()&&(e="w2ui-sort-up"),"desc"===(this.sortData[f].direction||"").toLowerCase()&&(e="w2ui-sort-down"));var g=this.last.selection.columns,
h=!1,k;for(k in g)for(f=0;f<g[k].length;f++)g[k][f]==a&&(h=!0);return'<td id="grid_'+this.name+"_column_"+a+'" col="'+a+'" class="w2ui-head '+e+c+'" '+("normal"==this.columnTooltip&&b.tooltip?'title="'+b.tooltip+'" ':"")+"    onmouseEnter = \"w2ui['"+this.name+"'].columnTooltipShow('"+a+"', event);\"    onmouseLeave  = \"w2ui['"+this.name+"'].columnTooltipHide('"+a+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+a+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+
b.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+b.field+"', event);\">"+(!1!==b.resizable?'<div class="w2ui-resizer" name="'+a+'"></div>':"")+'    <div class="w2ui-col-header '+(e?"w2ui-col-sorted":"")+" "+(h?"w2ui-col-selected":"")+'">        <div class="'+e+'"></div>'+(b.text?b.text:"&#160;")+"    </div></td>"},columnTooltipShow:function(a){if("normal"!=this.columnTooltip){var d=b(this.box).find("#grid_"+this.name+"_column_"+a),c=this.columns[a],e=this.columnTooltip;
d.prop("_mouse_over",!0);setTimeout(function(){!0===d.prop("_mouse_over")&&!0!==d.prop("_mouse_tooltip")&&(d.prop("_mouse_tooltip",!0),d.w2tag(c.tooltip,{position:e,top:5}))},1)}},columnTooltipHide:function(a){if("normal"!=this.columnTooltip){var d=b(this.box).find("#grid_"+this.name+"_column_"+a);d.removeProp("_mouse_over");setTimeout(function(){!0!==d.prop("_mouse_over")&&!0===d.prop("_mouse_tooltip")&&(d.removeProp("_mouse_tooltip"),d.w2tag())},1)}},getRecordsHTML:function(){var a=this.records.length,
d="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||d||(a=this.last.searchIds.length);this.last.show_extra=a>this.vs_start?this.vs_extra:this.vs_start;d=b("#grid_"+this.name+"_records");d=Math.floor((d.height()||0)/this.recordHeight)+this.last.show_extra+1;if(!this.fixedBody||d>a)d=a;var c=this.getRecordHTML(-1,0),e="<table><tbody>"+c[0],f="<table><tbody>"+c[1];e+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';f+='<tr id="grid_'+
this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(var g=0;g<d;g++)c=this.getRecordHTML(g,g+1),e+=c[0],f+=c[1];a=(Math.max(a,this.total)-d)*this.recordHeight;e+='<tr id="grid_'+this.name+'_frec_bottom" rec="bottom" line="bottom" style="height: '+a+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; visibility: hidden">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>';f+=
'<tr id="grid_'+this.name+'_rec_bottom" rec="bottom" line="bottom" style="height: '+a+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>';this.last.range_start=0;this.last.range_end=d;return[e,f]},getSummaryHTML:function(){if(0!==this.summary.length){for(var a=this.getRecordHTML(-1,0),b="<table><tbody>"+a[0],c="<table><tbody>"+a[1],e=0;e<this.summary.length;e++)a=
this.getRecordHTML(e,e+1,!0),b+=a[0],c+=a[1];return[b+"</tbody></table>",c+"</tbody></table>"]}},scroll:function(a){function d(){c.markSearch&&(clearTimeout(c.last.marker_timer),c.last.marker_timer=setTimeout(function(){for(var a=[],d=0;d<c.searchData.length;d++){var e=c.searchData[d],f=c.getSearch(e.field);f&&!f.hidden&&(f=c.getColumn(e.field,!0),a.push({field:e.field,search:e.value,col:f}))}0<a.length&&a.forEach(function(a){b(c.box).find('td[col="'+a.col+'"]').not(".w2ui-head").w2marker(a.search)})},
50))}(new Date).getTime();var c=this,e="object"!=typeof this.url?this.url:this.url.get,f=b("#grid_"+this.name+"_records"),g=b("#grid_"+this.name+"_frecords");if(a){var h=a.target.scrollTop;a=a.target.scrollLeft;c.last.scrollTop=h;c.last.scrollLeft=a;b("#grid_"+c.name+"_columns")[0].scrollLeft=a;b("#grid_"+c.name+"_summary")[0].scrollLeft=a;g[0].scrollTop=h}this.last.bubbleEl&&(b(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var k=a=null;if(c.disableCVS||0<c.columnGroups.length)a=0,k=c.columns.length-
1;else{h=f.width();for(var n=0,m=0;m<c.columns.length;m++)if(!c.columns[m].frozen&&!c.columns[m].hidden){var l=parseInt(c.columns[m].sizeCalculated?c.columns[m].sizeCalculated:c.columns[m].size);n+l+30>c.last.scrollLeft&&null==a&&(a=m);n+l-30>c.last.scrollLeft+h&&null==k&&(k=m);n+=l}null==k&&(k=c.columns.length-1)}if(null!=a&&(0>a&&(a=0),0>k&&(k=0),a==k&&(0<a?a--:k++),a!=c.last.colStart||k!=c.last.colEnd)){h=b(c.box);n=Math.abs(k-c.last.colEnd);if(5>Math.abs(a-c.last.colStart)&&5>n){n=h.find(".w2ui-grid-columns #grid_"+
c.name+"_column_start");l=h.find(".w2ui-grid-columns .w2ui-head-last");var v=h.find("#grid_"+c.name+"_records .w2ui-grid-data-spacer"),r=h.find("#grid_"+c.name+"_records .w2ui-grid-data-last"),t=h.find("#grid_"+c.name+"_summary .w2ui-grid-data-spacer"),x=h.find("#grid_"+c.name+"_summary .w2ui-grid-data-last");if(a>c.last.colStart)for(m=c.last.colStart;m<a;m++)h.find("#grid_"+c.name+"_columns #grid_"+c.name+"_column_"+m).remove(),h.find("#grid_"+c.name+'_records td[col="'+m+'"]').remove(),h.find("#grid_"+
c.name+'_summary td[col="'+m+'"]').remove();if(k<c.last.colEnd)for(m=c.last.colEnd;m>k;m--)h.find("#grid_"+c.name+"_columns #grid_"+c.name+"_column_"+m).remove(),h.find("#grid_"+c.name+'_records td[col="'+m+'"]').remove(),h.find("#grid_"+c.name+'_summary td[col="'+m+'"]').remove();if(a<c.last.colStart)for(m=c.last.colStart-1;m>=a;m--)c.columns[m]&&(c.columns[m].frozen||c.columns[m].hidden)||(n.after(c.getColumnCellHTML(m)),v.each(function(a,d){a=b(d).parent().attr("index");var e='<td class="w2ui-grid-data" col="'+
m+'" style="height: 0px"></td>';null!=a&&(e=c.getCellHTML(parseInt(a),m,!1));b(d).after(e)}),t.each(function(a,d){a=b(d).parent().attr("index");var e='<td class="w2ui-grid-data" col="'+m+'" style="height: 0px"></td>';null!=a&&(e=c.getCellHTML(parseInt(a),m,!0));b(d).after(e)}));if(k>c.last.colEnd)for(m=c.last.colEnd+1;m<=k;m++)c.columns[m]&&(c.columns[m].frozen||c.columns[m].hidden)||(l.before(c.getColumnCellHTML(m)),r.each(function(a,d){a=b(d).parent().attr("index");var e='<td class="w2ui-grid-data" col="'+
m+'" style="height: 0px"></td>';null!=a&&(e=c.getCellHTML(parseInt(a),m,!1));b(d).before(e)}),x.each(function(a,d){a=b(d).parent().attr("index")||-1;a=c.getCellHTML(parseInt(a),m,!0);b(d).before(a)}));c.last.colStart=a;c.last.colEnd=k}else{c.last.colStart=a;c.last.colEnd=k;a=this.getColumnsHTML();k=this.getRecordsHTML();n=this.getSummaryHTML();l=h.find("#grid_"+this.name+"_columns");var w=h.find("#grid_"+this.name+"_records");v=h.find("#grid_"+this.name+"_frecords");var u=h.find("#grid_"+this.name+
"_summary");l.find("tbody").html(a[1]);v.html(k[0]);w.prepend(k[1]);null!=n&&u.html(n[1]);setTimeout(function(){w.find("> table").not("table:first-child").remove();u[0]&&(u[0].scrollLeft=c.last.scrollLeft)},1)}c.resizeRecords()}h=this.records.length;0==this.searchData.length||e||(h=this.last.searchIds.length);if(0!==h&&0!==f.length&&0!==f.height()&&(this.last.show_extra=h>this.vs_start?this.vs_extra:this.vs_start,!(f.height()<h*this.recordHeight&&"hidden"==f.css("overflow-y"))&&(a=Math.round(f[0].scrollTop/
this.recordHeight+1),k=a+(Math.round(f.height()/this.recordHeight)-1),a>h&&(a=h),k>=h-1&&(k=h),b("#grid_"+this.name+"_footer .w2ui-footer-right").html((c.show.statusRange?w2utils.formatNumber(this.offset+a)+"-"+w2utils.formatNumber(this.offset+k)+(-1!=this.total?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(e&&c.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(h)+(0<this.offset?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),e||this.fixedBody&&
!(-1!=this.total&&this.total<=this.vs_start)))){e=Math.floor(f[0].scrollTop/this.recordHeight)-this.last.show_extra;a=e+Math.floor(f.height()/this.recordHeight)+2*this.last.show_extra+1;1>e&&(e=1);a>this.total&&-1!=this.total&&(a=this.total);k=f.find("#grid_"+this.name+"_rec_top");n=f.find("#grid_"+this.name+"_rec_bottom");l=g.find("#grid_"+this.name+"_frec_top");v=g.find("#grid_"+this.name+"_frec_bottom");-1!=String(k.next().prop("id")).indexOf("_expanded_row")&&(k.next().remove(),l.next().remove());
this.total>a&&-1!=String(n.prev().prop("id")).indexOf("_expanded_row")&&(n.prev().remove(),v.prev().remove());r=parseInt(k.next().attr("line"));t=parseInt(n.prev().attr("line"));if(r<e||1==r||this.last.pull_refresh){if(a<=t+this.last.show_extra-2&&a!=this.total)return;for(this.last.pull_refresh=!1;;){r=g.find("#grid_"+this.name+"_frec_top").next();t=f.find("#grid_"+this.name+"_rec_top").next();if("bottom"==t.attr("line"))break;if(parseInt(t.attr("line"))<e)r.remove(),t.remove();else break}g=f.find("#grid_"+
this.name+"_rec_bottom").prev();g=g.attr("line");"top"==g&&(g=e);for(m=parseInt(g)+1;m<=a;m++)this.records[m-1]&&((t=this.records[m-1].w2ui)&&!Array.isArray(t.children)&&(t.expanded=!1),g=this.getRecordHTML(m-1,m),n.before(g[1]),v.before(g[0]))}else{if(e>=r-this.last.show_extra+2&&1<e)return;for(;;){r=g.find("#grid_"+this.name+"_frec_bottom").prev();t=f.find("#grid_"+this.name+"_rec_bottom").prev();if("top"==t.attr("line"))break;if(parseInt(t.attr("line"))>a)r.remove(),t.remove();else break}g=f.find("#grid_"+
this.name+"_rec_top").next();g=g.attr("line");"bottom"==g&&(g=a);for(m=parseInt(g)-1;m>=e;m--)this.records[m-1]&&((t=this.records[m-1].w2ui)&&!Array.isArray(t.children)&&(t.expanded=!1),g=this.getRecordHTML(m-1,m),k.after(g[1]),l.after(g[0]))}d();setTimeout(function(){c.refreshRanges()},0);g=(e-1)*c.recordHeight;r=(Math.max(h,this.total)-a)*this.recordHeight;0>r&&(r=0);k.css("height",g+"px");l.css("height",g+"px");n.css("height",r+"px");v.css("height",r+"px");c.last.range_start=e;c.last.range_end=
a;if(Math.floor(f[0].scrollTop/this.recordHeight)+Math.floor(f.height()/this.recordHeight)+10>h&&!0!==this.last.pull_more&&(h<this.total-this.offset||-1==this.total&&this.last.xhr_hasMore))if(!0===this.autoLoad)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get");else{f=b("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");if("none"==f.css("display"))f.show().on("click",function(){c.last.pull_more=!0;c.last.xhr_offset+=c.limit;c.request("get");b(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')});
(0<f.find("td .w2ui-spinner").length||-1==f.find("td").text().indexOf("Load"))&&f.find("td").html("<div>"+w2utils.lang("Load")+" "+c.limit+" "+w2utils.lang("More")+"...</div>")}h>=this.total-this.offset&&-1!=this.total&&b("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide()}},getRecordHTML:function(a,b,c){var d="",f="",g=this.last.selection;if(-1==a){d+='<tr line="0">';this.show.lineNumbers&&(d+='<td class="w2ui-col-number" style="height: 0px;"></td>');this.show.selectColumn&&(d+=
'<td class="w2ui-col-select" style="height: 0px;"></td>');this.show.expandColumn&&(d+='<td class="w2ui-col-expand" style="height: 0px;"></td>');f+='<tr line="0"><td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>';this.show.orderColumn&&(f+='<td class="w2ui-col-order" style="height: 0px;" col="order"></td>');for(var h=0;h<this.columns.length;h++)b=this.columns[h],a='<td class="w2ui-grid-data" col="'+h+'" style="height: 0px;"></td>',b.frozen&&!b.hidden?
d+=a:b.hidden||h<this.last.colStart||h>this.last.colEnd||(f+=a);return[d+'<td class="w2ui-grid-data-last" style="height: 0px"></td></tr>',f+'<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td></tr>']}var k="object"!=typeof this.url?this.url:this.url.get;if(!0!==c){if(0<this.searchData.length&&!k){if(a>=this.last.searchIds.length)return"";a=this.last.searchIds[a]}else if(a>=this.records.length)return"";k=this.records[a]}else{if(a>=this.summary.length)return"";k=this.summary[a]}if(!k)return"";
null==k.recid&&null!=this.recid&&(h=this.parseField(k,this.recid),null!=h&&(k.recid=h));w2utils.escapeId(k.recid);h=!1;-1!=g.indexes.indexOf(a)&&(h=!0);g=k.w2ui?k.w2ui.style:"";if(null==g||"string"!=typeof g)g="";var n=k.w2ui?k.w2ui.class:"";if(null==n||"string"!=typeof n)n="";d+='<tr id="grid_'+this.name+"_frec_"+k.recid+'" recid="'+k.recid+'" line="'+b+'" index="'+a+'"  class="'+(0===b%2?"w2ui-even":"w2ui-odd")+" w2ui-record "+n+(h&&"row"==this.selectType?" w2ui-selected":"")+(k.w2ui&&!1===k.w2ui.editable?
" w2ui-no-edit":"")+(k.w2ui&&!0===k.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==c?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+
this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(h||""==g?g.replace("background-color","none"):g)+'" '+(""!=g?'custom_style="'+g+'"':"")+">";f+='<tr id="grid_'+this.name+"_rec_"+k.recid+'" recid="'+k.recid+'" line="'+b+'" index="'+a+'"  class="'+(0===b%2?"w2ui-even":"w2ui-odd")+" w2ui-record "+n+(h&&"row"==this.selectType?" w2ui-selected":"")+(k.w2ui&&!1===k.w2ui.editable?" w2ui-no-edit":"")+(k.w2ui&&
!0===k.w2ui.expanded?" w2ui-expanded":"")+'" '+(!0!==c?w2utils.isIOS?"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"var obj = w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+
this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(h||""==g?g.replace("background-color","none"):g)+'" '+(""!=g?'custom_style="'+g+'"':"")+">";this.show.lineNumbers&&(d+='<td id="grid_'+this.name+"_cell_"+a+"_number"+(c?"_s":"")+'"    class="w2ui-col-number '+(h?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(!0!==c?this.getLineHTML(b,k):"")+"</td>");this.show.selectColumn&&
(d+='<td id="grid_'+this.name+"_cell_"+a+"_select"+(c?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(!0===c||k.w2ui&&!0===k.w2ui.hideCheckBox?"":'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(h?'checked="checked"':"")+' style="pointer-events: none"/>    </div>')+"</td>");this.show.expandColumn&&(b=k.w2ui&&!0===k.w2ui.expanded?"-":"+",k.w2ui&&"none"==k.w2ui.expanded&&(b=""),k.w2ui&&"spinner"==k.w2ui.expanded&&(b='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),
d+='<td id="grid_'+this.name+"_cell_"+a+"_expand"+(c?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==c?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+b+" </div>":"")+"</td>");f+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';
this.show.orderColumn&&(f+='<td id="grid_'+this.name+"_cell_"+a+"_order"+(c?"_s":"")+'" class="w2ui-grid-data w2ui-col-order" col="order">'+(!0!==c?'<div title="Drag to reorder">&nbsp;</div>':"")+"</td>");for(h=g=0;;){n=1;b=this.columns[g];if(null==b)break;if(b.hidden)g++,0<h&&h--;else if(0<h){g++;if(null==this.columns[g])break;k.w2ui.colspan[this.columns[g-1].field]=0;h--}else{if(k.w2ui){var m=k.w2ui.colspan,l=this.columns[g].field;m&&0===m[l]&&delete m[l]}if(!(g<this.last.colStart||g>this.last.colEnd)||
b.frozen){if(k.w2ui&&"object"==typeof k.w2ui.colspan&&(m=parseInt(k.w2ui.colspan[b.field])||null,1<m)){n=0;for(h=g;h<g+m&&!(h>=this.columns.length);h++)this.columns[h].hidden&&n++;n=m-n;h=m-1}n=this.getCellHTML(a,g,c,n);b.frozen?d+=n:f+=n}g++}}return[d+'<td class="w2ui-grid-data-last"></td></tr>',f+'<td class="w2ui-grid-data-last" col="end"></td></tr>']},getLineHTML:function(a){return"<div>"+a+"</div>"},getCellHTML:function(a,d,c,e){var f=this.columns[d];if(null==f)return"";var g=!0!==c?this.records[a]:
this.summary[a],h=-1!==a?this.getCellValue(a,d,c):"",k=-1!==a?this.getCellEditable(a,d):"",n="max-height: "+parseInt(this.recordHeight)+"px;"+(f.clipboardCopy?"margin-right: 20px":""),m=!c&&g&&g.w2ui&&g.w2ui.changes&&null!=g.w2ui.changes[f.field],l="",v="",r=this.last.selection,t=!1,x="";-1!=r.indexes.indexOf(a)&&(t=!0);null==e&&(e=g&&g.w2ui&&g.w2ui.colspan&&g.w2ui.colspan[f.field]?g.w2ui.colspan[f.field]:1);if(0===d&&g&&g.w2ui&&Array.isArray(g.w2ui.children)){for(var w=0,u=this.get(g.w2ui.parent_recid,
!0);;)if(null!=u)if(w++,u=this.records[u].w2ui,null!=u&&null!=u.parent_recid)u=this.get(u.parent_recid,!0);else break;else break;if(g.w2ui.parent_recid)for(u=0;u<w;u++)x+='<span class="w2ui-show-children w2ui-icon-empty"></span>';x+='<span class="w2ui-show-children '+(0<g.w2ui.children.length?g.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}!0===f.info&&
(f.info={});null!=f.info&&(w="w2ui-icon-info","function"==typeof f.info.icon?w=f.info.icon(g):"object"==typeof f.info.icon?w=f.info.icon[this.parseField(g,f.field)]||"":"string"==typeof f.info.icon&&(w=f.info.icon),u=f.info.style||"","function"==typeof f.info.style?u=f.info.style(g):"object"==typeof f.info.style?u=f.info.style[this.parseField(g,f.field)]||"":"string"==typeof f.info.style&&(u=f.info.style),x+='<span class="w2ui-info '+w+'" style="'+u+'" '+(null!=f.info.showOn?"on"+f.info.showOn:"onclick")+
"=\"event.stopPropagation(); w2ui['"+this.name+"'].showBubble("+a+", "+d+')"'+(null!=f.info.hideOn?"on"+f.info.hideOn:"")+"=\"var grid = w2ui['"+this.name+"']; if (grid.last.bubbleEl) { $(grid.last.bubbleEl).w2tag() } grid.last.bubbleEl = null;\"></span>");if(null!=f.render&&-1!==a){"function"==typeof f.render&&(k=f.render.call(this,g,a,d,h),null!=k&&"object"==typeof k?(h=b.trim(k.html||""),v=k.class||"",l=k.style||""):h=b.trim(k),4>h.length||"<div"!=h.substr(0,4).toLowerCase())&&(h='<div style="'+
n+'">'+x+String(h)+"</div>");if("object"==typeof f.render){k=f.render[h];if(null==k||""===k)k=h;h='<div style="'+n+'">'+x+k+"</div>"}"string"==typeof f.render&&(k=f.render.toLowerCase().indexOf(":"),u=[],-1==k?(u[0]=f.render.toLowerCase(),u[1]=""):(u[0]=f.render.toLowerCase().substr(0,k),u[1]=f.render.toLowerCase().substr(k+1)),k=w2utils.formatters[u[0]],h='<div style="'+n+'">'+x+("function"==typeof k?k(h,u[1]):"")+"</div>")}else{k&&-1!=["checkbox","check"].indexOf(k.type)&&(n+="text-align: center;",
h='<input tabindex="-1" type="checkbox" '+(h?'checked="checked"':"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+(c?-(a+1):a)+", "+d+', event); "/>',x="");if(this.show.recordTitles){var y=w2utils.stripTags(String(h).replace(/"/g,"''"));null!=f.title&&("function"==typeof f.title&&(y=f.title.call(this,g,a,d)),"string"==typeof f.title&&(y=f.title))}h='<div style="'+n+'" title="'+(y||"")+'">'+x+String(h)+"</div>"}null==h&&(h="");"string"==typeof f.render&&(u=
f.render.toLowerCase().split(":"),-1!="number int float money currency percent size".split(" ").indexOf(u[0])&&(l+="text-align: right;"));g&&g.w2ui&&("object"==typeof g.w2ui.style&&("string"==typeof g.w2ui.style[d]&&(l+=g.w2ui.style[d]+";"),"string"==typeof g.w2ui.style[f.field]&&(l+=g.w2ui.style[f.field]+";")),"object"==typeof g.w2ui.class&&("string"==typeof g.w2ui.class[d]&&(v+=g.w2ui.class[d]+" "),"string"==typeof g.w2ui.class[f.field]&&(v+=g.w2ui.class[f.field]+" ")));g=!1;t&&-1!=b.inArray(d,
r.columns[a])&&(g=!0);r="string"==typeof f.clipboardCopy?f.clipboardCopy:"Copy to clipboard";t="<span onmouseEnter=\"jQuery(this).w2tag('"+r+"', { position: 'top|bottom' })\"onclick=\"w2ui['"+this.name+"'].clipboardCopy("+a+", "+d+'); jQuery(this).w2tag(\'Copied\', { position: \'top|bottom\' }); event.stopPropagation();" onmouseLeave="jQuery(this).w2tag()" class="w2ui-clipboard-copy w2ui-icon-paste"></span>';h='<td class="w2ui-grid-data'+(g?" w2ui-selected":"")+" "+v+(m?" w2ui-changed":"")+'"    id="grid_'+
this.name+"_data_"+a+"_"+d+'" col="'+d+'"    style="'+l+(null!=f.style?f.style:"")+'" '+(null!=f.attr?f.attr:"")+(1<e?'colspan="'+e+'"':"")+">"+h+(""!=w2utils.stripTags(h)&&f.clipboardCopy&&r?t:"")+"</td>";-1===a&&!0===c&&(h='<td class="w2ui-grid-data" col="'+d+'" style="height: 0px; '+l+'" '+(1<e?'colspan="'+e+'"':"")+"></td>");return h},clipboardCopy:function(a,d){a=this.records[a];var c=(d=this.columns[d])?this.parseField(a,d.field):"";"function"==typeof d.clipboardCopy&&(c=d.clipboardCopy(a));
b("#grid_"+this.name+"_focus").text(c).select();document.execCommand("copy")},showBubble:function(a,d){var c="",e=this.columns[d].info,f=this.records[a],g=b(this.box).find("#grid_"+this.name+"_data_"+a+"_"+d+" .w2ui-info");this.last.bubbleEl&&b(this.last.bubbleEl).w2tag();this.last.bubbleEl=g;if(null==e.fields){e.fields=[];for(var h=0;h<this.columns.length;h++){var k=this.columns[h];e.fields.push(k.field+("string"==typeof k.render?":"+k.render:""))}}var n=e.fields;"function"==typeof n&&(n=n(f,a,d));
if("function"==typeof e.render)c=e.render(f,a,d);else if(b.isArray(n)){c='<table cellpadding="0" cellspacing="0">';for(h=0;h<n.length;h++){var m=String(n[h]).split(":");if(""==m[0]||"-"==m[0]||"--"==m[0]||"---"==m[0])c+='<tr><td colspan=2><div style="border-top: '+(""==m[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';else{k=this.getColumn(m[0]);null==k&&(k={field:m[0],caption:m[0]});var l=k?this.parseField(f,k.field):"";1<m.length&&(w2utils.formatters[m[1]]?l=w2utils.formatters[m[1]](l,
m[2]||null):console.log('ERROR: w2utils.formatters["'+m[1]+'"] does not exists.'));if(!0===e.showEmpty||null!=l&&""!=l)null!=e.maxLength&&"string"==typeof l&&l.length>e.maxLength&&(l=l.substr(0,e.maxLength)+"..."),c+="<tr><td>"+k.text+"</td><td>"+((0===l?"0":l)||"")+"</td></tr>"}}c+="</table>"}else if(b.isPlainObject(n)){c='<table cellpadding="0" cellspacing="0">';for(var v in n)if(h=n[v],""==h||"-"==h||"--"==h||"---"==h)c+='<tr><td colspan=2><div style="border-top: '+(""==h?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>';
else if(m=String(h).split(":"),k=this.getColumn(m[0]),null==k&&(k={field:m[0],caption:m[0]}),l=k?this.parseField(f,k.field):"",1<m.length&&(w2utils.formatters[m[1]]?l=w2utils.formatters[m[1]](l,m[2]||null):console.log('ERROR: w2utils.formatters["'+m[1]+'"] does not exists.')),"function"==typeof h&&(l=h(f,a,d)),!0===e.showEmpty||null!=l&&""!=l)null!=e.maxLength&&"string"==typeof l&&l.length>e.maxLength&&(l=l.substr(0,e.maxLength)+"..."),c+="<tr><td>"+v+"</td><td>"+(l||"")+"</td></tr>";c+="</table>"}b(g).w2tag(b.extend({html:c,
left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},e.options||{}))},getCellEditable:function(a,b){var c=this.columns[b],d=this.records[a];if(!d||!c)return null;var f=d.w2ui?d.w2ui.editable:null;if(!1===f)return null;if(null==f||!0===f)f=c?c.editable:null,"function"===typeof f&&(c=this.getCellValue(a,b,!1),f=f.call(this,d,a,b,c));return f},getCellValue:function(a,d,c){d=this.columns[d];a=!0!==c?this.records[a]:this.summary[a];var e=this.parseField(a,d.field);a&&a.w2ui&&
a.w2ui.changes&&null!=a.w2ui.changes[d.field]&&(e=a.w2ui.changes[d.field]);b.isPlainObject(e)&&(d.options&&d.options.items?e=(val=d.options.items.find(function(a){return a.id==e.id}))?val.text:e.id:(null!=e.text&&(e=e.text),null!=e.id&&(e=e.id)));null==e&&(e="");return e},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(a){if(null!=a)b("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(a);
else{var d="";a=this.getSelection();0<a.length&&(this.show.statusSelection&&1<a.length&&(d=String(a.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==a.length&&(d=a[0],"object"==typeof d&&(d=d.recid+", "+w2utils.lang("Column")+": "+d.column),d=w2utils.lang("Record ID")+": "+d+" "));b("#grid_"+this.name+"_footer .w2ui-footer-left").html(d);1==a.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit");1<=a.length?this.toolbar.enable("w2ui-delete"):
this.toolbar.disable("w2ui-delete")}},lock:function(a,d){var c=this,e=Array.prototype.slice.call(arguments,0);e.unshift(this.box);setTimeout(function(){b(c.box).find("#grid_"+c.name+"_empty_msg").remove();w2utils.lock.apply(window,e)},10)},unlock:function(a){var d=this.box;setTimeout(function(){0<b(d).find(".w2ui-message").not(".w2ui-closing").length||w2utils.unlock(d,a)},25)},stateSave:function(a){var d=this;if(!w2utils.hasLocalStorage)return null;for(var c={columns:[],show:b.extend({},this.show),
last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,label:this.last.label,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},e,f=0;f<this.columns.length;f++){var g=d.columns[f],h={};Object.keys(d.stateColProps).forEach(function(a,b){d.stateColProps[a]&&(e=void 0!==g[a]?g[a]:d.stateColDefaults[a]||null,h[a]=e)});c.columns.push(h)}for(f=0;f<this.sortData.length;f++)c.sortData.push(b.extend({},this.sortData[f]));for(f=
0;f<this.searchData.length;f++)c.searchData.push(b.extend({},this.searchData[f]));if(!0!==a){a=this.trigger({phase:"before",type:"stateSave",target:this.name,state:c});if(!0===a.isCancelled){"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."});return}try{var k=b.parseJSON(localStorage.w2ui||"{}");k||(k={});k.states||(k.states={});k.states[this.stateId||this.name]=c;localStorage.w2ui=JSON.stringify(k)}catch(n){return delete localStorage.w2ui,null}this.trigger(b.extend(a,
{phase:"after"}))}return c},stateRestore:function(a){var d=this,c="object"!=typeof this.url?this.url:this.url.get;if(!a)try{if(!w2utils.hasLocalStorage)return!1;var e=b.parseJSON(localStorage.w2ui||"{}");e||(e={});e.states||(e.states={});a=e.states[this.stateId||this.name]}catch(m){return delete localStorage.w2ui,null}var f=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:a});if(!0===f.isCancelled)"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."});
else{if(b.isPlainObject(a)){b.extend(this.show,a.show);b.extend(this.last,a.last);for(var g=this.last.scrollTop,h=this.last.scrollLeft,k=0;k<a.columns.length;k++){e=a.columns[k];var n=this.getColumn(e.field,!0);null!==n&&(b.extend(this.columns[n],e),k!==n&&this.columns.splice(k,0,this.columns.splice(n,1)[0]))}this.sortData.splice(0,this.sortData.length);for(k=0;k<a.sortData.length;k++)this.sortData.push(a.sortData[k]);this.searchData.splice(0,this.searchData.length);for(k=0;k<a.searchData.length;k++)this.searchData.push(a.searchData[k]);
setTimeout(function(){c||(0<d.sortData.length&&d.localSort(),0<d.searchData.length&&d.localSearch());d.last.scrollTop=g;d.last.scrollLeft=h;d.refresh()},1)}this.trigger(b.extend(f,{phase:"after"}));return!0}},stateReset:function(){this.stateRestore(this.last.state);if(w2utils.hasLocalStorage)try{var a=b.parseJSON(localStorage.w2ui||"{}");a.states&&a.states[this.stateId||this.name]&&delete a.states[this.stateId||this.name];localStorage.w2ui=JSON.stringify(a)}catch(d){return delete localStorage.w2ui,
null}},parseField:function(a,b){if(this.nestedFields){var c="";try{c=a;var d=String(b).split(".");for(a=0;a<d.length;a++)c=c[d[a]]}catch(f){c=""}return c}return a?a[b]:""},prepareData:function(){function a(c){for(var d=0;d<b.columns.length;d++){var e=b.columns[d];if(null!=c[e.field]&&"string"==typeof e.render){-1!="number int float money currency percent".split(" ").indexOf(e.render.split(":")[0])&&"number"!=typeof c[e.field]&&(c[e.field]=parseFloat(c[e.field]));if(-1!=["date","age"].indexOf(e.render.split(":")[0])&&
!c[e.field+"_"]){var h=c[e.field];w2utils.isInt(h)&&(h=parseInt(h));c[e.field+"_"]=new Date(h)}if(-1!=["time"].indexOf(e.render)){if(w2utils.isTime(c[e.field])){var k=w2utils.isTime(c[e.field],!0);h=new Date;h.setHours(k.hours,k.minutes,k.seconds?k.seconds:0,0)}else k=c[e.field],w2utils.isInt(k)&&(k=parseInt(k)),k=null!=k?new Date(k):new Date,h=new Date,h.setHours(k.getHours(),k.getMinutes(),k.getSeconds(),0);c[e.field+"_"]||(c[e.field+"_"]=h)}}}if(c.w2ui&&c.w2ui.children&&!0!==c.w2ui.expanded)for(d=
0;d<c.w2ui.children.length;d++)a(c.w2ui.children[d])}for(var b=this,c=0;c<this.records.length;c++)a(this.records[c])},nextCell:function(a,b,c){var d=b+1;if(d>=this.columns.length)return null;var f=this.records[a].w2ui,g=this.columns[d];f=f&&f.colspan&&!isNaN(f.colspan[g.field])?parseInt(f.colspan[g.field]):1;return null==g?null:g&&g.hidden||0===f||c&&(b=this.getCellEditable(a,b),null==b||-1!=["checkbox","check"].indexOf(b.type))?this.nextCell(a,d,c):d},prevCell:function(a,b,c){var d=b-1;if(0>d)return null;
var f=this.records[a].w2ui,g=this.columns[d];f=f&&f.colspan&&!isNaN(f.colspan[g.field])?parseInt(f.colspan[g.field]):1;return null==g?null:g&&g.hidden||0===f||c&&(b=this.getCellEditable(a,b),null==b||-1!=["checkbox","check"].indexOf(b.type))?this.prevCell(a,d,c):d},nextRow:function(a,d){var c=this.last.searchIds,e=null;if(a+1<this.records.length&&0===c.length||0<c.length&&a<c[c.length-1]){a++;if(0<c.length)for(;!(-1!=b.inArray(a,c)||a>this.records.length);)a++;c=this.records[a].w2ui;e=this.columns[d];
e=0===(c&&c.colspan&&null!=e&&!isNaN(c.colspan[e.field])?parseInt(c.colspan[e.field]):1)?this.nextRow(a,d):a}return e},prevRow:function(a,d){var c=this.last.searchIds,e=null;if(0<a&&0===c.length||0<c.length&&a>c[0]){a--;if(0<c.length)for(;!(-1!=b.inArray(a,c)||0>a);)a--;c=this.records[a].w2ui;e=this.columns[d];e=0===(c&&c.colspan&&null!=e&&!isNaN(c.colspan[e.field])?parseInt(c.colspan[e.field]):1)?this.prevRow(a,d):a}return e},selectionSave:function(){this.last._selection=this.getSelection();return this.last._selection},
selectionRestore:function(a){var d=(new Date).getTime();this.last.selection={indexes:[],columns:{}};var c=this.last.selection,e=this.last._selection;if(e)for(var f=0;f<e.length;f++)if(b.isPlainObject(e[f])){var g=this.get(e[f].recid,!0);null!=g&&(-1==c.indexes.indexOf(g)&&c.indexes.push(g),c.columns[g]||(c.columns[g]=[]),c.columns[g].push(e[f].column))}else g=this.get(e[f],!0),null!=g&&c.indexes.push(g);delete this.last._selection;!0!==a&&this.refresh();return(new Date).getTime()-d},message:function(a,
d){"string"==typeof a&&(a={width:300>a.length?350:550,height:300>a.length?170:250,body:'<div class="w2ui-centered">'+a+"</div>",buttons:'<button type="button" class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(a){setTimeout(function(){b(this.box).find(".w2ui-btn").focus()},25)},onClose:function(a){"function"==typeof d&&d()}});w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},a)}};b.extend(l.prototype,
w2utils.event);w2obj.grid=l})(jQuery);
(function(b){var l=function(a){this.name=this.box=null;this.panels=[];this.tmp={};this.padding=1;this.resizer=4;this.style="";b.extend(!0,this,w2obj.layout,a)},a="top left main preview right bottom".split(" ");b.fn.w2layout=function(d){function c(a,c,d){var e=a.get(c);null!=e&&null==d&&(d=e.tabs);if(null==e||null==d)return!1;b.isArray(d)&&(d={tabs:d});b().w2destroy(a.name+"_"+c+"_tabs");e.tabs=b().w2tabs(b.extend({},d,{owner:a,name:a.name+"_"+c+"_tabs"}));return e.show.tabs=!0}function e(a,c,d){var e=
a.get(c);null!=e&&null==d&&(d=e.toolbar);if(null==e||null==d)return!1;b.isArray(d)&&(d={items:d});b().w2destroy(a.name+"_"+c+"_toolbar");e.toolbar=b().w2toolbar(b.extend({},d,{owner:a,name:a.name+"_"+c+"_toolbar"}));return e.show.toolbar=!0}if(b.isPlainObject(d)){if(w2utils.checkName(d,"w2layout")){var f=d.panels||[],g=new l(d);b.extend(g,{handlers:[],panels:[]});for(var h=0,k=f.length;h<k;h++)g.panels[h]=b.extend(!0,{},l.prototype.panel,f[h]),(b.isPlainObject(g.panels[h].tabs)||b.isArray(g.panels[h].tabs))&&
c(g,f[h].type),(b.isPlainObject(g.panels[h].toolbar)||b.isArray(g.panels[h].toolbar))&&e(g,f[h].type);for(f=0;f<a.length;f++)null==g.get(a[f])&&g.panels.push(b.extend(!0,{},l.prototype.panel,{type:a[f],hidden:"main"!==a[f],size:50}));0<b(this).length&&g.render(b(this)[0]);return w2ui[g.name]=g}}else return g=w2ui[b(this).attr("name")],g?0<arguments.length?(g[d]&&g[d].apply(g,Array.prototype.slice.call(arguments,1)),this):g:null};l.prototype={onShow:null,onHide:null,onResizing:null,onResizerClick:null,
onRender:null,onRefresh:null,onContent:null,onResize:null,onDestroy:null,panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},callBack:null,onRefresh:null,onShow:null,onHide:null},content:function(a,b,e){console.log("NOTICE: layout.content method is deprecated, please use layout.html() instead");return this.html(a,b,e)},html:function(a,c,e){var d=this,g=this.get(a),
h={panel:a,html:g.content,error:!1,cancelled:!1,removed:function(a){"function"==typeof a&&(g.callBack=a)}};"function"==typeof g.callBack&&(g.callBack({panel:a,content:g.content,new_content:c,transition:e||"none"}),g.callBack=null);if("css"==a)return b("#layout_"+d.name+"_panel_css").html("<style>"+c+"</style>"),h.status=!0,h;if(null==g)return console.log("ERROR: incorrect panel name. Panel name can be main, left, right, top, bottom, preview or css"),h.error=!0,h;if(null==c)return h;var k=this.trigger({phase:"before",
type:"content",target:a,object:g,content:c,transition:e});if(!0===k.isCancelled)return h.cancelled=!0,h;if(c instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),h;var n="#layout_"+this.name+"_panel_"+g.type,m=b(n+"> .w2ui-panel-content"),l=0;0<m.length&&(b(n).scrollTop(0),l=b(m).position().top);if(""===g.content)g.content=c;else if(g.content=c,!g.hidden&&null!=e&&""!==e){var v=b(n+"> .w2ui-panel-content");v.after('<div class="w2ui-panel-content new-panel" style="'+
v[0].style.cssText+'"></div>');var r=b(n+"> .w2ui-panel-content.new-panel");v.css("top",l);r.css("top",l);"object"==typeof c?(c.box=r[0],c.render()):r.html(c);w2utils.transition(v[0],r[0],e,function(){v.remove();r.removeClass("new-panel");r.css("overflow",g.overflow);b(n+"> .w2ui-panel-content").slice(1).remove();d.resize();-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){d.resize()},100)})}this.refresh(a);d.trigger(b.extend(k,{phase:"after"}));d.resize();-1!=window.navigator.userAgent.indexOf("MSIE")&&
setTimeout(function(){d.resize()},100);return h},message:function(a,c){var d=this;"string"==typeof c&&(c={width:300>c.length?350:550,height:300>c.length?170:250,body:'<div class="w2ui-centered">'+c+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message('"+a+"')\">Ok</button>",onOpen:function(a){setTimeout(function(){b(this.box).find(".w2ui-btn").focus()},25)}});var f=this.get(a),g=b("#layout_"+this.name+"_panel_"+f.type).css("overflow");if(c){if(c.onClose)var h=c.onClose;
c.onClose=function(a){"function"==typeof h&&h(a);a.done(function(){b("#layout_"+d.name+"_panel_"+f.type).css("overflow",g)})}}b("#layout_"+this.name+"_panel_"+f.type).css("overflow","hidden");w2utils.message.call(this,{box:b("#layout_"+this.name+"_panel_"+f.type),param:a,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},c)},load:function(a,c,e,f){var d=this;return"css"==a?(b.get(c,function(b,c,e){d.content(a,e.responseText);f&&f()}),!0):null!=this.get(a)?(b.get(c,
function(b,c,g){d.content(a,g.responseText,e);f&&f();d.resize();-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){d.resize()},100)}),!0):!1},sizeTo:function(a,c,e){var d=this;if(null==d.get(a))return!1;b(d.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",!0!==e?".2s":"0s"));setTimeout(function(){d.set(a,{size:c})},1);setTimeout(function(){b(d.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s"));d.resize()},500);return!0},show:function(a,
c){var d=this,f=this.trigger({phase:"before",type:"show",target:a,object:this.get(a),immediate:c});if(!0!==f.isCancelled){var g=d.get(a);if(null==g)return!1;g.hidden=!1;!0===c?(b("#layout_"+d.name+"_panel_"+a).css({opacity:"1"}),d.trigger(b.extend(f,{phase:"after"})),d.resize()):(b("#layout_"+d.name+"_panel_"+a).css({opacity:"0"}),b(d.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),setTimeout(function(){d.resize()},1),setTimeout(function(){b("#layout_"+d.name+"_panel_"+
a).css({opacity:"1"})},250),setTimeout(function(){b(d.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s"));d.trigger(b.extend(f,{phase:"after"}));d.resize()},500));return!0}},hide:function(a,c){var d=this,f=this.trigger({phase:"before",type:"hide",target:a,object:this.get(a),immediate:c});if(!0!==f.isCancelled){var g=d.get(a);if(null==g)return!1;g.hidden=!0;!0===c?(b("#layout_"+d.name+"_panel_"+a).css({opacity:"0"}),d.trigger(b.extend(f,{phase:"after"})),d.resize()):(b(d.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",
".2s")),b("#layout_"+d.name+"_panel_"+a).css({opacity:"0"}),setTimeout(function(){d.resize()},1),setTimeout(function(){b(d.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s"));d.trigger(b.extend(f,{phase:"after"}));d.resize()},500));return!0}},toggle:function(a,b){var c=this.get(a);return null==c?!1:c.hidden?this.show(a,b):this.hide(a,b)},set:function(a,c){var d=this.get(a,!0);if(null==d)return!1;b.extend(this.panels[d],c);null==c.content&&null==c.resizable||this.refresh(a);
this.resize();return!0},get:function(a,b){for(var c=0;c<this.panels.length;c++)if(this.panels[c].type==a)return!0===b?c:this.panels[c];return null},el:function(a){a=b("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-content");return 1!=a.length?null:a[0]},hideToolbar:function(a){var c=this.get(a);c&&(c.show.toolbar=!1,b("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(a){var c=this.get(a);c&&(c.show.toolbar=!0,b("#layout_"+this.name+"_panel_"+a+
"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(a){var b=this.get(a);b&&(b.show.toolbar?this.hideToolbar(a):this.showToolbar(a))},assignToolbar:function(a,c){"string"==typeof c&&null!=w2ui[c]&&(c=w2ui[c]);var d=this.get(a);d.toolbar=c;var f=b(this.box).find(a+"> .w2ui-panel-toolbar");null!=d.toolbar?(0===f.find("[name="+d.toolbar.name+"]").length?f.w2render(d.toolbar):null!=d.toolbar&&d.toolbar.refresh(),c.owner=this,this.showToolbar(a),this.refresh(a)):(f.html(""),this.hideToolbar(a))},
hideTabs:function(a){var c=this.get(a);c&&(c.show.tabs=!1,b("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(a){var c=this.get(a);c&&(c.show.tabs=!0,b("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(a){var b=this.get(a);b&&(b.show.tabs?this.hideTabs(a):this.showTabs(a))},render:function(d){function c(){h.tmp.events={resize:function(a){null==w2ui[h.name]?b(window).off("resize.w2ui-"+h.name):w2ui[h.name].resize()},
resizeStart:e,mouseMove:g,mouseUp:f};b(window).on("resize.w2ui-"+h.name,h.tmp.events.resize)}function e(c,d){if(h.box){d||(d=window.event);b(document).off("mousemove",h.tmp.events.mouseMove).on("mousemove",h.tmp.events.mouseMove);b(document).off("mouseup",h.tmp.events.mouseUp).on("mouseup",h.tmp.events.mouseUp);h.tmp.resize={type:c,x:d.screenX,y:d.screenY,diff_x:0,diff_y:0,value:0};for(d=0;d<a.length;d++){var e=b(h.el(a[d])).parent().find(".w2ui-lock");0<e.length?e.attr("locked","previous"):h.lock(a[d],
{opacity:0})}if("left"==c||"right"==c)h.tmp.resize.value=parseInt(b("#layout_"+h.name+"_resizer_"+c)[0].style.left);if("top"==c||"preview"==c||"bottom"==c)h.tmp.resize.value=parseInt(b("#layout_"+h.name+"_resizer_"+c)[0].style.top)}}function f(c){if(h.box&&(b(document).off("mousemove",h.tmp.events.mouseMove),b(document).off("mouseup",h.tmp.events.mouseUp),null!=h.tmp.resize)){for(c=0;c<a.length;c++){var d=b(h.el(a[c])).parent().find(".w2ui-lock");"previous"==d.attr("locked")?d.removeAttr("locked"):
h.unlock(a[c])}if(0!==h.tmp.diff_x||0!==h.tmp.resize.diff_y){c=h.get("top");d=h.get("bottom");var e=h.get(h.tmp.resize.type),f=parseInt(b(h.box).height()),g=parseInt(b(h.box).width()),k=String(e.size);switch(h.tmp.resize.type){case "top":var m=parseInt(e.sizeCalculated)+h.tmp.resize.diff_y;var n=0;break;case "bottom":m=parseInt(e.sizeCalculated)-h.tmp.resize.diff_y;n=0;break;case "preview":m=parseInt(e.sizeCalculated)-h.tmp.resize.diff_y;n=(c&&!c.hidden?c.sizeCalculated:0)+(d&&!d.hidden?d.sizeCalculated:
0);break;case "left":m=parseInt(e.sizeCalculated)+h.tmp.resize.diff_x;n=0;break;case "right":m=parseInt(e.sizeCalculated)-h.tmp.resize.diff_x,n=0}"%"==k.substr(k.length-1)?e.size=Math.floor(100*m/("left"==e.type||"right"==e.type?g:f-n)*100)/100+"%":"-"==String(e.size).substr(0,1)?e.size=parseInt(e.size)-e.sizeCalculated+m:e.size=m;h.resize()}b("#layout_"+h.name+"_resizer_"+h.tmp.resize.type).removeClass("active");delete h.tmp.resize}}function g(a){if(h.box&&(a||(a=window.event),null!=h.tmp.resize)){var c=
h.get(h.tmp.resize.type),d=h.tmp.resize,e=h.trigger({phase:"before",type:"resizing",target:h.name,object:c,originalEvent:a,panel:d?d.type:"all",diff_x:d?d.diff_x:0,diff_y:d?d.diff_y:0});if(!0!==e.isCancelled){var f=b("#layout_"+h.name+"_resizer_"+d.type),g=a.screenX-d.x;a=a.screenY-d.y;var k=h.get("main");f.hasClass("active")||f.addClass("active");switch(d.type){case "left":c.minSize-g>c.width&&(g=c.minSize-c.width);c.maxSize&&c.width+g>c.maxSize&&(g=c.maxSize-c.width);k.minSize+g>k.width&&(g=k.width-
k.minSize);break;case "right":c.minSize+g>c.width&&(g=c.width-c.minSize);c.maxSize&&c.width-g>c.maxSize&&(g=c.width-c.maxSize);k.minSize-g>k.width&&(g=k.minSize-k.width);break;case "top":c.minSize-a>c.height&&(a=c.minSize-c.height);c.maxSize&&c.height+a>c.maxSize&&(a=c.maxSize-c.height);k.minSize+a>k.height&&(a=k.height-k.minSize);break;case "preview":case "bottom":c.minSize+a>c.height&&(a=c.height-c.minSize),c.maxSize&&c.height-a>c.maxSize&&(a=c.height-c.maxSize),k.minSize-a>k.height&&(a=k.minSize-
k.height)}d.diff_x=g;d.diff_y=a;switch(d.type){case "top":case "preview":case "bottom":d.diff_x=0;0<f.length&&(f[0].style.top=d.value+d.diff_y+"px");break;case "left":case "right":d.diff_y=0,0<f.length&&(f[0].style.left=d.value+d.diff_x+"px")}h.trigger(b.extend(e,{phase:"after"}))}}}var h=this,k=(new Date).getTime(),n=h.trigger({phase:"before",type:"render",target:h.name,box:d});if(!0!==n.isCancelled){null!=d&&(0<b(h.box).find("#layout_"+h.name+"_panel_main").length&&b(h.box).removeAttr("name").removeClass("w2ui-layout").html(""),
h.box=d);if(!h.box)return!1;b(h.box).attr("name",h.name).addClass("w2ui-layout").html("<div></div>");0<b(h.box).length&&(b(h.box)[0].style.cssText+=h.style);for(d=0;d<a.length;d++){h.get(a[d]);var m='<div id="layout_'+h.name+"_panel_"+a[d]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+h.name+"_resizer_"+a[d]+'" class="w2ui-resizer"></div>';
b(h.box).find(" > div").append(m)}b(h.box).find(" > div").append('<div id="layout_'+h.name+'_panel_css" style="position: absolute; top: 10000px;"></div>');h.refresh();h.trigger(b.extend(n,{phase:"after"}));setTimeout(function(){c();h.resize()},0);return(new Date).getTime()-k}},refresh:function(a){null==a&&(a=null);var c=(new Date).getTime(),d=this.trigger({phase:"before",type:"refresh",target:null!=a?a:this.name,object:this.get(a)});if(!0!==d.isCancelled){if("string"==typeof a){var f=this.get(a);
if(null==f)return;var g="#layout_"+this.name+"_panel_"+f.type;a="#layout_"+this.name+"_resizer_"+f.type;b(g).css({display:f.hidden?"none":"block"});f.resizable?b(a).show():b(a).hide();"object"==typeof f.content&&"function"===typeof f.content.render?(f.content.box=b(g+"> .w2ui-panel-content")[0],setTimeout(function(){0<b(g+"> .w2ui-panel-content").length&&(b(g+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",f.overflow)[0].style.cssText+=";"+f.style);
f.content&&"function"==typeof f.content.render&&f.content.render()},1)):0<b(g+"> .w2ui-panel-content").length&&(b(g+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(f.content).css("overflow",f.overflow)[0].style.cssText+=";"+f.style);a=b(this.box).find(g+"> .w2ui-panel-tabs");f.show.tabs?0===a.find("[name="+f.tabs.name+"]").length&&null!=f.tabs?a.w2render(f.tabs):f.tabs.refresh():a.html("").removeClass("w2ui-tabs").hide();a=b(this.box).find(g+"> .w2ui-panel-toolbar");
f.show.toolbar?0===a.find("[name="+f.toolbar.name+"]").length&&null!=f.toolbar?a.w2render(f.toolbar):f.toolbar.refresh():a.html("").removeClass("w2ui-toolbar").hide();a=b(this.box).find(g+"> .w2ui-panel-title");f.title?a.html(f.title).show():a.html("").hide()}else{if(0===b("#layout_"+this.name+"_panel_main").length){this.render();return}this.resize();for(a=0;a<this.panels.length;a++)this.refresh(this.panels[a].type)}this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-c}},resize:function(){if(!this.box)return!1;
var d=(new Date).getTime(),c=this.tmp.resize,e=this.trigger({phase:"before",type:"resize",target:this.name,panel:c?c.type:"all",diff_x:c?c.diff_x:0,diff_y:c?c.diff_y:0});if(!0!==e.isCancelled){0>this.padding&&(this.padding=0);var f=parseInt(b(this.box).width()),g=parseInt(b(this.box).height());b(this.box).find(" > div").css({width:f+"px",height:g+"px"});var h=this,k=this.get("main"),n=this.get("preview"),m=this.get("left"),l=this.get("right"),v=this.get("top"),r=this.get("bottom"),t=null!=n&&!0!==
n.hidden?!0:!1,x=null!=m&&!0!==m.hidden?!0:!1,w=null!=l&&!0!==l.hidden?!0:!1,u=null!=v&&!0!==v.hidden?!0:!1,y=null!=r&&!0!==r.hidden?!0:!1,z;for(z=0;z<a.length;z++)if("main"!==a[z]&&(c=this.get(a[z]))){var q=String(c.size||0);"%"==q.substr(q.length-1)?(q=g,"preview"==c.type&&(q=q-(v&&!v.hidden?v.sizeCalculated:0)-(r&&!r.hidden?r.sizeCalculated:0)),c.sizeCalculated=parseInt(("left"==c.type||"right"==c.type?f:q)*parseFloat(c.size)/100)):c.sizeCalculated=parseInt(c.size);c.sizeCalculated=Math.max(c.sizeCalculated,
parseInt(c.minSize))}"-"==String(l.size).substr(0,1)&&(x&&"-"==String(m.size).substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):l.sizeCalculated=f-(x?m.sizeCalculated:0)+parseInt(l.size));"-"==String(m.size).substr(0,1)&&(w&&"-"==l.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):m.sizeCalculated=f-(w?l.sizeCalculated:0)+parseInt(m.size));if(null!=v&&!0!==v.hidden){z=c=0;q=f;var A=v.sizeCalculated;
b("#layout_"+this.name+"_panel_top").css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px"}).show();v.width=q;v.height=A;v.resizable&&(z=v.sizeCalculated-(0===this.padding?this.resizer:0),A=this.resizer>this.padding?this.resizer:this.padding,b("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(a){var c=h.trigger({phase:"before",type:"resizerClick",target:"top",
originalEvent:a});if(!0!==c.isCancelled)return w2ui[h.name].tmp.events.resizeStart("top",a),h.trigger(b.extend(c,{phase:"after"})),!1}))}else b("#layout_"+this.name+"_panel_top").hide(),b("#layout_"+this.name+"_resizer_top").hide();if(null!=m&&!0!==m.hidden){c=0;z=0+(u?v.sizeCalculated+this.padding:0);q=m.sizeCalculated;A=g-(u?v.sizeCalculated+this.padding:0)-(y?r.sizeCalculated+this.padding:0);var B=b("#layout_"+this.name+"_panel_left");-1!=window.navigator.userAgent.indexOf("MSIE")&&0<B.length&&
B[0].clientHeight<B[0].scrollHeight&&(q+=17);B.css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px"}).show();m.width=q;m.height=A;m.resizable&&(c=m.sizeCalculated-(0===this.padding?this.resizer:0),q=this.resizer>this.padding?this.resizer:this.padding,b("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(a){var c=h.trigger({phase:"before",type:"resizerClick",
target:"left",originalEvent:a});if(!0!==c.isCancelled)return w2ui[h.name].tmp.events.resizeStart("left",a),h.trigger(b.extend(c,{phase:"after"})),!1}))}else b("#layout_"+this.name+"_panel_left").hide(),b("#layout_"+this.name+"_resizer_left").hide();null!=l&&!0!==l.hidden?(c=f-l.sizeCalculated,z=0+(u?v.sizeCalculated+this.padding:0),q=l.sizeCalculated,A=g-(u?v.sizeCalculated+this.padding:0)-(y?r.sizeCalculated+this.padding:0),b("#layout_"+this.name+"_panel_right").css({display:"block",left:c+"px",
top:z+"px",width:q+"px",height:A+"px"}).show(),l.width=q,l.height=A,l.resizable&&(c-=this.padding,q=this.resizer>this.padding?this.resizer:this.padding,b("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(a){var c=h.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:a});if(!0!==c.isCancelled)return w2ui[h.name].tmp.events.resizeStart("right",a),h.trigger(b.extend(c,
{phase:"after"})),!1}))):(b("#layout_"+this.name+"_panel_right").hide(),b("#layout_"+this.name+"_resizer_right").hide());null!=r&&!0!==r.hidden?(c=0,z=g-r.sizeCalculated,q=f,A=r.sizeCalculated,b("#layout_"+this.name+"_panel_bottom").css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px"}).show(),r.width=q,r.height=A,r.resizable&&(z-=0===this.padding?0:this.padding,A=this.resizer>this.padding?this.resizer:this.padding,b("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",
left:c+"px",top:z+"px",width:q+"px",height:A+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(a){var c=h.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:a});if(!0!==c.isCancelled)return w2ui[h.name].tmp.events.resizeStart("bottom",a),h.trigger(b.extend(c,{phase:"after"})),!1}))):(b("#layout_"+this.name+"_panel_bottom").hide(),b("#layout_"+this.name+"_resizer_bottom").hide());c=0+(x?m.sizeCalculated+this.padding:0);z=0+(u?v.sizeCalculated+this.padding:0);
q=f-(x?m.sizeCalculated+this.padding:0)-(w?l.sizeCalculated+this.padding:0);A=g-(u?v.sizeCalculated+this.padding:0)-(y?r.sizeCalculated+this.padding:0)-(t?n.sizeCalculated+this.padding:0);B=b("#layout_"+this.name+"_panel_main");-1!=window.navigator.userAgent.indexOf("MSIE")&&0<B.length&&B[0].clientHeight<B[0].scrollHeight&&(q+=17);B.css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px"});k.width=q;k.height=A;null!=n&&!0!==n.hidden?(c=0+(x?m.sizeCalculated+this.padding:0),z=g-(y?r.sizeCalculated+
this.padding:0)-n.sizeCalculated,q=f-(x?m.sizeCalculated+this.padding:0)-(w?l.sizeCalculated+this.padding:0),A=n.sizeCalculated,B=b("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&0<B.length&&B[0].clientHeight<B[0].scrollHeight&&(q+=17),B.css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px"}).show(),n.width=q,n.height=A,n.resizable&&(z-=0===this.padding?0:this.padding,A=this.resizer>this.padding?this.resizer:this.padding,b("#layout_"+this.name+
"_resizer_preview").show().css({display:"block",left:c+"px",top:z+"px",width:q+"px",height:A+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(a){var c=h.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:a});if(!0!==c.isCancelled)return w2ui[h.name].tmp.events.resizeStart("preview",a),h.trigger(b.extend(c,{phase:"after"})),!1}))):(b("#layout_"+this.name+"_panel_preview").hide(),b("#layout_"+this.name+"_resizer_preview").hide());for(f=0;f<a.length;f++)g=this.get(a[f]),
k="#layout_"+this.name+"_panel_"+a[f]+" > .w2ui-panel-",n=0,g&&(g.title&&(n+=w2utils.getSize(b(k+"title").css({top:n+"px",display:"block"}),"height")),g.show.tabs&&(null!=g.tabs&&w2ui[this.name+"_"+a[f]+"_tabs"]&&w2ui[this.name+"_"+a[f]+"_tabs"].resize(),n+=w2utils.getSize(b(k+"tabs").css({top:n+"px",display:"block"}),"height")),g.show.toolbar&&(null!=g.toolbar&&w2ui[this.name+"_"+a[f]+"_toolbar"]&&w2ui[this.name+"_"+a[f]+"_toolbar"].resize(),n+=w2utils.getSize(b(k+"toolbar").css({top:n+"px",display:"block"}),
"height"))),b(k+"content").css({display:"block"}).css({top:n+"px"});clearTimeout(this._resize_timer);this._resize_timer=setTimeout(function(){for(var a in w2ui)if("function"==typeof w2ui[a].resize){null==w2ui[a].panels&&w2ui[a].resize();var c=b(w2ui[a].box).parents(".w2ui-layout");0<c.length&&c.attr("name")==h.name&&w2ui[a].resize()}},100);this.trigger(b.extend(e,{phase:"after"}));return(new Date).getTime()-d}},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});
if(!0!==a.isCancelled){if(null==w2ui[this.name])return!1;0<b(this.box).find("#layout_"+this.name+"_panel_main").length&&b(this.box).removeAttr("name").removeClass("w2ui-layout").html("");delete w2ui[this.name];this.trigger(b.extend(a,{phase:"after"}));this.tmp.events&&this.tmp.events.resize&&b(window).off("resize",this.tmp.events.resize);return!0}},lock:function(b,c,e){if(-1==a.indexOf(b))console.log("ERROR: First parameter needs to be the a valid panel name.");else{var d=Array.prototype.slice.call(arguments,
0);d[0]="#layout_"+this.name+"_panel_"+b;w2utils.lock.apply(window,d)}},unlock:function(b,c){-1==a.indexOf(b)?console.log("ERROR: First parameter needs to be the a valid panel name."):w2utils.unlock("#layout_"+this.name+"_panel_"+b,c)}};b.extend(l.prototype,w2utils.event);w2obj.layout=l})(jQuery);var w2popup={};
(function(b){b.fn.w2popup=function(l,a){null==l&&(a={},l="open");b.isPlainObject(l)&&(a=l,l="open");l=l.toLowerCase();"load"===l&&"string"===typeof a&&(a=b.extend({url:a},2<arguments.length?arguments[2]:{}));"open"===l&&null!=a.url&&(l="load");a=a||{};var d={};if(0<b(this).length&&"open"==l){if(0<b(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length){if(0<b("#w2ui-popup").length){var c=b("#w2ui-popup").data("options");w2popup._prev={template:w2popup._template,title:c.title,body:c.body,
buttons:c.buttons}}w2popup._template=this;0<b(this).find("div[rel=title]").length&&(d.title=b(this).find("div[rel=title]"));0<b(this).find("div[rel=body]").length&&(d.body=b(this).find("div[rel=body]"),d.style=b(this).find("div[rel=body]")[0].style.cssText);0<b(this).find("div[rel=buttons]").length&&(d.buttons=b(this).find("div[rel=buttons]"))}else d.title="&#160;",d.body=b(this).html();0!==parseInt(b(this).css("width"))&&(d.width=parseInt(b(this).css("width")));c=a.title||a.showClose||void 0===a.showClose||
a.showMax||void 0===a.showMax;0!==parseInt(b(this).css("height"))&&(d.height=parseInt(b(this).css("height"))+(c?32:0))}return w2popup[l](b.extend({},d,a))};w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null,multiple:!1},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(l){var a=this,d=b.extend(!0,{},
l);if("closing"==w2popup.status)setTimeout(function(){a.open.call(a,l)},100);else{var c=b("#w2ui-popup").data("options");l=b.extend({},this.defaults,c,{title:"",body:"",buttons:""},l,{maximized:!1});setTimeout(function(){b("#w2ui-popup").data("options",l)},100);0===b("#w2ui-popup").length&&(w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null,w2popup.onAction=null);l.onOpen&&(w2popup.onOpen=l.onOpen);l.onClose&&(w2popup.onClose=
l.onClose);l.onMax&&(w2popup.onMax=l.onMax);l.onMin&&(w2popup.onMin=l.onMin);l.onToggle&&(w2popup.onToggle=l.onToggle);l.onKeydown&&(w2popup.onKeydown=l.onKeydown);l.onAction&&(w2popup.onAction=l.onAction);l.width=parseInt(l.width);l.height=parseInt(l.height);if(void 0==window.innerHeight){var e=parseInt(document.documentElement.offsetWidth);var f=parseInt(document.documentElement.offsetHeight);"IE7"===w2utils.engine&&(e+=21,f+=4)}else e=parseInt(window.innerWidth),f=parseInt(window.innerHeight);
e-10<l.width&&(l.width=e-10);f-10<l.height&&(l.height=f-10);f=(f-l.height)/2*.6;e=(e-l.width)/2;null!=l.actions&&(l.buttons="",Object.keys(l.actions).forEach(function(a){var b=l.actions[a];"function"==typeof b&&(l.buttons+='<button class="w2ui-btn" onclick="w2popup.action(\''+a+"')\">"+a+"</button>");"object"==typeof b&&(l.buttons+='<button class="w2ui-btn '+(b["class"]||"")+'" style="'+(b.style||"")+'"onclick="w2popup.action(\''+a+"')\">"+(b.text||a)+"</button>");"string"==typeof b&&(l.buttons+=
b)}));if(0===b("#w2ui-popup").length){d=this.trigger({phase:"before",type:"open",target:"popup",options:l,present:!1});if(!0===d.isCancelled)return;w2popup.status="opening";w2popup.lockScreen(l);c="";l.showClose&&(c+='<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>');l.showMax&&(c+='<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>');f='<div id="w2ui-popup" class="w2ui-popup" style="opacity: 0; left: '+
e+"px; top: "+f+"px;     width: "+parseInt(l.width)+"px; height: "+parseInt(l.height)+"px; "+w2utils.cssPrefix("transform","scale(0.8)",!0)+'"></div>';b("body").append(f);f=b("#w2ui-popup");if(0<f.find("div[rel=title], div[rel=body], div[rel=buttons]").length){var g=f.find("div[rel=title]");0<g.length&&(l.title=g.html(),g.remove());g=f.find("div[rel=buttons]");0<g.length&&(l.buttons=g.html(),g.remove());g=f.find("div[rel=body]");l.body=0<g.length?g.html():f.html()}f='<div class="w2ui-popup-title" style="'+
(l.title?"":"display: none")+'">'+c+'</div><div class="w2ui-box" style="'+(l.title?"":"top: 0px !important;")+(l.buttons?"":"bottom: 0px !important;")+'">    <div class="w2ui-popup-body w2ui-popup-no-title'+(l.buttons?"":" w2ui-popup-no-buttons")+'" style="'+l.style+'">    </div></div><div class="w2ui-popup-buttons" style="'+(l.buttons?"":"display: none")+'"></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>';b("#w2ui-popup").html(f);l.title&&b("#w2ui-popup .w2ui-popup-title").append(l.title);
l.buttons&&b("#w2ui-popup .w2ui-popup-buttons").append(l.buttons);l.body&&b("#w2ui-popup .w2ui-popup-body").append(l.body);setTimeout(function(){b("#w2ui-popup").css("opacity","1").css(w2utils.cssPrefix({transition:l.speed+"s opacity, "+l.speed+"s -webkit-transform",transform:"scale(1)"}));a.focus()},1);setTimeout(function(){b("#w2ui-popup").css(w2utils.cssPrefix("transform",""))},1E3*l.speed);w2popup.status="open";a.trigger(b.extend(d,{phase:"after"}))}else if(!0===l.multiple)w2popup.message(d);
else{null==w2popup._prev&&null!=w2popup._template&&a.restoreTemplate();d=this.trigger({phase:"before",type:"open",target:"popup",options:l,present:!0});if(!0===d.isCancelled)return;w2popup.status="opening";null!=c&&(c.maximized||c.width==l.width&&c.height==l.height||w2popup.resize(l.width,l.height),l.prevSize=l.width+"px:"+l.height+"px",l.maximized=c.maximized);c=b("#w2ui-popup .w2ui-box").clone();c.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(l.body);
"string"==typeof l.body&&0<c.find("div[rel=title], div[rel=body], div[rel=buttons]").length&&(g=c.find("div[rel=title]"),0<g.length&&(l.title=g.html(),g.remove()),g=c.find("div[rel=buttons]"),0<g.length&&(l.buttons=g.html(),g.remove()),g=c.find("div[rel=body]"),l.body=0<g.length?g.html():c.html(),c.html(l.body));b("#w2ui-popup .w2ui-box").after(c);l.buttons?(b("#w2ui-popup .w2ui-popup-buttons").show().html("").append(l.buttons),b("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),
b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(b("#w2ui-popup .w2ui-popup-buttons").hide().html(""),b("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px"));l.title?(b("#w2ui-popup .w2ui-popup-title").show().html((l.showClose?'<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>':"")+(l.showMax?'<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>':
"")).append(l.title),b("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):(b("#w2ui-popup .w2ui-popup-title").hide().html(""),b("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));var h=b("#w2ui-popup .w2ui-box")[0],k=b("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(h,k,l.transition,function(){a.restoreTemplate();b(h).remove();
b(k).removeClass("w2ui-box-temp").addClass("w2ui-box");var c=b(k).find(".w2ui-popup-body");1==c.length&&(c[0].style.cssText=l.style);b("#w2ui-popup").data("prev-size",null);a.focus()});w2popup.status="open";a.trigger(b.extend(d,{phase:"after"}))}l._last_focus=b(":focus");if(l.keyboard)b(document).on("keydown",this.keydown);g={resizing:!1,mvMove:function(a){1==g.resizing&&(a||(a=window.event),g.div_x=a.screenX-g.x,g.div_y=a.screenY-g.y,a=w2popup.trigger({phase:"before",type:"move",target:"popup",div_x:g.div_x,
div_y:g.div_y}),!0!==a.isCancelled&&(b("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+g.div_x+"px, "+g.div_y+"px, 0px)"})),w2popup.trigger(b.extend(a,{phase:"after"}))))},mvStop:function(a){1==g.resizing&&(a||(a=window.event),w2popup.status="open",g.div_x=a.screenX-g.x,g.div_y=a.screenY-g.y,b("#w2ui-popup").css({left:g.pos_x+g.div_x+"px",top:g.pos_y+g.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),g.resizing=!1,b(document).off("mousemove",
g.mvMove),b(document).off("mouseup",g.mvStop),g.isLocked||w2popup.unlock())}};b("#w2ui-popup .w2ui-popup-title").on("mousedown",function(a){w2popup.get().maximized||(a||(a=window.event),w2popup.status="moving",g.resizing=!0,g.isLocked=1==b("#w2ui-popup > .w2ui-lock").length?!0:!1,g.x=a.screenX,g.y=a.screenY,g.pos_x=b("#w2ui-popup").position().left,g.pos_y=b("#w2ui-popup").position().top,g.isLocked||w2popup.lock({opacity:0}),b(document).on("mousemove",g.mvMove),b(document).on("mouseup",g.mvStop),a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0,a.preventDefault&&a.preventDefault())});return this}},action:function(l,a){var d=this,c=b("#w2ui-popup").data("options");null!=a&&(c=b("#w2ui-message"+a).data("options"),d={parent:this,options:c,close:function(){w2popup.message({msgId:a})}});var e=c.actions[l];c=e;b.isPlainObject(e)&&e.onClick&&(c=e.onClick);l=this.trigger({phase:"before",target:l,msgId:a,type:"action",action:e,originalEvent:event});!0!==l.isCancelled&&("function"===typeof c&&c.call(d,event),
this.trigger(b.extend(l,{phase:"after"})))},keydown:function(l){var a=b("#w2ui-popup").data("options");if(!a||a.keyboard)if(a=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:a,originalEvent:l}),!0!==a.isCancelled){switch(l.keyCode){case 27:l.preventDefault(),0<b("#w2ui-popup .w2ui-message").length?w2popup.message():w2popup.close()}w2popup.trigger(b.extend(a,{phase:"after"}))}},close:function(l){var a=this;l=b.extend({},b("#w2ui-popup").data("options"),l);if(0!==b("#w2ui-popup").length&&
"closed"!=this.status)if("opening"==this.status)setTimeout(function(){w2popup.close()},100);else{var d=this.trigger({phase:"before",type:"close",target:"popup",options:l});!0!==d.isCancelled&&(w2popup.status="closing",b("#w2ui-popup").css("opacity","0").css(w2utils.cssPrefix({transition:l.speed+"s opacity, "+l.speed+"s -webkit-transform",transform:"scale(0.9)"})),w2popup.unlockScreen(l),setTimeout(function(){a.restoreTemplate();b("#w2ui-popup").remove();w2popup.status="closed";l._last_focus&&0<l._last_focus.length&&
l._last_focus.focus();a.trigger(b.extend(d,{phase:"after"}))},1E3*l.speed),l.keyboard&&b(document).off("keydown",this.keydown))}},toggle:function(){var l=this,a=b("#w2ui-popup").data("options"),d=this.trigger({phase:"before",type:"toggle",target:"popup",options:a});!0!==d.isCancelled&&(!0===a.maximized?w2popup.min():w2popup.max(),setTimeout(function(){l.trigger(b.extend(d,{phase:"after"}))},1E3*a.speed+50))},max:function(){var l=this,a=b("#w2ui-popup").data("options");if(!0!==a.maximized){var d=this.trigger({phase:"before",
type:"max",target:"popup",options:a});!0!==d.isCancelled&&(w2popup.status="resizing",a.prevSize=b("#w2ui-popup").css("width")+":"+b("#w2ui-popup").css("height"),w2popup.resize(1E4,1E4,function(){w2popup.status="open";a.maximized=!0;l.trigger(b.extend(d,{phase:"after"}));b("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var a=b(this).attr("name");w2ui[a]&&w2ui[a].resize&&w2ui[a].resize()})}))}},min:function(){var l=this,a=b("#w2ui-popup").data("options");
if(!0===a.maximized){var d=a.prevSize.split(":"),c=this.trigger({phase:"before",type:"min",target:"popup",options:a});!0!==c.isCancelled&&(w2popup.status="resizing",w2popup.resize(parseInt(d[0]),parseInt(d[1]),function(){w2popup.status="open";a.maximized=!1;a.prevSize=null;l.trigger(b.extend(c,{phase:"after"}));b("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var a=b(this).attr("name");w2ui[a]&&w2ui[a].resize&&w2ui[a].resize()})}))}},get:function(){return b("#w2ui-popup").data("options")},
set:function(b){w2popup.open(b)},clear:function(){b("#w2ui-popup .w2ui-popup-title").html("");b("#w2ui-popup .w2ui-popup-body").html("");b("#w2ui-popup .w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(l){function a(a,c){delete l.url;b("body").append('<div id="w2ui-tmp" style="display: none">'+a+"</div>");null!=c&&0<b("#w2ui-tmp #"+c).length?b("#w2ui-tmp #"+c).w2popup(l):b("#w2ui-tmp > div").w2popup(l);0<b("#w2ui-tmp > style").length&&(a=b("<div>").append(b("#w2ui-tmp > style").clone()).html(),
0===b("#w2ui-popup #div-style").length&&b("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),b("#w2ui-popup #div-style").html(a));b("#w2ui-tmp").remove()}w2popup.status="loading";if(null==l.url)console.log("ERROR: The url parameter is empty.");else{var d=String(l.url).split("#"),c=d[0],e=d[1];null==l&&(l={});d=b("#w2ui-popup").data(c);null!=d?a(d,e):b.get(c,function(d,g,h){a(h.responseText,e);b("#w2ui-popup").data(c,h.responseText)})}},message:function(l){var a=
this;b().w2tag();l||(l={width:200,height:100});var d=parseInt(b("#w2ui-popup").width()),c=parseInt(b("#w2ui-popup").height());l.originalWidth=l.width;l.originalHeight=l.height;10>parseInt(l.width)&&(l.width=10);10>parseInt(l.height)&&(l.height=10);null==l.hideOnClick&&(l.hideOnClick=!1);var e=b("#w2ui-popup").data("options")||{},f=parseInt(b("#w2ui-popup > .w2ui-popup-title").css("height"));if(null==l.width||l.width>e.width-10)l.width=e.width-10;if(null==l.height||l.height>e.height-f-5)l.height=e.height-
f-5;0>l.originalHeight&&(l.height=c+l.originalHeight-f);0>l.originalWidth&&(l.width=d+2*l.originalWidth);c=b("#w2ui-popup .w2ui-popup-title");var g=b("#w2ui-popup .w2ui-message").length;null!=l.actions&&(l.buttons="",Object.keys(l.actions).forEach(function(a){var b=l.actions[a];"function"==typeof b&&(l.buttons+='<button class="w2ui-btn" onclick="w2popup.action(\''+a+"', "+g+')">'+a+"</button>");"object"==typeof b&&(l.buttons+='<button class="w2ui-btn '+(b["class"]||"")+'" style="'+(b.style||"")+'"onclick="w2popup.action(\''+
a+"', "+g+')">'+(b.text||a)+"</button>");"string"==typeof b&&(l.buttons+=b)}));if(""===b.trim(l.html)&&""===b.trim(l.body)&&""===b.trim(l.buttons)){var h=b("#w2ui-popup .w2ui-message").last();null!=l.msgId&&(h=b("#w2ui-message"+l.msgId));l=h.data("options")||{};var k=a.trigger({phase:"before",type:"msgClose",msgId:h.attr("data-msgId"),target:"popup",options:l});!0!==k.isCancelled&&(h.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+l.height+"px)"})),d=b("#w2ui-popup .w2ui-message"),
(d=b(d[d.length-2]).css("z-index",1500).data("msg-focus"))&&0<d.length?d.focus():a.focus(),1==g&&w2popup.unlock(150),setTimeout(function(){h.remove();if("function"==typeof l.onClose)l.onClose(k);a.trigger(b.extend(k,{phase:"after"}))},150))}else{if(""!==b.trim(l.body)||""!==b.trim(l.buttons))l.html='<div class="w2ui-message-body">'+l.body+'</div><div class="w2ui-message-buttons">'+l.buttons+"</div>";b("#w2ui-popup .w2ui-message").css("z-index",1390).data("msg-focus",b(":focus"));c.css("z-index",1501);
null==l.close&&(l.close=function(){w2popup.message({msgId:g})});b("#w2ui-popup .w2ui-box").before('<div id="w2ui-message'+g+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===c.length?"top: 0px;":"top: "+w2utils.getSize(c,"height")+"px;")+(null!=l.width?"width: "+l.width+"px; left: "+(d-l.width)/2+"px;":"left: 10px; right: 10px;")+(null!=l.height?"height: "+l.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition","0s",!0)+'" data-msgId="'+g+'" '+(!0===l.hideOnClick?'onclick="w2popup.message();"':
"")+"></div>");b("#w2ui-popup #w2ui-message"+g).data("options",l);var n=b("#w2ui-popup #w2ui-message"+g).css("display");b("#w2ui-popup #w2ui-message"+g).css(w2utils.cssPrefix({transform:"none"==n?"translateY(-"+l.height+"px)":"translateY(0px)"}));"none"==n&&(b("#w2ui-popup #w2ui-message"+g).show().html(l.html),setTimeout(function(){b("#w2ui-popup #w2ui-message"+g).css(b.extend(w2utils.cssPrefix("transition",".3s",!1),w2utils.cssPrefix({transform:"none"==n?"translateY(0px)":"translateY(-"+l.height+
"px)"})))},1),0===g&&w2popup.lock(),k=a.trigger({phase:"before",type:"msgOpen",msgId:g,target:"popup",options:l}),!0!==k.isCancelled&&setTimeout(function(){a.focus();b("#w2ui-popup #w2ui-message"+g).css(w2utils.cssPrefix({transition:"0s"}));if("function"==typeof l.onOpen)l.onOpen(k);a.trigger(b.extend(k,{phase:"after"}))},350))}},focus:function(){var l=null,a=b("#w2ui-popup");b(a).find("input:visible, button:visible, select:visible, textarea:visible, [contentEditable], .w2ui-input").off(".keep-focus");
var d=b("#w2ui-popup .w2ui-message").length-1;d=b("#w2ui-popup #w2ui-message"+d);if(0<d.length){var c=b(d[d.length-1]).find("button");0<c.length&&c[0].focus();l=d}else 0<a.length&&(c=a.find(".w2ui-popup-buttons button"),0<c.length&&c[0].focus(),l=a);b(l).find("input:visible, button:visible, select:visible, textarea:visible, [contentEditable], .w2ui-input").on("blur.keep-focus",function(a){setTimeout(function(){var a=b(":focus");if(0<a.length&&!b(l).find("input:visible, button:visible, select:visible, textarea:visible, [contentEditable], .w2ui-input").is(a)||
a.hasClass("w2ui-popup-hidden"))a=b(l).find("input:visible, button:visible, select:visible, textarea:visible, [contentEditable], .w2ui-input"),0<a.length&&a[0].focus()},1)})},lock:function(l,a){var d=Array.prototype.slice.call(arguments,0);d.unshift(b("#w2ui-popup"));w2utils.lock.apply(window,d)},unlock:function(l){w2utils.unlock(b("#w2ui-popup"),l)},lockScreen:function(l){if(0<b("#w2ui-lock").length)return!1;null==l&&(l=b("#w2ui-popup").data("options"));null==l&&(l={});l=b.extend({},w2popup.defaults,
l);b("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+l.color+'; width: 100%; height: 100%; opacity: 0;"></div>');setTimeout(function(){b("#w2ui-lock").css("opacity",l.opacity).css(w2utils.cssPrefix("transition",
l.speed+"s opacity"))},1);if(1==l.modal)b("#w2ui-lock").on("mousedown",function(){b("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}),b("#w2ui-lock").on("mouseup",function(){setTimeout(function(){b("#w2ui-lock").css("opacity",l.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)});else b("#w2ui-lock").on("mousedown",function(){w2popup.close()});return!0},unlockScreen:function(l){if(0===b("#w2ui-lock").length)return!1;null==l&&(l=b("#w2ui-popup").data("options"));
null==l&&(l={});l=b.extend({},w2popup.defaults,l);b("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",l.speed+"s opacity"));setTimeout(function(){b("#w2ui-lock").remove()},1E3*l.speed);return!0},resizeMessages:function(){b("#w2ui-popup").data("options");b("#w2ui-popup .w2ui-message").each(function(){var l=b(this).data("options"),a=b("#w2ui-popup");10>parseInt(l.width)&&(l.width=10);10>parseInt(l.height)&&(l.height=10);var d=parseInt(a.find("> .w2ui-popup-title").css("height")),c=
parseInt(a.width());a=parseInt(a.height());l.width=l.originalWidth;l.width>c-10&&(l.width=c-10);l.height=l.originalHeight;l.height>a-d-5&&(l.height=a-d-5);0>l.originalHeight&&(l.height=a+l.originalHeight-d);0>l.originalWidth&&(l.width=c+2*l.originalWidth);b(this).css({left:(c-l.width)/2+"px",width:l.width+"px",height:l.height+"px"})})},resize:function(l,a,d){var c=this,e=b("#w2ui-popup").data("options")||{};null==e.speed&&(e.speed=0);l=parseInt(l);a=parseInt(a);if(void 0==window.innerHeight){var f=
parseInt(document.documentElement.offsetWidth);var g=parseInt(document.documentElement.offsetHeight);"IE7"===w2utils.engine&&(f+=21,g+=4)}else f=parseInt(window.innerWidth),g=parseInt(window.innerHeight);f-10<l&&(l=f-10);g-10<a&&(a=g-10);g=(g-a)/2*.6;f=(f-l)/2;b("#w2ui-popup").css(w2utils.cssPrefix({transition:e.speed+"s width, "+e.speed+"s height, "+e.speed+"s left, "+e.speed+"s top"})).css({top:g,left:f,width:l,height:a});var h=setInterval(function(){c.resizeMessages()},10);setTimeout(function(){clearInterval(h);
e.width=l;e.height=a;c.resizeMessages();"function"==typeof d&&d()},1E3*e.speed+50)},restoreTemplate:function(){var l=b("#w2ui-popup").data("options");if(null!=l){var a=w2popup._template,d=l.title,c=l.body;l=l.buttons;w2popup._prev?(a=w2popup._prev.template,d=w2popup._prev.title,c=w2popup._prev.body,l=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template;null!=a&&(a=b(a),0!==a.length&&("body"==b(c).attr("rel")?(d&&a.append(d),c&&a.append(c),l&&a.append(l)):a.append(c)))}}};b.extend(w2popup,
w2utils.event)})(jQuery);
var w2alert=function(b,l,a){var d=jQuery;null==l&&(l=w2utils.lang("Notification"));0<d("#w2ui-popup").length&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+b+"</div>",buttons:'<button onclick="w2popup.message();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(){d("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose:function(){"function"==typeof a&&a()}}):w2popup.open({width:450,
height:220,showMax:!1,showClose:!1,title:l,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+b+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(a){setTimeout(function(){d("#w2ui-popup .w2ui-popup-btn").focus()},1)},onKeydown:function(a){d("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose:function(){"function"==typeof a&&a()}});return{ok:function(b){a=b;return this},done:function(b){a=
b;return this}}},w2confirm=function(b,l,a){var d=jQuery,c={},e={msg:"",title:w2utils.lang("Confirmation"),width:0<d("#w2ui-popup").length?400:450,height:0<d("#w2ui-popup").length?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,focus_to_no:!1,callBack:null};1==arguments.length&&"object"==typeof b?d.extend(c,e,b):"function"==typeof l?d.extend(c,e,{msg:b,callBack:l}):d.extend(c,e,{msg:b,title:l,callBack:a});"object"==typeof c.btn_yes&&
(c.yes_text=c.btn_yes.text||c.yes_text,c.yes_class=c.btn_yes["class"]||c.yes_class,c.yes_style=c.btn_yes.style||c.yes_style,c.yes_callBack=c.btn_yes.callBack||c.yes_callBack);"object"==typeof c.btn_no&&(c.no_text=c.btn_no.text||c.no_text,c.no_class=c.btn_no["class"]||c.no_class,c.no_style=c.btn_no.style||c.no_style,c.no_callBack=c.btn_no.callBack||c.no_callBack);0<d("#w2ui-popup").length&&"closing"!=w2popup.status&&w2popup.get()?(c.width>w2popup.get().width&&(c.width=w2popup.get().width),c.height>
w2popup.get().height-50&&(c.height=w2popup.get().height-50),w2popup.message({width:c.width,height:c.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+c.msg+"</div>",buttons:w2utils.settings.macButtonOrder?'<button id="No" class="w2ui-popup-btn w2ui-btn '+c.no_class+'" style="'+c.no_style+'">'+w2utils.lang(c.no_text)+'</button><button id="Yes" class="w2ui-popup-btn w2ui-btn '+c.yes_class+'" style="'+c.yes_style+'">'+w2utils.lang(c.yes_text)+"</button>":'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+
c.yes_class+'" style="'+c.yes_style+'">'+w2utils.lang(c.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+c.no_class+'" style="'+c.no_style+'">'+w2utils.lang(c.no_text)+"</button>",onOpen:function(a){d("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",function(a){w2popup._confirm_btn=a.target.id;w2popup.message()});if("function"==typeof c.onOpen)c.onOpen()},onClose:function(a){d("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm");setTimeout(function(){"function"==
typeof c.callBack&&c.callBack(w2popup._confirm_btn);"Yes"==w2popup._confirm_btn&&"function"==typeof c.yes_callBack&&c.yes_callBack();"No"==w2popup._confirm_btn&&"function"==typeof c.no_callBack&&c.no_callBack()},300);if("function"==typeof c.onClose)c.onClose()}})):(w2utils.isInt(c.height)||(c.height+=50),w2popup.open({width:c.width,height:c.height,title:c.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+c.msg+"</div>",buttons:w2utils.settings.macButtonOrder?
'<button id="No" class="w2ui-popup-btn w2ui-btn '+c.no_class+'" style="'+c.no_style+'">'+w2utils.lang(c.no_text)+'</button><button id="Yes" class="w2ui-popup-btn w2ui-btn '+c.yes_class+'" style="'+c.yes_style+'">'+w2utils.lang(c.yes_text)+"</button>":'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+c.yes_class+'" style="'+c.yes_style+'">'+w2utils.lang(c.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+c.no_class+'" style="'+c.no_style+'">'+w2utils.lang(c.no_text)+"</button>",
onOpen:function(a){setTimeout(function(){d("#w2ui-popup .w2ui-popup-btn").on("click",function(a){w2popup.close();"function"==typeof c.callBack&&c.callBack(a.target.id);"Yes"==a.target.id&&"function"==typeof c.yes_callBack&&c.yes_callBack();"No"==a.target.id&&"function"==typeof c.no_callBack&&c.no_callBack()});c.focus_to_no?d("#w2ui-popup .w2ui-popup-btn#No").focus():d("#w2ui-popup .w2ui-popup-btn#Yes").focus();if("function"==typeof c.onOpen)c.onOpen()},1)},onClose:function(a){if("function"==typeof c.onClose)c.onClose()},
onKeydown:function(a){if(0===d("#w2ui-popup .w2ui-message").length)switch(a.originalEvent.keyCode){case 13:d("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked");w2popup.close();break;case 27:d("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}}));return{yes:function(a){c.yes_callBack=a;return this},no:function(a){c.no_callBack=a;return this}}},w2prompt=function(b,l,a){var d=jQuery,c={},e={label:"",value:"",attrs:"",textarea:!1,title:w2utils.lang("Notification"),ok_text:w2utils.lang("Ok"),
cancel_text:w2utils.lang("Cancel"),width:0<d("#w2ui-popup").length?400:450,height:0<d("#w2ui-popup").length?170:220,callBack:null};1==arguments.length&&"object"==typeof b?d.extend(c,e,b):"function"==typeof l?d.extend(c,e,{label:b,callBack:l}):d.extend(c,e,{label:b,title:l,callBack:a});0<d("#w2ui-popup").length&&"closing"!=w2popup.status&&w2popup.get()?(c.width>w2popup.get().width&&(c.width=w2popup.get().width),c.height>w2popup.get().height-50&&(c.height=w2popup.get().height-50),w2popup.message({width:c.width,
height:c.height,body:c.textarea?'<div class="w2ui-prompt textarea">  <div>'+c.label+'</div>  <textarea id="w2prompt" class="w2ui-input" '+c.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered">  <label>'+c.label+'</label>  <input id="w2prompt" class="w2ui-input" '+c.attrs+"></div>",buttons:w2utils.settings.macButtonOrder?'<button id="Cancel" class="w2ui-popup-btn w2ui-btn '+c.cancel_class+'">'+c.cancel_text+'</button><button id="Ok" class="w2ui-popup-btn w2ui-btn '+c.ok_class+'">'+c.ok_text+
"</button>":'<button id="Ok" class="w2ui-popup-btn w2ui-btn '+c.ok_class+'">'+c.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn '+c.cancel_class+'">'+c.cancel_text+"</button>",onOpen:function(){d("#w2prompt").val(c.value);d("#w2ui-popup .w2ui-message .w2ui-btn#Ok").on("click.w2prompt",function(a){w2popup._prompt_value=d("#w2prompt").val();w2popup.message()});d("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").on("click.w2prompt",function(a){w2popup._prompt_value=null;w2popup.message()});
setTimeout(function(){d("#w2prompt").focus()},100);if("function"==typeof c.onOpen)c.onOpen()},onClose:function(){d("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt");setTimeout(function(){"function"==typeof c.callBack&&c.callBack(w2popup._prompt_value)},300);if("function"==typeof c.onClose)c.onClose()}})):(w2utils.isInt(c.height)||(c.height+=50),w2popup.open({width:c.width,height:c.height,title:c.title,modal:!0,showClose:!1,body:c.textarea?'<div class="w2ui-prompt">  <div>'+c.label+'</div>  <textarea id="w2prompt" class="w2ui-input" '+
c.attrs+"></textarea></div>":'<div class="w2ui-prompt w2ui-centered" style="font-size: 13px;">  <label>'+c.label+'</label>  <input id="w2prompt" class="w2ui-input" '+c.attrs+"></div>",buttons:w2utils.settings.macButtonOrder?'<button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+c.cancel_text+'</button><button id="Ok" class="w2ui-popup-btn w2ui-btn">'+c.ok_text+"</button>":'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+c.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+c.cancel_text+
"</button>",onOpen:function(a){setTimeout(function(){d("#w2prompt").val(c.value);d("#w2prompt").w2field("text");d("#w2ui-popup .w2ui-popup-btn#Ok").on("click",function(a){w2popup._prompt_value=d("#w2prompt").val();w2popup.close();"function"==typeof c.callBack&&c.callBack(w2popup._prompt_value)});d("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",function(a){w2popup._prompt_value=null;w2popup.close();"function"==typeof c.callBack&&c.callBack(w2popup._prompt_value)});d("#w2ui-popup .w2ui-popup-btn#Ok");
setTimeout(function(){d("#w2prompt").focus()},100);if("function"==typeof c.onOpen)c.onOpen()},1)},onClose:function(a){if("function"==typeof c.onClose)c.onClose()},onKeydown:function(a){if(0===d("#w2ui-popup .w2ui-message").length)switch(a.originalEvent.keyCode){case 13:d("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked");w2popup.close();break;case 27:w2popup.close()}}}));return{change:function(a){d("#w2prompt").on("keyup",a).keyup();return this},ok:function(a){c.callBack=a;return this}}};
(function(b){var l=function(a){this.active=this.name=this.box=null;this.flow="down";this.tooltip="top|left";this.tabs=[];this.routeData={};this.style=this.right="";b.extend(this,{handlers:[]});b.extend(!0,this,w2obj.tabs,a)};b.fn.w2tabs=function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2tabs")){for(var d=a.tabs||[],c=new l(a),e=0;e<d.length;e++)c.tabs[e]=b.extend({},l.prototype.tab,d[e]);0!==b(this).length&&c.render(b(this)[0]);return w2ui[c.name]=c}}else return d=w2ui[b(this).attr("name")],
d?0<arguments.length?(d[a]&&d[a].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null};l.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(a){return this.insert(null,a)},insert:function(a,d){b.isArray(d)||(d=[d]);for(var c=0;c<d.length;c++){if(null==d[c].id){console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+
this.name+")");break}if(!w2utils.checkUniqueId(d[c].id,this.tabs,"tabs",this.name))break;var e=b.extend({},l.prototype.tab,d[c]);if(null==a)this.tabs.push(e);else{var f=this.get(a,!0);this.tabs=this.tabs.slice(0,f).concat([e],this.tabs.slice(f))}this.refresh(d[c].id);this.resize()}},remove:function(){for(var a=0,d=0;d<arguments.length;d++){var c=this.get(arguments[d]);if(!c)return!1;a++;this.tabs.splice(this.get(c.id,!0),1);b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(c.id)).remove()}this.resize();
return a},select:function(a){if(this.active==a||null==this.get(a))return!1;this.active=a;this.refresh();return!0},set:function(a,d){var c=this.get(a,!0);if(null==c)return!1;b.extend(this.tabs[c],d);this.refresh(a);return!0},get:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.tabs.length;d++)null!=this.tabs[d].id&&c.push(this.tabs[d].id);return c}for(c=0;c<this.tabs.length;c++)if(this.tabs[c].id==a)return!0===b?c:this.tabs[c];return null},show:function(){for(var a=this,b=0,c=[],e=0;e<
arguments.length;e++){var f=this.get(arguments[e]);f&&!1!==f.hidden&&(b++,f.hidden=!1,c.push(f.id))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]);a.resize()},15);return b},hide:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=this.get(arguments[e]);f&&!0!==f.hidden&&(b++,f.hidden=!0,c.push(f.id))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]);a.resize()},15);return b},enable:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=
this.get(arguments[e]);f&&!1!==f.disabled&&(b++,f.disabled=!1,c.push(f.id))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15);return b},disable:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=this.get(arguments[e]);f&&!0!==f.disabled&&(b++,f.disabled=!0,c.push(f.id))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15);return b},tooltipShow:function(a,d,c){if(null!=this.tooltip){var e=b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(a));
a=this.get(a);var f=this.tooltip,g=a.tooltip;"function"==typeof g&&(g=g.call(this,a));e.prop("_mouse_over",!0);setTimeout(function(){!0===e.prop("_mouse_over")&&!0!==e.prop("_mouse_tooltip")&&(e.prop("_mouse_tooltip",!0),e.w2tag(w2utils.lang(g),{position:f}));1==c&&e.w2tag(w2utils.lang(g),{position:f})},1)}},tooltipHide:function(a){if(null!=this.tooltip){var d=b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(a));this.get(a);d.removeProp("_mouse_over");setTimeout(function(){!0!==d.prop("_mouse_over")&&
!0===d.prop("_mouse_tooltip")&&(d.removeProp("_mouse_tooltip"),d.w2tag())},1)}},refresh:function(a){var d=(new Date).getTime();"up"==this.flow?b(this.box).addClass("w2ui-tabs-up"):b(this.box).removeClass("w2ui-tabs-up");var c=this.trigger({phase:"before",type:"refresh",target:null!=a?a:this.name,object:this.get(a)});if(!0!==c.isCancelled){if(null==a)for(a=0;a<this.tabs.length;a++)this.refresh(this.tabs[a].id);else{var e=this.get(a);if(null==e)return!1;null==e.text&&null!=e.caption&&(e.text=e.caption);
null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint);null!=e.caption&&console.log("NOTICE: tabs tab.caption property is deprecated, please use tab.text. Tab -> ",e);null!=e.hint&&console.log("NOTICE: tabs tab.hint property is deprecated, please use tab.tooltip. Tab -> ",e);var f=e.text;"function"==typeof f&&(f=f.call(this,e));null==f&&(f="");var g=b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e.id)),h="";e.closable&&!e.disabled&&(h='<div class="w2ui-tab-close"     onmouseover = "w2ui[\''+
this.name+"'].tooltipShow('"+e.id+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].tooltipHide('"+e.id+"', event);\"    onclick=\"w2ui['"+this.name+"'].animateClose('"+e.id+"', event);\"></div>");f=h+'    <div class="w2ui-tab'+(this.active===e.id?" active":"")+(e.closable?" closable":"")+(e["class"]?" "+e["class"]:"")+'" style="'+e.style+'"         onmouseover = "'+(e.disabled?"":"w2ui['"+this.name+"'].tooltipShow('"+e.id+"', event);")+'"        onmouseout  = "'+(e.disabled?"":"w2ui['"+this.name+
"'].tooltipHide('"+e.id+"', event);")+'"        onclick="w2ui[\''+this.name+"'].click('"+e.id+"', event);\">"+w2utils.lang(f)+"</div>";0===g.length?(g="",e.hidden&&(g+="display: none;"),e.disabled&&(g+="opacity: 0.2;"),e='<td id="tabs_'+this.name+"_tab_"+e.id+'" style="'+g+'" valign="middle">'+f+"</td>",this.get(a,!0)!==this.tabs.length-1&&0<b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,!0))+1].id)).length?b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,
!0))+1].id)).before(e):b(this.box).find("#tabs_"+this.name+"_right").before(e)):(g.html(f),e.hidden?g.css("display","none"):g.css("display",""),e.disabled?g.css({opacity:"0.2"}):g.css({opacity:"1"}))}b("#tabs_"+this.name+"_right").html(this.right);this.trigger(b.extend(c,{phase:"after"}));return(new Date).getTime()-d}},render:function(a){var d=(new Date).getTime(),c=this.trigger({phase:"before",type:"render",target:this.name,box:a});if(!0!==c.isCancelled){null!=a&&(0<b(this.box).find("> table #tabs_"+
this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=a);if(!this.box)return!1;a='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="1" width="100%"><tbody>    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+'</td></tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+
this.name+"']; if (el) el.scroll('right');\"></div>";b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(a);0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);this.trigger(b.extend(c,{phase:"after"}));this.refresh();this.resize();return(new Date).getTime()-d}},scroll:function(a){var d=this,c=b(this.box).find(".w2ui-scroll-wrapper"),e=c.scrollLeft();switch(a){case "left":a=c.outerWidth();var f=c.find(":first").outerWidth();e=e-a+50;0>=e&&(e=0);c.animate({scrollLeft:e},
300);break;case "right":a=c.outerWidth(),f=c.find(":first").outerWidth(),e=e+a-50,e>=f-a&&(e=f-a),c.animate({scrollLeft:e},300)}setTimeout(function(){d.resize()},350)},resize:function(){var a=(new Date).getTime(),d=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==d.isCancelled){var c=b(this.box);c.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var e=c.find(".w2ui-scroll-wrapper");e.find(":first").outerWidth()>e.outerWidth()&&(0<e.scrollLeft()&&c.find(".w2ui-scroll-left").show(),
e.scrollLeft()<e.find(":first").outerWidth()-e.outerWidth()&&c.find(".w2ui-scroll-right").show());this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==a.isCancelled&&(0<b(this.box).find("> table #tabs_"+this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},click:function(a,
d){var c=this.get(a);if(null==c||c.disabled)return!1;d=this.trigger({phase:"before",type:"click",target:a,tab:c,object:c,originalEvent:d});if(!0!==d.isCancelled){b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active");this.active=c.id;if("string"==typeof c.route){var e=""!==c.route?String("/"+c.route).replace(/\/{2,}/g,"/"):"";c=w2utils.parseRoute(e);if(0<c.keys.length)for(var f=0;f<c.keys.length;f++)null!=this.routeData[c.keys[f].name]&&(e=e.replace(new RegExp(":"+
c.keys[f].name,"g"),this.routeData[c.keys[f].name]));setTimeout(function(){window.location.hash=e},1)}this.trigger(b.extend(d,{phase:"after"}));this.refresh(a)}},animateClose:function(a,d){var c=this.get(a);if(null==c||c.disabled)return!1;d=this.trigger({phase:"before",type:"close",target:a,object:this.get(a),originalEvent:d});if(!0!==d.isCancelled){var e=this;b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(c.id)).css(w2utils.cssPrefix("transition",".2s")).css("opacity","0");setTimeout(function(){var a=
b(e.box).find("#tabs_"+e.name+"_tab_"+w2utils.escapeId(c.id)).width();b(e.box).find("#tabs_"+e.name+"_tab_"+w2utils.escapeId(c.id)).html('<div style="width: '+a+"px; "+w2utils.cssPrefix("transition",".2s",!0)+'"></div>');setTimeout(function(){b(e.box).find("#tabs_"+e.name+"_tab_"+w2utils.escapeId(c.id)).find(":first-child").css({width:"0px"})},50)},200);setTimeout(function(){e.remove(a)},450);this.trigger(b.extend(d,{phase:"after"}));this.refresh()}},animateInsert:function(a,d){if(null!=this.get(a)&&
b.isPlainObject(d)&&w2utils.checkUniqueId(d.id,this.tabs,"tabs",this.name)&&0===b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(d.id)).length){null==d.text&&null!=d.caption&&(d.text=d.caption);var c='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tbody><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(d.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===
d.id?"active":"")+'">'+d.text+"</div></td></tr></tbody></table></div>";b("body").append(c);c='<div style="width: 1px; '+w2utils.cssPrefix("transition",".2s",!0)+'">&#160;</div>';var e="";d.hidden&&(e+="display: none;");d.disabled&&(e+="opacity: 0.2;");c='<td id="tabs_'+this.name+"_tab_"+d.id+'" style="'+e+'" valign="middle">'+c+"</td>";this.get(a,!0)!==this.tabs.length&&0<b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,!0))].id)).length?b(this.box).find("#tabs_"+
this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,!0))].id)).before(c):b(this.box).find("#tabs_"+this.name+"_right").before(c);var f=this;setTimeout(function(){var a=b("#_tmp_simple_tab").width();b("#_tmp_tabs").remove();b("#tabs_"+f.name+"_tab_"+w2utils.escapeId(d.id)+" > div").css("width",a+"px")},1);setTimeout(function(){f.insert(a,d)},200)}}};b.extend(l.prototype,w2utils.event);w2obj.tabs=l})(jQuery);
(function(b){var l=function(a){this.name=this.box=null;this.routeData={};this.items=[];this.right="";this.tooltip="top|left";b.extend(!0,this,w2obj.toolbar,a)};b.fn.w2toolbar=function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2toolbar")){var d=a.items||[],c=new l(a);b.extend(c,{items:[],handlers:[]});for(var e=0;e<d.length;e++)if(c.items[e]=b.extend({},l.prototype.item,d[e]),"menu-check"==c.items[e].type){var f=c.items[e];Array.isArray(f.selected)||(f.selected=[]);if(Array.isArray(f.items))for(var g=
0;g<f.items.length;g++){var h=f.items[g];h.checked&&-1==f.selected.indexOf(h.id)&&f.selected.push(h.id);h.checked||-1==f.selected.indexOf(h.id)||(h.checked=!0);null==h.checked&&(h.checked=!1)}}else if("menu-radio"==c.items[e].type&&(f=c.items[e],Array.isArray(f.items)))for(g=0;g<f.items.length;g++)h=f.items[g],h.checked&&null==f.selected?f.selected=h.id:h.checked=!1,h.checked||f.selected!=h.id||(h.checked=!0),null==h.checked&&(h.checked=!1);0!==b(this).length&&c.render(b(this)[0]);return w2ui[c.name]=
c}}else return d=w2ui[b(this).attr("name")],d?0<arguments.length?(d[a]&&d[a].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null};l.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,group:null,items:null,selected:null,overlay:{},color:null,options:{advanced:!1,transparent:!0,html:""},onClick:null,onRefresh:null},
add:function(a){this.insert(null,a)},insert:function(a,d){b.isArray(d)||(d=[d]);for(var c=0;c<d.length;c++){if(null==d[c].type){console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');break}if(-1==b.inArray(String(d[c].type),"button check radio drop menu menu-radio menu-check color text-color break html spacer".split(" "))){console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');
break}if(null==d[c].id&&"break"!=d[c].type&&"spacer"!=d[c].type){console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');break}if(!w2utils.checkUniqueId(d[c].id,this.items,"toolbar items",this.name))break;var e=b.extend({},l.prototype.item,d[c]);if(null==a)this.items.push(e);else{var f=this.get(a,!0);this.items=this.items.slice(0,f).concat([e],this.items.slice(f))}this.refresh(e.id);this.resize()}},remove:function(){for(var a=0,d=0;d<arguments.length;d++){var c=
this.get(arguments[d]);c&&-1==String(arguments[d]).indexOf(":")&&(a++,b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(c.id)).remove(),c=this.get(c.id,!0),null!=c&&this.items.splice(c,1))}this.resize();return a},set:function(a,d){var c=this.get(a);if(null==c)return!1;b.extend(c,d);this.refresh(String(a).split(":")[0]);return!0},get:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.items.length;d++)null!=this.items[d].id&&c.push(this.items[d].id);return c}c=String(a).split(":");
for(d=0;d<this.items.length;d++){var f=this.items[d];if(-1!=["menu","menu-radio","menu-check"].indexOf(f.type)&&2==c.length&&f.id==c[0])for(var g=0;g<f.items.length;g++){var h=f.items[g];if(h.id==c[1]||null==h.id&&h.text==c[1])return 1==b?g:h;if(Array.isArray(h.items))for(var k=0;k<h.items.length;k++)if(h.items[k].id==c[1]||null==h.items[k].id&&h.items[k].text==c[1])return 1==b?g:h.items[k]}else if(f.id==c[0])return 1==b?d:f}return null},show:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=
this.get(arguments[e]);f&&(b++,f.hidden=!1,c.push(String(arguments[e]).split(":")[0]))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]);a.resize()},15);return b},hide:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=this.get(arguments[e]);f&&(b++,f.hidden=!0,c.push(String(arguments[e]).split(":")[0]))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]),a.tooltipHide(c[b]);a.resize()},15);return b},enable:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=
this.get(arguments[e]);f&&(b++,f.disabled=!1,c.push(String(arguments[e]).split(":")[0]))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15);return b},disable:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=this.get(arguments[e]);f&&(b++,f.disabled=!0,c.push(String(arguments[e]).split(":")[0]))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b]),a.tooltipHide(c[b])},15);return b},check:function(){for(var a=this,b=0,c=[],e=0;e<arguments.length;e++){var f=
this.get(arguments[e]);f&&-1==String(arguments[e]).indexOf(":")&&(b++,f.checked=!0,c.push(String(arguments[e]).split(":")[0]))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15);return b},uncheck:function(){for(var a=this,d=0,c=[],e=0;e<arguments.length;e++){var f=this.get(arguments[e]);f&&-1==String(arguments[e]).indexOf(":")&&(-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&f.checked&&setTimeout(function(){b("#tb_"+a.name+"_item_"+w2utils.escapeId(f.id)).w2overlay({name:a.name})},
1),d++,f.checked=!1,c.push(String(arguments[e]).split(":")[0]))}setTimeout(function(){for(var b=0;b<c.length;b++)a.refresh(c[b])},15);return d},click:function(a,d){var c=this,e=String(a).split(":"),f=this.get(e[0]),g=f&&f.items?w2obj.field.prototype.normMenu.call(this,f.items,f):[];if(1<e.length)(a=this.get(a))&&!a.disabled&&c.menuClick({name:c.name,item:f,subItem:a,originalEvent:d});else if(f&&!f.disabled&&(e=this.trigger({phase:"before",type:"click",target:null!=a?a:this.name,item:f,object:f,originalEvent:d}),
!0!==e.isCancelled)){var h="#tb_"+this.name+"_item_"+w2utils.escapeId(f.id)+" table.w2ui-button";b(h).removeClass("down");if("radio"==f.type){for(var k=0;k<this.items.length;k++){var n=this.items[k];null!=n&&n.id!=f.id&&"radio"===n.type&&n.group==f.group&&n.checked&&(n.checked=!1,this.refresh(n.id))}f.checked=!0;b(h).addClass("checked")}-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&(c.tooltipHide(a),f.checked?setTimeout(function(){b("#tb_"+c.name+"_item_"+w2utils.escapeId(f.id)).w2overlay({name:c.name});
f.checked=!1;c.refresh(f.id)},1):setTimeout(function(){function a(a){f.checked=!1;b(h).removeClass("checked")}var d=b("#tb_"+c.name+"_item_"+w2utils.escapeId(f.id));b.isPlainObject(f.overlay)||(f.overlay={});var e=(d.width()-50)/2;19<e&&(e=19);"drop"==f.type&&d.w2overlay(f.html,b.extend({name:c.name,left:e,top:3},f.overlay,{onHide:function(b){a()}}));if(-1!=["menu","menu-radio","menu-check"].indexOf(f.type)){var k="normal";"menu-radio"==f.type&&(k="radio",g.forEach(function(a){a.checked=f.selected==
a.id?!0:!1}));"menu-check"==f.type&&(k="check",g.forEach(function(a){b.isArray(f.selected)&&-1!=f.selected.indexOf(a.id)?a.checked=!0:a.checked=!1}));d.w2menu(b.extend({name:c.name,items:g,left:e,top:3},f.overlay,{type:k,remove:function(a){c.menuClick({name:c.name,remove:!0,item:f,subItem:a.item,originalEvent:a.originalEvent,keepOpen:a.keepOpen})},select:function(a){c.menuClick({name:c.name,item:f,subItem:a.item,originalEvent:a.originalEvent,keepOpen:a.keepOpen})},onHide:function(b){a()}}))}-1!=["color",
"text-color"].indexOf(f.type)&&b(d).w2color(b.extend({color:f.color,onHide:function(b){a();c._tmpColor&&c.colorClick({name:c.name,item:f,color:c._tmpColor,final:!0});delete c._tmpColor},onSelect:function(a){null!=a&&(c.colorClick({name:c.name,item:f,color:a}),c._tmpColor=a)}},f.options))},1));-1!="check menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&(f.checked=!f.checked,f.checked?b(h).addClass("checked"):b(h).removeClass("checked"));if(f.route){var m=String("/"+f.route).replace(/\/{2,}/g,
"/");k=w2utils.parseRoute(m);if(0<k.keys.length)for(n=0;n<k.keys.length;n++)m=m.replace(new RegExp(":"+k.keys[n].name,"g"),this.routeData[k.keys[n].name]);setTimeout(function(){window.location.hash=m},1)}d&&-1!=["button","check","radio"].indexOf(f.type)&&this.tooltipShow(a,d,!0);this.trigger(b.extend(e,{phase:"after"}))}},scroll:function(a){var d=this,c=b(this.box).find(".w2ui-scroll-wrapper"),e=c.scrollLeft();switch(a){case "left":a=c.outerWidth();var f=c.find(":first").outerWidth();e=e-a+50;0>=
e&&(e=0);c.animate({scrollLeft:e},300);break;case "right":a=c.outerWidth(),f=c.find(":first").outerWidth(),e=e+a-50,e>=f-a&&(e=f-a),c.animate({scrollLeft:e},300)}setTimeout(function(){d.resize()},350)},render:function(a){var d=(new Date).getTime(),c=this.trigger({phase:"before",type:"render",target:this.name,box:a});if(!0!==c.isCancelled&&(null!=a&&(0<b(this.box).find("> table #tb_"+this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=
a),this.box)){a='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>';for(var e=0;e<this.items.length;e++){var f=this.items[e];null!=f&&(null==f.id&&(f.id="item_"+e),null!=f.caption&&console.log("NOTICE: toolbar item.caption property is deprecated, please use item.text. Item -> ",f),null!=f.hint&&console.log("NOTICE: toolbar item.hint property is deprecated, please use item.tooltip. Item -> ",
f),a="spacer"==f.type?a+('<td width="100%" id="tb_'+this.name+"_item_"+f.id+'" align="right"></td>'):a+('<td id="tb_'+this.name+"_item_"+f.id+'" style="'+(f.hidden?"display: none":"")+'"     class="'+(f.disabled?"disabled":"")+'" valign="middle"></td>'))}a+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>";a+='</tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+
this.name+"']; if (el) el.scroll('right');\"></div>";b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(a);0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);this.refresh();this.resize();this.trigger(b.extend(c,{phase:"after"}));return(new Date).getTime()-d}},refresh:function(a){var d=(new Date).getTime(),c=this.trigger({phase:"before",type:"refresh",target:null!=a?a:this.name,item:this.get(a)});if(!0!==c.isCancelled)if(null==a)for(d=0;d<this.items.length;d++)c=
this.items[d],null==c.id&&(c.id="item_"+d),this.refresh(c.id);else{var e=this.get(a);if(null==e)return!1;if("function"==typeof e.onRefresh){var f=this.trigger({phase:"before",type:"refresh",target:a,item:e,object:e});if(!0===f.isCancelled)return}var g=b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(e.id)),h=this.getItemHTML(e);this.tooltipHide(a,{});0===g.length?(h="spacer"==e.type?'<td width="100%" id="tb_'+this.name+"_item_"+e.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+
e.id+'" style="'+(e.hidden?"display: none":"")+'"     class="'+(e.disabled?"disabled":"")+'" valign="middle">'+h+"</td>",this.get(a,!0)==this.items.length-1?b(this.box).find("#tb_"+this.name+"_right").before(h):b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(a,!0))+1].id)).before(h)):(-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(e.type)&&(a=b("#w2ui-overlay-"+this.name),0<a.length&&(0==e.checked?a[0].hide():a.w2menu("refresh",{items:e.items}))),
g.html(h),e.hidden?g.css("display","none"):g.css("display",""),e.disabled?g.addClass("disabled"):g.removeClass("disabled"));"function"==typeof e.onRefresh&&this.trigger(b.extend(f,{phase:"after"}));this.trigger(b.extend(c,{phase:"after"}));return(new Date).getTime()-d}},resize:function(){var a=(new Date).getTime(),d=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==d.isCancelled){var c=b(this.box);c.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var e=c.find(".w2ui-scroll-wrapper");
e.find(":first").outerWidth()>e.outerWidth()&&(0<e.scrollLeft()&&c.find(".w2ui-scroll-left").show(),e.scrollLeft()<e.find(":first").outerWidth()-e.outerWidth()&&c.find(".w2ui-scroll-right").show());this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==a.isCancelled&&(0<b(this.box).find("> table #tb_"+this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),
b(this.box).html(""),delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},getItemHTML:function(a){var b="";null!=a.caption&&null==a.text&&(a.text=a.caption);null==a.text&&(a.text="");null==a.tooltip&&null!=a.hint&&(a.tooltip=a.hint);null==a.tooltip&&(a.tooltip="");"function"===typeof a.get||!Array.isArray(a.items)&&"function"!=typeof a.items||(a.get=function(b){var c=a.items;"function"==typeof c&&(c=a.items(a));return c.find(function(a){return a.id==b?!0:!1})});var c="<td>&#160;</td>",
e="function"==typeof a.text?a.text.call(this,a):a.text;a.img&&(c='<td><div class="w2ui-tb-image w2ui-icon '+a.img+'"></div></td>');a.icon&&(c='<td><div class="w2ui-tb-image"><span class="'+("function"==typeof a.icon?a.icon.call(this,a):a.icon)+'"></span></div></td>');if(""===b)switch(a.type){case "color":case "text-color":"string"==typeof a.color&&("#"==a.color.substr(0,1)&&(a.color=a.color.substr(1)),3==a.color.length||6==a.color.length)&&(a.color="#"+a.color),"color"==a.type&&(e='<div style="height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: '+
(null!=a.color?a.color:"#fff")+'; float: left;"></div>'+(a.text?'<div style="margin-left: 17px;">'+w2utils.lang(a.text)+"</div>":"")),"text-color"==a.type&&(e='<div style="color: '+(null!=a.color?a.color:"#444")+';">'+(a.text?w2utils.lang(a.text):"<b>Aa</b>")+"</div>");case "menu":case "menu-check":case "menu-radio":case "button":case "check":case "radio":case "drop":b+='<table cellpadding="0" cellspacing="0"        class="w2ui-button '+(a.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+
this.name+"']; if (el) el.click('"+a.id+'\', event);"        onmouseenter = "'+(a.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+a.id+"', event);")+'"       onmouseleave = "'+(a.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+a.id+"', event);")+'"       onmousedown = "'+(a.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   = "'+(a.disabled?"":"jQuery(this).removeClass('down');")+'"><tbody><tr><td>  <table cellpadding="1" cellspacing="0"><tbody>  <tr>'+
c+(""!==e?'<td class="w2ui-tb-text w2ui-tb-caption" nowrap="nowrap" style="'+(a.style?a.style:"")+'">'+w2utils.lang(e)+"</td>":"")+(null!=a.count?'<td class="w2ui-tb-count" nowrap="nowrap"><span>'+a.count+"</span></td>":"")+(-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(a.type)&&!1!==a.arrow?'<td class="w2ui-tb-down" nowrap="nowrap"><div></div></td>':"")+"  </tr></tbody></table></td></tr></tbody></table>";break;case "break":b+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td><div class="w2ui-break">&#160;</div></td></tr></tbody></table>';
break;case "html":b+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td nowrap="nowrap">'+("function"==typeof a.html?a.html.call(this,a):a.html)+"</td></tr></tbody></table>"}return"<div>"+b+"</div>"},tooltipShow:function(a,d,c){if(null!=this.tooltip){var e=b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(a)),f=this.get(a),g=this.tooltip,h=f.tooltip;"function"==typeof h&&(h=h.call(this,f));clearTimeout(this._tooltipTimer);this._tooltipTimer=setTimeout(function(){!0!==e.prop("_mouse_tooltip")&&
(e.prop("_mouse_tooltip",!0),-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&1==f.checked||e.w2tag(w2utils.lang(h),{position:g}))},0);e.prop("_mouse_tooltip")&&1==c&&e.w2tag(w2utils.lang(h),{position:g})}},tooltipHide:function(a,d){if(null!=this.tooltip){var c=b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(a));this.get(a);clearTimeout(this._tooltipTimer);setTimeout(function(){!0===c.prop("_mouse_tooltip")&&(c.removeProp("_mouse_tooltip"),c.w2tag())},
1)}},menuClick:function(a){if(a.item&&!a.item.disabled){var d=this.trigger({phase:"before",type:!0!==a.remove?"click":"remove",target:a.item.id+":"+a.subItem.id,item:a.item,subItem:a.subItem,originalEvent:a.originalEvent});if(!0!==d.isCancelled){var c=a.subItem,e=this.get(a.item.id),f=e.items;"function"==typeof f&&(f=e.items());"menu-radio"==e.type&&(e.selected=c.id,Array.isArray(f)&&f.forEach(function(a){!0===a.checked&&delete a.checked;Array.isArray(a.items)&&a.items.forEach(function(a){!0===a.checked&&
delete a.checked})}),c.checked=!0);if("menu-check"==e.type)if(b.isArray(e.selected)||(e.selected=[]),null==c.group)f=e.selected.indexOf(c.id),-1==f?(e.selected.push(c.id),c.checked=!0):(e.selected.splice(f,1),c.checked=!1);else{var g=[];(function p(a){a.forEach(function(a){if(a.group===c.group){var b=e.selected.indexOf(a.id);-1!=b&&(a.id!=c.id&&g.push(a.id),e.selected.splice(b,1))}Array.isArray(a.items)&&p(a.items)})})(f);f=e.selected.indexOf(c.id);-1==f&&(e.selected.push(c.id),c.checked=!0)}if("string"==
typeof c.route){var h=""!==c.route?String("/"+c.route).replace(/\/{2,}/g,"/"):"";f=w2utils.parseRoute(h);if(0<f.keys.length)for(var k=0;k<f.keys.length;k++)null!=this.routeData[f.keys[k].name]&&(h=h.replace(new RegExp(":"+f.keys[k].name,"g"),this.routeData[f.keys[k].name]));setTimeout(function(){window.location.hash=h},1)}this.refresh(a.item.id);this.trigger(b.extend(d,{phase:"after"}))}}},colorClick:function(a){if(a.item&&!a.item.disabled){var d=this.trigger({phase:"before",type:"click",target:a.item.id,
item:a.item,color:a.color,final:a.final,originalEvent:a.originalEvent});!0!==d.isCancelled&&(a.item.color=a.color,this.refresh(a.item.id),this.trigger(b.extend(d,{phase:"after"})))}}};b.extend(l.prototype,w2utils.event);w2obj.toolbar=l})(jQuery);
(function(b){var l=function(a){this.parent=this.sidebar=this.box=this.name=null;this.nodes=[];this.menu=[];this.routeData={};this.icon=this.img=this.selected=null;this.bottomHTML=this.topHTML=this.style="";this.flatButton=!1;this.keyboard=!0;this.hasFocus=this.flat=!1;b.extend(!0,this,w2obj.sidebar,a)};b.fn.w2sidebar=function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2sidebar")){var d=a.nodes,c=new l(a);b.extend(c,{handlers:[],nodes:[]});null!=d&&c.add(c,d);0!==b(this).length&&c.render(b(this)[0]);
c.sidebar=c;return w2ui[c.name]=c}}else return d=w2ui[b(this).attr("name")],d?0<arguments.length?(d[a]&&d[a].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null};l.prototype={onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onExpand:null,onCollapse:null,onKeydown:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onFocus:null,onBlur:null,onFlat:null,node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,
disabled:!1,group:!1,groupShowHide:!0,collapsible:!1,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(a,b){1==arguments.length&&(b=arguments[0],a=this);"string"==typeof a&&(a=this.get(a));return this.insert(a,null,b)},insert:function(a,d,c){if(2==arguments.length)if(c=arguments[1],d=arguments[0],null!=d){var e=this.get(d);if(null==e)return b.isArray(c)||(c=[c]),null!=c[0].caption&&null==c[0].text&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",
c[0]),c[0].text=c[0].caption),e=c[0].text,console.log('ERROR: Cannot insert node "'+e+'" because cannot find node "'+d+'" to insert before.'),null;a=this.get(d).parent}else a=this;"string"==typeof a&&(a=this.get(a));b.isArray(c)||(c=[c]);for(var f=0;f<c.length;f++){var g=c[f];if(null!=this.get(this,g.id))console.log("ERROR: Cannot insert node with id="+g.id+" (text: "+g.text+") because another node with the same id already exists.");else{var h=b.extend({},l.prototype.node,g);h.sidebar=this;h.parent=
a;var k=h.nodes||[];h.nodes=[];if(null==d)a.nodes.push(h);else{e=this.get(a,d,!0);if(null==e)return console.log('ERROR: Cannot insert node "'+g.text+'" because cannot find node "'+d+'" to insert before.'),null;a.nodes.splice(e,0,h)}0<k.length&&this.insert(h,null,k)}}this.refresh(a.id);return h},remove:function(){for(var a=0,b,c=0;c<arguments.length;c++)if(b=this.get(arguments[c]),null!=b){null!=this.selected&&this.selected===b.id&&(this.selected=null);var e=this.get(b.parent,arguments[c],!0);null!=
e&&(b.parent.nodes[e].selected&&b.sidebar.unselect(b.id),b.parent.nodes.splice(e,1),a++)}0<a&&1==arguments.length?this.refresh(b.parent.id):this.refresh();return a},set:function(a,d,c){2==arguments.length&&(c=d,d=a,a=this);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return null;for(var e=0;e<a.nodes.length;e++){if(a.nodes[e].id===d){var f=c.nodes;b.extend(a.nodes[e],c,{nodes:[]});null!=f&&this.add(a.nodes[e],f);this.refresh(d);return!0}if(this.set(a.nodes[e],d,c))return!0}return!1},get:function(a,
b,c){if(0===arguments.length){for(var d=[],f=this.find({}),g=0;g<f.length;g++)null!=f[g].id&&d.push(f[g].id);return d}if(1==arguments.length||2==arguments.length&&!0===b)c=b,b=a,a=this;"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return null;for(d=0;d<a.nodes.length;d++){if(a.nodes[d].id==b)return!0===c?d:a.nodes[d];if((f=this.get(a.nodes[d],b,c))||0===f)return f}return null},find:function(a,b,c){1==arguments.length&&(b=a,a=this);c||(c=[]);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return c;
for(var d=0;d<a.nodes.length;d++){var f=!0,g;for(g in b)a.nodes[d][g]!=b[g]&&(f=!1);f&&c.push(a.nodes[d]);0<a.nodes[d].nodes.length&&(c=this.find(a.nodes[d],b,c))}return c},hide:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);null!=c&&!0!==c.hidden&&(c.hidden=!0,a++)}0<a&&(1==arguments.length?this.refresh(arguments[0]):this.refresh());return a},show:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);null!=c&&!1!==c.hidden&&(c.hidden=!1,
a++)}0<a&&(1==arguments.length?this.refresh(arguments[0]):this.refresh());return a},disable:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);null!=c&&!0!==c.disabled&&(c.disabled=!0,c.selected&&this.unselect(c.id),a++)}0<a&&(1==arguments.length?this.refresh(arguments[0]):this.refresh());return a},enable:function(){for(var a=0,b=0;b<arguments.length;b++){var c=this.get(arguments[b]);null!=c&&!1!==c.disabled&&(c.disabled=!1,a++)}0<a&&(1==arguments.length?this.refresh(arguments[0]):
this.refresh());return a},select:function(a){var d=this.get(a);if(!d||this.selected==a&&d.selected)return!1;this.unselect(this.selected);var c=b(this.box).find("#node_"+w2utils.escapeId(a));c.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");0<c.length&&this.scrollIntoView(a,!0);d.selected=!0;this.selected=a;return!0},unselect:function(a){0===arguments.length&&(a=this.selected);var d=this.get(a);if(!d)return!1;d.selected=!1;b(this.box).find("#node_"+w2utils.escapeId(a)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected");
this.selected==a&&(this.selected=null);return!0},toggle:function(a){var b=this.get(a);if(null==b)return!1;if(b.plus)this.set(a,{plus:!1}),this.expand(a),this.refresh(a);else return 0!==b.nodes.length&&b.collapsible?this.get(a).expanded?this.collapse(a):this.expand(a):!1},collapse:function(a){var d=this,c=this.get(a),e=this.trigger({phase:"before",type:"collapse",target:a,object:c});if(!0!==e.isCancelled)return b(this.box).find("#node_"+w2utils.escapeId(a)+"_sub").slideUp(200),b(this.box).find("#node_"+
w2utils.escapeId(a)+" .w2ui-expanded").removeClass("w2ui-expanded").addClass("w2ui-collapsed"),c.expanded=!1,this.trigger(b.extend(e,{phase:"after"})),setTimeout(function(){d.refresh(a)},200),!0},collapseAll:function(a){null==a&&(a=this);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return!1;for(var b=0;b<a.nodes.length;b++)!0===a.nodes[b].expanded&&(a.nodes[b].expanded=!1),a.nodes[b].nodes&&0<a.nodes[b].nodes.length&&this.collapseAll(a.nodes[b]);this.refresh(a.id);return!0},expand:function(a){var d=
this,c=this.get(a),e=this.trigger({phase:"before",type:"expand",target:a,object:c});if(!0!==e.isCancelled)return b(this.box).find("#node_"+w2utils.escapeId(a)+"_sub").slideDown(200),b(this.box).find("#node_"+w2utils.escapeId(a)+" .w2ui-collapsed").removeClass("w2ui-collapsed").addClass("w2ui-expanded"),c.expanded=!0,this.trigger(b.extend(e,{phase:"after"})),setTimeout(function(){d.refresh(a)},200),!0},expandAll:function(a){null==a&&(a=this);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return!1;
for(var b=0;b<a.nodes.length;b++)!1===a.nodes[b].expanded&&(a.nodes[b].expanded=!0),a.nodes[b].nodes&&0<a.nodes[b].nodes.length&&this.expandAll(a.nodes[b]);this.refresh(a.id)},expandParents:function(a){a=this.get(a);if(null==a)return!1;a.parent&&(a.parent.expanded||(a.parent.expanded=!0,this.refresh(a.parent.id)),this.expandParents(a.parent.id));return!0},click:function(a,d){var c=this,e=this.get(a);if(null!=e&&!e.disabled&&!e.group){b(c.box).find(".w2ui-node.w2ui-selected").each(function(a,d){a=
b(d).attr("id").replace("node_","");a=c.get(a);null!=a&&(a.selected=!1);b(d).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});var f=b(c.box).find("#node_"+w2utils.escapeId(a)),g=b(c.box).find("#node_"+w2utils.escapeId(c.selected));f.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");setTimeout(function(){var h=c.trigger({phase:"before",type:"click",target:a,originalEvent:d,node:e,object:e});if(!0===h.isCancelled)f.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),
g.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");else{null!=g&&(g.selected=!1);c.get(a).selected=!0;c.selected=a;if("string"==typeof e.route){var k=""!==e.route?String("/"+e.route).replace(/\/{2,}/g,"/"):"",n=w2utils.parseRoute(k);if(0<n.keys.length)for(var m=0;m<n.keys.length;m++)null!=c.routeData[n.keys[m].name]&&(k=k.replace(new RegExp(":"+n.keys[m].name,"g"),c.routeData[n.keys[m].name]));setTimeout(function(){window.location.hash=k},1)}c.trigger(b.extend(h,{phase:"after"}))}},
1)}},focus:function(a){var d=this;a=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=!0;b(this.box).find(".w2ui-sidebar-body").addClass("w2ui-focus");setTimeout(function(){var a=b(d.box).find("#sidebar_"+d.name+"_focus");a.is(":focus")||a.focus()},10);this.trigger(b.extend(a,{phase:"after"}))},blur:function(a){a=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=
!1;b(this.box).find(".w2ui-sidebar-body").removeClass("w2ui-focus");this.trigger(b.extend(a,{phase:"after"}))},keydown:function(a){function d(a,b){null==a||a.hidden||a.disabled||a.group||(h.click(a.id,b),setTimeout(function(){h.scrollIntoView()},50))}function c(a,b){for(a=b(a);null!=a&&(a.hidden||a.disabled)&&!a.group;)a=b(a);return a}function e(a,b){if(null==a)return null;var c=a.parent,d=h.get(a.id,!0);a.expanded&&0<a.nodes.length&&!0!==b?(a=a.nodes[0],a=a.hidden||a.disabled||a.group?e(a):a):a=
c&&d+1<c.nodes.length?c.nodes[d+1]:e(c,!0);null!=a&&(a.hidden||a.disabled||a.group)&&(a=e(a));return a}function f(a){if(null==a)return null;var b=a.parent;a=h.get(a.id,!0);b=0<a?g(b.nodes[a-1]):b;null!=b&&(b.hidden||b.disabled||b.group)&&(b=f(b));return b}function g(a){return a.expanded&&0<a.nodes.length?(a=a.nodes[a.nodes.length-1],a.hidden||a.disabled||a.group?f(a):g(a)):a}var h=this,k=h.get(h.selected);if(!0===h.keyboard){k||(k=h.nodes[0]);var n=h.trigger({phase:"before",type:"keydown",target:h.name,
originalEvent:a});!0!==n.isCancelled&&((13==a.keyCode||32==a.keyCode)&&0<k.nodes.length&&h.toggle(h.selected),37==a.keyCode&&(0<k.nodes.length&&k.expanded?h.collapse(h.selected):(d(k.parent),k.parent.group||h.collapse(k.parent.id))),39==a.keyCode&&(0<k.nodes.length||k.plus)&&!k.expanded&&h.expand(h.selected),38==a.keyCode&&(null==h.get(h.selected)?d(this.nodes[0]||null):d(c(k,f))),40==a.keyCode&&(null==h.get(h.selected)?d(this.nodes[0]||null):d(c(k,e))),-1!=b.inArray(a.keyCode,[13,32,37,38,39,40])&&
(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()),h.trigger(b.extend(n,{phase:"after"})))}},scrollIntoView:function(a,d){null==a&&(a=this.selected);if(null!=this.get(a)){var c=b(this.box).find(".w2ui-sidebar-body");a=b(this.box).find("#node_"+w2utils.escapeId(a));var e=a.offset().top-c.offset().top;(e+a.height()>c.height()||0>=e)&&c.animate({scrollTop:c.scrollTop()+e-c.height()/2+a.height()},d?0:250,"linear")}},dblClick:function(a,d){var c=this.get(a);d=this.trigger({phase:"before",
type:"dblClick",target:a,originalEvent:d,object:c});!0!==d.isCancelled&&(this.toggle(a),this.trigger(b.extend(d,{phase:"after"})))},contextMenu:function(a,d){var c=this,e=c.get(a);a!=c.selected&&c.click(a);var f=c.trigger({phase:"before",type:"contextMenu",target:a,originalEvent:d,object:e,allowOnDisabled:!1});!0===f.isCancelled||e.disabled&&!f.allowOnDisabled||(0<c.menu.length&&b(c.box).find("#node_"+w2utils.escapeId(a)).w2menu({items:c.menu,contextMenu:!0,originalEvent:d,onSelect:function(b){c.menuClick(a,
parseInt(b.index),b.originalEvent)}}),d.preventDefault&&d.preventDefault(),c.trigger(b.extend(f,{phase:"after"})))},menuClick:function(a,d,c){a=this.trigger({phase:"before",type:"menuClick",target:a,originalEvent:c,menuIndex:d,menuItem:this.menu[d]});!0!==a.isCancelled&&this.trigger(b.extend(a,{phase:"after"}))},goFlat:function(){var a=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});!0!==a.isCancelled&&(this.flat=!this.flat,this.refresh(),this.trigger(b.extend(a,{phase:"after"})))},render:function(a){var d=
(new Date).getTime(),c=this,e=this.trigger({phase:"before",type:"render",target:this.name,box:a});if(!0!==e.isCancelled&&(null!=a&&(0<b(this.box).find("> div > div.w2ui-sidebar-body").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=a),this.box)){b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><input id="sidebar_'+this.name+'_focus" style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0" '+(w2utils.isIOS?
"readonly":"")+'/><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-body"></div><div class="w2ui-sidebar-bottom"></div></div>');b(this.box).find("> div").css({width:b(this.box).width()+"px",height:b(this.box).height()+"px"});0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);a="";1==this.flatButton&&(a='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>");if(""!==this.topHTML||""!==a)b(this.box).find(".w2ui-sidebar-top").html(this.topHTML+
a),b(this.box).find(".w2ui-sidebar-body").css("top",b(this.box).find(".w2ui-sidebar-top").height()+"px");""!==this.bottomHTML&&(b(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),b(this.box).find(".w2ui-sidebar-body").css("bottom",b(this.box).find(".w2ui-sidebar-bottom").height()+"px"));var f;b(this.box).find("#sidebar_"+this.name+"_focus").on("focus",function(a){clearTimeout(f);c.hasFocus||c.focus(a)}).on("blur",function(a){f=setTimeout(function(){c.hasFocus&&c.blur(a)},100)}).on("keydown",
function(a){9!=a.keyCode&&w2ui[c.name].keydown.call(w2ui[c.name],a)});b(this.box).off("mousedown").on("mousedown",function(a){setTimeout(function(){if(-1==["INPUT","TEXTAREA","SELECT"].indexOf(a.target.tagName.toUpperCase())){var d=b(c.box).find("#sidebar_"+c.name+"_focus");if(!d.is(":focus")){if(b(a.target).hasClass("w2ui-node")){var e=b(a.target).position().top+b(c.box).find(".w2ui-sidebar-top").height()+a.offsetY;d.css({top:e+"px",left:"0px"})}d.focus()}}},1)});this.trigger(b.extend(e,{phase:"after"}));
this.refresh();return(new Date).getTime()-d}},refresh:function(a){function d(a){var b=a.img;var c=a.icon;null==c&&null==b&&(null==c&&(c=h.icon),null==b&&(b=h.img));for(var d=a.parent,e=0;d&&null!=d.parent;)d=d.parent,e++;null!=a.caption&&null==a.text&&(a.text=a.caption);null!=a.caption&&(console.log("NOTICE: sidebar node.caption property is deprecated, please use node.text. Node -> ",a),a.text=a.caption);Array.isArray(a.nodes)&&0<a.nodes.length&&(a.collapsible=!0);a.group?(c='<div class="w2ui-node-group w2ui-level-'+
e+(a.class?" "+a.class:"")+'" id="node_'+a.id+'"   style="'+(a.hidden?"display: none":"")+'" onclick="w2ui[\''+h.name+"'].toggle('"+a.id+"')\"   oncontextmenu=\"w2ui['"+h.name+"'].contextMenu('"+a.id+"', event);\"   onmouseout=\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover=\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(a.groupShowHide&&a.collapsible?"<span>"+(!a.hidden&&a.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>":"<span></span>")+
("function"==typeof a.text?a.text.call(h,a):"<span>"+a.text+"</span>")+'</div><div class="w2ui-node-sub" id="node_'+a.id+'_sub" style="'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"></div>',h.flat&&(c='<div class="w2ui-node-group" id="node_'+a.id+'"><span>&#160;</span></div><div id="node_'+a.id+'_sub" style="'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"></div>')):(a.selected&&!a.disabled&&(h.selected=a.id),d="",b&&(d='<div class="w2ui-node-image w2ui-icon '+b+(a.selected&&
!a.disabled?" w2ui-icon-selected":"")+'"></div>'),c&&(d='<div class="w2ui-node-image"><span class="'+("function"==typeof c?c.call(h,a):c)+'"></span></div>'),b=a.text,c=null!=a.count?'<div class="w2ui-node-count">'+a.count+"</div>":"",!0===a.collapsible&&(c='<div class="w2ui-'+(a.expanded?"expanded":"collapsed")+'"><span></span></div>'),"function"==typeof a.text&&(b=a.text.call(h,a)),c='<div class="w2ui-node w2ui-level-'+e+(a.selected?" w2ui-selected":"")+(a.disabled?" w2ui-disabled":"")+(a.class?
" "+a.class:"")+'" id="node_'+a.id+'" style="'+(a.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+h.name+"'].dblClick('"+a.id+"', event);\"    oncontextmenu=\"w2ui['"+h.name+"'].contextMenu('"+a.id+"', event);\"    onClick=\"w2ui['"+h.name+"'].click('"+a.id+'\', event); ">   <div class="w2ui-node-data" style="margin-left:'+12*e+'px">'+d+c+'<div class="w2ui-node-text w2ui-node-caption">'+b+'</div>   </div></div><div class="w2ui-node-sub" id="node_'+a.id+'_sub" style="'+a.style+";"+(!a.hidden&&
a.expanded?"":"display: none;")+'"></div>',h.flat&&(c='<div class="w2ui-node w2ui-level-'+e+" "+(a.selected?"w2ui-selected":"")+" "+(a.disabled?"w2ui-disabled":"")+(a.class?" "+a.class:"")+'" id="node_'+a.id+'" style="'+(a.hidden?"display: none;":"")+"\"    onmouseover=\"jQuery(this).find('.w2ui-node-data').w2tag(w2utils.base64decode('"+w2utils.base64encode(b+(a.count||0===a.count?' - <span class="w2ui-node-count">'+a.count+"</span>":""))+"'),                { id: '"+a.id+"', left: -5 })\"    onmouseout=\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+
a.id+"' })\"    ondblclick=\"w2ui['"+h.name+"'].dblClick('"+a.id+"', event);\"    oncontextmenu=\"w2ui['"+h.name+"'].contextMenu('"+a.id+"', event);\"    onClick=\"w2ui['"+h.name+"'].click('"+a.id+'\', event); "><div class="w2ui-node-data w2ui-node-flat">'+d+'</div></div><div class="w2ui-node-sub" id="node_'+a.id+'_sub" style="'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"></div>'));return c}var c=(new Date).getTime(),e=this.trigger({phase:"before",type:"refresh",target:null!=a?a:this.name,
fullRefresh:null!=a?!1:!0});if(!0!==e.isCancelled){var f="";1==this.flatButton&&(f='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>");if(""!==this.topHTML||""!==f)b(this.box).find(".w2ui-sidebar-top").html(this.topHTML+f),b(this.box).find(".w2ui-sidebar-body").css("top",b(this.box).find(".w2ui-sidebar-top").height()+"px");""!==this.bottomHTML&&(b(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),b(this.box).find(".w2ui-sidebar-body").css("bottom",
b(this.box).find(".w2ui-sidebar-bottom").height()+"px"));b(this.box).find("> div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:b(this.box).width()+"px",height:b(this.box).height()+"px"});if(0<this.nodes.length&&null==this.nodes[0].parent){var g=this.nodes;this.nodes=[];this.add(this,g)}var h=this;if(null==a)a=this,f=".w2ui-sidebar-body";else{a=this.get(a);if(null==a)return;f="#node_"+w2utils.escapeId(a.id)+"_sub"}if(a!==this){g="#node_"+w2utils.escapeId(a.id);
var k=d(a);b(this.box).find(g).before('<div id="sidebar_'+this.name+'_tmp"></div>');b(this.box).find(g).remove();b(this.box).find(f).remove();b("#sidebar_"+this.name+"_tmp").before(k);b("#sidebar_"+this.name+"_tmp").remove()}g=b(this.box).find(f).scrollTop();var n=b(this.box).find(f).scrollLeft();b(this.box).find(f).html("");for(var m=0;m<a.nodes.length;m++){var l=a.nodes[m];k=d(l);b(this.box).find(f).append(k);if(0!==l.nodes.length)this.refresh(l.id);else{k=this.trigger({phase:"before",type:"refresh",
target:l.id});if(!0===k.isCancelled)return;this.trigger(b.extend(k,{phase:"after"}))}}b(this.box).find(f).scrollLeft(n).scrollTop(g);this.trigger(b.extend(e,{phase:"after"}));return(new Date).getTime()-c}},resize:function(){var a=(new Date).getTime(),d=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==d.isCancelled)return b(this.box).css("overflow","hidden"),b(this.box).find("> div").css({width:b(this.box).width()+"px",height:b(this.box).height()+"px"}),this.trigger(b.extend(d,
{phase:"after"})),(new Date).getTime()-a},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==a.isCancelled&&(0<b(this.box).find("> div > div.w2ui-sidebar-body").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},lock:function(a,b){var c=Array.prototype.slice.call(arguments,0);c.unshift(this.box);w2utils.lock.apply(window,c)},unlock:function(a){w2utils.unlock(this.box,
a)}};b.extend(l.prototype,w2utils.event);w2obj.sidebar=l})(jQuery);
(function(b){var l=function(a){this.el=null;this.helpers={};this.type=a.type||"text";this.options=b.extend(!0,{},a);this.onSearch=a.onSearch||null;this.onRequest=a.onRequest||null;this.onLoad=a.onLoad||null;this.onError=a.onError||null;this.onClick=a.onClick||null;this.onAdd=a.onAdd||null;this.onNew=a.onNew||null;this.onRemove=a.onRemove||null;this.onMouseOver=a.onMouseOver||null;this.onMouseOut=a.onMouseOut||null;this.onIconClick=a.onIconClick||null;this.onScroll=a.onScroll||null;this.tmp={};delete this.options.type;
delete this.options.onSearch;delete this.options.onRequest;delete this.options.onLoad;delete this.options.onError;delete this.options.onClick;delete this.options.onMouseOver;delete this.options.onMouseOut;delete this.options.onIconClick;delete this.options.onScroll;b.extend(!0,this,w2obj.field)};b.fn.w2field=function(a,d){if(0===this.length){var c=l.prototype;if(c[a])return c[a].apply(c,Array.prototype.slice.call(arguments,1))}else{if(0===arguments.length)return b(this).data("w2field");"string"===
typeof a&&"object"===typeof d&&(a=b.extend(!0,{},d,{type:a}));"string"===typeof a&&null==d&&(a={type:a});a&&(a.type=String(a.type).toLowerCase());return this.each(function(c,d){c=b(d).data("w2field");if(null!=c&&(c.clear(),"clear"===a.type))return;c=new l(a);b.extend(c,{handlers:[]});d&&(c.el=b(d)[0]);c.init();b(d).data("w2field",c);return c})}};l.prototype={custom:{},addType:function(a,b){a=String(a).toLowerCase();this.custom[a]=b;return!0},removeType:function(a){a=String(a).toLowerCase();if(!this.custom[a])return!1;
delete this.custom[a];return!0},init:function(){var a=this,d=this.options;if("function"===typeof this.custom[this.type])this.custom[this.type].call(this,d);else if(-1==["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase()))console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else{switch(this.type){case "text":case "int":case "float":case "money":case "currency":case "percent":case "alphanumeric":case "bin":case "hex":var c={min:null,max:null,step:1,autoFormat:!0,
currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""};d=this.options=b.extend(!0,{},c,d);d.numberRE=new RegExp("["+d.groupSymbol+"]","g");d.moneyRE=new RegExp("["+d.currencyPrefix+d.currencySuffix+d.groupSymbol+"]","g");d.percentRE=new RegExp("["+d.groupSymbol+
"%]","g");-1!==["text","alphanumeric","hex","bin"].indexOf(this.type)&&(d.arrows=!1,d.keyboard=!1);this.addPrefix();this.addSuffix();break;case "color":c={prefix:"",suffix:'<div style="width: '+(parseInt(b(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,advanced:null,transparent:!0};b.extend(d,c);this.addPrefix();this.addSuffix();""!==b(this.el).val()&&setTimeout(function(){a.change()},1);break;case "date":c={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",
end:"",blocked:{},colored:{},blockWeekDays:null};d=this.options=b.extend(!0,{},c,d);null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",d.format);break;case "time":c={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1};d=this.options=b.extend(!0,{},c,d);null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",d.format);break;case "datetime":c={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",
end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1};d=this.options=b.extend(!0,{},c,d);null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",d.placeholder||d.format);break;case "list":case "combo":c={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",align:"both",altRows:!0,onSearch:null,onRequest:null,onLoad:null,onError:null,
onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1};"function"==typeof d.items&&(d._items_fun=d.items);d.items=w2obj.field.prototype.normMenu.call(this,d.items);if("list"===this.type){c.openOnFocus=!0;b(this.el).addClass("w2ui-select");if(!b.isPlainObject(d.selected)&&Array.isArray(d.items))for(var e=0;e<d.items.length;e++){var f=d.items[e];if(f&&f.id===d.selected){d.selected=b.extend(!0,{},f);break}}this.watchSize()}this.options=d=b.extend({},
c,d);b.isPlainObject(d.selected)||(d.selected={});b(this.el).data("selected",d.selected);d.url&&(d.items=[],this.request(0));"list"===this.type&&this.addFocus();this.addPrefix();this.addSuffix();setTimeout(function(){a.refresh()},10);b(this.el).attr("autocapitalize","off").attr("autocomplete","off").attr("autocorrect","off").attr("spellcheck","false");null!=d.selected.text&&b(this.el).val(d.selected.text);break;case "enum":c={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,
method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,align:"both",altRows:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null};d=b.extend({},c,d,{suffix:""});"function"==typeof d.items&&(d._items_fun=d.items);d.items=w2obj.field.prototype.normMenu.call(this,
d.items);d.selected=w2obj.field.prototype.normMenu.call(this,d.selected);this.options=d;b.isArray(d.selected)||(d.selected=[]);b(this.el).data("selected",d.selected);d.url&&(d.items=[],this.request(0));this.addSuffix();this.addMulti();this.watchSize();break;case "file":c={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,align:"both",altRows:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,
onMouseOut:null},this.options=d=b.extend({},c,d),b.isArray(d.selected)||(d.selected=[]),b(this.el).data("selected",d.selected),null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(b){a.change.call(a,b)},onClick:function(b){a.click.call(a,b)},onFocus:function(b){a.focus.call(a,b)},onBlur:function(b){a.blur.call(a,b)},onKeydown:function(b){a.keyDown.call(a,
b)},onKeyup:function(b){a.keyUp.call(a,b)},onKeypress:function(b){a.keyPress.call(a,b)}};b(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box"));this.change(b.Event("change"))}},
watchSize:function(){var a=this,d=b(a.el).data("tmp")||{};d.sizeTimer=setInterval(function(){0<b(a.el).parents("body").length?a.resize():clearInterval(d.sizeTimer)},200);b(a.el).data("tmp",d)},get:function(){return-1!==["list","enum","file"].indexOf(this.type)?b(this.el).data("selected"):b(this.el).val()},set:function(a,d){-1!==["list","enum","file"].indexOf(this.type)?("list"!==this.type&&d?(null==b(this.el).data("selected")&&b(this.el).data("selected",[]),b(this.el).data("selected").push(a),b(this.el).change()):
(a="enum"===this.type?[a]:a,b(this.el).data("selected",a).change()),this.refresh()):b(this.el).val(a)},setIndex:function(a,d){if(-1!==["list","enum"].indexOf(this.type)){var c=this.options.items;if(c&&c[a])return"list"!==this.type&&d?(null==b(this.el).data("selected")&&b(this.el).data("selected",[]),b(this.el).data("selected").push(c[a]),b(this.el).change()):(a="enum"===this.type?[c[a]]:c[a],b(this.el).data("selected",a).change()),this.refresh(),!0}return!1},clear:function(){var a=this.options;-1!==
["money","currency"].indexOf(this.type)&&b(this.el).val(b(this.el).val().replace(a.moneyRE,""));"percent"===this.type&&b(this.el).val(b(this.el).val().replace(/%/g,""));"list"===this.type&&b(this.el).removeClass("w2ui-select");this.type="clear";a=b(this.el).data("tmp");if(this.tmp){null!=a&&(b(this.el).height("auto"),a&&a["old-padding-left"]&&b(this.el).css("padding-left",a["old-padding-left"]),a&&a["old-padding-right"]&&b(this.el).css("padding-right",a["old-padding-right"]),a&&a["old-background-color"]&&
b(this.el).css("background-color",a["old-background-color"]),a&&a["old-border-color"]&&b(this.el).css("border-color",a["old-border-color"]),clearInterval(a.sizeTimer));b(this.el).val(this.clean(b(this.el).val())).removeClass("w2field").removeData().off(".w2field");for(var d in this.helpers)b(this.helpers[d]).remove();this.helpers={}}},refresh:function(){var a=this,d=this.options,c=b(this.el).data("selected"),e=(new Date).getTime();-1!==["list"].indexOf(this.type)&&(b(a.el).parent().css("white-space",
"nowrap"),a.helpers.prefix&&a.helpers.prefix.hide(),setTimeout(function(){if(a.helpers.focus){!b.isEmptyObject(c)&&d.icon?d.prefix='<span class="w2ui-icon '+d.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+d.iconStyle+'"></span>':d.prefix="";a.addPrefix();var e=a.helpers.focus.find("input");""===b(e).val()?(b(e).css("text-indent","-9999em").prev().css("opacity",0),b(a.el).val(c&&null!=c.text?w2utils.lang(c.text):"")):(b(e).css("text-indent",
0).prev().css("opacity",1),b(a.el).val(""),setTimeout(function(){a.helpers.prefix&&a.helpers.prefix.hide();d.icon?(b(e).css("margin-left","17px"),b(a.helpers.focus).find(".icon-search").attr("style","position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;width: 11px !important; opacity: 1; display: block")):(b(e).css("margin-left","0px"),b(a.helpers.focus).find(".icon-search").attr("style","position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;width: 0px !important; opacity: 0; display: none"))},
1));b(a.el).prop("readonly")||b(a.el).prop("disabled")?setTimeout(function(){b(a.helpers.prefix).css("opacity","0.6");b(a.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){b(a.helpers.prefix).css("opacity","1");b(a.helpers.suffix).css("opacity","1")},1)}},1));if(-1!==["enum","file"].indexOf(this.type)){var f="";if(c)for(var g=0;g<c.length;g++){var h=c[g],k="";k="function"===typeof d.renderItem?d.renderItem(h,g,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+
g+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+g+'">&#160;&#160;</div>'+("enum"===a.type?h.text:h.name+'<span class="file-size"> - '+w2utils.formatSize(h.size)+"</span>");f+='<li index="'+g+'" style="max-width: '+parseInt(d.maxWidth)+"px; "+(h.style?h.style:"")+'">'+k+"</li>"}var n=a.helpers.multi;g=n.find("ul");n.attr("style",n.attr("style")+";"+d.style);b(a.el).css("z-index","-1");b(a.el).prop("readonly")||b(a.el).prop("disabled")?setTimeout(function(){n[0].scrollTop=
0;n.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(function(){n.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1);n.find(".w2ui-enum-placeholder").remove();g.find("li").not("li.nomouse").remove();""!==f?g.prepend(f):null!=b(a.el).attr("placeholder")&&
""===n.find("input").val()&&(f="padding-top: "+b(this.el).css("padding-top")+";padding-left: "+b(this.el).css("padding-left")+"; box-sizing: "+b(this.el).css("box-sizing")+"; line-height: "+b(this.el).css("line-height")+"; font-size: "+b(this.el).css("font-size")+"; font-family: "+b(this.el).css("font-family")+"; ",n.prepend('<div class="w2ui-enum-placeholder" style="'+f+'">'+b(a.el).attr("placeholder")+"</div>"));n.off("scroll.w2field").on("scroll.w2field",function(c){c=a.trigger({phase:"before",
type:"scroll",target:a.el,originalEvent:c});!0!==c.isCancelled&&a.trigger(b.extend(c,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(d){var e="LI"===d.target.tagName.toUpperCase()?d.target:b(d.target).parents("LI"),f=c[b(e).attr("index")];if(!b(e).hasClass("nomouse"))if(d.stopPropagation(),b(d.target).hasClass("w2ui-list-remove")){if(!b(a.el).prop("readonly")&&!b(a.el).prop("disabled")){var g=a.trigger({phase:"before",type:"remove",target:a.el,originalEvent:d.originalEvent,
item:f});!0!==g.isCancelled&&(b().w2overlay(),c.splice(b(d.target).attr("index"),1),b(a.el).trigger("input").trigger("change"),b(d.target).parent().fadeOut("fast"),setTimeout(function(){a.refresh();a.trigger(b.extend(g,{phase:"after"}))},300))}}else g=a.trigger({phase:"before",type:"click",target:a.el,originalEvent:d.originalEvent,item:f}),!0!==g.isCancelled&&("file"===a.type&&(d="",/image/i.test(f.type)&&(d='<div style="padding: 3px;">    <img src="'+(f.content?"data:"+f.type+";base64,"+f.content:
"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>'),d+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td style="padding: 3px; text-align: right; color: #777;">'+w2utils.lang("Name")+':</td><td style="padding: 3px">'+
f.name+'</td></tr>    <tr><td style="padding: 3px; text-align: right; color: #777;">'+w2utils.lang("Size")+':</td><td style="padding: 3px">'+w2utils.formatSize(f.size)+'</td></tr>    <tr><td style="padding: 3px; text-align: right; color: #777;">'+w2utils.lang("Type")+':</td><td style="padding: 3px">        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+f.type+'</span>    </td></tr>    <tr><td style="padding: 3px; text-align: right; color: #777;">'+
w2utils.lang("Modified")+':</td><td style="padding: 3px">'+w2utils.date(f.modified)+"</td></tr>    </tbody></table></div>",b("#w2ui-overlay").remove(),b(e).w2overlay(d)),a.trigger(b.extend(g,{phase:"after"})))}).on("mouseover",function(d){var e="LI"===d.target.tagName.toUpperCase()?d.target:b(d.target).parents("LI");if(!b(e).hasClass("nomouse")){if("out"===b(e).data("mouse")){var f=c[b(d.target).attr("index")];d=a.trigger({phase:"before",type:"mouseOver",target:a.el,originalEvent:d.originalEvent,
item:f});if(!0===d.isCancelled)return;a.trigger(b.extend(d,{phase:"after"}))}b(e).data("mouse","over")}}).on("mouseout",function(d){var e="LI"===d.target.tagName.toUpperCase()?d.target:b(d.target).parents("LI");b(e).hasClass("nomouse")||(b(e).data("mouse","leaving"),setTimeout(function(){if("leaving"===b(e).data("mouse")){b(e).data("mouse","out");var f=c[b(d.target).attr("index")];f=a.trigger({phase:"before",type:"mouseOut",target:a.el,originalEvent:d.originalEvent,item:f});!0!==f.isCancelled&&a.trigger(b.extend(f,
{phase:"after"}))}},0))});b(this.el).height("auto");f=b(n).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(n,"+height");26>f&&(f=26);f>d.maxHeight&&(f=d.maxHeight);0<n.length&&(n[0].scrollTop=1E3);g=w2utils.getSize(b(this.el),"height")-2;g>f&&(f=g);b(n).css({height:f+"px",overflow:f==d.maxHeight?"auto":"hidden"});f<d.maxHeight&&b(n).prop("scrollTop",0);b(this.el).css({height:f+0+"px"});"enum"===a.type&&(f=a.helpers.multi.find("input"),f.width(8*(f.val().length+2)+"px"))}return(new Date).getTime()-
e},reset:function(){var a=this.type;this.clear();this.type=a;this.init()},resize:function(){var a=b(this.el).width(),d=b(this.el).height();if(!(this.tmp.current_width==a&&0<d)){var c=this.helpers.focus;d=this.helpers.multi;var e=this.helpers.suffix,f=this.helpers.prefix;c&&c.width(b(this.el).width());d&&(c=w2utils.getSize(this.el,"width")-parseInt(b(this.el).css("margin-left"),10)-parseInt(b(this.el).css("margin-right"),10),b(d).width(c));e&&(this.options.suffix='<div class="arrow-down" style="margin-top: '+
(parseInt(b(this.el).height())-6)/2+'px;"></div>',this.addSuffix());f&&this.addPrefix();this.tmp.current_width=a}},clean:function(a){if("number"===typeof a)return a;var d=this.options;a=String(a).trim();-1!==["int","float","money","currency","percent"].indexOf(this.type)&&("string"===typeof a&&(d.autoFormat&&-1!==["money","currency"].indexOf(this.type)&&(a=String(a).replace(d.moneyRE,"")),d.autoFormat&&"percent"===this.type&&(a=String(a).replace(d.percentRE,"")),d.autoFormat&&-1!==["int","float"].indexOf(this.type)&&
(a=String(a).replace(d.numberRE,"")),a=a.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(a)==a&&(null!=d.min&&a<d.min&&(a=d.min,b(this.el).val(d.min)),null!=d.max&&a>d.max&&(a=d.max,b(this.el).val(d.max))),a=""!==a&&w2utils.isFloat(a)?Number(a):"");return a},format:function(a){var b=this.options;if(b.autoFormat&&""!==a)switch(this.type){case "money":case "currency":a=w2utils.formatNumber(a,b.currencyPrecision,b.groupSymbol);""!==
a&&(a=b.currencyPrefix+a+b.currencySuffix);break;case "percent":a=w2utils.formatNumber(a,b.precision,b.groupSymbol);""!==a&&(a+="%");break;case "float":a=w2utils.formatNumber(a,b.precision,b.groupSymbol);break;case "int":a=w2utils.formatNumber(a,0,b.groupSymbol)}return a},change:function(a){var d=this,c=d.options;if(-1!==["int","float","money","currency","percent"].indexOf(this.type)){var e=b(this.el).val(),f=this.format(this.clean(b(this.el).val()));if(""!==e&&e!=f)return b(this.el).val(f).change(),
a.stopPropagation(),a.preventDefault(),!1}"color"===this.type&&(a=b(this.el).val(),"rgb"!==a.substr(0,3).toLowerCase()&&(a="#"+a,6!==b(this.el).val().length&&3!==b(this.el).val().length&&(a="")),b(this.el).next().find("div").css("background-color",a),b(this.el).is(":focus")&&!0!==b(this.el).data("skipInit")&&this.updateOverlay());-1!==["list","enum","file"].indexOf(this.type)&&(d.refresh(),setTimeout(function(){d.refresh()},5));-1!==["date","time","datetime"].indexOf(this.type)&&(a=parseInt(d.el.value),
w2utils.isInt(d.el.value)&&3E3<a&&("time"===this.type&&b(d.el).val(w2utils.formatTime(new Date(a),c.format)).change(),"date"===this.type&&b(d.el).val(w2utils.formatDate(new Date(a),c.format)).change(),"datetime"===this.type&&b(d.el).val(w2utils.formatDateTime(new Date(a),c.format)).change()))},click:function(a){a.stopPropagation();-1!==["list","combo","enum"].indexOf(this.type)&&(b(this.el).is(":focus")||this.focus(a));-1!==["date","time","color","datetime"].indexOf(this.type)&&this.updateOverlay()},
focus:function(a){var d=this;if(-1!==["color","date","time","datetime"].indexOf(d.type)){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();setTimeout(function(){d.updateOverlay()},150)}if(-1!==["list","combo","enum"].indexOf(d.type)){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();d.resize();setTimeout(function(){"list"===d.type&&b(d.el).is(":focus")?b(d.helpers.focus).find("input").focus():
(d.search(),setTimeout(function(){d.updateOverlay()},1))},1);"function"==typeof d.options._items_fun&&(d.options.items=w2obj.field.prototype.normMenu.call(this,d.options._items_fun))}"file"===d.type&&b(d.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(a){var d=this;a=d.options;var c=b(d.el).val().trim(),e=b("#w2ui-overlay");if(-1!=="color date time list combo enum datetime".split(" ").indexOf(d.type)){var f=window.setTimeout(function(){!0!==e.data("keepOpen")&&
e.hide()},0);b(".menu",e).one("focus",function(){clearTimeout(f);b(this).one("focusout",function(a){e.hide()})})}-1===["int","float","money","currency","percent"].indexOf(d.type)||""===c||d.checkType(c)||(b(d.el).val("").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid number"),setTimeout(function(){b(d.el).w2tag("")},3E3)));-1!==["date","time","datetime"].indexOf(d.type)&&(""===c||d.inRange(d.el.value)?"date"!==d.type||""===c||w2utils.isDate(d.el.value,a.format)?"time"!==d.type||""===c||w2utils.isTime(d.el.value)?
"datetime"!==d.type||""===c||w2utils.isDateTime(d.el.value,a.format)||(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid date"),setTimeout(function(){b(d.el).w2tag("")},3E3))):(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid time"),setTimeout(function(){b(d.el).w2tag("")},3E3))):(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid date"),setTimeout(function(){b(d.el).w2tag("")},
3E3))):(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not in range"),setTimeout(function(){b(d.el).w2tag("")},3E3))));"enum"===d.type&&b(d.helpers.multi).find("input").val("").width(20);"file"===d.type&&b(d.helpers.multi).css({outline:"none"})},keyPress:function(a){var b=this;if(-1!=="int float money currency percent hex bin color alphanumeric".split(" ").indexOf(b.type)){if(a.metaKey||a.ctrlKey||a.altKey||a.charCode!=a.keyCode&&0<a.keyCode)return;var c=String.fromCharCode(a.charCode);
if(!b.checkType(c,!0)&&13!=a.keyCode)return a.preventDefault(),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1}-1!==["date","time","datetime"].indexOf(b.type)&&9!==a.keyCode&&setTimeout(function(){b.updateOverlay()},1)},keyDown:function(a,d){var c=this,e=c.options;d=a.keyCode||d&&d.keyCode;var f=!1;if(-1!==["int","float","money","currency","percent"].indexOf(c.type)){if(!e.keyboard||b(c.el).prop("readonly")||b(c.el).prop("disabled"))return;var g=parseFloat(b(c.el).val().replace(e.moneyRE,
""))||0,h=e.step;if(a.ctrlKey||a.metaKey)h=10;switch(d){case 38:if(a.shiftKey)break;b(c.el).val(g+h<=e.max||null==e.max?Number((g+h).toFixed(12)):e.max).change();f=!0;break;case 40:a.shiftKey||(b(c.el).val(g-h>=e.min||null==e.min?Number((g-h).toFixed(12)):e.min).change(),f=!0)}f&&(a.preventDefault(),setTimeout(function(){c.el.setSelectionRange(c.el.value.length,c.el.value.length)},0))}if("date"===c.type){if(!e.keyboard||b(c.el).prop("readonly")||b(c.el).prop("disabled"))return;g=864E5;h=1;if(a.ctrlKey||
a.metaKey)h=10;var k=w2utils.isDate(b(c.el).val(),e.format,!0);k||(k=new Date,g=0);switch(d){case 38:if(a.shiftKey)break;f=w2utils.formatDate(k.getTime()+g,e.format);10==h&&(f=w2utils.formatDate(new Date(k.getFullYear(),k.getMonth()+1,k.getDate()),e.format));b(c.el).val(f).trigger("input").change();f=!0;break;case 40:a.shiftKey||(f=w2utils.formatDate(k.getTime()-g,e.format),10==h&&(f=w2utils.formatDate(new Date(k.getFullYear(),k.getMonth()-1,k.getDate()),e.format)),b(c.el).val(f).trigger("input").change(),
f=!0)}f&&(a.preventDefault(),setTimeout(function(){c.el.setSelectionRange(c.el.value.length,c.el.value.length);c.updateOverlay()},0))}if("time"===c.type){if(!e.keyboard||b(c.el).prop("readonly")||b(c.el).prop("disabled"))return;h=a.ctrlKey||a.metaKey?60:1;g=b(c.el).val();g=c.toMin(g)||c.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(d){case 38:if(a.shiftKey)break;g+=h;f=!0;break;case 40:a.shiftKey||(g-=h,f=!0)}f&&(b(c.el).val(c.fromMin(g)).trigger("input").change(),a.preventDefault(),
setTimeout(function(){c.el.setSelectionRange(c.el.value.length,c.el.value.length)},0))}if("datetime"===c.type){if(!e.keyboard||b(c.el).prop("readonly")||b(c.el).prop("disabled"))return;g=864E5;h=1;if(a.ctrlKey||a.metaKey)h=10;k=b(c.el).val();k=w2utils.isDateTime(k,this.options.format,!0);k||(k=new Date,g=0);switch(d){case 38:if(a.shiftKey)break;f=w2utils.formatDateTime(k.getTime()+g,e.format);10==h&&(f=w2utils.formatDateTime(new Date(k.getFullYear(),k.getMonth()+1,k.getDate()),e.format));b(c.el).val(f).trigger("input").change();
f=!0;break;case 40:a.shiftKey||(f=w2utils.formatDateTime(k.getTime()-g,e.format),10==h&&(f=w2utils.formatDateTime(new Date(k.getFullYear(),k.getMonth()-1,k.getDate()),e.format)),b(c.el).val(f).trigger("input").change(),f=!0)}f&&(a.preventDefault(),setTimeout(function(){c.el.setSelectionRange(c.el.value.length,c.el.value.length);c.updateOverlay()},0))}if("color"===c.type){if(b(c.el).prop("readonly")||b(c.el).prop("disabled"))return;if((a.ctrlKey||a.metaKey)&&!a.shiftKey){f=h=null;switch(d){case 38:h=
"up";break;case 40:h="down";break;case 39:h="right";break;case 37:h="left"}c.el.nav&&null!=h&&(f=c.el.nav(h),b(c.el).val(f).change(),a.preventDefault())}}if(-1!==["list","combo","enum"].indexOf(c.type)&&!b(c.el).prop("readonly")&&!b(c.el).prop("disabled")){h=b(c.el).data("selected");var n=b(c.el);f=!1;-1!==["list","enum"].indexOf(c.type)&&("list"===c.type&&(n=b(c.helpers.focus).find("input")),"enum"===c.type&&(n=b(c.helpers.multi).find("input")),-1==[37,38,39,40].indexOf(d)&&setTimeout(function(){c.refresh()},
1),86==a.keyCode&&(a.ctrlKey||a.metaKey)&&setTimeout(function(){c.refresh();c.search();c.request()},50));switch(d){case 27:"list"===c.type&&(""!==n.val()&&n.val(""),a.stopPropagation());break;case 13:if(0===b("#w2ui-overlay").length)break;d=e.items[e.index];if("enum"===c.type){if(null!=d){g=c.trigger({phase:"before",type:"add",target:c.el,originalEvent:a.originalEvent,item:d});if(!0===g.isCancelled)return;d=g.item;h.length>=e.max&&0<e.max&&h.pop();delete d.hidden;delete c.tmp.force_open;h.push(d);
b(c.el).change();n.val("").width(20);c.refresh()}else{d={id:n.val(),text:n.val()};g=c.trigger({phase:"before",type:"new",target:c.el,originalEvent:a.originalEvent,item:d});if(!0===g.isCancelled)return;d=g.item;"function"===typeof c.onNew&&(h.length>=e.max&&0<e.max&&h.pop(),delete c.tmp.force_open,h.push(d),b(c.el).change(),n.val("").width(20),c.refresh())}c.trigger(b.extend(g,{phase:"after"}))}else d&&b(c.el).data("selected",d).val(d.text).change(),""===b(c.el).val()&&b(c.el).data("selected")&&b(c.el).removeData("selected").val("").change(),
"list"===c.type&&(n.val(""),c.refresh()),c.tmp.force_hide=!0;break;case 8:case 46:if("enum"===c.type&&8===d&&""===n.val()&&0<h.length){d=h[h.length-1];g=c.trigger({phase:"before",type:"remove",target:c.el,originalEvent:a.originalEvent,item:d});if(!0===g.isCancelled)return;h.pop();b(c.el).trigger("input").trigger("change");c.refresh();c.trigger(b.extend(g,{phase:"after"}))}"list"===c.type&&""===n.val()&&(b(c.el).data("selected",{}).change(),c.refresh());break;case 38:e.index=w2utils.isInt(e.index)?
parseInt(e.index):0;for(e.index--;0<e.index&&e.items[e.index].hidden;)e.index--;if(0===e.index&&e.items[e.index].hidden)for(;e.items[e.index]&&e.items[e.index].hidden;)e.index++;f=!0;break;case 40:e.index=w2utils.isInt(e.index)?parseInt(e.index):-1;for(e.index++;e.index<e.items.length-1&&e.items[e.index].hidden;)e.index++;if(e.index==e.items.length-1&&e.items[e.index].hidden)for(;e.items[e.index]&&e.items[e.index].hidden;)e.index--;""===n.val()&&0===b("#w2ui-overlay").length?c.tmp.force_open=!0:f=
!0}f?(0>e.index&&(e.index=0),e.index>=e.items.length&&(e.index=e.items.length-1),c.updateOverlay(f),a.preventDefault(),setTimeout(function(){if("enum"===c.type){var a=n.get(0);a.setSelectionRange(a.value.length,a.value.length)}else"list"===c.type?(a=n.get(0),a.setSelectionRange(a.value.length,a.value.length)):c.el.setSelectionRange(c.el.value.length,c.el.value.length)},0)):"enum"===c.type&&n.width(8*(n.val().length+2)+"px")}},keyUp:function(a){if(-1!==["list","combo","enum"].indexOf(this.type)&&!b(this.el).prop("readonly")&&
!b(this.el).prop("disabled")&&-1==[16,17,18,20,37,39,91].indexOf(a.keyCode)){var d=b(this.helpers.focus).find("input");0===d.length&&(d=b(this.el));var c=this.trigger({phase:"before",type:"search",originalEvent:a,target:d,search:d.val()});!0!==c.isCancelled&&(this.tmp.force_hide||this.request(),1==d.val().length&&this.refresh(),0!==b("#w2ui-overlay").length&&-1!=[38,40].indexOf(a.keyCode)||this.search(),this.trigger(b.extend(c,{phase:"after"})))}},clearCache:function(){this.options.items=[];this.tmp.xhr_loading=
!1;this.tmp.xhr_search="";this.tmp.xhr_total=-1},request:function(a){var d=this,c=this.options,e=b(d.el).val()||"";if(c.url){if("enum"===d.type){var f=b(d.helpers.multi).find("input");e=0===f.length?"":f.val()}"list"===d.type&&(f=b(d.helpers.focus).find("input"),e=0===f.length?"":f.val());0!==c.minLength&&e.length<c.minLength?(c.items=[],this.updateOverlay()):(null==a&&(a=c.interval),null==d.tmp.xhr_search&&(d.tmp.xhr_search=""),null==d.tmp.xhr_total&&(d.tmp.xhr_total=-1),c.url&&(0===c.items.length&&
0!==d.tmp.xhr_total||d.tmp.xhr_total==c.cacheMax&&e.length>d.tmp.xhr_search.length||e.length>=d.tmp.xhr_search.length&&e.substr(0,d.tmp.xhr_search.length)!==d.tmp.xhr_search||e.length<d.tmp.xhr_search.length)&&(d.tmp.xhr&&d.tmp.xhr.abort(),d.tmp.xhr_loading=!0,d.search(),clearTimeout(d.tmp.timeout),d.tmp.timeout=setTimeout(function(){var a=c.url,f={search:e,max:c.cacheMax};b.extend(f,c.postData);var k=d.trigger({phase:"before",type:"request",search:e,target:d.el,url:a,postData:f});!0!==k.isCancelled&&
(a=k.url,f=k.postData,a={type:"GET",url:a,data:f,dataType:"JSON"},c.method&&(a.type=c.method),"JSON"===w2utils.settings.dataType&&(a.type="POST",a.data=JSON.stringify(a.data),a.contentType="application/json"),"HTTPJSON"===w2utils.settings.dataType&&(a.data={request:JSON.stringify(a.data)}),null!=c.method&&(a.type=c.method),d.tmp.xhr=b.ajax(a).done(function(a,g,h){g=d.trigger({phase:"before",type:"load",target:d.el,search:f.search,data:a,xhr:h});if(!0!==g.isCancelled)if(a=g.data,"string"===typeof a&&
(a=JSON.parse(a)),null==a.records&&null!=a.items&&(a.records=a.items,delete a.items),"success"===a.status&&null==a.records&&(a.records=[]),"success"===a.status&&Array.isArray(a.records)){a.records.length>c.cacheMax&&a.records.splice(c.cacheMax,1E5);null==c.recId&&null!=c.recid&&(c.recId=c.recid);(c.recId||c.recText)&&a.records.forEach(function(a){"string"===typeof c.recId&&(a.id=a[c.recId]);"function"===typeof c.recId&&(a.id=c.recId(a));"string"===typeof c.recText&&(a.text=a[c.recText]);"function"===
typeof c.recText&&(a.text=c.recText(a))});d.tmp.xhr_loading=!1;d.tmp.xhr_search=e;d.tmp.xhr_total=a.records.length;d.tmp.lastError="";c.items=d.normMenu(a.records);d.tmp.emptySet=""===e&&0===a.records.length?!0:!1;var k=b(d.el).data("find_selected");if(k){if(Array.isArray(k)){var m=[];k.forEach(function(a){c.items.forEach(function(c){c.id==a&&m.push(b.extend(!0,{},c))})})}else c.items.forEach(function(a){a.id==k&&(m=a)});b(d.el).data("selected",m).removeData("find_selected").change()}d.search();d.trigger(b.extend(g,
{phase:"after"}))}else console.log("ERROR: server did not return proper structure. It should return",{status:"success",records:[{id:1,text:"item"}]})}).fail(function(a,f,g){g=d.trigger({phase:"before",type:"error",target:d.el,search:e,error:{status:f,error:g,rawResponseText:a.responseText},xhr:a});if(!0!==g.isCancelled){if("abort"!==f){try{var h=b.parseJSON(a.responseText)}catch(r){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",records:[{id:1,text:"item"}]},
"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"===typeof h?h:a.responseText)}d.tmp.xhr_loading=!1;d.tmp.xhr_search=e;d.tmp.xhr_total=0;d.tmp.emptySet=!0;d.tmp.lastError=g.error||"Server communication failed";c.items=[];d.clearCache();d.search();d.updateOverlay(!1);d.trigger(b.extend(g,{phase:"after"}))}}),d.trigger(b.extend(k,{phase:"after"})))},a)))}},search:function(){var a=this.options,d=b(this.el).val(),c=this.el,e=[],f=b(this.el).data("selected");if("enum"===
this.type){c=b(this.helpers.multi).find("input");d=c.val();for(var g in f)f[g]&&e.push(f[g].id)}else if("list"===this.type)for(g in c=b(this.helpers.focus).find("input"),d=c.val(),f)f[g]&&e.push(f[g].id);c=a.items;if(!0!==this.tmp.xhr_loading){for(g=f=0;g<c.length;g++){var h=c[g];if(null!=a.compare)"function"===typeof a.compare&&(h.hidden=!1===a.compare.call(this,h,d)?!0:!1);else{var k="",n="";-1!==["is","begins"].indexOf(a.match)&&(k="^");-1!==["is","ends"].indexOf(a.match)&&(n="$");try{(new RegExp(k+
d+n,"i")).test(h.text)||"..."===h.text?h.hidden=!1:h.hidden=!0}catch(m){}}!1===a.filter&&(h.hidden=!1);"enum"===this.type&&-1!==b.inArray(h.id,e)&&(h.hidden=!0);!0!==h.hidden&&(f++,delete h.hidden)}for(a.index=-1;c[a.index]&&c[a.index].hidden;)a.index++;0>=f&&(a.index=-1);a.spinner=!1;this.updateOverlay();setTimeout(function(){var c=b("#w2ui-overlay").html()||"";a.markSearch&&-1!==c.indexOf("$.fn.w2menuHandler")&&b("#w2ui-overlay").w2marker(d)},1)}else c.splice(0,a.cacheMax),a.spinner=!0,this.updateOverlay()},
updateOverlay:function(a){var d=this,c=this.options;if("color"===this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;b(this.el).w2color({color:b(this.el).val(),transparent:c.transparent,advanced:c.advanced},function(a){null!=a&&b(d.el).val(a).trigger("input").change()})}if("date"===this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0===b("#w2ui-overlay").length&&b(d.el).w2overlay('<div class="w2ui-reset w2ui-calendar"></div>',{css:{"background-color":"#f5f5f5"},
onShow:function(a){w2utils.isIE&&(console.log("IE"),b(".w2ui-calendar").on("mousedown",function(a){a=b(a.target);1===a.length&&"w2ui-jump-year"===a[0].id&&b("#w2ui-overlay").data("keepOpen",!0)}))}});var e=w2utils.isDate(b(d.el).val(),d.options.format,!0);if(e){var f=e.getMonth()+1;var g=e.getFullYear()}(function r(a,c){b("#w2ui-overlay > div > div").html(d.getMonthHTML(a,c,b(d.el).val()));b("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(b(this).next().hasClass("w2ui-calendar-jump"))b(this).next().remove();
else{var a,c;b(this).after('<div class="w2ui-calendar-jump" style=""></div>');b(this).next().hide().html(d.getYearHTML()).fadeIn(200);setTimeout(function(){b("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){b(this).hasClass("w2ui-jump-month")&&(b(this).parent().find(".w2ui-jump-month").removeClass("selected"),b(this).addClass("selected"),c=b(this).attr("name"));b(this).hasClass("w2ui-jump-year")&&(b(this).parent().find(".w2ui-jump-year").removeClass("selected"),
b(this).addClass("selected"),a=b(this).attr("name"));null!=a&&null!=c&&(b("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){r(parseInt(c)+1,a)},100))});b("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2E3)},1)}});b("#w2ui-overlay .w2ui-date").on("mousedown",function(){var a=b(this).attr("date");b(d.el).val(a).trigger("input").change();b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&
b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)});b("#w2ui-overlay .previous").on("mousedown",function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])-1;r(a[0],a[1])});b("#w2ui-overlay .next").on("mousedown",function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])+1;r(a[0],a[1])})})(f,g)}if("time"===this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0===b("#w2ui-overlay").length&&b(d.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',
{css:{"background-color":"#fff"}});var h="h24"===this.options.format;b("#w2ui-overlay > div").html(d.getHourHTML());b("#w2ui-overlay .w2ui-time").on("mousedown",function(a){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});a=b(this).attr("hour");b(d.el).val((12<a&&!h?a-12:a)+":00"+(h?"":12>a?" am":" pm")).trigger("input").change()});if(null==this.options.noMinutes||!1===this.options.noMinutes)b("#w2ui-overlay .w2ui-time").on("mouseup",function(){var a=b(this).attr("hour");0<b("#w2ui-overlay").length&&
b("#w2ui-overlay")[0].hide();b(d.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});b("#w2ui-overlay > div").html(d.getMinHTML(a));b("#w2ui-overlay .w2ui-time").on("mousedown",function(){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var c=b(this).attr("min");b(d.el).val((12<a&&!h?a-12:a)+":"+(10>c?0:"")+c+(h?"":12>a?" am":" pm")).trigger("input").change()}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&
b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})});else b("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"===this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0<b("#w2ui-overlay .w2ui-time").length&&b("#w2ui-overlay")[0].hide();0===b("#w2ui-overlay").length&&b(d.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',
{css:{"background-color":"#f5f5f5"},onShow:function(a){w2utils.isIE&&(console.log("IE"),b(".w2ui-calendar").on("mousedown",function(a){a=b(a.target);1===a.length&&"w2ui-jump-year"===a[0].id&&b("#w2ui-overlay").data("keepOpen",!0)}))}});if(e=w2utils.isDateTime(b(d.el).val(),d.options.format,!0))f=e.getMonth()+1,g=e.getFullYear();var k=null;(function r(a,e){b("#w2ui-overlay > div > div").html(d.getMonthHTML(a,e,b(d.el).val())+(c.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+
"</div>":""));b("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(b(this).next().hasClass("w2ui-calendar-jump"))b(this).next().remove();else{var a,c;b(this).after('<div class="w2ui-calendar-jump" style=""></div>');b(this).next().hide().html(d.getYearHTML()).fadeIn(200);setTimeout(function(){b("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){b(this).hasClass("w2ui-jump-month")&&(b(this).parent().find(".w2ui-jump-month").removeClass("selected"),
b(this).addClass("selected"),c=b(this).attr("name"));b(this).hasClass("w2ui-jump-year")&&(b(this).parent().find(".w2ui-jump-year").removeClass("selected"),b(this).addClass("selected"),a=b(this).attr("name"));null!=a&&null!=c&&(b("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){r(parseInt(c)+1,a)},100))});b("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2E3)},1)}});b("#w2ui-overlay .w2ui-date").on("mousedown",function(){var a=b(this).attr("date");b(d.el).val(a).trigger("input").change();
b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});k=new Date(b(this).attr("data-date"))}).on("mouseup",function(){var a,c;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();b(d.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});b("#w2ui-overlay > div").html(d.getHourHTML());b("#w2ui-overlay .w2ui-time").on("mousedown",function(c){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});a=b(this).attr("hour");k.setHours(a);
c=w2utils.formatDateTime(k,d.options.format);b(d.el).val(c).trigger("input").change()});if(null==d.options.noMinutes||!1===d.options.noMinutes)b("#w2ui-overlay .w2ui-time").on("mouseup",function(){var e=b(this).attr("hour");0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();b(d.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});b("#w2ui-overlay > div").html(d.getMinHTML(e));b("#w2ui-overlay .w2ui-time").on("mousedown",function(){b(this).css({"background-color":"#B6D5FB",
"border-color":"#aaa"});c=b(this).attr("min");k.setHours(a,c);var e=w2utils.formatDateTime(k,d.options.format);b(d.el).val(e).trigger("input").change()}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})});else b("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})});b("#w2ui-overlay .previous").on("mousedown",
function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])-1;r(a[0],a[1])});b("#w2ui-overlay .next").on("mousedown",function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])+1;r(a[0],a[1])});b("#w2ui-overlay .now").on("mousedown",function(){var a=w2utils.formatDateTime(new Date,d.options.format);b(d.el).val(a).trigger("input").change();return!1}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})})(f,
g)}if(-1!==["list","combo","enum"].indexOf(this.type)){g=f=this.el;"enum"===this.type&&(f=b(this.helpers.multi),g=b(f).find("input"));if("list"===this.type){var n=b(g).data("selected");b.isPlainObject(n)&&!b.isEmptyObject(n)&&-1==c.index&&c.items.forEach(function(a,b){a.id===n.id&&(c.index=b)});g=b(this.helpers.focus).find("input")}b(g).is(":focus")&&(!1===c.openOnFocus&&""===b(g).val()&&!0!==d.tmp.force_open?b().w2overlay():d.tmp.force_hide?(b().w2overlay(),setTimeout(function(){delete d.tmp.force_hide},
1)):(""!==b(g).val()&&delete d.tmp.force_open,e=w2utils.lang("No matches"),null!=c.url&&b(g).val().length<c.minLength&&!0!==d.tmp.emptySet&&(e=c.minLength+" "+w2utils.lang("letters or more...")),null!=c.url&&""===b(g).val()&&!0!==d.tmp.emptySet&&(e=w2utils.lang(c.msgSearch||"Type to search...")),null==c.url&&0===c.items.length&&(e=w2utils.lang("Empty list")),null!=c.msgNoItems&&(e="function"===typeof e?e(c):c.msgNoItems),d.tmp.lastError&&(e=d.tmp.lastError),g=b.extend(!0,{},c,{search:!1,render:c.renderDrop,
maxHeight:c.maxDropHeight,maxWidth:c.maxDropWidth,msgNoItems:'<div style="white-space: normal; line-height: 1.3">'+e+"</div>",onSelect:function(a){if("enum"===d.type){var e=b(d.el).data("selected");if(a.item){var f=d.trigger({phase:"before",type:"add",target:d.el,originalEvent:a.originalEvent,item:a.item});!0!==f.isCancelled&&(e.length>=c.max&&0<c.max&&e.pop(),delete a.item.hidden,e.push(a.item),b(d.el).data("selected",e).trigger("input").change(),b(d.helpers.multi).find("input").val("").width(20),
d.refresh(),0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),d.trigger(b.extend(f,{phase:"after"})))}}else b(d.el).data("selected",a.item).val(a.item.text).trigger("input").change(),d.helpers.focus&&d.helpers.focus.find("input").val("")}}),b(f).w2menu(a?"refresh-index":"refresh",g)))}},inRange:function(a,d){var c=!1;if("date"===this.type){var e=w2utils.isDate(a,this.options.format,!0);if(e){if(this.options.start||this.options.end){var f="string"===typeof this.options.start?this.options.start:
b(this.options.start).val(),g="string"===typeof this.options.end?this.options.end:b(this.options.end).val();f=w2utils.isDate(f,this.options.format,!0);g=w2utils.isDate(g,this.options.format,!0);var h=new Date(e);f||(f=h);g||(g=h);h>=f&&h<=g&&(c=!0)}else c=!0;this.options.blocked&&-1!==b.inArray(a,this.options.blocked)&&(c=!1);if(null!==this.options.blockWeekDays&&void 0!==this.options.blockWeekDays&&void 0!=this.options.blockWeekDays.length)for(d=this.options.blockWeekDays.length,a=0;a<d;a++)e.getDay()==
this.options.blockWeekDays[a]&&(c=!1)}}else if("time"===this.type)this.options.start||this.options.end?(e=this.toMin(a),a=this.toMin(this.options.start),d=this.toMin(this.options.end),a||(a=e),d||(d=e),e>=a&&e<=d&&(c=!0)):c=!0;else if("datetime"===this.type&&(e=w2utils.isDateTime(a,this.options.format,!0))&&(this.options.start||this.options.end?("object"===typeof this.options.start&&this.options.start instanceof Date?f=this.options.start:(f="string"===typeof this.options.start?this.options.start:
b(this.options.start).val(),f=""!==f.trim()?w2utils.isDateTime(f,this.options.format,!0):""),"object"===typeof this.options.end&&this.options.end instanceof Date?g=this.options.end:(g="string"===typeof this.options.end?this.options.end:b(this.options.end).val(),g=""!==g.trim()?w2utils.isDateTime(g,this.options.format,!0):""),h=e,f||(f=h),g||(g=h),d&&f instanceof Date&&(f.setHours(0),f.setMinutes(0),f.setSeconds(0)),h>=f&&h<=g&&(c=!0)):c=!0,c&&this.options.blocked))for(a=0;a<this.options.blocked.length;a++)if(d=
this.options.blocked[a],"string"===typeof d&&(d=w2utils.isDateTime(d,this.options.format,!0)),"object"===typeof d&&d instanceof Date&&d.getFullYear()==e.getFullYear()&&d.getMonth()==e.getMonth()&&d.getDate()==e.getDate()){c=!1;break}return c},checkType:function(a,b){switch(this.type){case "int":if(b&&-1!==["-",this.options.groupSymbol].indexOf(a))break;return w2utils.isInt(a.replace(this.options.numberRE,""));case "percent":a=a.replace(/%/g,"");case "float":if(b&&-1!==["-",w2utils.settings.decimalSymbol,
this.options.groupSymbol].indexOf(a))break;return w2utils.isFloat(a.replace(this.options.numberRE,""));case "money":case "currency":if(b&&-1!==["-",this.options.decimalSymbol,this.options.groupSymbol,this.options.currencyPrefix,this.options.currencySuffix].indexOf(a))break;return w2utils.isFloat(a.replace(this.options.moneyRE,""));case "bin":return w2utils.isBin(a);case "hex":return w2utils.isHex(a);case "alphanumeric":return w2utils.isAlphaNumeric(a)}return!0},addPrefix:function(){var a=this;setTimeout(function(){if("clear"!==
a.type){var d=b(a.el).data("tmp")||{};d["old-padding-left"]&&b(a.el).css("padding-left",d["old-padding-left"]);d["old-padding-left"]=b(a.el).css("padding-left");b(a.el).data("tmp",d);a.helpers.prefix&&b(a.helpers.prefix).remove();""!==a.options.prefix&&(b(a.el).before('<div class="w2ui-field-helper">'+a.options.prefix+"</div>"),d=b(a.el).prev(),d.css({color:b(a.el).css("color"),"font-family":b(a.el).css("font-family"),"font-size":b(a.el).css("font-size"),"padding-top":b(a.el).css("padding-top"),"padding-bottom":b(a.el).css("padding-bottom"),
"padding-left":b(a.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(b(a.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(b(a.el).css("margin-bottom"),10)+1+"px","margin-left":b(a.el).css("margin-left"),"margin-right":0}).on("click",function(c){a.options.icon&&"function"===typeof a.onIconClick?(c=a.trigger({phase:"before",type:"iconClick",target:a.el,el:b(this).find("span.w2ui-icon")[0]}),!0!==c.isCancelled&&a.trigger(b.extend(c,{phase:"after"}))):"list"===a.type?b(a.helpers.focus).find("input").focus():
b(a.el).focus()}),b(a.el).css("padding-left",d.width()+parseInt(b(a.el).css("padding-left"),10)+"px"),a.helpers.prefix=d)}},1)},addSuffix:function(){var a=this,d,c;setTimeout(function(){if("clear"!==a.type){var e=b(a.el).data("tmp")||{};e["old-padding-right"]&&b(a.el).css("padding-right",e["old-padding-right"]);e["old-padding-right"]=b(a.el).css("padding-right");b(a.el).data("tmp",e);c=parseInt(b(a.el).css("padding-right"),10);a.options.arrows&&(a.helpers.arrows&&b(a.helpers.arrows).remove(),b(a.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>'),
d=b(a.el).next(),d.css({color:b(a.el).css("color"),"font-family":b(a.el).css("font-family"),"font-size":b(a.el).css("font-size"),height:b(a.el).height()+parseInt(b(a.el).css("padding-top"),10)+parseInt(b(a.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(b(a.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(d.width()+parseInt(b(a.el).css("margin-right"),10)+12)+"px").on("mousedown",function(c){function d(){clearTimeout(f.data("_field_update_timer"));
f.off("mouseup",d)}function e(d){b(a.el).focus();a.keyDown(b.Event("keydown"),{keyCode:"up"===b(c.target).attr("type")?38:40});!1!==d&&b("body").data("_field_update_timer",setTimeout(e,60))}var f=b("body");f.on("mouseup",d);f.data("_field_update_timer",setTimeout(e,700));e(!1)}),c+=d.width()+12,b(a.el).css("padding-right",c+"px"),a.helpers.arrows=d);""!==a.options.suffix&&(a.helpers.suffix&&b(a.helpers.suffix).remove(),b(a.el).after('<div class="w2ui-field-helper">'+a.options.suffix+"</div>"),d=b(a.el).next(),
d.css({color:b(a.el).css("color"),"font-family":b(a.el).css("font-family"),"font-size":b(a.el).css("font-size"),"padding-top":b(a.el).css("padding-top"),"padding-bottom":b(a.el).css("padding-bottom"),"padding-left":"3px","padding-right":b(a.el).css("padding-right"),"margin-top":parseInt(b(a.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(b(a.el).css("margin-bottom"),10)+1+"px"}).on("click",function(c){"list"===a.type?b(a.helpers.focus).find("input").focus():b(a.el).focus()}),d.css("margin-left",
"-"+(w2utils.getSize(d,"width")+parseInt(b(a.el).css("margin-right"),10)+2)+"px"),c+=d.width()+3,b(a.el).css("padding-right",c+"px"),a.helpers.suffix=d)}},1)},addFocus:function(){var a=this,d;b(a.helpers.focus).remove();var c=parseInt(b(a.el).attr("tabIndex"));isNaN(c)||-1===c||(a.el._tabIndex=c);a.el._tabIndex&&(c=a.el._tabIndex);null==c&&(c=-1);isNaN(c)&&(c=0);var e="";null!=b(a.el).attr("id")&&(e='id="'+b(a.el).attr("id")+'_search"');c='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search" style="opacity: 0; display: none"></div>    <input '+
e+' type="text" tabIndex="'+c+'" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"/></div>';b(a.el).attr("tabindex",-1).before(c);c=b(a.el).prev();a.helpers.focus=c;c.css({width:b(a.el).width(),"margin-top":b(a.el).css("margin-top"),"margin-left":parseInt(b(a.el).css("margin-left"))+parseInt(b(a.el).css("padding-left"))+"px","margin-bottom":b(a.el).css("margin-bottom"),"margin-right":b(a.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",
opacity:1,margin:0,border:"1px solid transparent",padding:b(a.el).css("padding-top"),"padding-left":0,"margin-left":0,"background-color":"transparent"});c.find("input").on("click",function(c){0===b("#w2ui-overlay").length&&a.focus(c);c.stopPropagation()}).on("focus",function(c){d=b(a.el).attr("placeholder");b(a.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"});b(this).val("");b(a.el).triggerHandler("focus");c.stopPropagation?c.stopPropagation():c.cancelBubble=!0}).on("blur",function(c){b(a.el).css("outline",
"none");b(this).val("");a.refresh();b(a.el).triggerHandler("blur");c.stopPropagation?c.stopPropagation():c.cancelBubble=!0;null!=d&&b(a.el).attr("placeholder",d)}).on("keydown",function(c){var e=this;a.keyDown(c);setTimeout(function(){""===e.value?b(a.el).attr("placeholder",d):b(a.el).attr("placeholder","")},10)}).on("keyup",function(b){a.keyUp(b)}).on("keypress",function(b){a.keyPress(b)});c.on("click",function(a){b(this).find("input").focus()});a.refresh()},addMulti:function(){var a=this;b(a.helpers.multi).remove();
var d="",c="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+b(a.el).css("margin-left")+"; margin-right   : "+b(a.el).css("margin-right")+"; width          : "+(w2utils.getSize(a.el,"width")-parseInt(b(a.el).css("margin-left"),10)-parseInt(b(a.el).css("margin-right"),10))+"px;",e="";null!=b(a.el).attr("id")&&(e='id="'+b(a.el).attr("id")+'_search" ');"enum"===a.type&&((d=b(a.el).attr("tabIndex"))&&-1!==d&&(a.el._tabIndex=d),a.el._tabIndex&&(d=a.el._tabIndex),null==d&&(d=-1),d='<div class="w2ui-field-helper w2ui-list" style="'+
c+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input '+e+' type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocapitalize="off" autocomplete="off" autocorrect="off" spellcheck="false"'+(b(a.el).prop("readonly")?' readonly="readonly"':"")+(b(a.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+
d+'"/>        </li>    </ul>    </div></div>');"file"===a.type&&(d='<div class="w2ui-field-helper w2ui-list" style="'+c+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input '+e+' name="attachment" class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" tabindex="-1"'+(1!==a.options.max?' multiple="multiple"':"")+(b(a.el).prop("readonly")?' readonly="readonly"':"")+(b(a.el).prop("disabled")?' disabled="disabled"':
"")+(b(a.el).attr("accept")?' accept="'+b(a.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');c=b(a.el).data("tmp")||{};c["old-background-color"]=b(a.el).css("background-color");c["old-border-color"]=b(a.el).css("border-color");b(a.el).data("tmp",c);b(a.el).before(d).css({"background-color":"transparent",
"border-color":"transparent"});var f=b(a.el).prev();a.helpers.multi=f;"enum"===a.type&&(b(a.el).attr("tabindex",-1),f.find("input").on("click",function(c){0===b("#w2ui-overlay").length&&a.focus(c);b(a.el).triggerHandler("click")}).on("focus",function(c){b(f).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"});b(a.el).triggerHandler("focus");c.stopPropagation?c.stopPropagation():c.cancelBubble=!0}).on("blur",function(c){b(f).css("outline","none");b(a.el).triggerHandler("blur");c.stopPropagation?
c.stopPropagation():c.cancelBubble=!0}).on("keyup",function(b){a.keyUp(b)}).on("keydown",function(b){a.keyDown(b)}).on("keypress",function(b){a.keyPress(b)}),f.on("click",function(a){b(this).find("input").focus()}));"file"===a.type&&(b(a.el).css("outline","none"),f.on("click",function(c){b(a.el).focus();b(a.el).prop("readonly")||b(a.el).prop("disabled")||(a.blur(c),a.resize(),setTimeout(function(){f.find("input").click()},10))}).on("dragenter",function(c){b(a.el).prop("readonly")||b(a.el).prop("disabled")||
b(f).addClass("w2ui-file-dragover")}).on("dragleave",function(c){b(a.el).prop("readonly")||b(a.el).prop("disabled")||0===b(c.target).parents(".w2ui-field-helper").length&&b(f).removeClass("w2ui-file-dragover")}).on("drop",function(c){if(!b(a.el).prop("readonly")&&!b(a.el).prop("disabled")){b(f).removeClass("w2ui-file-dragover");for(var d=c.originalEvent.dataTransfer.files,e=0,g=d.length;e<g;e++)a.addFile.call(a,d[e]);c.preventDefault();c.stopPropagation()}}).on("dragover",function(a){a.preventDefault();
a.stopPropagation()}),f.find("input").on("click",function(a){a.stopPropagation()}).on("change",function(){if("undefined"!==typeof this.files)for(var b=0,c=this.files.length;b<c;b++)a.addFile.call(a,this.files[b])}));a.refresh()},addFile:function(a){var d=this,c=this.options,e=b(d.el).data("selected"),f={name:a.name,type:a.type,modified:a.lastModifiedDate,size:a.size,content:null,file:a},g=0,h=0;if(e)for(var k=0;k<e.length;k++){if(e[k].name==a.name&&e[k].size==a.size)return;g+=e[k].size;h++}var n=
d.trigger({phase:"before",type:"add",target:d.el,file:f,total:h,totalSize:g});!0!==n.isCancelled&&(0!==c.maxFileSize&&f.size>c.maxFileSize?(a="Maximum file size is "+w2utils.formatSize(c.maxFileSize),!1===c.silent&&b(d.el).w2tag(a),console.log("ERROR: "+a)):0!==c.maxSize&&g+f.size>c.maxSize?(a=w2utils.lang("Maximum total size is")+" "+w2utils.formatSize(c.maxSize),!1===c.silent?b(d.el).w2tag(a):console.log("ERROR: "+a)):0!==c.max&&h>=c.max?(a=w2utils.lang("Maximum number of files is")+" "+c.max,!1===
c.silent?b(d.el).w2tag(a):console.log("ERROR: "+a)):(e.push(f),"undefined"!==typeof FileReader&&!0===c.readContent?(c=new FileReader,c.onload=function(){return function(a){a=a.target.result;var c=a.indexOf(",");f.content=a.substr(c+1);d.refresh();b(d.el).trigger("input").trigger("change");d.trigger(b.extend(n,{phase:"after"}))}}(),c.readAsDataURL(a)):(d.refresh(),b(d.el).trigger("input").trigger("change"),d.trigger(b.extend(n,{phase:"after"})))))},normMenu:function(a,d){if(b.isArray(a)){for(var c=
0;c<a.length;c++)"string"===typeof a[c]?a[c]={id:a[c],text:a[c]}:null!=a[c]?(null!=a[c].text&&null==a[c].id&&(a[c].id=a[c].text),null==a[c].text&&null!=a[c].id&&(a[c].text=a[c].id),null!=a[c].caption&&(a[c].text=a[c].caption)):a[c]={id:null,text:"null"};return a}if("function"===typeof a)return w2obj.field.prototype.normMenu.call(this,a.call(this,d));if("object"===typeof a){d=[];for(c in a)d.push({id:c,text:a[c]});return d}},getMonthHTML:function(a,b,c){var d=new Date,f=w2utils.settings.fullmonths,
g="31 28 31 30 31 30 31 31 30 31 30 31".split(" "),h=d.getDate()+"/"+(Number(d.getMonth())+1)+"/"+d.getFullYear(),k=w2utils.settings.fulldays.slice(),n=w2utils.settings.shortdays.slice();"M"!==w2utils.settings.weekStarts&&(k.unshift(k.pop()),n.unshift(n.pop()));var l=this.options;null==l&&(l={});b=w2utils.isInt(b)?parseInt(b):d.getFullYear();a=w2utils.isInt(a)?parseInt(a):d.getMonth()+1;12<a&&(a-=12,b++);if(1>a||0===a)a+=12,b--;g[1]=b/4==Math.floor(b/4)?"29":"28";l.current=a+"/"+b;d=new Date(b,a-
1,1);d=d.getDay();for(var p="",v=0;v<n.length;v++)p+='<td title="'+k[v]+'">'+n[v]+"</td>";f='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+f[a-1]+", "+b+'</div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+p+"</tr>    <tr>";k=1;"M"!==w2utils.settings.weekStarts&&d++;"datetime"===this.type&&(c=w2utils.isDateTime(c,l.format,!0),c=w2utils.formatDate(c,
w2utils.settings.dateFormat));for(n=1;43>n;n++){if(0===d&&1==n){for(p=0;6>p;p++)f+='<td class="w2ui-day-empty">&#160;</td>';n+=6}else if(n<d||k>g[a-1]){f+='<td class="w2ui-day-empty">&#160;</td>';0===n%7&&(f+="</tr><tr>");continue}var r=k+"/"+a+"/"+b;p=new Date(r);v="";6===p.getDay()&&(v=" w2ui-saturday");0===p.getDay()&&(v=" w2ui-sunday");r==h&&(v+=" w2ui-today");var t=k,x="",w="";if("datetime"===this.type){var u=w2utils.formatDateTime(r,l.format);r=w2utils.formatDate(r,w2utils.settings.dateFormat)}else r=
u=w2utils.formatDate(r,l.format);l.colored&&void 0!==l.colored[r]&&(x=l.colored[r].split(":"),w="background-color: "+x[0]+";",x="color: "+x[1]+";");f+='<td class="'+(this.inRange(u,!0)?"w2ui-date "+(r==c?"w2ui-date-selected":""):"w2ui-blocked")+v+'"    style="'+x+w+'" date="'+u+'" data-date="'+p+'">'+t+"</td>";if(0===n%7||0===d&&1==n)f+="</tr><tr>";k++}return f+"</tr></tbody></table>"},getYearHTML:function(){for(var a=w2utils.settings.shortmonths,b=w2utils.settings.dateStartYear,c=w2utils.settings.dateEndYear,
e="",f="",g=0;g<a.length;g++)e+='<div class="w2ui-jump-month" name="'+g+'">'+a[g]+"</div>";for(a=b;a<=c;a++)f+='<div class="w2ui-jump-year" name="'+a+'">'+a+"</div>";return'<div id="w2ui-jump-month">'+e+'</div><div id="w2ui-jump-year">'+f+"</div>"},getHourHTML:function(){var a=[],b=this.options;null==b&&(b={format:w2utils.settings.timeFormat});for(var c=-1<b.format.indexOf("h24"),e=0;24>e;e++){var f=(12<=e&&!c?e-12:e)+":00"+(c?"":12>e?" am":" pm");12!=e||c||(f="12:00 pm");a[Math.floor(e/8)]||(a[Math.floor(e/
8)]="");var g=this.fromMin(this.toMin(f)),h=this.fromMin(this.toMin(f)+59);if("datetime"===this.type){var k=w2utils.isDateTime(this.el.value,b.format,!0),l=b.format.split("|")[0].trim();g=w2utils.formatDate(k,l)+" "+g;h=w2utils.formatDate(k,l)+" "+h}a[Math.floor(e/8)]+='<div class="'+(this.inRange(g)||this.inRange(h)?"w2ui-time ":"w2ui-blocked")+'" hour="'+e+'">'+f+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+
a[0]+"</td>       <td>"+a[1]+"</td>       <td>"+a[2]+"</td>   </tr></tbody></table></div></div>"},getMinHTML:function(a){null==a&&(a=0);var b=this.options;null==b&&(b={format:w2utils.settings.timeFormat});for(var c=-1<b.format.indexOf("h24"),e=[],f=0;60>f;f+=5){var g=(12<a&&!c?a-12:a)+":"+(10>f?0:"")+f+" "+(c?"":12>a?"am":"pm"),h=g,k=20>f?0:40>f?1:2;e[k]||(e[k]="");if("datetime"===this.type){var l=w2utils.isDateTime(this.el.value,b.format,!0),m=b.format.split("|")[0].trim();h=w2utils.formatDate(l,
m)+" "+h}e[k]+='<div class="'+(this.inRange(h)?"w2ui-time ":"w2ui-blocked")+'" min="'+f+'">'+g+"</div>"}return'<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+e[0]+"</td>       <td>"+e[1]+"</td>       <td>"+e[2]+"</td>   </tr></tbody></table></div></div>"},toMin:function(a){if("string"!==typeof a)return null;var b=a.split(":");if(2===b.length)b[0]=parseInt(b[0]),b[1]=parseInt(b[1]),
-1!==a.indexOf("pm")&&12!==b[0]&&(b[0]+=12);else return null;return 60*b[0]+b[1]},fromMin:function(a){1440<=a&&(a%=1440);0>a&&(a=1440+a);var b=Math.floor(a/60);a=(10>a%60?"0":"")+a%60;var c=this.options;null==c&&(c={format:w2utils.settings.timeFormat});return-1!==c.format.indexOf("h24")?b+":"+a:(12>=b?b:b-12)+":"+a+" "+(12<=b?"pm":"am")}};b.extend(l.prototype,w2utils.event);w2obj.field=l})(jQuery);
(function(b){var l=function(a){this.name=null;this.header="";this.box=null;this.url="";this.routeData={};this.formHTML=this.formURL="";this.recid=this.page=0;this.fields=[];this.actions={};this.record={};this.original=null;this.postData={};this.httpHeaders={};this.method=null;this.toolbar={};this.tabs={};this.style="";this.focus=0;this.nestedFields=this.autosize=!0;this.multipart=!1;this.tabindexBase=0;this.isGenerated=!1;this.last={xhr:null,errors:[]};b.extend(!0,this,w2obj.form,a)};b.fn.w2form=
function(a){if(b.isPlainObject(a)){var d=this;if(w2utils.checkName(a,"w2form")){var c=a.record,e=a.original,f=a.fields,g=a.toolbar,h=a.tabs,k=new l(a);b.extend(k,{record:{},original:null,fields:[],tabs:{},toolbar:{},handlers:[]});if(b.isArray(h)){b.extend(!0,k.tabs,{tabs:[]});for(var n=0;n<h.length;n++){var m=h[n];"object"===typeof m?(k.tabs.tabs.push(m),!0===m.active&&(k.tabs.active=m.id)):k.tabs.tabs.push({id:m,text:m})}}else b.extend(!0,k.tabs,h);b.extend(!0,k.toolbar,g);if(f)for(var p=0;p<f.length;p++)g=
b.extend(!0,{},f[p]),null==g.field&&null!=g.name&&(console.log("NOTICE: form field.name property is deprecated, please use field.field. Field ->",g),g.field=g.name),k.fields[p]=g;for(p in c)b.isPlainObject(c[p])?k.record[p]=b.extend(!0,{},c[p]):k.record[p]=c[p];for(p in e)b.isPlainObject(e[p])?k.original[p]=b.extend(!0,{},e[p]):k.original[p]=e[p];0<d.length&&(k.box=d[0]);""!==k.formURL?b.get(k.formURL,function(a){k.formHTML=a;k.isGenerated=!0;if(0!==b(k.box).length||0!==a.length)b(k.box).html(a),
k.render(k.box)}):""===k.formHTML&&(0!==b(this).length&&""!==b.trim(b(this).html())?k.formHTML=b(this).html():k.formHTML=k.generateHTML());w2ui[k.name]=k;""===k.formURL&&(-1===String(k.formHTML).indexOf("w2ui-page")&&(k.formHTML='<div class="w2ui-page page-0" style="'+(k.pageStyle||"")+'">'+k.formHTML+"</div>"),b(k.box).html(k.formHTML),k.isGenerated=!0,k.render(k.box));return k}}else return d=w2ui[b(this).attr("name")],d?0<arguments.length?(d[a]&&d[a].apply(d,Array.prototype.slice.call(arguments,
1)),this):d:null};l.prototype={onRequest:null,onLoad:null,onValidate:null,onSubmit:null,onProgress:null,onSave:null,onChange:null,onInput:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onAction:null,onToolbar:null,onError:null,msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Loading...",msgSaving:"Saving...",get:function(a,b){if(0===arguments.length){for(var c=[],d=0;d<this.fields.length;d++)null!=this.fields[d].field&&
c.push(this.fields[d].field);return c}for(c=0;c<this.fields.length;c++)if(this.fields[c].field==a)return!0===b?c:this.fields[c];return null},set:function(a,d){for(var c=0;c<this.fields.length;c++)if(this.fields[c].field==a)return b.extend(this.fields[c],d),this.refresh(a),!0;return!1},getValue:function(a){if(this.nestedFields){var b=void 0;try{var c=this.record;b=String(a).split(".").reduce(function(a,b){return a[b]},c)}catch(e){}return b}return this.record[a]},setValue:function(a,b){if(this.nestedFields)try{var c=
this.record;String(a).split(".").map(function(a,d,g){g.length-1!==d?(c[a]||(c[a]={}),c=c[a]):c[a]=b});return!0}catch(e){return!1}else return this.record[a]=b,!0},show:function(){for(var a=[],b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&c.hidden&&(c.hidden=!1,a.push(c.field))}0<a.length&&this.refresh.apply(this,a);return a.length},hide:function(){for(var a=[],b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&!c.hidden&&(c.hidden=!0,a.push(c.field))}0<a.length&&this.refresh.apply(this,
a);return a.length},enable:function(){for(var a=[],b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&c.disabled&&(c.disabled=!1,a.push(c.field))}0<a.length&&this.refresh.apply(this,a);return a.length},disable:function(){for(var a=[],b=0;b<arguments.length;b++){var c=this.get(arguments[b]);c&&!c.disabled&&(c.disabled=!0,a.push(c.field))}0<a.length&&this.refresh.apply(this,a);return a.length},change:function(){Array.from(arguments).forEach(function(a){a=this.get(a);a.$el&&a.$el.change()}.bind(this))},
reload:function(a){("object"!==typeof this.url?this.url:this.url.get)&&0!==this.recid&&null!=this.recid?this.request(a):"function"===typeof a&&a()},clear:function(){0!=arguments.length?Array.from(arguments).forEach(function(a){var b=this.record;String(a).split(".").map(function(a,d,f){f.length-1!==d?b=b[a]:delete b[a]});this.refresh(a)}.bind(this)):(this.recid=0,this.record={},this.original=null,this.refresh());b().w2tag()},error:function(a){var d=this,c=this.trigger({target:this.name,type:"error",
message:a,xhr:this.last.xhr});!0===c.isCancelled?"function"===typeof callBack&&callBack():(setTimeout(function(){d.message(a)},1),this.trigger(b.extend(c,{phase:"after"})))},message:function(a){"string"===typeof a&&(a={width:300>a.length?350:550,height:300>a.length?170:250,body:'<div class="w2ui-centered">'+a+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(a){setTimeout(function(){b(a.box).find(".w2ui-btn").focus()},25)}});w2utils.message.call(this,
{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},a)},validate:function(a){null==a&&(a=!0);b().w2tag();for(var d=[],c=0;c<this.fields.length;c++){var e=this.fields[c];null==this.getValue(e.field)&&this.setValue(e.field,"");switch(e.type){case "int":this.getValue(e.field)&&!w2utils.isInt(this.getValue(e.field))&&d.push({field:e,error:w2utils.lang("Not an integer")});break;case "float":this.getValue(e.field)&&!w2utils.isFloat(this.getValue(e.field))&&d.push({field:e,
error:w2utils.lang("Not a float")});break;case "money":this.getValue(e.field)&&!w2utils.isMoney(this.getValue(e.field))&&d.push({field:e,error:w2utils.lang("Not in money format")});break;case "color":case "hex":this.getValue(e.field)&&!w2utils.isHex(this.getValue(e.field))&&d.push({field:e,error:w2utils.lang("Not a hex number")});break;case "email":this.getValue(e.field)&&!w2utils.isEmail(this.getValue(e.field))&&d.push({field:e,error:w2utils.lang("Not a valid email")});break;case "checkbox":1==this.getValue(e.field)?
this.setValue(e.field,1):this.setValue(e.field,0);break;case "date":e.options.format||(e.options.format=w2utils.settings.dateFormat),this.getValue(e.field)&&!w2utils.isDate(this.getValue(e.field),e.options.format)&&d.push({field:e,error:w2utils.lang("Not a valid date")+": "+e.options.format})}var f=this.getValue(e.field);e.required&&!0!==e.hidden&&-1==["div","custom","html","empty"].indexOf(e.type)&&(""===f||b.isArray(f)&&0===f.length||b.isPlainObject(f)&&b.isEmptyObject(f))&&d.push({field:e,error:w2utils.lang("Required field")});
e.options&&!0!==e.hidden&&0<e.options.minLength&&-1==["enum","list","combo"].indexOf(e.type)&&this.getValue(e.field).length<e.options.minLength&&d.push({field:e,error:w2utils.lang("Field should be at least "+e.options.minLength+" characters.")})}c=this.trigger({phase:"before",target:this.name,type:"validate",errors:d});if(!0!==c.isCancelled)return this.last.errors=d,a&&this.showErrors(),this.trigger(b.extend(c,{phase:"after"})),d},showErrors:function(){var a=this.last.errors;if(0<a.length){var d=
a[0];this.goto(a[0].field.page);b(d.field.$el).parents(".w2ui-field")[0].scrollIntoView(!0);for(var c=0;c<a.length;c++){d=a[c];var e=b.extend({"class":"w2ui-error",hideOnFocus:!0},d.options);null!=d.field&&("radio"===d.field.type?b(b(d.field.el).closest("div")[0]).w2tag(d.error,e):-1!==["enum","file"].indexOf(d.field.type)?function(a){setTimeout(function(){var c=b(a.field.el).data("w2field").helpers.multi;b(a.field.el).w2tag(a.error,a.options);b(c).addClass("w2ui-error")},1)}(d):b(d.field.el).w2tag(d.error,
e))}setTimeout(function(){var c=a[0];b(c.field.$el).parents(".w2ui-page").off(".hideErrors").on("scroll.hideErrors",function(d){for(d=0;d<a.length;d++)c=a[d],b(c.field.el).w2tag();b(c.field.$el).parents(".w2ui-page").off(".hideErrors")})},300)}},getChanges:function(){function a(c,d,f){for(var e in c)"object"===typeof c[e]?(f[e]=a(c[e],d[e]||{},{}),(!f[e]||b.isEmptyObject(f[e])&&b.isEmptyObject(d[e]))&&delete f[e]):c[e]!=d[e]&&(f[e]=c[e]);return f}var d={};null==this.original||"object"!=typeof this.original||
b.isEmptyObject(this.record)||(d=a(this.record,this.original,{}));return d},getCleanRecord:function(a){var d=b.extend(!0,{},this.record);this.fields.forEach(function(a){if(-1!=["list","combo","enum"].indexOf(a.type)){var c={nestedFields:!0,record:d},f=this.getValue.call(c,a.field);b.isPlainObject(f)&&f.id&&this.setValue.call(c,a.field,f.id);Array.isArray(f)&&f.forEach(function(a,c){b.isPlainObject(a)&&a.id&&(f[c]=a.id)})}"map"==a.type&&(c={nestedFields:!0,record:d},f=this.getValue.call(c,a.field),
f._order&&delete f._order)}.bind(this));!0===a&&Object.keys(d).forEach(function(a){this.get(a)||delete d[a]}.bind(this));return d},request:function(a,d){var c=this;"function"===typeof a&&(d=a,a=null);null==a&&(a={});if(this.url&&("object"!==typeof this.url||this.url.get)){null==this.recid&&(this.recid=0);var e={cmd:"get"};e.recid=this.recid;e.name=this.name;b.extend(e,this.postData);b.extend(e,a);a=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:e,httpHeaders:this.httpHeaders});
if(!0===a.isCancelled)"function"===typeof d&&d({status:"error",message:"Request aborted."});else{this.record={};this.original=null;this.lock(w2utils.lang(this.msgRefresh));e=a.url;"object"===typeof a.url&&a.url.get&&(e=a.url.get);if(this.last.xhr)try{this.last.xhr.abort()}catch(h){}if(!b.isEmptyObject(c.routeData)){var f=w2utils.parseRoute(e);if(0<f.keys.length)for(var g=0;g<f.keys.length;g++)null!=c.routeData[f.keys[g].name]&&(e=e.replace(new RegExp(":"+f.keys[g].name,"g"),c.routeData[f.keys[g].name]))}e=
{type:"POST",url:e,data:a.postData,headers:a.httpHeaders,dataType:"text"};f=c.dataType||w2utils.settings.dataType;a.dataType&&(f=a.dataType);switch(f){case "HTTP":e.data=String(b.param(e.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case "HTTPJSON":e.data={request:JSON.stringify(e.data)};break;case "RESTFULL":e.type="GET";e.data=String(b.param(e.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case "RESTFULLJSON":e.type="GET";e.data=JSON.stringify(e.data);e.contentType="application/json";
break;case "JSON":e.type="POST",e.data=JSON.stringify(e.data),e.contentType="application/json"}this.method&&(e.type=this.method);a.method&&(e.type=a.method);this.last.xhr=b.ajax(e).done(function(a,e,f){c.unlock();var g=f.responseText;if("error"!==e&&null!=g&&""!==g){if("object"===typeof g)a=g;else try{eval("data = "+g)}catch(p){}null==a&&(a={status:"error",message:w2utils.lang(c.msgNotJSON),responseText:g})}a=c.trigger({phase:"before",target:c.name,type:"load",data:a,xhr:f});!0===a.isCancelled?"function"===
typeof d&&d({status:"error",message:"Request aborted."}):("error"!==e?"error"===a.data.status?c.error(w2utils.lang(a.data.message)):c.record=b.extend({},a.data.record):(c.error("AJAX Error "+f.status+": "+f.statusText),a.data={status:"error",message:w2utils.lang(c.msgAJAXerror),responseText:g}),c.trigger(b.extend(a,{phase:"after"})),c.refresh(),c.applyFocus(),"function"===typeof d&&d(a.data))}).fail(function(a,d,e){e=c.trigger({phase:"before",type:"error",error:{status:d,error:e,rawResponseText:a.responseText},
xhr:a});if(!0!==e.isCancelled){if("abort"!==d){try{var f=b.parseJSON(a.responseText)}catch(p){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"===typeof f?f:a.responseText);c.unlock()}c.trigger(b.extend(e,{phase:"after"}))}});this.trigger(b.extend(a,{phase:"after"}))}}},submit:function(a,b){return this.save(a,b)},save:function(a,d){var c=this;b(this.box).find(":focus").change();
"function"===typeof a&&(d=a,a=null);0===c.validate(!0).length&&(null==a&&(a={}),!c.url||"object"===typeof c.url&&!c.url.save?console.log("ERROR: Form cannot be saved because no url is defined."):(c.lock(w2utils.lang(c.msgSaving)+' <span id="'+c.name+'_progress"></span>'),setTimeout(function(){var e={cmd:"save"};e.recid=c.recid;e.name=c.name;b.extend(e,c.postData);b.extend(e,a);c.multipart||c.fields.forEach(function(a){"file"===a.type&&Array.isArray(c.getValue(a.field))&&c.getValue(a.field).forEach(function(a){delete a.file})});
e.record=b.extend(!0,{},c.record);e=c.trigger({phase:"before",type:"submit",target:c.name,url:c.url,postData:e,httpHeaders:c.httpHeaders});if(!0!==e.isCancelled){var f=e.url;"object"===typeof e.url&&e.url.save&&(f=e.url.save);if(c.last.xhr)try{c.last.xhr.abort()}catch(n){}if(!b.isEmptyObject(c.routeData)){var g=w2utils.parseRoute(f);if(0<g.keys.length)for(var h=0;h<g.keys.length;h++)null!=c.routeData[g.keys[h].name]&&(f=f.replace(new RegExp(":"+g.keys[h].name,"g"),c.routeData[g.keys[h].name]))}f=
{type:"POST",url:f,data:e.postData,headers:e.httpHeaders,dataType:"text",xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){if(a.lengthComputable){var d=c.trigger({phase:"before",type:"progress",total:a.total,loaded:a.loaded,originalEvent:a});!0!==d.isCancelled&&(((a=Math.round(a.loaded/a.total*100))&&100!=a||""!=b("#"+c.name+"_progress").text())&&b("#"+c.name+"_progress").text(""+a+"%"),c.trigger(b.extend(d,{phase:"after"})))}},!1);return a}};g=c.dataType||
w2utils.settings.dataType;e.dataType&&(g=e.dataType);switch(g){case "HTTP":f.data=String(b.param(f.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case "HTTPJSON":f.data={request:JSON.stringify(f.data)};break;case "RESTFULL":0!==c.recid&&null!=c.recid&&(f.type="PUT");f.data=String(b.param(f.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case "RESTFULLJSON":0!==c.recid&&null!=c.recid&&(f.type="PUT");f.data=JSON.stringify(f.data);f.contentType="application/json";break;case "JSON":if(f.type=
"POST",f.contentType="application/json",c.multipart){var k=function(a,b,c,d){function e(b,c,d){"object"===typeof b&&b instanceof File&&a.append(d,b);if("object"===typeof b)if(b&&b.constructor===Array)for(var f=0;f<b.length;f++)e(b[f],c?c[f]:c,d+"["+f+"]");else k(a,b,c,d)}null==d&&(d="");for(var f in b)e(b[f],c?c[f]:c,""==d?f:"${p}[${prop}]")};g=new FormData;g.append("__body",JSON.stringify(f.data));k(g,f.data);f.data=g;f.contentType=!1;f.processData=!1}else f.data=JSON.stringify(f.data)}this.method&&
(f.type=this.method);e.method&&(f.type=e.method);c.last.xhr=b.ajax(f).done(function(a,e,f){c.unlock();var g=c.trigger({phase:"before",target:c.name,type:"save",xhr:f,status:e,data:a});if(!0!==g.isCancelled){var h=f.responseText;if("error"!==e){if(null!=h&&""!==h){if("object"===typeof h)a=h;else try{eval("data = "+h)}catch(t){}null==a&&(a={status:"error",message:w2utils.lang(c.msgNotJSON),responseText:h});"error"===a.status?c.error(w2utils.lang(a.message)):c.original=null}}else c.error("AJAX Error "+
f.status+": "+f.statusText),a={status:"error",message:w2utils.lang(c.msgAJAXerror),responseText:h};c.trigger(b.extend(g,{phase:"after"}));c.refresh();"function"===typeof d&&d(a,f)}}).fail(function(a,d,e){d={status:d,error:e,rawResponseText:a.responseText};a=c.trigger({phase:"before",type:"error",error:d,xhr:a});!0!==a.isCancelled&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",
d),c.unlock(),c.trigger(b.extend(a,{phase:"after"})))});c.trigger(b.extend(e,{phase:"after"}))}},50)))},lock:function(a,b){var c=Array.prototype.slice.call(arguments,0);c.unshift(this.box);setTimeout(function(){w2utils.lock.apply(window,c)},10)},unlock:function(a){var b=this.box;setTimeout(function(){w2utils.unlock(b,a)},25)},lockPage:function(a,d){a=b(this.box).find(".page-"+a);return a.length?(w2utils.lock(a,d),!0):!1},unlockPage:function(a,d){a=b(this.box).find(".page-"+a);return a.length?(w2utils.unlock(a,
d),!0):!1},goto:function(a){this.page!==a&&(null!=a&&(this.page=a),!0===b(this.box).data("auto-size")&&b(this.box).height(0),this.refresh())},generateHTML:function(){for(var a=[],d="",c,e,f,g,h,k=0;k<this.fields.length;k++){f="";g=this.tabindexBase+k+1;h=' tabindex="'+g+'"';g=this.fields[k];null==g.html&&(g.html={});null==g.options&&(g.options={});null!=g.html.caption&&null==g.html.label&&(console.log("NOTICE: form field.html.caption property is deprecated, please use field.html.label. Field ->",
g),g.html.label=g.html.caption);null==g.html.label&&(g.html.label=g.field);g.html=b.extend(!0,{label:"",span:6,attr:"",text:"",style:"",page:0,column:0},g.html);null==c&&(c=g.html.page);null==e&&(e=g.html.column);var l='<input id="'+g.field+'" name="'+g.field+'" class="w2ui-input" type="text" '+g.html.attr+h+">";switch(g.type){case "pass":case "password":l='<input id="'+g.field+'" name="'+g.field+'" class="w2ui-input" type = "password" '+g.html.attr+h+">";break;case "check":case "checks":null==g.options.items&&
null!=g.html.items&&(g.options.items=g.html.items);var m=g.options.items;l="";b.isArray(m)||(m=[]);0<m.length&&(m=w2obj.field.prototype.normMenu.call(this,m,g));for(var p=0;p<m.length;p++)l+='<label style="user-select: none">  <input id="'+g.field+p+'" name="'+g.field+'" class="w2ui-input" type="checkbox" '+g.html.attr+(0===p?h:"")+' data-value="'+m[p].id+'" data-index="'+p+'">&#160;'+m[p].text+"</label><br>";break;case "checkbox":l='<label>   <input id="'+g.field+'" name="'+g.field+'" style="float: left" class="w2ui-input" type="checkbox" '+
g.html.attr+h+'>   <div style="margin: 6px 0 0 20px; user-select: none;">'+g.html.label+"</div></label>";break;case "radio":l="";null==g.options.items&&null!=g.html.items&&(g.options.items=g.html.items);m=g.options.items;b.isArray(m)||(m=[]);0<m.length&&(m=w2obj.field.prototype.normMenu.call(this,m,g));for(p=0;p<m.length;p++)l+='<label style="user-select: none">  <input id="'+g.field+p+'" name="'+g.field+'" class="w2ui-input" type = "radio" '+g.html.attr+(0===p?h:"")+' value="'+m[p].id+'">&#160;'+
m[p].text+"</label><br>";break;case "select":l='<select id="'+g.field+'" name="'+g.field+'" class="w2ui-input" '+g.html.attr+h+">";null==g.options.items&&null!=g.html.items&&(g.options.items=g.html.items);m=g.options.items;b.isArray(m)||(m=[]);0<m.length&&(m=w2obj.field.prototype.normMenu.call(this,m,g));for(p=0;p<m.length;p++)l+='<option value="'+m[p].id+'">'+m[p].text+"</option>";l+="</select>";break;case "textarea":l='<textarea id="'+g.field+'" name="'+g.field+'" class="w2ui-input" '+g.html.attr+
h+"></textarea>";break;case "toggle":l='<input id="'+g.field+'" name="'+g.field+'" type="checkbox" '+g.html.attr+h+' class="w2ui-input w2ui-toggle"><div><div></div></div>';break;case "map":case "array":g.html.key=g.html.key||{};g.html.value=g.html.value||{};g.html.tabindex_str=h;l='<span style="float: right">'+(g.html.text||"")+'</span><input id="'+g.field+'" name="'+g.field+'" type="hidden" '+g.html.attr+h+'><div class="w2ui-map-container"></div>';break;case "html":case "div":case "custom":l='<div id="'+
g.field+'" name="'+g.field+'" '+g.html.attr+h+">"+(g&&g.html&&g.html.html?g.html.html:"")+"</div>"}""!==d&&(c!=g.html.page||e!=g.html.column||g.html.group&&d!=g.html.group)&&(a[c][e]+="\n   </div>",d="");g.html.group&&d!=g.html.group&&(d="",g.html.groupCollapsable&&(d='<span class="w2ui-icon-collapse" style="width: 15px; display: inline-block; position: relative; top: -2px;"></span>'),f+='\n   <div class="w2ui-group-title" '+(""!=d?'data-group="'+w2utils.base64encode(g.html.group)+'"':"")+(""!=d?
'style="cursor: pointer"':"")+(""!=d?"onclick=\"w2ui['"+this.name+"'].toggleGroup('"+g.html.group+"')\"":"")+">"+d+g.html.group+'</div>\n   <div class="w2ui-group" style="'+(g.html.groupStyle||"")+'">',d=g.html.group);null==g.html.anchor?(c=null!=g.html.span?"w2ui-span"+g.html.span:"",-1==g.html.span&&(c="w2ui-span-none"),f+='\n      <div class="w2ui-field '+c+'" style="'+(g.hidden?"display: none;":"")+g.html.style+'">\n         <label'+("none"==c?' style="display: none"':"")+">"+w2utils.lang("checkbox"!=
g.type?g.html.label:g.html.text)+"</label>"+("empty"===g.type?"":"\n         <div>"+l+("array"!=g.type&&"map"!=g.type?w2utils.lang("checkbox"!=g.type?g.html.text:""):"")+"</div>")+"\n      </div>"):(a[g.html.page].anchors=a[g.html.page].anchors||{},a[g.html.page].anchors[g.html.anchor]='<div class="w2ui-field w2ui-field-inline" style="'+(g.hidden?"display: none;":"")+g.html.style+'">'+("empty"===g.type?"":"<div>"+w2utils.lang("checkbox"!=g.type?g.html.label:g.html.text)+l+w2utils.lang("checkbox"!=
g.type?g.html.text:"")+"</div>")+"</div>");null==a[g.html.page]&&(a[g.html.page]={});null==a[g.html.page][g.html.column]&&(a[g.html.page][g.html.column]="");a[g.html.page][g.html.column]+=f;c=g.html.page;e=g.html.column}""!==d&&(a[c][e]+="\n   </div>");if(this.tabs.tabs)for(p=0;p<this.tabs.tabs.length;p++)null==a[p]&&(a[p]=[]);k="";if(!b.isEmptyObject(this.actions)){k+='\n<div class="w2ui-buttons">';g=this.tabindexBase+this.fields.length+1;for(var v in this.actions)d=this.actions[v],l={text:"",style:"",
"class":""},b.isPlainObject(d)?(null==d.text&&null!=d.caption&&(console.log("NOTICE: form action.caption property is deprecated, please use action.text. Action ->",d),d.text=d.caption),d.text&&(l.text=d.text),d.style&&(l.style=d.style),d["class"]&&(l["class"]=d["class"])):(l.text=v,-1!==["save","update","create"].indexOf(v.toLowerCase())?l["class"]="w2ui-btn-blue":l["class"]=""),k+='\n    <button name="'+v+'" class="w2ui-btn '+l["class"]+'" style="'+l.style+'" tabindex="'+g+'">'+w2utils.lang(l.text)+
"</button>",g++;k+="\n</div>"}f="";for(var r=0;r<a.length;r++)f+='<div class="w2ui-page page-'+r+'" style="'+(0!==r?"display: none;":"")+this.pageStyle+'">',a[r].before&&(f+=a[r].before),f+='<div class="w2ui-column-container">',Object.keys(a[r]).sort().forEach(function(b,c){b==parseInt(b)&&(f+='<div class="w2ui-column col-'+b+'">'+(a[r][b]||"")+"\n</div>")}),f+="\n</div>",a[r].after&&(f+=a[r].after),f+="\n</div>",a[r].anchors&&Object.keys(a[r].anchors).forEach(function(b,c){f=f.replace(b,a[r].anchors[b])});
return f+=k},toggleGroup:function(a,d){var c=b(this.box).find('.w2ui-group-title[data-group="'+w2utils.base64encode(a)+'"]');if("none"==c.next().css("display")&&!0!==d)c.next().slideDown(300),c.next().next().remove(),c.find("span").addClass("w2ui-icon-collapse").removeClass("w2ui-icon-expand");else{c.next().slideUp(300);var e="width: "+c.next().css("width")+";padding-left: "+c.next().css("padding-left")+";padding-right: "+c.next().css("padding-right")+";margin-left: "+c.next().css("margin-left")+
";margin-right: "+c.next().css("margin-right")+";";setTimeout(function(){c.next().after('<div style="height: 5px;'+e+'"></div>')},100);c.find("span").addClass("w2ui-icon-expand").removeClass("w2ui-icon-collapse")}},action:function(a,d){var c=this.actions[a],e=c;b.isPlainObject(c)&&c.onClick&&(e=c.onClick);a=this.trigger({phase:"before",target:a,type:"action",action:c,originalEvent:d});!0!==a.isCancelled&&("function"===typeof e&&e.call(this,d),this.trigger(b.extend(a,{phase:"after"})))},resize:function(){function a(){e.width(b(d.box).width()).height(b(d.box).height());
g.css("top",""!==d.header?w2utils.getSize(f,"height"):0);h.css("top",(""!==d.header?w2utils.getSize(f,"height"):0)+("object"===typeof d.toolbar&&b.isArray(d.toolbar.items)&&0<d.toolbar.items.length?w2utils.getSize(g,"height"):0));k.css("top",(""!==d.header?w2utils.getSize(f,"height"):0)+("object"===typeof d.toolbar&&b.isArray(d.toolbar.items)&&0<d.toolbar.items.length?w2utils.getSize(g,"height")+5:0)+("object"===typeof d.tabs&&b.isArray(d.tabs.tabs)&&0<d.tabs.tabs.length?w2utils.getSize(h,"height")+
5:0));k.css("bottom",0<p.length?w2utils.getSize(p,"height"):0)}var d=this,c=this.trigger({phase:"before",target:this.name,type:"resize"});if(!0!==c.isCancelled){var e=b(this.box).find("> div.w2ui-form-box"),f=b(this.box).find("> div .w2ui-form-header"),g=b(this.box).find("> div .w2ui-form-toolbar"),h=b(this.box).find("> div .w2ui-form-tabs"),k=b(this.box).find("> div .w2ui-page"),l=b(this.box).find("> div .w2ui-page.page-"+this.page),m=b(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),
p=b(this.box).find("> div .w2ui-buttons");a();if(this.autosize){if(0===parseInt(b(this.box).height())||!0===b(this.box).data("auto-size"))b(this.box).height((0<f.length?w2utils.getSize(f,"height"):0)+("object"===typeof this.tabs&&b.isArray(this.tabs.tabs)&&0<this.tabs.tabs.length?w2utils.getSize(h,"height"):0)+("object"===typeof this.toolbar&&b.isArray(this.toolbar.items)&&0<this.toolbar.items.length?w2utils.getSize(g,"height"):0)+(0<k.length?w2utils.getSize(m,"height")+w2utils.getSize(l,"+height")+
12:0)+(0<p.length?w2utils.getSize(p,"height"):0)),b(this.box).data("auto-size",!0);a()}this.toolbar&&this.toolbar.resize&&this.toolbar.resize();this.tabs&&this.tabs.resize&&this.tabs.resize();d.trigger(b.extend(c,{phase:"after"}))}},refresh:function(){var a=(new Date).getTime(),d=this;if(this.box&&this.isGenerated&&null!=b(this.box).html()){var c=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:g,fields:arguments});if(!0!==c.isCancelled){var e=Array.from(this.fields.keys());
0<arguments.length?e=Array.from(arguments).map(function(a,b){"string"!=typeof a&&console.log("ERROR: Arguments in refresh functions should be field names");return this.get(a,!0)}.bind(this)).filter(function(a,b){return null!=a?!0:!1}):(b(this.box).find("input, textarea, select").each(function(a,c){a=null!=b(c).attr("name")?b(c).attr("name"):b(c).attr("id");if(a=d.get(a))if(c=b(c).closest(".w2ui-page"),0<c.length)for(var e=0;100>e;e++)if(c.hasClass("page-"+e)){a.page=e;break}}),b(this.box).find(".w2ui-page").hide(),
b(this.box).find(".w2ui-page.page-"+this.page).show(),b(this.box).find(".w2ui-form-header").html(this.header),"object"===typeof this.tabs&&b.isArray(this.tabs.tabs)&&0<this.tabs.tabs.length?(b("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):b("#form_"+this.name+"_tabs").hide(),"object"===typeof this.toolbar&&b.isArray(this.toolbar.items)&&0<this.toolbar.items.length?(b("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):b("#form_"+this.name+
"_toolbar").hide());for(var f=0;f<e.length;f++){var g=this.fields[e[f]];null==g.name&&null!=g.field&&(g.name=g.field);null==g.field&&null!=g.name&&(g.field=g.name);g.$el=b(this.box).find('[name="'+String(g.name).replace(/\\/g,"\\\\")+'"]');g.el=g.$el[0];g.el&&(g.el.id=g.name);var h=b(g).data("w2field");h&&h.clear();b(g.$el).off(".w2form").on("change.w2form",function(a){var c=d.get(this.name);if(null!=c){var e=this.value,f=d.getValue(this.name);null==f&&(f="");if(-1!==["list","enum","file"].indexOf(c.type)&&
b(this).data("selected")){var g=b(this).data("selected"),h=d.getValue(this.name);if(b.isArray(g)){e=[];for(var k=0;k<g.length;k++)e[k]=b.extend(!0,{},g[k])}b.isPlainObject(g)&&(e=b.extend(!0,{},g));if(b.isArray(h))for(f=[],k=0;k<h.length;k++)f[k]=b.extend(!0,{},h[k]);b.isPlainObject(h)&&(f=b.extend(!0,{},h))}-1!==["toggle","checkbox"].indexOf(c.type)&&(e=b(this).prop("checked")?"on"===b(this).prop("value")?!0:b(this).prop("value"):!1);-1!==["check","checks"].indexOf(c.type)&&(Array.isArray(f)||(f=
[]),e=f.slice(),g=c.options.items[b(this).attr("data-index")],b(this).prop("checked")?e.push(g.id):e.splice(e.indexOf(g.id),1));-1!==["int","float","percent","money","currency"].indexOf(c.type)&&(e=b(this).data("w2field").clean(e));if(e!==f)if(a=d.trigger({phase:"before",target:this.name,type:"change",value_new:e,value_previous:f,originalEvent:a}),!0===a.isCancelled)b(this).val(d.getValue(this.name));else{e=a.value_new;-1!==["enum","file"].indexOf(c.type)&&0<e.length&&(c=b(c.el).data("w2field").helpers.multi,
b(c).removeClass("w2ui-error"));if(""===e||null==e||b.isArray(e)&&0===e.length||b.isPlainObject(e)&&b.isEmptyObject(e))e=null;d.setValue(this.name,e);d.trigger(b.extend(a,{phase:"after"}))}}}).on("input.w2form",function(a){var c=this.value;"checkbox"==a.target.type&&(c=a.target.checked);null==d.original&&(b.isEmptyObject(d.record)?d.original={}:d.original=b.extend(!0,{},d.record));a=d.trigger({phase:"before",target:this.name,type:"input",value_new:c,originalEvent:a});!0!==a.isCancelled&&d.trigger(b.extend(a,
{phase:"after"}))});g.required?b(g.el).parent().parent().addClass("w2ui-required"):b(g.el).parent().parent().removeClass("w2ui-required");null!=g.disabled&&(h=b(g.el),g.disabled?(null==h.data("w2ui-tabIndex")&&h.data("w2ui-tabIndex",h.prop("tabIndex")),b(g.el).prop("readonly",!0).prop("tabindex",-1).closest(".w2ui-field").addClass("w2ui-disabled")):b(g.el).prop("readonly",!1).prop("tabIndex",h.data("w2ui-tabIndex")).closest(".w2ui-field").removeClass("w2ui-disabled"));(h=g.el)||(h=b(this.box).find("#"+
g.field));g.hidden?b(h).closest(".w2ui-field").hide():b(h).closest(".w2ui-field").show()}b(this.box).find("button, input[type=button]").each(function(a,c){b(c).off("click").on("click",function(a){var b=this.value;this.id&&(b=this.id);this.name&&(b=this.name);d.action(b,a)})});for(f=0;f<e.length;f++){g=this.fields[e[f]];var k=null!=this.getValue(g.name)?this.getValue(g.name):"";if(g.el)switch(b(g.el).hasClass("w2ui-input")||b(g.el).addClass("w2ui-input"),g.type=String(g.type).toLowerCase(),g.options||
(g.options={}),g.type){case "text":case "textarea":case "email":case "pass":case "password":g.el.value=k;break;case "int":case "float":case "money":case "currency":case "percent":g.el.value=k;b(g.el).w2field(b.extend({},g.options,{type:g.type}));break;case "hex":case "alphanumeric":case "color":case "date":case "time":g.el.value=k;b(g.el).w2field(b.extend({},g.options,{type:g.type}));break;case "toggle":w2utils.isFloat(k)&&(k=parseFloat(k));b(g.el).prop("checked",k?!0:!1);this.setValue(g.name,k?k:
!1);break;case "radio":b(g.$el).prop("checked",!1).each(function(a,c){b(c).val()==k&&b(c).prop("checked",!0)});break;case "checkbox":b(g.el).prop("checked",k?!0:!1);!0!==g.disabled&&!1!==g.disabled||b(g.el).prop("disabled",g.disabled?!0:!1);break;case "check":case "checks":Array.isArray(k)&&k.forEach(function(a){b(g.el).closest("div").find('[data-value="'+a+'"]').prop("checked",!0)});g.disabled?b(g.el).closest("div").find("input[type=checkbox]").prop("disabled",!0):b(g.el).closest("div").find("input[type=checkbox]").removeProp("disabled");
break;case "list":case "combo":if("list"===g.type){var l=b.isPlainObject(k)?k.id:b.isPlainObject(g.options.selected)?g.options.selected.id:k;g.options.items||(g.options.items=[]);h=g.options.items;"function"==typeof h&&(h=h());var m=!1;if(Array.isArray(h))for(var p=0;p<h.length;p++){var v=h[p];if(v.id==l){k=b.extend(!0,{},v);d.setValue(g.name,k);m=!0;break}}m||null==k||""===k||g.$el.data("find_selected",k)}else"combo"!==g.type||b.isPlainObject(k)?b.isPlainObject(k)&&null!=k.text?g.el.value=k.text:
g.el.value="":g.el.value=k;b.isPlainObject(k)||(k={});b(g.el).w2field(b.extend({},g.options,{type:g.type,selected:k}));break;case "enum":case "file":var r=[];m=!1;b.isArray(k)||(k=[]);"function"!=typeof g.options.items&&(b.isArray(g.options.items)||(g.options.items=[]),k.forEach(function(a){g.options.items.forEach(function(c){c&&(c.id==a||b.isPlainObject(a)&&c.id==a.id)&&(r.push(b.isPlainObject(c)?b.extend(!0,{},c):c),m=!0)})}));m||null==k||0===k.length||(g.$el.data("find_selected",k),r=k);var t=
b.extend({},g.options,{type:g.type,selected:r});Object.keys(g.options).forEach(function(a){"function"==typeof g.options[a]&&(t[a]=g.options[a])});b(g.el).w2field(t);break;case "select":h=g.options.items;if(null!=h&&0<h.length)for(h=w2obj.field.prototype.normMenu.call(this,h,g),b(g.el).html(""),p=0;p<h.length;p++)b(g.el).append('<option value="'+h[p].id+'">'+h[p].text+"</option");b(g.el).val(k);break;case "map":case "array":"map"!=g.type||null!=k&&b.isPlainObject(k)||(this.setValue(g.field,{}),k=this.getValue(g.field));
"array"!=g.type||null!=k&&Array.isArray(k)||(this.setValue(g.field,[]),k=this.getValue(g.field));(function(a,c){c.el.mapAdd=function(a,b,c){var d=(a.disabled?" readOnly ":"")+(a.html.tabindex_str||"");b.append('<div class="w2ui-map-field" style="margin-bottom: 5px"><input id="'+a.field+"_key_"+c+'" data-cnt="'+c+'" type="text" '+a.html.key.attr+d+' class="w2ui-input w2ui-map key">'+(a.html.key.text||"")+'<input id="'+a.field+"_value_"+c+'" data-cnt="'+c+'" type="text" '+a.html.value.attr+d+' class="w2ui-input w2ui-map value">'+
(a.html.value.text||"")+"</div>")};c.el.mapRefresh=function(d,e){var f=1;if("map"==c.type){b.isPlainObject(d)||(d={});null==d._order&&(d._order=Object.keys(d));var g=d._order}"array"==c.type&&(Array.isArray(d)||(d=[]),g=d.map(function(a){return a.key}));var h,k;g.forEach(function(a){h=e.find("#"+w2utils.escapeId(c.name)+"_key_"+f);k=e.find("#"+w2utils.escapeId(c.name)+"_value_"+f);if(0==h.length||0==k.length)c.el.mapAdd(c,e,f),h=e.find("#"+w2utils.escapeId(c.name)+"_key_"+f),k=e.find("#"+w2utils.escapeId(c.name)+
"_value_"+f);var b=d[a];if("array"==c.type){var g=d.filter(function(b){return b.key==a?!0:!1});0<g.length&&(b=g[0].value)}h.val(a);k.val(b);if(!0===c.disabled||!1===c.disabled)h.prop("readOnly",c.disabled?!0:!1),k.prop("readOnly",c.disabled?!0:!1);h.parents(".w2ui-map-field").attr("data-key",a);f++});g=e.find("#"+w2utils.escapeId(c.name)+"_key_"+f).parent();var l=e.find("#"+w2utils.escapeId(c.name)+"_key_"+(f+1)).parent();0!==g.length||h&&(!0===h.prop("readOnly")||!0===h.prop("disabled"))||c.el.mapAdd(c,
e,f);1==g.length&&1==l.length&&(g.removeAttr("data-key"),g.find(".key").val(l.find(".key").val()),g.find(".value").val(l.find(".value").val()),l.remove());if(!0===c.disabled||!1===c.disabled)g.find(".key").prop("readOnly",c.disabled?!0:!1),g.find(".value").prop("readOnly",c.disabled?!0:!1);b(c.el).next().find("input.w2ui-map").off(".mapChange").on("keyup.mapChange",function(a){var c=b(a.target).parents(".w2ui-map-field");13==a.keyCode&&c.next().find("input.key").focus()}).on("change.mapChange",function(){var f=
b(event.target).parents(".w2ui-map-field"),g=f.attr("data-key"),h=f.find(".key").val(),k=f.find(".value").val(),l={},m={},n=null,p=null;l[h]=k;"array"==c.type&&(d.forEach(function(a,b){a.key==g&&(p=b)}),n=d[p]);null!=g&&"map"==c.type&&(m[g]=d[g]);null!=g&&"array"==c.type&&(m[g]=n.value);l=a.trigger({phase:"before",target:c.field,type:"change",originalEvent:event,value_new:l,value_previous:m});if(!0!==l.isCancelled){if("map"==c.type)if(delete d[g],n=d._order.indexOf(g),""!=h){if(null!=d[h]){var q=
0;do q++,m=h+q;while(null!=d[m]);h=m;f.find(".key").val(m)}d[h]=k;f.attr("data-key",h);-1!=n?d._order[n]=h:d._order.push(h)}else d._order.splice(n,1),f.find(".value").val("");else"array"==c.type&&(""!=h?null==n?d.push({key:h,value:k}):(n.key=h,n.value=k):d.splice(p,1));a.setValue(c.field,d);c.el.mapRefresh(d,e);a.trigger(b.extend(l,{phase:"after"}))}})};c.el.mapRefresh(k,b(c.el).parent().find(".w2ui-map-container"))})(this,g);break;case "div":case "custom":b(g.el).html(k);break;case "html":case "empty":break;
default:b(g.el).val(k),b(g.el).w2field(b.extend({},g.options,{type:g.type}))}}h=b(this.box).find(".w2ui-page");for(p=0;p<h.length;p++)1<b(h[p]).find("> *").length&&b(h[p]).wrapInner("<div></div>");this.trigger(b.extend(c,{phase:"after"}));this.resize();return(new Date).getTime()-a}}},render:function(a){var d=(new Date).getTime(),c=this;"object"===typeof a&&(0<b(this.box).find("#form_"+this.name+"_tabs").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=a);
if(this.isGenerated&&this.box&&(a=this.trigger({phase:"before",target:this.name,type:"render",box:null!=a?a:this.box}),!0!==a.isCancelled)){var e='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>";b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(e);
0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);"function"!==typeof this.toolbar.render&&(this.toolbar=b().w2toolbar(b.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(a){a=c.trigger({phase:"before",type:"toolbar",target:a.target,originalEvent:a});!0!==a.isCancelled&&c.trigger(b.extend(a,{phase:"after"}))}));"object"===typeof this.toolbar&&"function"===typeof this.toolbar.render&&this.toolbar.render(b("#form_"+this.name+"_toolbar")[0]);
"function"!==typeof this.tabs.render&&(this.tabs=b().w2tabs(b.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",function(a){c.goto(this.get(a.target,!0))}));"object"===typeof this.tabs&&"function"===typeof this.tabs.render&&(this.tabs.render(b("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active));this.trigger(b.extend(a,{phase:"after"}));this.resize();("object"!==typeof this.url?this.url:this.url.get)&&0!==this.recid&&
null!=this.recid?this.request():this.refresh();0===b(".w2ui-layout").length&&(this.tmp_resize=function(a){null==w2ui[c.name]?b(window).off("resize.w2uiResize",c.tmp_resize):w2ui[c.name].resize()},b(window).off("resize.w2uiResize").on("resize.w2uiResize",c.tmp_resize));-1!=this.focus&&setTimeout(function(){0===b(c.box).find("input, select, textarea").length?setTimeout(focusEl,500):c.applyFocus()},50);return(new Date).getTime()-d}},applyFocus:function(){for(var a=this.focus,d=b(this.box).find("div:not(.w2ui-field-helper) > input, select, textarea, div > label:nth-child(1) > :radio").not(".file-input");b(d[a]).is(":hidden")&&
d.length>=a;)a++;d[a]&&d[a].focus()},destroy:function(){var a=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==a.isCancelled&&("object"===typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"===typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),0<b(this.box).find("#form_"+this.name+"_tabs").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})),b(window).off("resize",
"body"))}};b.extend(l.prototype,w2utils.event);w2obj.form=l})(jQuery);(function(b,l){if("function"==typeof define&&define.amd)return define(function(){return l});if("undefined"!=typeof exports){if("undefined"!=typeof module&&module.exports)return exports=module.exports=l;b=exports}for(var a in l)b[a]=l[a]})(this,{w2ui:w2ui,w2obj:w2obj,w2utils:w2utils,w2popup:w2popup,w2alert:w2alert,w2confirm:w2confirm,w2prompt:w2prompt});
